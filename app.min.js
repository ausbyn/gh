function Exception(e,t){return this.message=e,this.code=t,{getMessage:function(){return this.message},getCode:function(){return this.code}}}function ModelException(){void 0}function getPotentialFactoryName(e,t){t="ta"===t?"admin":t;var r="";return e=e.capitalize(),r+=e+"_",t=t.capitalize(),r+=t+"Override"}function findProvider(e){var t=!1;return angular.module("baiApp")._invokeQueue.forEach(function(r){var n=r[2][0];e===n&&(t=!0)}),t}function mapPageAndRoleToOverride(e,t,r,n){var o=getPotentialFactoryName(e,t),a=findProvider(o);if(a||(o=getPotentialFactoryName(e,"student"),a=findProvider(o)),a){var s=r.get(o);void 0,new s(n)}}function TypeMapsMixin(){}window.loggedin=!1,window.timeout=15e3;var app=angular.module("baiApp",["ngRoute","ngAnimate","ngCookies","ui.bootstrap","AngularPrint","ngMessages","ngMaterial","ngSanitize","dibari.angular-ellipsis","ngScrollbars","chart.js","ngTagsInput","ngTagsInput","ngFileUpload","mgo-angular-wizard","treeControl"]);app.config(["$compileProvider","$mdThemingProvider","$httpProvider","$routeProvider","$locationProvider","$rootScopeProvider",function(e,t,r,n,o,a){var s="";a.digestTtl(15),t.theme("default").primaryPalette("light-blue"),n.when("/",{templateUrl:function(){return"app/templates/users/login.html"},controller:function(){return"indexController"}}).when("/:controller/",{templateUrl:function(e){return s=e.controller,"app/templates/"+s+"/index.html"},controller:function(){return""===s.toString()&&(s="index"),s+"Controller"}}).when("/:controller/:name/",{templateUrl:function(e){var t=["catalog","search"];return s=e.controller,null===e.name&&(e.name="index"),jQuery.inArray(s,t)!==-1?"app/templates/"+s+"/mutable.html":"app/templates/"+s+"/"+e.name+".html"},controller:function(){return""===s.toString()&&(s="index"),s+"Controller"}}).when("/:controller/:name/:param*",{templateUrl:function(e){var t=["catalog","documents"];return s=e.controller,null===e.name&&(e.name="index"),jQuery.inArray(s,t)!==-1?"app/templates/"+s+"/mutable.html":"app/templates/"+s+"/"+e.name+".html"},controller:function(){return""===s.toString()&&(s="index"),s+"Controller"}}),o.html5Mode(!0),r.interceptors.push(["$q",function(e){return{response:function(e){return"undefined"!=typeof e.data.response&&(e.data=e.data.response),e},responseError:function(t){var r=t.data;return"undefined"!=typeof r&&null!==r&&"undefined"!=typeof r.message&&null!==r.message&&"undefined"==typeof r.ErrorMessage&&(r.ErrorMessage=r.message),"undefined"!=typeof r&&null!==r&&"undefined"!=typeof r.Message&&null!==r.Message&&"undefined"==typeof r.ErrorMessage&&(r.ErrorMessage=r.Message),null!==r&&"undefined"!=typeof r.ErrorMessage||(r={},r.ErrorCode=0,r.ErrorMessage="An unknown error has occurred. Please contact your organization's training administrator.","undefined"!=typeof window.Cookies.get("userRole")&&window.Cookies.get("userRole").indexOf("TA")>0&&(r.ErrorMessage="Time out error. Please try again. If the issue persists, please contact BAI Customer Support Services"),r.StatusCode=500),e.reject(r)}}}]),e.preAssignBindingsEnabled(!0)}]),app.run(["$rootScope","$location","$http","$window","CssService","UsersService","SettingsService","urlParamsUtil","popupcheckUtil","$templateRequest","$templateCache",function(e,t,r,n,o,a,s,i,u,l,c){a.setFromCookies();var d="";d+="<ul {{options.ulClass}}>",d+='    <li ng-repeat="node in node.{{options.nodeChildren}} | filter:filterExpression:filterComparator {{options.orderBy}} {{options.limitTo}}"',d+='     ng-class="headClass(node)"',d+="  {{options.liClass}}",d+="  set-node-to-data>",d+='       <div class="treeRow" ng-class="[selectedClass()]">',d+='         <div class="iconAndName">',d+='            <img ng-if="node.pencilIcon" width="16" height="16" ng-click="node.nodeClick(node); $event.stopPropagation()" ng-src="app/images/premiumAdmin/pencil_tool.svg" />',d+='            <img ng-if="node.lockIcon" width="16" height="16" src="app/images/premiumAdmin/lock.svg" />',d+="            <!--",d+="            Displays icons next to leaves.",d+="            -->",d+='            <div class="tree-label {{options.labelClass}}" ng-click="selectNodeLabel(node)" tree-transclude></div>',d+="         </div>",d+='            <i class="tree-branch-head openClose" ng-class="iBranchClass()" ng-click="selectNodeHead(node)">',d+='                <span ng-if="!nodeExpanded()">',d+="                +",d+="                </span>",d+='                <span ng-if="nodeExpanded()">',d+="                -",d+="                </span>",d+="            </i>",d+="        </div>",d+='        <treeitem ng-if="nodeExpanded()"></treeitem>',d+="    </li>",d+="</ul>",c.put("tree.html",d),e.checkCss=!0,e.resetCache=!0,e.videoShownThisSession=!1,e.sysSettings={},e.css="",e.cssDoneLoading=!1,e.$on("$locationChangeStart",function(r,n,i){var l=null,c="",d=null;a.isLoggedIn()?(d=s.getSettings(),d.then(function(t){e.sysSettings=t},function(){}),null!==a.getPortalCode()&&e.checkCss===!0&&t.search("portal",null),"undefined"!=typeof t.search().portal&&e.checkCss===!0?(jQuery("#portalStyles").length>0&&(o.purgeResults(),jQuery("#portalStyles").remove()),c=t.search().portal,l=o.fetchByPortalId(c),l.then(function(t){e.cssDoneLoading=!0,e.css=t,jQuery("<style id='portalStyles'></style>").appendTo("head").html(t)},function(){t.search("portal",null)}),e.checkCss=!1):e.checkCss===!0&&(jQuery("#portalStyles").length>0&&(o.purgeResults(),jQuery("#portalStyles").remove()),c=a.getId(),l=o.fetchByUserId(c),l.then(function(t){e.cssDoneLoading=!0,e.css=t,jQuery("<style id='portalStyles'></style>").appendTo("head").html(t)},function(){t.search("portal",null)}),e.checkCss=!1),"/"===t.path()&&t.url("/users/home/"),u.openPopUp()):("undefined"!=typeof t.search().portal&&e.checkCss===!0&&(jQuery("#portalStyles").length>0&&(o.purgeResults(),jQuery("#portalStyles").remove()),c=t.search().portal,l=o.fetchByPortalId(c),l.then(function(t){e.cssDoneLoading=!0,e.css=t,jQuery("<style id='portalStyles'></style>").appendTo("head").html(t)},function(){t.search("portal",null)})),t.path("/"))}),e.$on("$routeChangeSuccess",function(r,n){e.query="","undefined"!=typeof t.search().portal&&(e.query="?portal="+t.search().portal)})}]),app.service("AssessmentService",["$http","$q",function(e,t){var r=this;r.singleResponse=null,r.fetchSingle=function(t,n){var o="api/user/"+t+"/assessment/"+n+"/",a={method:"GET",url:o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return r.singleResponse=e.data,r.singleResponse},function(e){throw e})}}]),app.service("AssignmentsService",["$http","$q","dateUtil","UsersService","SettingsService","errorDisplayerUtil","courseFormatterUtil",function(e,t,r,n,o,a,s){var i=this;i.response=null,i.UsersService=n,i.courseGroupID=null,i.fetch=function(t){var r={method:"GET",url:"api/assignments/"+t+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return i.response=i.format(e.data),i.response},function(e){throw e})},i.fetchSingle=function(t,r){var n=(i.UsersService.getId(),{method:"GET",url:"api/assignments/single/"+t+"/"+r,headers:{"Content-Type":"application/json"},timeout:window.timeout});return e(n).then(function(e){return i.response=i.format([e.data])[0],i.response},function(e){throw e})},i.updateDueDate=function(t,r,n,o){var a={method:"PUT",url:"api/assignments/updateduedate/"+t+"/"+r+"/"+n,data:o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return i.response=e.data,i.response},function(e){throw e})},i.getAssignmentsBystateAndType=function(t,r,n,o,a){var s={StudentId:t,Type:r,CourseState:n,StartDate:o,EndDate:a},u={method:"POST",url:"api/assignments/query",data:s,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(u).then(function(e){return i.response=i.format(e.data),i.response},function(e){throw e})},i.getCourseGroupCourses=function(t,r,n){var o={method:"GET",url:"api/assignments/"+t+"/coursegroup/"+r+"/list/courses/"+n,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return i.courseGroupID=n,i.response=i.format(e.data),i.courseGroupID=null,i.response},function(e){throw e})},i.submitAssignment=function(t,r){var n=angular.copy(r);n.studentId=t,n=[n];var o={method:"POST",url:"api/assignments/add/",data:n,timeout:window.timeout};return e(o).then(function(e){return e.data},function(e){throw e})},i.approveDenyEnrollment=function(t,r,n,o,a){var s={method:"PUT",url:"api/team/enroll/"+t+"/course/"+r+"/"+n+"/"+o+"/"+a,timeout:window.timeout};return e.put(s.url).then(function(e){return i.response=i.format(e.data),i.response},function(e){throw e})},i.removeAssignment=function(t){var r=({studentId:t.studentId,AssignmentCourseId:t.assignmentCourseId},{method:"POST",url:"api/assignments/",data:JSON.stringify(i.unformat(t)),headers:{"Content-Type":"application/json"},timeout:window.timeout});return e(r).then(function(e){},function(e){})},i.waiveAssignment=function(t,r){var n={method:"PUT",url:"api/assignments/"+r,data:JSON.stringify(i.unformat(t)),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){},function(e){})},i.unformat=function(e){var t=angular.copy(e);return null!==t.assignedOn&&"undefined"!=typeof t.assignedOn&&null!==t.assignedOn.utcDate&&"undefined"!=typeof t.assignedOn.utcDate&&(t.assignedOn=t.assignedOn.utcDate.format()),null!==t.completedDate&&"undefined"!=typeof t.completedDate&&null!==t.completedDate.utcDate&&"undefined"!=typeof t.completedDate.utcDate&&(t.completedDate=t.completedDate.utcDate.format()),null!==t.dueDate&&"undefined"!=typeof t.dueDate&&null!==t.dueDate.utcDate&&"undefined"!=typeof t.dueDate.utcDate&&(t.dueDate=t.dueDate.utcDate.format()),null!==t.dueDate&&"undefined"!=typeof t.dueDate&&null!==t.dueDate.jsDate&&"undefined"!=typeof t.dueDate.jsDate&&(t.dueDate=moment(t.dueDate.jsDate).utc().format()),null!==t.endDateTime&&"undefined"!=typeof t.endDateTime&&null!==t.endDateTime.utcDate&&"undefined"!=typeof t.endDateTime.utcDate&&(t.endDateTime=t.endDateTime.utcDate.format()),null!==t.endDate&&"undefined"!=typeof t.endDate&&null!==t.endDate.utcDate&&"undefined"!=typeof t.endDate.utcDate&&(t.endDate=t.endDate.utcDate.format()),null!==t.startDate&&"undefined"!=typeof t.startDate&&null!==t.startDate.utcDate&&"undefined"!=typeof t.startDate.utcDate&&(t.startDate=t.startDate.utcDate.format()),null!==t.startDateTime&&"undefined"!=typeof t.startDateTime&&null!==t.startDateTime.utcDate&&"undefined"!=typeof t.startDateTime.utcDate&&(t.startDateTime=t.startDateTime.utcDate.format()),t},i.format=function(e){var t=["assignedOn","completedDate","dueDate","endDateTime","startDate","startDateTime"],n=null,u=parseInt(o.maxEnrollmentAttemptsAllowed,10);if(null!==e)for(var l in e){n=e[l],null!==n.curriculumName&&""!==n.curriculumName?(n.CourseGroupName=n.curriculumName,n.courseGroupId=n.curriculumId,n.courseGroupImage="CourseGroupCurriculum"):null!==n.certificationName&&""!==n.certificationName?(n.CourseGroupName=n.certificationName,n.courseGroupId=n.certificationId,n.courseGroupImage="CourseGroupCertification"):n.courseGroupImage="CourseGroup",null!==i.courseGroupID&&(n.isInCourseGroup=i.courseGroupID),u>0?(n.enrollmentAttemptsAllowed=u,n.enrollmentAttemptsRemaining=u-n.totalEnrollmentAttempts>0?u-n.totalEnrollmentAttempts:0):(n.enrollmentAttemptsAllowed=-1,n.enrollmentAttemptsRemaining=-1);for(var c in n)if(null!==n[c]&&$.inArray(c,t)!==-1)n[c]=r.formatDate(n[c]);else if(("offerings"===c||"sessions"===c||"assignedOffering"===c)&&(null!==n[c]&&"assignedOffering"===c?(n[c]=[n[c]],n[c]=i.format(n[c])[0]):n[c]=i.format(n[c]),"offerings"===c))for(var d in n[c])void 0!==n[c][d].sessions&&n[c][d].sessions.length>0&&(n[c][d].location=n[c][d].sessions[0].locationName,n[c][d].instructor=n[c][d].sessions[0].instructor);null!==n&&"undefined"!=typeof n.code&&(n.codeForImage=s.getCourseCodeForImage(n.code)),n.error=a.create()}return e},i.formatToSend=function(e){var t=["endDate","startDate","displayStart","displayEnd","newStartDate","newEndDate","lastProcessedOn","lastUpdatedOn","acceptPassingScoreDate","dueDateFixed"];if(e.constructor!==Array)for(var n in e)"undefined"!=typeof e[n]&&null!==e[n]&&"object"==typeof e[n]&&$.inArray(n,t)!==-1&&(e[n]=r.formatDate(e[n].jsDate).utcDate);return e.hasOwnProperty("course")&&e.course.constructor===Object&&i.formatToSend(e.course),e.constructor===Array&&_.each(e,function(e){i.formatToSend(e)}),e},i.isCourseRelaunchable=function(e){return!(!e||!(0===o.maxEnrollmentAttemptsAllowed||e.totalEnrollmentAttempts<o.maxEnrollmentAttemptsAllowed))},i.assignAssignment=function(t){var r=angular.copy(t),n={method:"POST",url:"api/assignments/add/",data:i.formatToSend(r),timeout:window.timeout};return e(n).then(function(e){return e.data},function(e){throw e})}}]),app.service("BreadcrumbsService",["$rootScope",function(e){var t=this;t.crumbs=[],t.pushCrumb=function(e,r){var n={};n.name=e,r&&(n.link=r),t.crumbs.push(n)},t.getCrumbs=function(){return t.crumbs},t.reset=function(){t.crumbs=[]},e.$on("$routeChangeStart",function(e,r){t.reset()})}]),app.service("CatalogService",["$http","$q",function(e,t){var r=this;r.data=null,r.filter=null,r.response=null,r.responseComplete=!1,r.user=null,r.fetch=function(n){r.filter=n;var o="api/catalog/";if("undefined"!=typeof r.response&&r.responseComplete===!0)return t(function(e){r.format(),e(r.data)});var a={method:"GET",url:o,headers:{"Content-Type":"application/json"}};return e.get(a.url).then(function(e){return r.responseComplete=!0,r.response=e.data,r.format(),r.data},function(e){r.responseComplete=!0})},r.format=function(){r.findObjectById(r.filter);for(var e in r.response)r.response[e].iconImage=r._getIcon(r.response[e].nodeId)},r.filterBy=function(){var e=r.response,t=r.filter;if(null!==t)for(var n in e)if(e[n].nodeId===t)return void(r.data=e[n].children);r.data=e},r.findObjectById=function(e,t){var n="undefined"==typeof t?r.response:t,o=null;if(null!==e){for(var a in n)n[a].nodeId===parseInt(e,10)?(n[a].iconImage=r._getIcon(n[a].nodeId),r.data=n[a]):"undefined"!=typeof n[a].children&&(o=r.findObjectById(e,n[a].children));return o}r.data=n},r.getResponse=function(){return r.response},r._getIcon=function(e){var t={1009:"three_person_circle",1025:"tools",1066:"bank",1156:"atom",1157:"",1189:"",1692:"certificate",1710:"lightbulb",1774:"bank",1775:"money_house",1777:"credit_union"},r="undefined"!=typeof t[e]?t[e]:"default";return r},r.getBaiCatalogData=function(){var t={method:"GET",url:"api/Catalog/",headers:{"Content-Type":"application/json"}};return e(t).then(function(e){return r.response=r.format_CatalogData(e.data),r.response},function(e){throw e})},r.format_CatalogData=function(e){return r.newArrayForCatlogData=[],r.formattedDataCatalog=[],r.formattedDataCatalog.originalFlatArray=[],r.formattedDataCatalog.formattedCatalogTree=[],r.formattedDataCatalog.formattedCatalogTreeData=[],r.formattedDataCatalog.formattedCoursesData=[],r.formattedDataCatalog.originalFlatArray=n(e),o(r.newArrayForCatlogData),a(r.formattedDataCatalog.formattedCatalogTree),r.formattedDataCatalog};var n=function(e){return _.each(e,function(e){e.name=e.title,e.nodes=e.children,e.id=e.nodeId,delete e.title,delete e.children,r.newArrayForCatlogData.push(e),e.nodes&&n(e.nodes)}),r.newArrayForCatlogData},o=function(e){_.each(e,function(e){e.nodes=[],null!==e.courseId&&void 0!==e.courseId&&0===e.nodes.length?r.formattedDataCatalog.formattedCoursesData.push(e):r.formattedDataCatalog.formattedCatalogTree.push(e)})},a=function(e){var t={};_.each(e,function(e){t[e.nodeId]=e,null!==e.parentId?t[e.parentId].nodes.push(e):r.formattedDataCatalog.formattedCatalogTreeData.push(e)})};r.getCustomCatalog=function(){var t={method:"GET",url:"api/course/custom",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return r.response=r.formatCustomCatalog(e.data),r.response},function(e){throw e})},r.formatCustomCatalog=function(e){var t=["wbt","ilt","vle","task","survey","evaluation","courseGroups","assessment"],n=[];if(null!==e)for(var o in e)null!==e[o]&&"undefined"!==e[o]&&"courseGroups"!==o&&n.push({api_name:o,nodes:[],courses:e[o]}),null!==e[o]&&"undefined"!==e[o]&&"courseGroups"===o&&n.push({api_name:o,courses:e[o]});return _.each(n,function(e){var n=e.api_name;"undefined"!==n&&null!==n&&$.inArray(n,t)!==-1&&(e.name=r.courseTypeDisplayName(n))}),_.each(n,function(e){"courseGroups"===e.api_name&&_.each(e.nodes,function(e){e.courses=e.children,e.api_name="courseGroups",delete e.children})}),n},r.courseTypeDisplayName=function(e){var t;return"wbt"===e?t="Web Based Training":"ilt"===e?t="Instructor Led Training":"vle"===e?t="Virtual Classroom":"task"===e?t="Tasks":"survey"===e?t="Surveys":"evaluation"===e?t="Evaluations":"assessment"===e?t="Assessments":"courseGroups"===e&&(t="Course Groups"),t},r.removeDuplicates=function(e,t){var r=[],n={};for(var o in e)n[e[o][t]]=e[o];for(o in n)r.push(n[o]);return r}}]),app.service("CountriesService",["$http","UsersService",function(e,t){var r=this;r.getCountryList=function(){var n={method:"GET",url:"app/json/CountriesWithIsoCodes.json",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e.get(n.url).then(function(e){r.user=t.user;var n=e.data.find(function(e){return e.value===r.user.homeAddress.countryName});return n||e.data.push({key:r.user.homeAddress.countryName,value:r.user.homeAddress.countryName}),e.data},function(e){throw e})},r.getLatitudeCountryList=function(t){var r={method:"GET",url:"api/user/countries/"+t+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e.get(r.url).then(function(e){return e.data},function(e){throw e})}}]),app.service("CoursesService",["$http","$q","courseFormatterUtil","dateUtil",function(e,t,r,n){var o=this;o.response=null,o.format=function(e){var t,o=["assignedOn","completedDate","dueDate","startDate","endDate","endDateTime","startDateTime","displayStart","displayEnd","requestedOn","registrationEndDateTime"],a=null;if(null!==e)for(var s in e){t=e[s];for(var i in t)if(null!==t[i]&&$.inArray(i,o)!==-1)t[i]=n.formatDate(t[i]);else if("offerings"===i){for(var u in t.offerings)if("undefined"!=typeof t.offerings[u].sessions&&t.offerings[u].sessions.length>0){t.offerings[u].location=t.offerings[u].sessions[0].locationName,a=t.offerings[u].sessions;for(var l in a)for(var c in a[l])null!==a[l][c]&&$.inArray(c,o)!==-1&&(a[l][c]=n.formatDate(a[l][c]))}}else if("assignedOffering"===i){if("undefined"!=typeof t.assignedOffering&&null!==t.assignedOffering&&"undefined"!=typeof t.assignedOffering.sessions&&t.assignedOffering.sessions.length>0){a=t.assignedOffering.sessions;for(var d in a)for(var p in a[d])null!==a[d][p]&&$.inArray(p,o)!==-1&&(a[d][p]=n.formatDate(a[d][p]))}}else if("sessions"===i){var m=t[i];for(var f in m){var g=m[f];for(var h in m[f])null!==g[h]&&$.inArray(h,o)!==-1&&(g[h]=n.formatDate(g[h]))}}if(t.codeForImage=r.getCourseCodeForImage(t.code),"undefined"==typeof t.displayEnd||null===t.displayEnd)t.isActive=!0;else{var v=moment(t.displayEnd.dateAsObj.year+"/"+t.displayEnd.dateAsObj.month+"/"+t.displayEnd.dateAsObj.day),y=v.isSameOrBefore(moment(new Date),"day");t.isActive=!y}t.catalogId=parseInt(t.catalogId,10)>0?t.catalogId:null,null!==t.enrollmentRestrictionDays&&null!==t.allowedEnrollments?t.retakeLimitUsePortal=!1:t.retakeLimitUsePortal=!0}return e},o.formatToSend=function(e){var t=["endDate","startDate","displayStart","displayEnd","lastProcessedOn","lastUpdatedOn","acceptPassingScoreDate","dueDateFixed"];if(e.constructor!==Array)for(var r in e)"undefined"!=typeof e[r]&&null!==e[r]&&$.inArray(r,t)!==-1&&(e[r].jsDate?e[r]=n.formatDate(e[r].jsDate).utcDate:e[r]=n.formatDate(e[r]).utcDate),"undefined"!=typeof e[r]&&null!==e[r]&&e[r].constructor===Array&&o.formatToSend(e[r]);return e.constructor===Array&&_.each(e,function(e){o.formatToSend(e)}),e},o.format_skinned=function(e){var t=["assignedOn","completedDate","dueDate","startDate","endDate","endDateTime","startDateTime","displayStart","displayEnd"];if(e.constructor!==Array)for(var r in e)"undefined"!=typeof e[r]&&null!==e[r]&&$.inArray(r,t)!==-1&&e[r]&&(e[r]=n.formatDate(e[r])),"undefined"!=typeof e[r]&&null!==e[r]&&e[r].constructor===Array&&o.format_skinned(e[r]);return e.constructor===Array&&_.each(e,function(e){o.format_skinned(e)}),e},o.getSingle=function(t,r,n){n="undefined"!=typeof n&&null!==n?n+"/":"";var a="api/course/"+r+"/"+n,s={method:"GET",url:a,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(s).then(function(e){return o.singleResponse=o.format([e.data]),o.singleResponse},function(e){throw e})},o.getCourseUrl=function(t,r,n){var a={method:"GET",url:"api/course/courseurl/"+t+"/"+r+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return o.courseResponse=e.data,o.courseResponse},function(e){throw e})},o.scheduleOffering=function(t,r,n,o){var a={method:"POST",url:"api/course/schedule/"+r+"/"+t+"/"+o+"/"+n+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return e.data},function(e){throw e})},o.completeTask=function(t,r){var n={method:"POST",url:"api/user/"+r+"/task/"+t+"/",headers:{"Content-type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return o.response=e.data,o.response=o.format(e.data),o.response},function(e){throw e})},o.fetchMany=function(t,r){var n={method:"POST",url:"api/course/"+t+"/",data:r,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return o.response=o.format(e.data),o.response},function(e){throw e})},o.dropElectiveCourse=function(t,r){var n={id:t.id,name:t.name,code:t.code,offeringid:t.offeringId,type:t.type,transcriptId:t.transcriptId},a={method:"DELETE",url:"api/course/"+r+"/",data:n,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return o.courseResponse},function(e){throw e})},o.requestManagerialApproval=function(t,r,n,o){var a="api/course/approval/"+n+"/"+t+"/"+o+"/"+r+"/",s={method:"POST",url:a,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(s).then(function(e){return e.data},function(e){throw e})},o.getSingleCourse=function(t){var r="api/course/"+t,n={method:"GET",url:r,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return o.singleCourseResponse=o.format([e.data])[0],o.singleCourseResponse},function(e){throw e})},o.getCoursesBySearch=function(){var t={method:"GET",url:"api/search/?q=",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return o.response=o.format(e.data),o.response},function(e){throw e})},o.createCourse=function(t){var r={method:"POST",url:"api/course/",data:o.formatToSend(t),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){var t=o.format_skinned(e.data);return t},function(e){throw e})},o.getActiveCoursesForOrg=function(){var t={method:"GET",url:"api/course/Activecourses",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){var t=o.format(e.data);return o.response=o.courseFormattedDates(t),o.response},function(e){throw e})},o.getCoursesForOrg=function(){var t={method:"GET",url:"api/course/courses",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){var t=o.format(e.data);return o.response=o.courseFormattedDates(t),o.response},function(e){throw e})},o.updateCourse=function(t){var r={method:"PUT",url:"api/course/",data:o.formatToSend(t),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return o.format_skinned(e.data)},function(e){throw e})},o.courseFormattedDates=function(e){return _.each(e,function(e){null!==e.displayStart&&void 0!==e.displayStart&&(e.startDateFormatted=e.displayStart.fullDate),null!==e.displayEnd&&void 0!==e.displayEnd&&(e.endDateFormatted=e.displayEnd.fullDate)}),e},o.getCourseGroup=function(t,r){var n={method:"GET",url:"api/coursegroup/"+t+"/"+r,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return e.data},function(e){throw e})},o.formatCourseIds=function(e){if(e.length>0)return _.pluck(e,"id")},o.updateCourseGroupChildren=function(t){var r=t.id,n=o.formatCourseIds(t.childCourses),a={method:"PUT",url:"api/coursegroup/"+r+"/",data:n,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return e.data},function(e){throw e})},o.getSingleCourseOfferings=function(t){var r={method:"GET",url:"api/offering/courseid/"+t+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return o.response=o.format(e.data),o.response},function(e){throw e})},o.getImodifyUrl=function(t){var r={method:"GET",url:"api/course/imodify/"+t,headers:{"Content-Type":"application/json"},timeout:1e5};return e(r).then(function(e){return e.data},function(e){throw e})},o.CreateIModifyCourse=function(t){var r={method:"POST",url:"api/course/imodify/"+t,headers:{"Content-Type":"application/json"},timeout:1e5};return e(r).then(function(e){return e.data},function(e){throw e})},o.resetIModifyCourseContent=function(t){var r={method:"POST",url:"api/course/resetimodify/"+t,headers:{"Content-Type":"application/json"},timeout:1e5};return e(r).then(function(e){return e.data},function(e){throw e})},o.resetCourseStatus=function(t,r){var n={method:"POST",url:"api/course/reset/"+t+"/"+r,headers:{"Content-Type":"application/json"}};return e(n).then(function(e){return e.data},function(e){throw e})}}]),app.service("CssService",["$http","$q",function(e,t){var r=this;r.response=null,r.RGBtoGrey=function(e){var t,r,n,o,a=/^#([0-9A-F]{6}|[0-9A-F]{3})$/;if("string"==typeof e&&(e=e.trim().toUpperCase(),a.test(e)))return 4===e.length&&(e="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),r=parseInt(e.substring(1,3),16),n=parseInt(e.substring(3,5),16),o=parseInt(e.substring(5,7),16),t=.2126*r+.7152*n+.0722*o,Math.round(t,0)},r.shouldTextBeLight=function(e){var t=r.RGBtoGrey(e);return t<=76.5},r.extractColorFromCSS=function(e){var t,r=/\.portalBackground\s*\{\s*background-color:\s*(#[a-fA-F0-9]{6}|#[a-fA-F0-9]{3})!important/;return t=r.exec(e),t&&"object"==typeof t&&"string"==typeof t[1]?t[1]:null},r.getAlternateColor=function(e){return"#808080"},r.handleContrastProblems=function(e){var t=r.extractColorFromCSS(e);if(!t)return e;var n=r.RGBtoGrey(t);return n>=216.75?(e+="html body button.btn-default { background-color: "+r.getAlternateColor(t)+" !important; }",e+="html body a.btn-default { background-color: "+r.getAlternateColor(t)+"!important; }",e+="html body button.md-primary { background-color: "+r.getAlternateColor(t)+"!important; }",e+="html body #calendarMonthView .selected { background-color: "+r.getAlternateColor(t)+" !important; }",e+=".checkboxHolder input[type='checkbox']:checked + label::after { color: "+r.getAlternateColor(t)+" !important; }",e+=".radio input[type='radio']:checked + label::after { background-color: "+r.getAlternateColor(t)+"!important; }",e+=".md-calendar-date.md-calendar-date-today { color: "+r.getAlternateColor(t)+"!important; }",e+=".md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator { background-color: "+t+" !important; }"):n<=114.75?(e+=".selected .portalLightText { color: white !important; }",e+=".md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator { background-color: "+t+" !important; color: white !important;}"):e},r.fetchByUserId=function(n){if(null!==r.response)return t(function(e){e(r.response)});var o={method:"GET",url:"api/account/customcss/user/"+n,headers:{"Content-type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return r.response=r.handleContrastProblems(e.data),r.response},function(e){throw e})},r.fetchByPortalId=function(n){if(null!==r.response)return t(function(e){e(r.response)});var o={method:"GET",url:"api/account/customcss/company/"+n,headers:{"Content-type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return r.response=r.handleContrastProblems(e.data),r.response},function(e){throw e})},r.purgeResults=function(){r.response=null}}]),app.service("DocumentService",["$http","$q","dateUtil","Upload",function(e,t,r,n){var o=this;o.data=null,o.fetch=function(t){var r="api/asset",n={method:"GET",url:r,headers:{"Content-Type":"application/json"}};return e(n).then(function(e){return o.data=e.data,o._format(t),o.data},function(e){throw e})},o._format=function(e){return o._formatDocuments([o.data])[0]},o._findObjectById=function(e,t){var r="undefined"==typeof t?o.data:t,n=null;if(null!==e){for(var a in r)r[a].nodeId===parseInt(e,10)?o.data=r[a]:"undefined"!=typeof r[a].children&&(n=o._findObjectById(e,r[a].children));return n}o.data=r},o._formatDocuments=function(e){for(var t in e)void 0!==e[t].isParent&&(e[t].isParent===!0?e[t].children=o._formatDocuments(e[t].children):e[t].postedDate=r.formatDate(e[t].postedDate));return e},o.uploadUrlToRepository=function(t){var r={Url:t},n={method:"POST",url:"api/asset/url/",headers:{"Content-Type":"application/json"},data:r,timeout:window.timeout};return e(n).then(function(e){return e},function(e){throw e})},o.attachUrlToCourse=function(t,r,n){void 0===n&&(n=!1);var o={Url:t},a={method:"POST",url:"api/asset/url/"+r+"/"+n,headers:{"Content-Type":"application/json"},data:o,timeout:window.timeout};return e(a).then(function(e){return e},function(e){throw e})},o.uploadDocumentToRepository=function(e){var t=a(e.type);return n.upload({url:"api/asset/"+t,data:{file:e}}).then(function(e){return e},function(e){throw e})},o.uploadDocument=function(e,t,r){void 0===r&&(r=!1);var o=a(e.type);return n.upload({url:"api/asset/doc/"+t+"/"+o+"/"+r,data:{file:e}}).then(function(e){return e},function(e){throw e})},o.attachDocumentFromRepositoryToCourse=function(t,r){return e.put("api/asset/"+r+"/"+t+"/").then(function(e){return e},function(e){throw e})},o.uploadScormPackage=function(e,t){return n.upload({url:"api/course/scorm/"+t+"/",data:{file:e}}).then(function(e){return e},function(e){throw e})},o.updateScormPackage=function(e,t){return n.upload({url:"api/course/scormcontent/"+t+"/",data:{file:e}}).then(function(e){return e},function(e){throw e})},o.getDocumentRepositoryList=function(){var t="api/asset/",r={method:"GET",url:t};return e.get(r.url).then(function(e){return o.response=e.data,o.response},function(e){throw e})},o.getDocumentsForCourse=function(t){var r="api/asset/"+t+"/course",n={method:"GET",url:r};return e(n).then(function(e){return o.response=e.data,o.response},function(e){throw e})},o.getSingleDocumentInfo=function(t){var r="api/asset/"+t+"/",n={method:"GET",url:r};return e.get(n.url).then(function(e){return o.response=e.data,o.response},function(e){throw e})},o.updateSingleAsset=function(t){var r={method:"PUT",url:"api/asset/update/",data:t,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return o.response=e.data,o.response},function(e){throw e})},o.replaceAsset=function(t,r,o){var s;if("file"===o)return s=a(t.type),n.upload({url:"api/asset/"+r+"/"+s+"/0",data:{file:t}}).then(function(e){return e},function(e){throw e});if("url"===o){var i={Url:t},u={method:"PUT",url:"api/asset/"+r,headers:{"Content-Type":"application/json"},data:i,timeout:window.timeout};return e(u).then(function(e){return e},function(e){throw e})}},o.deleteAsset=function(t,r){var n={method:"DELETE",url:"api/asset/"+t+"/"+r,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return o.response=e.data,o.response},function(e){throw e})};var a=function(e){var t={};return t["application/vnd.ms-word.document.macroEnabled.12"]="word",t["application/msword"]="word",
t["application/vnd.openxmlformats-officedocument.wordprocessingml.document"]="word",t["text/rtf"]="word",t["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"]="excel",t["application/zip"]="zip",t["application/pdf"]="pdf",t["audio/mp3"]="audio",t["audio/3gpp"]="audio",t["audio/3gpp2"]="audio",t["audio/mp4"]="audio",t["audio/ogg"]="audio",t["audio/mpeg4-generic"]="audio",t["audio/mpeg"]="audio",t["audio/rtp-midi"]="audio",t["audio/vorbis"]="audio",t["audio/ac3"]="audio",t["text/html"]="text",t["text/csv"]="text",t["image/jpeg"]="picture",t["image/png"]="picture",t["image/tiff"]="picture",t["image/gif"]="video",t["video/quicktime"]="video",t["video/ogg"]="video",t["video/mpeg4-generic"]="video",t["video/mp4"]="video",t["video/VP8"]="video",t["video/jpeg2000"]="video",t["video/JPEG"]="video",t["video/H264"]="video",t["video/3gpp"]="video",t["application/vnd.openxmlformats-officedocument.presentationml.presentation"]="powerpoint",t["application/vnd.ms-powerpoint"]="powerpoint",e in t?t[e]:"text"}}]),app.service("EvaluationService",["$http","$q",function(e,t){var r=this;r.singleResponse=null,r.fetchSingle=function(t,n){var o="api/user/"+t+"/evaluation/"+n+"/",a={method:"GET",url:o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return r.singleResponse=e.data,r.singleResponse},function(e){throw e})}}]),app.service("GroupsService",["$http","$q","$filter","dateUtil","UsersService","LocationsService",function(e,t,r,n,o,a){var s=this;s.response=null,s.UsersService=o,s.LocationsService=a,s.peopleGroupStructure=function(t){var r={method:"GET",url:"api/PeopleGroup?groupId="+t,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return s.response=s.format_peopleGroupStructure(e.data),s.response},function(e){throw e})},s.getPeopleGroupFilters=function(){var t={method:"GET",url:"api/peoplegroup/filters",cache:!0,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return s.response=s.format_getPeopleGroupFilters(e.data),s.response},function(e){throw e})},s.getContainerOperands=function(){var t={method:"GET",url:"api/peoplegroup/operands",cache:!0,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return s.response=_.each(e.data,function(e){s.formatDisplayNameForOperands(e)}),s.response},function(e){throw e})},s.getPeopleGroups=function(){var t={method:"GET",url:"api/user/groups/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return s.response=s.formatForPeopleGroups(e.data),s.allGroupsData=e,s.response},function(e){throw e})},s.getPeopleGroupUsers=function(t){var r={method:"GET",url:"api/groups/"+t+"/users",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return s.response=e.data,s.response},function(e){throw e})},s.getPeoplePreview=function(t){var r=angular.copy(t),n=s.formatGroupDataToSend(r),o={method:"POST",url:"api/peoplegroup/preview",data:n,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return s.response=e.data,s.response},function(e){throw e})},s.savePeopleGroup=function(t,r){var n=angular.copy(t),o=s.formatGroupDataToSend(n),a="";r.includes("update")||r.includes("activate")?a="PUT":r.includes("create")&&(a="POST");var i={method:a,url:"api/peoplegroup",data:o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(i).then(function(e){return s.response=s.format_peopleGroupStructure(e.data),s.response},function(e){throw e})},s.formatDisplayNameForOperands=function(e){for(var t=["equals","greater than","less than","less than or equals to","greater than or equals to"],r="!&=-<>?",n=e.name||e.operandValue,o=0;o<n.length;o++)r.indexOf(n.charAt(o))!==-1?"="===n?e.displayName=t[0]:">"===n?e.displayName=t[1]:"<"===n?e.displayName=t[2]:"<="===n?e.displayName=t[3]:">="===n&&(e.displayName=t[4]):e.displayName=e.name||e.operandValue;return e},s.containerOperandsRequired=function(e){var t=["AND","OR","NOT"],r=[];return _.each(e,function(e){_.each(t,function(t){t===e.operandValue&&r.push(e)})}),r},s.format_peopleGroupStructure=function(e){var t=["startDate","endDate"];if(e.subContainers.length>0){var r=e.subContainers;_.each(r,function(e){s.format_peopleGroupStructure(e)})}if(e.criteria.length>0){var o=e.criteria;_.each(o,function(e){e.criteriaName.includes("Date")?(e.value=n.formatDate(e.value),e.isDate=!0,e.isString=!1):(e.isDate=!1,e.isString=!0)})}for(var a in e)null!==e[a]&&$.inArray(a,t)!==-1&&(e[a]=n.formatDate(e[a]));return e},s.formatForPeopleGroups=function(e){var t=e.groups;return _.each(t,function(e){e.nodes=[],e.name=e.groupName}),e},s.formatGroupDataToSend=function(e){if("undefined"!==e.startDate&&null!==e.startDate&&(e.startDate=e.startDate.jsDate),"undefined"!==e.endDate&&null!==e.endDate&&(e.endDate=e.endDate.jsDate),e.criteria.length>0||e.subContainers.length>0){var t=e.criteria;_.each(t,function(e){e.criteriaName.includes("Date")&&"undefined"!==e.value&&null!==e.value&&(e.value=e.value.jsDate,e.operandName.includes(">=")?e.value.setHours(0,0,0,0):e.operandName.includes("<=")&&e.value.setHours(23,59,59,999)),delete e.operatorsData,delete e.autoCompleteData,delete e.isString,delete e.isDropdown,delete e.isDate}),_.each(e.subContainers,function(e){s.formatGroupDataToSend(e)})}return e},s.format_getPeopleGroupFilters=function(e){return _.each(e,function(e){e.operands&&_.each(e.operands,function(e){s.formatDisplayNameForOperands(e)})}),e},s.activeUsers=function(e){var t=r("filter")(e,function(e){if(e.endDate>moment.utc().format()||null===e.endDate||"undefined"==typeof e.endDate)return e});return t},s.activePositions=function(e){var t=r("filter")(e,function(e){if(e.isActive===!0)return e});return t},s.secondaryFormatGroupStructure=function(e,t,r,n){s.secondaryFormatGroupStructue_orgData=e,s.secondaryFormatGroupStructue_groupData=t,s.secondaryFormatGroupStructue_jobsData=s.activePositions(r),s.secondaryFormatGroupStructue_countriesData=n},s.secondaryFormatGroupStructure_groupStructure=function(e){s.secondaryFormatGroupStructue_groupStructure=e;var t=[s.secondaryFormatGroupStructue_groupStructure];return s.secondaryFormatGroupStructue_01(t),s.peopleGroupCleanUpBeforeRender([e])},s.peopleGroupCleanUpBeforeRender=function(e){return _.each(e,function(e){e.criteria.length>0&&_.each(e.criteria,function(e){"undefined"!=typeof e.valueLabel&&null!==e.valueLabel||(e.valueLabel=e.value)}),e.subContainers.length>0&&s.peopleGroupCleanUpBeforeRender(e.subContainers)}),e[0]},s.secondaryFormatGroupStructue_01=function(e){return _.each(e,function(e){e.criteria.length>0&&s.secondaryFormatGroupStructue_02(e.criteria),e.subContainers.length>0&&s.secondaryFormatGroupStructue_01(e.subContainers)}),e},s.secondaryFormatGroupStructue_02=function(e){var t,r=["People Group","Manager","Organization","Position","Person","Country"],n=null;if(e.length>0)for(var o in e){n=e[o];for(t in n)"undefined"!=typeof n[t]&&null!==n[t]&&$.inArray(n[t],r)!==-1&&s.secondaryFormatGroupStructue_03(n)}return e},s.secondaryFormatGroupStructue_03=function(e){var t;return"Person"!==e.criteriaName&&"Manager"!==e.criteriaName||(e.valueLabel=e.additionalDetails),"Position"===e.criteriaName&&(t=r("filter")(s.secondaryFormatGroupStructue_jobsData,{id:e.value}),"undefined"!=typeof t&&null!==t&&0!==t.length?e.valueLabel=t[0].name:e.valueLabel=e.value),"People Group"===e.criteriaName&&(t=r("filter")(s.secondaryFormatGroupStructue_groupData,{id:e.value}),"undefined"!=typeof t&&null!==t&&0!==t.length?e.valueLabel=t[0].groupName:e.valueLabel=e.value),"Organization"===e.criteriaName&&(t=r("filter")(s.secondaryFormatGroupStructue_orgData,{id:e.value}),"undefined"!=typeof t&&null!==t&&0!==t.length?e.valueLabel=t[0].name:e.valueLabel=e.value),"Country"===e.criteriaName&&(t=r("filter")(s.secondaryFormatGroupStructue_countriesData,{countryId:e.value}),"undefined"!=typeof t&&null!==t&&0!==t.length?e.valueLabel=t[0].countryName:e.valueLabel=e.value),e},s.filterDataForAutoComplete=function(e,t){var r,n=e;return"Custom1"===n.criteriaName?r="custom1":"Custom2"===n.criteriaName?r="custom2":"Custom3"===n.criteriaName?r="custom3":"Custom4"===n.criteriaName?r="custom4":"Custom5"===n.criteriaName?r="custom5":"Person Status"===n.criteriaName?r="personStatus":"Location"===n.criteriaName?r="location":"Person"===n.criteriaName?r="person":"Country"===n.criteriaName?r="country":"State/Providence"===n.criteriaName?r="stateName":"City"===n.criteriaName?r="city":"Person Type"===n.criteriaName?r="personType":"Username"===n.criteriaName?r="userName":"First Name"===n.criteriaName?r="firstName":"Last Name"===n.criteriaName?r="lastName":"Manager"===n.criteriaName?r="manager":"Position"===n.criteriaName?r="positionId":"Organization"===n.criteriaName?r="organizationId":"Email Address"===n.criteriaName?r="email":"People Group"===n.criteriaName&&(r="groupId"),s.skinnedAutoCompleteData(r,t)},s.skinnedAutoCompleteData=function(e,t){var r,n,a=[],i=["firstName","lastName","userName","custom1","custom2","custom3","custom4","custom5","email","stateName","city","location"];if("undefined"!=typeof e&&null!==e&&$.inArray(e,i)!==-1){if("stateName"!==e)return r={},r[e]=t,r.pageNumber=1,r.pageSize=25,n=o.advancedSearch(r),n.then(function(t){var r=_.uniq(_.compact(_.pluck(t,e)));return _.each(r,function(e){var t={};t.id=e,t.name=e,a.push(t)}),a});_.each(s.secondaryFormatGroupStructue_userData,function(e){var t={};return"undefined"!=typeof e.homeAddress&&null!==e.homeAddress&&(t.id=e.homeAddress.stateName,t.name=e.homeAddress.stateName,a.push(t)),a})}else{if("person"===e||"manager"===e)return r={},r.fullNameContains=t,"manager"===e&&(r.roleId=11),n=o.advancedSearch(r),n.then(function(e){return _.each(e,function(e){if(e.fullName.toLowerCase().indexOf(t.toLowerCase())!==-1){var r={};r.id=e.id,r.name=e.fullName,a.push(r)}}),a});if("groupId"===e)return _.each(s.secondaryFormatGroupStructue_groupData,function(e){if(e.groupName.toLowerCase().indexOf(t.toLowerCase())!==-1){var r={};r.id=e.id,r.name=e.groupName,a.push(r)}}),a;if("organizationId"===e)return _.each(s.secondaryFormatGroupStructue_orgData,function(e){if(e.name.toLowerCase().indexOf(t.toLowerCase())!==-1){var r={};r.id=e.id,r.name=e.name,a.push(r)}}),a;if("positionId"===e)return _.each(s.secondaryFormatGroupStructue_jobsData,function(e){if(e.name.toLowerCase().indexOf(t.toLowerCase())!==-1){var r={};r.id=e.id,r.name=e.name,a.push(r)}}),a;if("country"===e)return _.each(s.secondaryFormatGroupStructue_countriesData,function(e){if(e.countryName.toLowerCase().indexOf(t.toLowerCase())!==-1){var r={};r.id=e.countryName,r.name=e.countryName,a.push(r)}}),a;if("personType"===e){var u=s.UsersService.personTypes;return _.each(u,function(e){if(e.name.toLowerCase().indexOf(t.toLowerCase())!==-1){var r={};r.id=e.value,r.name=e.name,a.push(r)}}),a}if("personStatus"===e){var l=s.UsersService.personStatuses;return _.each(l,function(e){if(e.name.toLowerCase().indexOf(t.toLowerCase())!==-1){var r={};r.id=e.value,r.name=e.name,a.push(r)}}),a}}},s.mapUsersForPreview=function(e){var t=[];return _.each(e,function(e){_.each(s.secondaryFormatGroupStructue_userData,function(r){r.id===e&&t.push(r)})}),t},s.generateGuid=sqlguid,s.generateRootContainer=function(e){var r=t.defer(),o={data:{containerId:s.generateGuid(),groupId:null,name:"",startDate:n.formatDate(moment()),endDate:null,subContainers:[],criteria:[],operandId:1,operandName:"AND (1)",followHierarchy:!1,parentContainerId:null,hasChildren:!1,isRoot:!0}};return e===!0?r.resolve(o.data):r.reject("No Object available!!"),r.promise},s.generateSubContainer=function(e){var r=t.defer(),n={data:{containerId:s.generateGuid(),groupId:"",name:"Container",startDate:null,endDate:null,subContainers:[],criteria:[{groupCriteriaId:s.generateGuid(),criteriaId:"",criteriaName:"",operandId:"",operandName:"",value:"",isString:!0,folowHierarchy:!0}],operandId:2,operandName:"OR (2)",followHierarchy:!1,parentContainerId:null,hasChildren:!1,isRoot:!1}};return e===!0?r.resolve(n.data):r.reject("No Object available!!"),r.promise},s.generateCriteria=function(){var e={groupCriteriaId:s.generateGuid(),criteriaId:"",criteriaName:"",operandId:"",operandName:"",value:"",isString:!0,folowHierarchy:!1};return e}}]),app.service("HelpService",["$http","$q",function(e,t){var r=this;r.user=null,r.response=null,r.filter=null,r.data=null,r.responseComplete=!0}]),app.service("JobsService",["$http","$httpParamSerializer",function(e,t){var r=this;r.getAllJobs=function(){var t={method:"GET",url:"api/jobs/?=",timeout:window.timeout};return e(t).then(function(e){return e.data},function(e){return e})},r.searchJobs=function(n){n=t(n);var o={method:"GET",url:"api/jobs/?"+n,timeout:window.timeout};return e(o).then(function(e){return r.format(e.data)},function(e){return e})},r.updateJob=function(t){var r={method:"PUT",url:"api/jobs/",timeout:window.timeout,data:t,headers:{"Content-Type":"application/json"}};return e(r).then(function(e){return e},function(e){throw e})},r.createJob=function(t){var r={method:"POST",url:"api/jobs/",timeout:window.timeout,data:t,headers:{"Content-Type":"application/json"}};return e(r).then(function(e){return e},function(e){throw e})},r.format=function(e){for(var t=0;t<e.length;t+=1)e[t].nodes=[],e[t].lastUpdate=moment(e[t].lastUpdate);return e}}]),app.service("LocationsService",["$http","dateUtil",function(e,t){var r=this;r.types=[{name:"Select a Location",value:"--default--"},{name:"College",value:"college"},{name:"Dealership",value:"dealership"},{name:"Hotel",value:"hotel"},{name:"Online",value:"online"},{name:"Other",value:"other"},{name:"Technical",value:"technical"},{name:"Unknown",value:"unknown"},{name:"Vendor",value:"vendor"},{name:"Webinar",value:"webinar"}],r.mock={facilityType:"--default--"},r.getMock=function(){return r.mock},r.create=function(t){var r={method:"POST",url:"api/facility",headers:{"Content-Type":"application/json"},data:t,timeout:window.timeout};return e(r).then(function(e){return e},function(e){throw e})},r.edit=function(t){var r={method:"PUT",url:"api/facility/"+t.id,headers:{"Content-Type":"application/json"},data:t,timeout:window.timeout};return e(r).then(function(e){return e},function(e){throw e})},r.getSingle=function(t){var n={method:"GET",url:"api/facility/"+t+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return r.response=r.format([e.data])[0],r.response},function(e){throw e})},r.getAll=function(){var t={method:"GET",url:"api/facility/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return r.response=r.format(e.data),r.response},function(e){throw e})},r.format=function(e){for(var r=0;r<e.length;r++)e[r].startDate=t.formatDate(e[r].startDate);return e}}]),app.service("MessagesService",["$rootScope","$http","$q",function(e,t,r){var n=this;n.response=null,n.responseComplete=!1,n.request="",n.dateOrged={},n.typeOrged={},n.fetch=function(){if("undefined"!=typeof n.response&&n.responseComplete===!0)return r(function(e){n.format(),e(n.data)});var o={method:"GET",url:"api/message/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return t(o).then(function(t){return n.response=t.data,e.$broadcast("messages:model:success",t.data),n.response},function(e){throw e})},n.count=function(){return n.response.length},n.setRequest=function(e){n.request=e},n.getRequest=function(){return n.request},n.getResponse=function(){return n.response},n.orderByType=function(){if(0!==Object.keys(n.typeOrged).length)return n.typeOrged;var e=n.response,t=["organization","system"];for(var r in e)for(var o in e[r])if("undefined"==typeof n.typeOrged[o]&&jQuery.inArray(e[r].type,t)>-1){n.typeOrged[e[r].type]={label:e[r].type,messages:[]},n.typeOrged[e[r].type].messages.push(e[r]);break}return n.typeOrged},n.orderByDate=function(){var e=n.response.data,t=moment(),r=(t.clone().startOf("day"),t.clone().subtract(1,"days").startOf("day")),o=null,a="";for(var s in e)o=moment.unix(e[s].sent),o.isSame(r,"d")?("undefined"==typeof n.dateOrged.Yesterday&&(n.dateOrged.Yesterday={label:"Yesterday",messages:[]}),n.dateOrged.Yesterday.messages.push(e[s])):(a=o.format("MMMM Do, YYYY"),"undefined"==typeof n.dateOrged[a]&&(n.dateOrged[a]={label:a,messages:[]}),n.dateOrged[a].messages.push(e[s]));return n.dateOrged}}]),app.service("OfferingsService",["$http","addressUtil","dateUtil","messagingDisplayerUtil","sessionFormatterUtil","RosterService",function(e,t,r,n,o,a){var s=this;s.formatableDates=["endDateTime","registrationEndDateTime","startDateTime"],s.offerings=s.response=null,s.fetch=function(t,r){var n={method:"GET",url:"api/course/"+t+"/"+r+"/",headers:{"Content-Type":"application/json"},timeout:3e5};return e(n).then(function(e){s.offerings=s.format(e.data)},function(e){throw e})},s.fetchSingle=function(t,r){var n={method:"GET",url:"api/offering/"+t+"/"+r+"/",header:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return s.response=s.formatOfferingsOnly([e.data])[0],s.response},function(e){throw e})},s.fetchInstructorAssignments=function(t){var r={method:"GET",url:"api/offering/"+t+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return s.response=s.formatOfferingsOnly(e.data),s.response},function(e){throw e})},s.cancelOffering=function(t,r){var n={method:"PUT",url:"api/offering/cancel/"+t+"/"+r+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return s.response},function(e){throw e})},s.completeOffering=function(t,r){var n={method:"PUT",url:"api/offering/deliver/"+t+"/"+r+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return s.response},function(e){throw e})},s.format=function(e){var t,r;if(null!==e){for(var n in e){t=e[n];for(var a in t.offerings)r=t.offerings[a],r.hasOwnProperty(a)||(generic=s.createGenericOffering(r.id,r.courseId),_.extend(generic,r),r.assignmentId=e[n].id,r.status=e[n].status,"undefined"!=typeof r.sessions&&null!==r.sessions&&r.sessions.length>0&&(r.closestSession=null,r.closestSessionKey=null,r.highestSessionDateForOffering=null,r.lowestSessionDateForOffering=null,r.courseTypeLabel=s.getCourseTypeLabel(r.type),r.roster=JSON.parse(JSON.stringify(s._generateRosterObjects(r.roster))),r.type=e[n].type,r=o.formatSessions(r),r.instructor=r.sessions[0].instructor,r.locationName=r.sessions[0].locationName))}e=s.extractOfferings(e)}return e},s.formatOfferingsOnly=function(e){var n;if(null!==e)for(var a=null,i=0;i<e.length;i++){n=e[i];for(var u in n)null!==n[u]&&$.inArray(u,s.formatableDates)!==-1&&(n[u]=r.formatDate(n[u]));a=s.createGenericOffering(n.id,n.courseId),_.extend(a,n),n.closestSession=null,n.closestSessionKey=null,n.highestSessionDateForOffering=null,n.lowestSessionDateForOffering=null,n.addressExists=t.isThereAnAddress(n.address),n.courseTypeLabel=s.getCourseTypeLabel(n.type),n.roster=s._generateRosterObjects(n.roster),n.type=n.assignmentType,n.address.cityStateZipLabel=t.getCityStateZipLabel(n.address),(n.sessions||n.studentSessions)&&(n=o.formatSessions(n))}return e},s.extractOfferings=function(e){var t=null,r=[];for(var n in e)for(var o in e[n].offerings)t=e[n].offerings[o],t.isAssigned=!1,s.sessionsExist(e[n])&&e[n].assignedOffering.id===t.id&&(t.isAssigned=!0),r.push(t);return r},s.sessionsExist=function(e){return"undefined"!=typeof e.assignedOffering&&null!==e.assignedOffering&&"undefined"!=typeof e.assignedOffering.sessions&&e.assignedOffering.sessions.length>0},s.getCourseTypeLabel=function(e){switch(e){case"ilt":return"Instructor Led Training";case"vle":return"Virtually Led Elective"}return"Instructor Led Training"},s._generateRosterObjects=function(e){return a.setFromOfferingsService("attendingStudents",e.attendingStudents),a.setFromOfferingsService("droppedStudents",e.droppedStudents),a.setFromOfferingsService("pendingApprovalStudents",e.pendingApprovalStudents),a.setFromOfferingsService("waitlistStudents",e.waitlistedStudents),a},s.hasAttendingStudents=function(){return 0===s.getAttendingStudents().length},s.getAttendingStudents=function(){return s.response.attendingStudents},s.getIncompleteUserCount=function(){return s.response.roster.getIncompleteUserCount()},s.isOfferingCancellable=function(){var e=s.response.roster.getAttendingStudents(),t=["cancelledNoShow","successful","unsuccessful"];for(var r in e)if(jQuery.inArray(e[r].registrationStatus,t)>-1)return!1;return!0},s.getAllSession=function(){return s.response.sessions},s.getLowestSessionIdByDate=function(){var e=null,t=null,r=s.response.sessions;if(r.length>0)for(var n=0;n<r.length;n++)(r[n].startDateTime.original<e||null===e)&&(e=r[n].startDateTime.original,t=r[n].id);return t},s.removeStudentFromWaitList=function(t,r){var n={method:"PUT",url:"api/roster/updatestatus/"+t.student.id+"/"+r+"/Cancelled/ilt/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return s.response},function(e){throw e})},s.createOfferings=function(t){var r={method:"POST",url:"api/offering/multi",data:s.formatForSend(t),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){for(var t in e.data)e.data[t]=e.data[t].offering;return e.data},function(e){throw e})},s.formatForSend=function(e){return s.formatOfferingsForSend(e)},s.formatOfferingsForSend=function(e){for(var t=["requestedOn","registrationEndDateTime"],n=["error","instructorLabel","instructorPills","instructorReader","locationId","accordionOpen","rosterUser"],o=null,a=0;a<e.length;a++){o=e[a];for(var i in o)"undefined"!=typeof o[i]&&null!==o[i]&&jQuery.inArray(i,t)>-1?o[i].jsDate?o[i]=r.formatDate(o[i].jsDate).utcDate:o[i]=null:jQuery.inArray(i,n)>-1&&delete o[i];"undefined"!=typeof o.sessions&&null!==o.sessions&&o.sessions.length>0&&(o.sessions=s.formatSessionsForSend(o.sessions)),o.enrollmentRestrictions="",o.instructionalLanguageId=9,o.languageId=9,o.maxStudentsPerDealer=o.maxAllowedSize,o.trainingType=3}return e},s.formatSessionsForSend=function(e){for(var t=["startDateTime","endDateTime"],r=["id"],n=["instructorPills","error","instructorReader","offeringId","startDate","endDate","startTime","endTime"],o=null,a=0;a<e.length;a++){o=e[a];for(var s in o)jQuery.inArray(s,t)>-1&&(o[s]=o[s].utcDate.format()),jQuery.inArray(s,r)>-1?o[s]=parseInt(o[s],10):jQuery.inArray(s,n)>-1&&delete o[s]}return e},s.createGenericOffering=function(e,t){var r={accordionOpen:!1,assignmentType:"ilt",courseId:t,localId:e,instructorIds:[],instructorPills:[],search:{isLoading:!1,error:n.create()},rosterUser:"",roster:{attendingStudents:[]},sessions:[]};return r},s.updateOffering=function(t){var r={method:"PUT",url:"api/offering/updateoffering",data:s.formatForSend([t])[0],headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return s.response},function(e){throw e})}}]),app.service("OrganizationsService",["$http","$q","OrgFunctions","UsersService",function(e,t,r,n){var o=this;o.updateOrganization=function(t,r){var n={method:r,url:"api/organization/",data:t,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return e},function(e){throw e})},o.format_AddOrgFields=function(e){return"undefined"!==e&&null!==e&&_.each(e,function(t){_.each(e,function(e){t.parentId===e.id&&(t.parentOrgName=e.name)}),t.enabled===!0?t.status="Enabled":t.enabled===!1&&(t.status="Disabled")}),e},o.getOrganizationHierarchy=function(){var t={method:"GET",url:"api/organizationHierarchy/",timeout:window.timeout};return e(t).then(function(e){return o.response=e.data,o.response},function(e){throw e})},o.getOrgTree=function(){var t={method:"GET",url:"api/organizationTree/",timeout:window.timeout};return e(t).then(function(e){return e.data},function(e){throw e})},o.getSingleOrg=function(t){var r={method:"GET",url:"api/organization/"+t,timeout:window.timeout};return e(r).then(function(e){return o.response=e.data,o.response},function(e){throw e})},o.createOrgObj=function(e){var r=t.defer(),o={data:{id:0,name:"",typeId:null,type:"dealer",parentId:null,typeName:"",announcements:"",description:"",enabled:null,updateDateTime:moment().format(),updateUserId:null,sourceCode:"",abbreviation:"",portalId:n.getPortalId(),portalCode:"",isTopLevelOrg:null}};return e===!0?r.resolve(o.data):r.reject("No Object available!!"),r.promise}}]),app.service("RosterService",["$http","dateUtil","errorDisplayerUtil","sessionFormatterUtil",function(e,t,r,n){var o=this;o.response=null,o.attendingStudents=null,o.waitlistStudents=null,o.pendingApprovalStudents=null,o.fetch=function(t,r){var n={method:"GET",url:"api/roster/"+t+"/"+r,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){return o.response=o.format(e.data),o.response},function(e){})},o.updateSinglePersonOnRoster=function(t,r,n,o,a){var s={method:"PUT",url:"api/roster/updatestatus/"+t+"/"+r+"/"+n+"/"+o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return null!==a&&(s.data=a),e(s)},o.substituteUser=function(t,r,n,o){var a={method:"PUT",url:"api/roster/substitute/"+n+"/"+t+"/"+r+"/"+o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a)},o.updateSessionByUserOnOffering=function(t,r,n){var o={method:"PUT",data:n,url:"api/roster/updatesession/"+t+"/"+r,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o)},o.format=function(e){if(null!==e){var a,s,i=["completionDate","registrationDate"];for(var u in e)if(e[u].length>0){a=e[u];for(var l in a)if("function"!=typeof a[l]){s=a[l];for(var c in s.student)null!==s.student[c]&&$.inArray(c,i)!==-1&&(s.student[c]=t.formatDate(s.student[c]));s.highestSessionDateForOffering=null,s.lowestSessionDateForOffering=null,s.cancellingPerson=!1,s.error=r.create(),s.isLoading=!1,s.sessionUpdateIsLoading=!1,s.success=!1,s.statusForDropdown=o.getDropDownStatus(s.student.registrationStatus),s.hasCompletedTheOffering="default"!==s.statusForDropdown,s=n.formatSessions(s)}o[u]=e[u]}o.set("attendingStudents",e.attendingStudents),o.set("droppedStudents",e.droppedStudents),o.set("pendingApprovalStudents",e.pendingApprovalStudents),o.set("waitlistStudents",e.waitlistStudents)}return e},o.formatFromOfferingService=function(e){if("undefined"!=typeof e&&null!==e){var n,a,s=["completionDate","registrationDate"];for(var u in e)if(e[u].length>0){n=e[u];for(var l in n)if("function"!=typeof n&&"function"!=typeof n[l]&&"undefined"==typeof n[l]){a=n[l];for(var c in a.student)"function"!=typeof a.student[i]&&null!==a.student[c]&&$.inArray(c,s)!==-1&&(a.student[c]=t.formatDate(a.student[c]));a.cancellingPerson=!1,a.error=r.create(),a.isLoading=!1,a.sessionUpdateIsLoading=!1,a.success=!1,a.statusForDropdown=o.getDropDownStatus(a.registrationStatus),a.hasCompletedTheOffering="default"!==a.statusForDropdown}o[u]=e[u]}}else e=[];return e},o.getDropDownStatus=function(e){var t=["cancelledNoShow","successful","unsuccessful"];return jQuery.inArray(e,t)>-1?t[jQuery.inArray(e,t)]:"default"},o.getIncompleteUserCount=function(){var e=0;if(0===o.attendingStudents.length)return e-1;for(var t in o.attendingStudents)null===o.attendingStudents[t].completionDate&&e++;return e},o.incompleteUsersInAttendingRoster=function(){return 0===o.getIncompleteUserCount()},o.get=function(e){return o[e]},o.set=function(e,t){return o[e]=t,o},o.setFromOfferingsService=function(e,t){var r=o.formatFromOfferingService(t);return o[e]=r,o},o.getAttendingStudents=function(){return o.attendingStudents},o.getWaitlistedStudents=function(){return o.waitlistStudents},o.getPendingApprovalStudents=function(){return o.pendingApprovalStudents},o.generateMailToFromUsers=function(e){var t=[],r=null,n=o.get(e);for(var a in n)r=n[a],null!==r.email&&""!==r.email&&t.push(r.email);return t},o.getCorrectSessionFromUser=function(e,t){var r=o.getAttendingStudents();for(var n in r)if(r[n].student.id===e)for(var a in r[n].sessions){var s=r[n].sessions[a];if(s.id===t)return s}},o.updateMultiplePersonOnRoster=function(t){var r={method:"PUT",url:"api/roster/updatestatus/",headers:{"Content-Type":"application/json"},timeout:window.timeout,data:t};return e(r).then(function(e){return e.data},function(e){throw e})}}]),app.service("RulesService",["$http","$q","dateUtil",function(e,t,r){var n=this;n.response=null,n.format=function(e){var t,n=["endDate","startDate","lastProcessedOn","lastUpdatedOn","dueDateFixed","acceptPassingScoreDate"],o=null;if(e.length>0)for(var a in e){o=e[a];for(t in o)"undefined"!=typeof o[t]&&null!==o[t]&&$.inArray(t,n)!==-1&&(o[t]=r.formatDate(o[t]))}else for(t in e)"undefined"!=typeof e[t]&&null!==e[t]&&$.inArray(t,n)!==-1&&(e[t]=r.formatDate(e[t]));return e},n.formatToSend=function(e){var t=["endDate","startDate","displayStart","displayEnd","newStartDate","newEndDate","lastProcessedOn","lastUpdatedOn","acceptPassingScoreDate","dueDateFixed"];if(e.constructor!==Array)for(var o in e)"undefined"!=typeof e[o]&&null!==e[o]&&"object"==typeof e[o]&&$.inArray(o,t)!==-1&&(e[o]=r.formatDate(e[o].jsDate).utcDate);return e.hasOwnProperty("course")&&e.course.constructor===Object&&n.formatToSend(e.course),e.constructor===Array&&_.each(e,function(e){if("undefined"!=typeof e.newEndDate&&null!==e.newEndDate){var t=moment(e.newStartDate.jsDate),o=moment(e.newEndDate.jsDate);o.isAfter(t)||(e.newEndDate.jsDate=r.formatDate(e.newStartDate.jsDate).moment.add(1,"year")._d)}n.formatToSend(e)}),e},n.formatSingleRule=function(e){return"undefined"!==e.afterDueNotificationDays&&null!==e.afterDueNotificationDays&&"undefined"!==e.beforeDueNotificationDays&&null!==e.beforeDueNotificationDays?e:(e.afterDueNotificationDays=[],e.beforeDueNotificationDays=[],e)},n.formatCourseObj=function(e){var t=e,r=[];return _.each(t,function(e){var t={};t.ruleCourseId="",t.required="",t.dueDateFixed=null,t.acceptPassingScoreDate=null,t.dueDateDaysFromKey="",t.dueDateDaysFromValue="",t.recordUserId="",t.foriegnSystemId="",t.recurrence="",t.course=e,r.push(t)}),n.format(r)},n.formatRuleForCopy=function(e){var t=[];return _.each(e,function(e){var n={};n.id=e.id,n.name=e.name,n.newName=e.name+"_copy",n.startDate=e.startDate,n.endDate=e.endDate,n.newStartDate=r.formatDate(e.startDate.moment.add(1,"year")),n.newEndDate=e.endDate,n.isAddYear=null,t.push(n)}),t},n.getAllRules=function(){var t={method:"GET",url:"api/rules/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return n.response=n.format(e.data),n.response},function(e){throw e})},n.getSingleRule=function(t){var r={method:"GET",url:"api/rules/"+t,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return n.response=n.format(e.data),n.rule=n.formatSingleRule(n.response),n.rule},function(e){throw e})},n.ruleGeneralCall=function(t,r){var o;"undefined"!==r&&null!==r&&"create"===r?o="POST":"undefined"!==r&&null!==r&&"update"===r&&(o="PUT");var a={method:o,url:"api/rules/",data:n.formatToSend(t),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return n.response=n.format(e.data),n.response},function(e){throw e})},n.format_courseDates=function(e){var t=e;return _.each(t,function(e){null===e.dueDateDaysFromValue?e.flagDueDateMethod=0:null===e.dueDateFixed&&(e.flagDueDateMethod=1)}),t},n.getRuleAssignments=function(t){var r={method:"GET",url:"api/rules/"+t+"/courses",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return n.response=n.format_courseDates(n.format(e.data)),n.response},function(e){throw e})},n.getRuleCounts=function(t){var r={method:"GET",url:"api/rules/"+t+"/counts",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return n.response=e.data,n.response},function(e){throw e})},n.updateRuleAssignments=function(t,r){
var o={method:"PUT",url:"api/rules/"+t+"/courses",data:n.formatToSend(r),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return n.response=n.format(e.data),n.response},function(e){throw e})},n.saveCopiedRule=function(t){var r={method:"PUT",url:"api/rules/copy",data:n.formatToSend(t),headers:{"Content-Type":"application/json"},timeout:window.timeout};return void 0,e(r).then(function(e){return n.response=n.format(e.data),n.response},function(e){throw e})},n.getRuleStatusOptions=function(e){var r=t.defer(),n={data:[{id:0,name:"draft"},{id:1,name:"active"},{id:2,name:"closed"}]};return e===!0?r.resolve(n.data):r.reject("No Object available!!"),r.promise},n.createRuleObj=function(e){var r=t.defer(),n={data:{id:null,name:"",description:"",startDate:null,endDate:null,reoccurance:!0,groupId:null,lastUpdatedByUser:"",lastUpdatedByUserId:"",beforeDueNotificationDays:[],afterDueNotificationDays:[],lastProcessedOn:"",lastUpdatedOn:"",status:""}};return e===!0?r.resolve(n.data):r.reject("No Object available!!"),r.promise}}]),app.service("SearchServices",["$http","$q","AssignmentsService","dateUtil",function(e,t,r,n){var o=this;o.response=null,o.request="",o.fetch=function(){var t={method:"GET",url:"api/search/?q="+encodeURIComponent(o.request),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e.get(t.url).then(function(e){return o.response=e.data,o.format(),o.response},function(e){if(404===e.status){o.response=Array();var t={course:0,document:0,task:0};return o.response.counts=t,o.response}})},o.setRequest=function(e){o.request=e},o.format=function(){var e=["postedDate"],t=null;if(null!==o.response)for(var r in o.response){t=o.response[r];for(var a in t)null!==t[a]&&$.inArray(a,e)!==-1&&(t[a]="object"==typeof t[a]?t[a].origin:t[a],t[a]=n.formatDate(t[a]))}o.response.counts=o.organizeByType()},o.organizeByType=function(){var e={course:0,document:0,helpTopic:0},t=["wbt","ilt","vle"];for(var r in o.response)jQuery.inArray(o.response[r].type,t)>-1?e.course++:"file"===o.response[r].type&&e.document++;return e}}]),app.service("SettingsService",["$http","$q",function(e,t){var r=this;r.response=null,r.maxEnrollmentAttemptsAllowed=-1,r.features={},r.getSettings=function(t){"undefined"==typeof t&&(t=!0);var n=t?"private, max-age=3600":"no-cache",o={method:"GET",url:"api/settings/",headers:{"Content-Type":"application/json","Cache-Control":n},cache:t,timeout:2e4};return e(o).then(function(e){return r.response=r.format(e.data),r.response},function(e){throw e})},r.updateSettings=function(t,n){var o={method:"POST",url:"api/settings/"+t,data:n,headers:{"Content-Type":"application/json"},timeout:2e4};return e(o).then(function(e){return r.response=r.format(e.data),r.response},function(e){throw e})},r.format=function(e){if(e.enrollmentAttempts!==parseInt(e.enrollmentAttempts,10))throw new Error("Could not convert maxEnrollmentAttemptsAllowed data to integer.");if(r.maxEnrollmentAttemptsAllowed=parseInt(e.enrollmentAttempts,10),null===e.features||void 0===e.features)throw new Error("Could not convert features data to an object");var t=e.features;return null!==t.sysPropInstructorLed&&void 0!==t.sysPropInstructorLed||(t.sysPropInstructorLed=!1),null!==t.sysPropCourseGroups&&void 0!==t.sysPropCourseGroups||(t.sysPropCourseGroups=!1),null!==t.sysPropTasks&&void 0!==t.sysPropTasks||(t.sysPropTasks=!1),null!==t.sysPropIDesign&&void 0!==t.sysPropIDesign||(t.sysPropIDesign=!1),null!==t.sysPropVirtualClassroom&&void 0!==t.sysPropVirtualClassroom||(t.sysPropVirtualClassroom=!1),null!==t.sysPropLDConnect&&void 0!==t.sysPropLDConnect||(t.sysPropLDConnect=!1),null!==t.sysPropEarlyAccess&&void 0!==t.sysPropEarlyAccess||(t.sysPropEarlyAccess=!1),r.features=t,e},r.isILTEnabled=function(){return r.features.sysPropInstructorLed===!0}}]),app.service("StatesService",["$http","$q",function(e,t){var r=this;r.getLatitudeStateList=function(t){var r={method:"GET",url:"api/user/states/"+t+"/"};return e.get(r.url).then(function(e){return e.data},function(e){throw e})}}]),app.service("SurveyService",["$http","$q",function(e,t){var r=this;r.singleResponse=null,r.fetchSingle=function(t,n){var o="api/user/"+t+"/survey/"+n+"/",a={method:"GET",url:o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return r.singleResponse=e.data,r.singleResponse},function(e){throw e})}}]),app.service("TasksService",["$http","dateUtil","errorDisplayerUtil",function(e,t,r){var n=this;n.response=null,n.fetchSingle=function(t,r){var o={method:"GET",url:"api/user/"+r+"/task/"+t+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return n.response=n.format(e.data),n.response},function(e){throw e})},n.getTasksApprovalTA=function(){var t={method:"GET",url:"api/tasks/requireapproval",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return n.response=n.format(e.data),n.response},function(e){throw e})},n.taskApproval=function(t,r,o){var a={method:"POST",url:"api/team/user/"+t+"/task/"+r+"/"+o,timeout:window.timeout};return e(a).then(function(e){return n.response=n.format(e.data),n.response},function(e){throw e})},n.format=function(e){var o=["assignedOn","completedDate","dueDate","endDateTime","startDate","startDateTime","requestedDate","endDate","createdDate"],a=null;if(null!==e)for(var s in e){a=e[s];for(var i in a)null!==a[i]&&$.inArray(i,o)!==-1?a[i]=t.formatDate(a[i]):"offerings"!==i&&"sessions"!==i&&"assignedOffering"!==i||("assignedOffering"===i?(a[i]=[a[i]],a[i]=n.format(a[i])[0]):a[i]=n.format(a[i]));a.error=r.create(),a.isLoading=!1}return e}}]),app.service("TeamService",["$http","UsersService","dateUtil","courseFormatterUtil","errorDisplayerUtil","$q",function(e,t,r,n,o,a){var s=this;s.getSummary=function(t,r,n){var o={method:"GET",url:"api/team/summary/"+t+"/"+r+"/"+n,headers:{"Content-Type":"application/json"},timeout:3e5};return e(o).then(function(e){return e=e.data,e.pieChartData=[e.complete,e.incomplete],e},function(e){throw e})},s.getTeamList=function(t,r,n,o){var a="direct";t&&(a="alternate");var i={method:"GET",url:"api/team/list/"+r+"/"+a+"/"+n+"/"+o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(i).then(function(e){return s.addChartDataToTeamList(e.data)},function(e){throw e})},s.addChartDataToTeamList=function(e){for(var t=e.slice(),r=0;r<t.length;r+=1)t[r].pieChartData=[t[r].complete,t[r].incomplete],t[r].error=o.create(),t[r].isLoading=!1,t[r].profileExpanded=!1;return t},s.getDirectTeamList=function(e,r){var n=t.getId();return s.getTeamList(!1,n,e,r)},s.getAlternateTeamList=function(e,r){var n=t.getId();return s.getTeamList(!0,n,e,r)},s.getDirectTeamListByManagerId=function(e,t,r){return s.getTeamList(!1,e,t,r)},s.searchAssignments=function(t,r){var n={method:"GET",url:"api/team/courses/"+r+"?q="+encodeURIComponent(t),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(n).then(function(e){var t=s.formatAssignments(e.data);return t},function(e){throw e})},s.getTasksForApproval=function(){var t={method:"GET",url:"api/team/tasks/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return s.response=s.formatTask(e.data),s.response},function(e){throw e})},s.getListOfAssignmentsToApprove=function(){var t={method:"GET",url:"api/team/enrollments/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(t).then(function(e){return s.response=s.format(e.data),s.response},function(e){throw e})},s.getRollup=function(t,r,n){var o={method:"GET",url:"api/team/rollup/"+t+"/direct/"+r+"/"+n,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return e=e.data,e.pieChartData=[e.complete,e.incomplete],e},function(e){throw e})},s.recursiveTeamList=function(t,r,n){var o={method:"GET",url:"api/team/list/"+t+"/direct/"+r+"/"+n,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){var t=e.data;return a.all(t.map(function(e){return e.isManager&&s.recursiveTeamList(e.studentId,r,n).then(function(t){e.checked=!1,e.hidden=!0,e.teamList=t},function(e){throw e}),e}))},function(e){throw e})},s.getSummariesByUserId=function(t,r,n){var o={method:"POST",url:"api/team/list/"+r+"/"+n,data:JSON.stringify(t),headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return s.addChartDataToTeamList(e.data)},function(e){throw e})},s.formatTask=function(e){return s.tasks=s.format(e),s.tasks.forEach(function(e){e.isLoading=!1,e.error=o.create()}),s.tasks},s.formatAssignments=function(e){for(var t in e)e[t].checked=!1,e[t].error=o.create();return e},s.format=function(e){var t=["assignedOn","completedDate","dueDate","endDateTime","startDate","startDateTime","requestedDate","endDate"],a=null;if(null!==e)for(var i in e){a=e[i];for(var u in a)null!==a[u]&&$.inArray(u,t)!==-1?a[u]=r.formatDate(a[u]):"offerings"!==u&&"sessions"!==u&&"assignedOffering"!==u||("assignedOffering"===u?(a[u]=[a[u]],a[u]=s.format(a[u])[0]):a[u]=s.format(a[u]));a.error=o.create(),a.isLoading=!1,null!==a&&"undefined"!=typeof a.code&&(a.codeForImage=n.getCourseCodeForImage(a.code))}return e}}]),app.service("TimezoneService",["$http","$q",function(e,t){var r=this;r.timezones=null,r.getAllZones=function(){var e=null,t=null;if(null===r.timezones){r.timezones=[];for(var n=0;n<r._timezones.length;n++)"function"!=typeof r._timezones[n]&&"function"!=typeof r._timezones[n]&&(t=r._timezones[n].split("|"),e={id:t[0],name:t[1]},r.timezones.push(e))}return r.timezones},r.getAllTimezones=function(){var t={method:"GET",url:"app/json/latitude_countries.json",timeout:window.timeout};return e.get(t.url).then(function(e){return e.data},function(e){})},r._timezones=["21|(UTC-12:00) International Date Line West","78|(UTC-11:00) Coordinated Universal Time-11","79|(UTC-10:00) Aleutian Islands","35|(UTC-10:00) Hawaii","104|(UTC-09:30) Marquesas Islands","2|(UTC-09:00) Alaska","131|(UTC-09:00) Coordinated Universal Time-09","113|(UTC-08:00) Baja California","130|(UTC-08:00) Coordinated Universal Time-08","52|(UTC-08:00) Pacific Time (US & Canada)","68|(UTC-07:00) Arizona","41|(UTC-07:00) Chihuahua, La Paz, Mazatlan","43|(UTC-07:00) Mountain Time (US & Canada)","14|(UTC-06:00) Central America","19|(UTC-06:00) Central Time (US & Canada)","92|(UTC-06:00) Easter Island","40|(UTC-06:00) Guadalajara, Mexico City, Monterrey","10|(UTC-06:00) Saskatchewan","56|(UTC-05:00) Bogota, Lima, Quito, Rio Branco","93|(UTC-05:00) Chetumal","26|(UTC-05:00) Eastern Time (US & Canada)","95|(UTC-05:00) Haiti","91|(UTC-05:00) Havana","67|(UTC-05:00) Indiana (East)","115|(UTC-04:00) Asuncion","6|(UTC-04:00) Atlantic Time (Canada)","132|(UTC-04:00) Caracas","89|(UTC-04:00) Cuiaba","57|(UTC-04:00) Georgetown, La Paz, Manaus, San Juan","51|(UTC-04:00) Santiago","127|(UTC-04:00) Turks and Caicos","48|(UTC-03:30) Newfoundland","123|(UTC-03:00) Araguaina","25|(UTC-03:00) Brasilia","55|(UTC-03:00) Cayenne, Fortaleza","81|(UTC-03:00) City of Buenos Aires","32|(UTC-03:00) Greenland","107|(UTC-03:00) Montevideo","103|(UTC-03:00) Punta Arenas","119|(UTC-03:00) Saint Pierre and Miquelon","85|(UTC-03:00) Salvador","77|(UTC-02:00) Coordinated Universal Time-02","42|(UTC-02:00) Mid-Atlantic - Old","9|(UTC-01:00) Azores","11|(UTC-01:00) Cabo Verde Is.","75|(UTC) Coordinated Universal Time","108|(UTC+00:00) Casablanca","31|(UTC+00:00) Dublin, Edinburgh, Lisbon, London","33|(UTC+00:00) Monrovia, Reykjavik","72|(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna","16|(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague","53|(UTC+01:00) Brussels, Copenhagen, Madrid, Paris","17|(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb","71|(UTC+01:00) West Central Africa","109|(UTC+01:00) Windhoek","96|(UTC+02:00) Amman","34|(UTC+02:00) Athens, Bucharest","106|(UTC+02:00) Beirut","27|(UTC+02:00) Cairo","24|(UTC+02:00) Chisinau","122|(UTC+02:00) Damascus","134|(UTC+02:00) Gaza, Hebron","61|(UTC+02:00) Harare, Pretoria","30|(UTC+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius","38|(UTC+02:00) Jerusalem","97|(UTC+02:00) Kaliningrad","99|(UTC+02:00) Tripoli","5|(UTC+03:00) Baghdad","126|(UTC+03:00) Istanbul","3|(UTC+03:00) Kuwait, Riyadh","87|(UTC+03:00) Minsk","54|(UTC+03:00) Moscow, St. Petersburg, Volgograd","22|(UTC+03:00) Nairobi","37|(UTC+03:30) Tehran","4|(UTC+04:00) Abu Dhabi, Muscat","82|(UTC+04:00) Astrakhan, Ulyanovsk","84|(UTC+04:00) Baku","118|(UTC+04:00) Izhevsk, Samara","105|(UTC+04:00) Port Louis","121|(UTC+04:00) Saratov","94|(UTC+04:00) Tbilisi","12|(UTC+04:00) Yerevan","1|(UTC+04:30) Kabul","73|(UTC+05:00) Ashgabat, Tashkent","28|(UTC+05:00) Ekaterinburg","114|(UTC+05:00) Islamabad, Karachi","36|(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi","62|(UTC+05:30) Sri Jayawardenepura","46|(UTC+05:45) Kathmandu","15|(UTC+06:00) Astana","86|(UTC+06:00) Dhaka","112|(UTC+06:00) Omsk","44|(UTC+06:30) Yangon (Rangoon)","59|(UTC+07:00) Bangkok, Hanoi, Jakarta","80|(UTC+07:00) Barnaul, Gorno-Altaysk","133|(UTC+07:00) Hovd","50|(UTC+07:00) Krasnoyarsk","45|(UTC+07:00) Novosibirsk","124|(UTC+07:00) Tomsk","20|(UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi","49|(UTC+08:00) Irkutsk","60|(UTC+08:00) Kuala Lumpur, Singapore","70|(UTC+08:00) Perth","63|(UTC+08:00) Taipei","128|(UTC+08:00) Ulaanbaatar","111|(UTC+08:30) Pyongyang","83|(UTC+08:45) Eucla","125|(UTC+09:00) Chita","65|(UTC+09:00) Osaka, Sapporo, Tokyo","39|(UTC+09:00) Seoul","13|(UTC+09:30) Adelaide","7|(UTC+09:30) Darwin","23|(UTC+10:00) Brisbane","8|(UTC+10:00) Canberra, Melbourne, Sydney","74|(UTC+10:00) Guam, Port Moresby","64|(UTC+10:00) Hobart","69|(UTC+10:00) Vladivostok","101|(UTC+10:30) Lord Howe Island","88|(UTC+11:00) Bougainville Island","116|(UTC+11:00) Chokurdakh","102|(UTC+11:00) Magadan","110|(UTC+11:00) Norfolk Island","120|(UTC+11:00) Sakhalin","18|(UTC+11:00) Solomon Is., New Caledonia","117|(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky","47|(UTC+12:00) Auckland, Wellington","76|(UTC+12:00) Coordinated Universal Time+12","29|(UTC+12:00) Fiji","98|(UTC+12:00) Petropavlovsk-Kamchatsky - Old","90|(UTC+12:45) Chatham Islands","129|(UTC+13:00) Coordinated Universal Time+13","66|(UTC+13:00) Nuku'alofa","58|(UTC+13:00) Samoa","100|(UTC+14:00) Kiritimati Island"]}]),app.service("TranscriptsService",["$http","$q","courseFormatterUtil","dateUtil","SettingsService","UsersService",function(e,t,r,n,o,a){var s=this;s.response=null,s.fetch=function(t){var r={method:"GET",url:"api/transcript/"+t+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(r).then(function(e){return s.response=s.format(e.data),s.response},function(e){throw e})},s.rangeFetch=function(t,r,n){var o="api/transcript/"+t+"/";null!==r&&null!==n&&(o+=r+"/"+n+"/");var a={method:"GET",url:o,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(a).then(function(e){return s.response=s.format(e.data),s.response},function(e){throw e})},s.create=function(t){var r={};return r=null!==t.userId&&void 0!==t.userId?{method:"POST",data:t,url:"api/transcript/user/"+t.userId+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout}:{method:"POST",data:t,url:"api/transcript/",headers:{"Content-Type":"application/json"},timeout:window.timeout},e(r).then(function(e){return s.response=e.data,s.response},function(e){throw e})},s.batchCreate=function(t){var r={method:"PUT",url:"api/transcript/batchadd",timeout:3e5,data:t,headers:{"Content-Type":"application/json"}};return e(r).then(function(e){return s.response=e.data,s.response},function(e){throw e})},s.format=function(e){var t=["assignedOn","completedDate","dueDate","startDate"],r=null,s=null;if(a.isSaba()&&(s=parseInt(o.maxEnrollmentAttemptsAllowed,10)),null!==e){for(var i in e){r=e[i],a.isSaba()||(s=r.allowedEnrollments),s>0?(r.enrollmentAttemptsAllowed=s,r.enrollmentAttemptsRemaining=s-r.totalEnrollmentAttempts>0?s-r.totalEnrollmentAttempts:0):(r.enrollmentAttemptsAllowed=-1,r.enrollmentAttemptsRemaining=-1);for(var u in r)null!==r[u]&&$.inArray(u,t)!==-1&&(r[u]=n.formatDate(r[u]))}var l=function(e,t){return e.completedDate.original<t.completedDate.original?1:e.completedDate.original>t.completedDate.original?-1:0};e=e.sort(l)}return e},s.getSingleTranscript=function(t,n){var o={method:"GET",url:"api/transcript/"+t+"/"+n,headers:{"Content-Type":"application/json"},timeout:window.timeout};return e(o).then(function(e){return s.response=s.format([e.data])[0],s.response.codeForImage=r.getCourseCodeForImage(s.response.code),s.response},function(e){throw e})},s.formatToSend=function(e){var t=["assignedOn","completedDate","dueDate","endDateTime","startDate","startDateTime"];if(e.constructor!==Array)for(var r in e)"undefined"!=typeof e[r]&&null!==e[r]&&"object"==typeof e[r]&&$.inArray(r,t)!==-1&&(e[r]=n.formatDate(e[r].jsDate).utcDate);return e.constructor===Array&&_.each(e,function(e){s.formatToSend(e)}),e},s.updateTranscript=function(t){var r={method:"PUT",url:"api/transcript/user/"+t.studentId+"/",headers:{"Content-Type":"application/json"},data:s.formatToSend(t),timeout:window.timeout};return e(r).then(function(e){return s.response},function(e){throw e})},s.updateSingle=function(t,r){var n={method:"PUT",url:"api/transcript/user/"+t+"/",data:s.formatToSend(r),timeout:5e3};return e(n).then(function(e){},function(e){throw e})}}]),app.service("UsersService",["$rootScope","$cookies","$http","$q","addressUtil","dateUtil","messagingDisplayerUtil","$httpParamSerializer",function(e,t,r,n,o,a,s,u){var l=this;l.roleObj=null,l.user=null,l.response=null,l.originalResponse=null,l.singleResponse=null,l.userApplicationType=null,l.auth={currentRole:null,isLoggedIn:!1,roles:null,authedUser:null,isTopLevel:null},l.personTypes=[{name:"Regular",value:"regular"},{name:"Part Time",value:"partTime"},{name:"Independent Contractor",value:"independentContractor"},{name:"Intern",value:"intern"},{name:"Outsourced",value:"outsourced"},{name:"Seasonal",value:"seasonal"},{name:"Temporary",value:"temporary"},{name:"Unknown",value:"unknown"}],l.personStatuses=[{name:"Prior-To-Hire",value:"priorToHire"},{name:"Active",value:"active"},{name:"Terminated",value:"terminated"},{name:"Leave",value:"leave"},{name:"Paid Leave Of Absence",value:"paidLeaveOfAbsence"},{name:"Suspend",value:"suspend"},{name:"Retired",value:"retired"},{name:"Unknown",value:"unknown"}],l.fetch=function(e){var t={method:"GET",url:"api/user/single/"+e+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(t).then(function(e){return l.response=l.format([e.data]),l.response[0]},function(e){throw e})},l.fetchSingle=function(e){var t={method:"GET",url:"api/user/single/"+e+"/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return r.get(t.url).then(function(e){return l.response=e.data,l.response},function(e){})},l.search=function(e,t){t||(t="all");var n={method:"GET",url:"api/searchuser/"+t+"?q="+e,headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(n).then(function(e){return l.response=l.formatMultipleUsers(e.data),l.response},function(e){throw e})},l.validatePassword=function(e,t){var n={method:"POST",url:"api/account/login/",data:{Password:t,UserName:e},headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(n).then(function(e){return e.data},function(e){throw e})},l.requestTemporaryPassword=function(e){l.username=e;var t={method:"POST",url:"api/account/forgotpassword/",data:{UserName:l.username},headers:{"Content-type":"application/json"},timeout:window.timeout};return r(t).then(function(e){return l.response=e.data,l.response},function(e){throw e})},l.resetPassword=function(e){l.password=e,l.username="undefined"==typeof l.username?l.user.userName:l.username;var t={method:"POST",url:"api/account/savepassword/",data:{Password:l.password,UserName:l.username},headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(t).then(function(e){return l.response=l.formatSingleUser(e.data),l.response},function(e){throw e})},l.login=function(e,t){l.password=t,l.username=e;var n={method:"POST",url:"api/account/login/",data:{Password:l.password,UserName:l.username},headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(n).then(function(e){if(l.originalResponse=l.response=e.data,l.response=l.formatSingleUser(e.data),l.setUpCreds(),l.isSaba()){l.password=l.user.token.toString();l.doSabaLogin()}return l.response},function(e){throw e})},l.doSabaLogin=function(){var e={method:"POST",url:"/Saba/Web_wdk/Main/index/startIndex.rdf",data:$.param({j_username:this.username,j_password:l.password,localeFieldCauseReload:!1,j_security_check:!0}),headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:window.timeout};return r(e).then(function(e){return l.response},function(e){throw e})},l.switchProfile=function(e){var t={method:"POST",url:"api/account/switchprofile/"+e,headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(t).then(function(e){},function(e){throw e})},l.clearSession=function(){var e={method:"POST",url:"api/account/logout/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return l.auth={isLoggedIn:!1,roles:null,authedUser:null},l.user=null,r(e).then(function(e){var t=document.querySelector("base").href.split("/")[3];return Cookies.remove("userRole",{path:"/"+t}),e.data},function(e){throw e})},l.editMyProfile=function(){var e={method:"PUT",url:"api/User/updateMyProfile/",data:l.user,headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(e).then(function(e){},function(e){throw e})},l.editProfile=function(){var e={method:"PUT",url:"api/user/"+l.getId()+"/",data:l.user,headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(e).then(function(e){return jQuery.extend(l.originalResponse.user,l.user),l.response},function(e){throw e})},l.taEditProfile=function(e){var t={method:"PUT",url:"api/user/update/",data:l.formatToSend(e),headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(t).then(function(e){return l.response=l.format(e.data),l.response},function(e){throw e})},l.getManagerSabaReportUrl=function(e){var t={method:"GET",url:"api/user/reportlink",headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(t).then(function(e){return e.data},function(){e()})},l.getLatitudeStateList=function(e){var t={method:"GET",url:"api/user/states/"+e+"/"};return r.get(t.url).then(function(e){return e.data},function(e){throw e})},l.getAllUsersForTa=function(){var e={method:"GET",url:"api/user/search",timeout:window.timeout};return r(e).then(function(e){return l.response=e.data,l.allUsersData=e.data,l.response},function(e){throw e})},l.deactivateUser=function(e){var t,n=moment().format("MM-DD-YYYY HH:mm:ss");t=n;var o={method:"PUT",url:"api/User/"+e,data:'"'+t+'"',timeout:window.timeout};return r(o).then(function(e){return l.response=e.data,l.response},function(e){throw e})},l.activateUser=function(e){var t={method:"PUT",url:"api/User/Activate/"+e,timeout:window.timeout};return r(t).then(function(e){return l.response=e.data,l.response},function(e){throw e})},l.batchUpdateUsers=function(e){var t={method:"PUT",url:"api/user/update/",timeout:window.timeout,data:e,headers:{"Content-Type":"application/json"}};return r(t).then(function(e){return l.response=e.data,l.response},function(e){throw e})},l.getUserTrainingAudit=function(e){var t={method:"GET",url:"api/user/"+e+"/trainingaudit/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(t).then(function(e){return l.response=l.format(e.data.response),l.response},function(e){throw e})},l.getIdesignUrl=function(){var e={method:"GET",url:"api/user/idesign",headers:{"Content-Type":"application/json"},timeout:1e5};return r(e).then(function(e){return e.data},function(e){throw e})},l.getNavigation=function(){var e=l.getUserType();switch(e){case 1:return[{id:1,display:"assignments",label:"Assignments",url:null},{id:2,display:"catalog",label:"Catalog",url:"catalog/"},{id:3,display:"transcripts",label:"Transcript",url:"users/transcripts/"},{id:4,display:"myProfile",label:"Profile",url:"users/account/"}]}},l.getUserType=function(){return 1},l.format=function(e){var t=["hireDate","endDate","assignmentAddedDate","assignmentRemovedDate"],r=null;for(var n in e){r=e[n];for(var o in r)"undefined"!=typeof r[o]&&null!==r[o]&&$.inArray(o,t)!==-1&&("hireDate"===o?r[o]=a.formatDate(r[o].fullDateTime):r[o]=a.formatDate(r[o]))}return e.hasOwnProperty("alternateManagers")&&("undefined"!=typeof e.alternateManagers&&null!==e.alternateManagers||(e.alternateManagers=[])),e.droppingStudent=!1,e.error=s.create(),e.isLoading=!1,e.showCheck=!1,e.showEx=!1,e.success=s.create(),e},l.formatToSend=function(e){var t=["endDate","startDate","displayStart","displayEnd","hireDate"];if(e.constructor!==Array)for(var r in e)"undefined"!=typeof e[r]&&null!==e[r]&&$.inArray(r,t)!==-1&&(e[r].jsDate?e[r]=a.formatDate(e[r].jsDate).utcDate:e[r]=a.formatDate(e[r]).utcDate),"undefined"!=typeof e[r]&&null!==e[r]&&e[r].constructor===Array&&l.formatToSend(e[r]);return e.constructor===Array&&_.each(e,function(e){l.formatToSend(e)}),e},l.formatSingleUser=function(e){return e=l.response="undefined"!=typeof l.response?l.response:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(pako.inflate(atob(decodeURIComponent(Cookies.get("user"))))))),null!==e&&(e=l.format(e)),e},l.formatMultipleUsers=function(e){if(e.length>0)for(var t in e)e[t]=l.format(e[t]);return e},l.setUpCreds=function(){l.originalResponse="undefined"!=typeof l.originalResponse&&null!==l.originalResponse?l.originalResponse:JSON.parse(String.fromCharCode.apply(null,new Uint8Array(pako.inflate(atob(decodeURIComponent(Cookies.get("user"))))))),l.response="undefined"!=typeof l.response&&null!==l.response?l.response:l.originalResponse,l.auth.isLoggedIn=!0,l.user=l.auth.authedUser=l.response.user,l.auth.roles=l.response.roles,l.userApplicationType=l.auth.userApplicationType=l.response.userApplicationType,l.auth.isTopLevel=l.response.isTopLevel,l.auth.taDomains=l.response.taDomains,l.auth.activeDomain=l.response.activeDomain,"Manager"===localStorage.getItem("sabaRole")?l.hasRole("manager")?(l.auth.currentRole=l.getRoleObjectByName("manager"),l.roleObj=l.auth.currentRole,l.setCurrentRoleCookie(),localStorage.removeItem("sabaRole")):(l.roleObj=l.response.currentRole,l.setCurrentRoleCookie()):"Instructor"===localStorage.getItem("sabaRole")?l.hasRole("instructor")?(l.auth.currentRole=l.getRoleObjectByName("instructor"),l.roleObj=l.auth.currentRole,l.setCurrentRoleCookie(),localStorage.removeItem("sabaRole")):(l.roleObj=l.response.currentRole,l.setCurrentRoleCookie()):(l.auth.currentRole=l.roleObj="undefined"!=typeof t.getObject("userRole")&&"null"!==t.getObject("userRole")?t.getObject("userRole"):l.response.currentRole,l.setCurrentRoleCookie())},l.setFromCookies=function(){var e=Cookies.get("user");if("undefined"!=typeof e){var t=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(pako.inflate(atob(decodeURIComponent(Cookies.get("user")))))));t&&(l.response=l.formatSingleUser(t),l.setUpCreds())}},l.isLoggedIn=function(){return l.auth.isLoggedIn},l.getUrlsForRoles=function(){var e=null,t=[];for(var r in l.auth.roles)switch(l.auth.roles[r].type){case"student":e={display:"student",label:"student",value:"student",roleName:"student"},t.push(e);break;case"instructor":e={display:"instructor",label:"Instructor",roleName:"instructor"},t.push(e);break;case"manager":e={display:"teamManagement",label:"Team Management",value:"manager",roleName:"manager"},t.push(e);break;case"admin":e={display:"administration",label:"Administration",roleName:"admin"},t.push(e);break;case"ta":e={display:"premiumAdmin",label:"Administration",value:"admin",roleName:"ta"},t.push(e);break;case"premiumAdmin":e={display:"premiumAdmin",label:"Premium Admin",value:"admin",roleName:"admin"},t.push(e)}return t},l.hasRole=function(e){var t="object"==typeof l.getRoleObjectByName(e);return t},l.isUserAboveStudent=function(){var e=l.auth.roles.length;return e>1},l.setUserContext=function(e){if(l.hasRole(e)){if(l.roleObj=l.getRoleObjectByName(e),"TA"!==l.roleObj.name||l.isSaba()){if("Instructor"!==l.roleObj.name||l.isSaba())return n(function(e){l.setCurrentRoleCookie(),e()});var t=l.switchProfile(l.auth.authedUser.topLevelOrganizationId);return t.then(function(e){l.setCurrentRoleCookie()},function(e){throw e})}if(void 0!==l.taDomains()[0]){var r=l.switchProfile(l.taDomains()[0].id);return r.then(function(e){l.auth.activeDomain=l.taDomains()[0],l.setCurrentRoleCookie()},function(e){throw e})}}},l.isSubDomainAdmin=function(){return null!==l.auth.isTopLevel&&(l.auth.isTopLevel===!1&&"ta"===l.auth.currentRole.type)},l.taDomains=function(){return l.auth.taDomains},l.activeDomain=function(){return l.auth.activeDomain},l.topLevelOrganizationId=function(){return l.auth.authedUser.topLevelOrganizationId},l.setCurrentRoleCookie=function(e){l.auth.currentRole=l.roleObj;var r=document.querySelector("base").href.split("/")[3];t.putObject("userRole",l.auth.currentRole,{path:"/"+r})},l.getRoleObjectByName=function(e){var t=l.auth.roles;if(null!==e&&t.length>0)for(var r in t)if(t[r].type===e)return t[r];return!1},l.getCurrentRole=function(){return l.auth.currentRole},l.getCurrentRoleType=function(){return l.auth.currentRole.type},l.isAdmin=function(){return"ta"===l.auth.currentRole.type},l.isManager=function(){return"manager"===l.auth.currentRole.type},l.isInstructor=function(){return"instructor"===l.auth.currentRole.type},l.isStudent=function(){return"student"===l.auth.currentRole.type},l.getName=function(){return l.user.firstName+" "+l.user.lastName},l.getJobPosition=function(){return l.user.jobTitle},l.isSaba=function(){return"saba"===l.userApplicationType.toLowerCase()},l.getId=function(){return l.user.id},l.getPortalId=function(){return l.user.portalId},l.getCountryId=function(){if(null!==l.user.homeAddress)return l.user.homeAddress.countryId},l.getStateId=function(){if(null!==l.user.homeAddress)return l.user.homeAddress.stateId},l.getPortalCode=function(){var e="undefined"!=typeof l.user&&null!==l.user.portalCode&&""!==l.user.portalCode?l.user.portalCode:null;return e},l.getAddress=function(){var e=l.user.homeAddress;if(null!==e)return o.formatAddress(e)},l.getHireDate=function(){var e="undefined"!=typeof l.user.hireDate.fullDateTime?l.user.hireDate.fullDateTime:l.user.hireDate.original;return a.formatDate(e).fullDate};var c={};c.firstName="Sean",c.lastName="Neilan",l.advancedSearch=function(e){var t=["terminatedAfter","terminatedBefore","startedOnOrBefore","startedOnOrAfter"];for(i=0;i<t.length;i+=1)if(e[t[i]]){var n=moment.utc(e[t[i]]);"startedOnOrBefore"!==t[i]&&"terminatedBefore"!==t[i]||n.add(1,"d"),e[t[i]]=n.toDate()}var o={method:"GET",url:"api/user/search/?"+u(e),timeout:window.timeout};return r(o).then(function(e){return e.data},function(e){throw e})},l.format_advancedSearch=function(){},l.getSabaManagerReportUriFromCookie=function(){var e="undefined"!=typeof Cookies.get("managerReportSabaURI")&&"manager"===l.getCurrentRoleType()?Cookies.get("managerReportSabaURI"):null;return e},l.createUser=function(e){var t={method:"POST",url:"api/user/",timeout:window.timeout,data:[l.formatToSend(e)]};return r(t).then(function(e){return e.data},function(e){throw e})},l.getAllInstructors=function(){var e={method:"GET",url:"api/user/instructors/",timeout:window.timeout};return r(e).then(function(e){return l.formatMultipleUsers(e.data)},function(e){throw e})},l.isInFuture=function(e){var t=new Date,r=new Date(e.hireDate.fullDateWithTime);if(t<r&&null===e.endDate)return!0},l.isUserActive=function(e){var t=new Date;if(void 0===e.hireDate)return!1;var r=new Date(e.hireDate.fullDateTime);if(t<r)return!1;if(null===e.endDate)return!0;var n=new Date(e.endDate);return!(t>n)&&(t<n||(t===r||void 0))},l.isSSO=function(){var e={method:"GET",
url:"api/user/isSSO/",headers:{"Content-Type":"application/json"},timeout:window.timeout};return r(e).then(function(e){return l.response=e.data,l.response},function(e){throw e})},l.getManagerTree=function(){var e={method:"GET",url:"api/user/managers/",timeout:window.timeout};return r(e).then(function(e){return e.data},function(e){throw e})}}]),app.controller("accountController",["$location","$scope","$window","$timeout","BreadcrumbsService","CountriesService","StatesService","UsersService",function(e,t,r,n,o,a,s,i){t.user=i,t.apiError=!1,t.isLoading=!1,t.success=!1,t.passwordChangeSuccess=!1,t.showPasswordForm=!1,t.showEditProfileForm=!1,t.isSaba=!1,t.countryId=null,t.StateId=null,t.latitudeCountryList=null,t.stateList=null,i.isSaba()?(a.getCountryList().then(function(e){t.countryList=e}),t.isSaba=!0):(t.isSaba=!1,"undefined"!=typeof t.user.getCountryId()&&null!==t.user.user.homeAddress||(t.user.user.homeAddress={}),a.getLatitudeCountryList(i.getPortalId()).then(function(e){t.latitudeCountryList=e;var r=t.user.getCountryId()||222;s.getLatitudeStateList(r).then(function(e){t.stateList=e,t.user.user.homeAddress.stateId=""+i.getStateId()})})),t.loadStates=function(e){s.getLatitudeStateList(e).then(function(e){t.stateList=e})},t.resetMessages=function(){t.apiError=!1,t.isLoading=!1,t.success=!1,t.passwordChangeSuccess=!1},t.clearDisplays=function(){t.resetMessages(),t.showPasswordForm=!1,t.showEditProfileForm=!1},t.displayLoading=function(){t.resetMessages(),t.isLoading=!0},t.displayApiError=function(){t.resetMessages(),t.apiError=!0},t.displaySuccess=function(){t.resetMessages(),t.success=!0},t.displayPasswordChangeSuccess=function(){t.resetMessages(),t.passwordChangeSuccess=!0},t.toggleEditProfileForm=function(){t.showPasswordForm=!1,t.showEditProfileForm=!t.showEditProfileForm},t.togglePasswordForm=function(){t.showEditProfileForm=!1,t.showPasswordForm=!t.showPasswordForm},t.changePassword=function(){t.displayLoading();var e=i.resetPassword(this.baiform.password.$viewValue);e.then(function(){t.displayPasswordChangeSuccess()},function(){t.displayApiError()}).then(function(){n(function(){jQuery("#showForm").toggle(),t.clearDisplays()},3e3)})},t.editProfile=function(){t.displayLoading();var e=i.editMyProfile();e.then(function(){r.location.reload()},function(){t.displayApiError()})},t.clearForm=function(){r.location.reload()},"undefined"!=typeof e.search().resetpw&&"true"===e.search().resetpw&&t.togglePasswordForm(),o.pushCrumb("assignments","users/home"),o.pushCrumb("profile")}]),app.controller("assignmentsTaController",["$sce","$scope","$route","$window","RoleMapsMixin","UsersService","BreadcrumbsService",function(e,t,r,n,o,a,s){var i=r.current.params.name;t.courseFailure=!1,t.isLoading=!0,t.user=a,t.homeAction=function(){},t.dump=function(e){void 0},o.overrideScope(t),t[i+"Action"]()}]),app.controller("catalogController",["$sce","$scope","$location","$route","$window","AssignmentsService","CatalogService","CoursesService","UsersService","BreadcrumbsService","TypeMapsMixin","DocumentService",function(e,t,r,n,o,a,s,i,u,l,c,d){var p="undefined"!=typeof n.current.params.param?n.current.params.param.split("/"):null,m=null!==p&&p.length>0?p[0]:null,f=null!==p&&"courses"===p[1],g=s.fetch(m);t.apiActionLoader=!1,t.apiError=!1,t.coursesOnly=f,t.isLoading=!0,t.oneAtATime=!0,t.role="student";var h=this;h.BreadcrumbsService=l,g.then(function(e){if(null!==m&&(t.iconImage=e.iconImage),t.catalog=e,t.generateBreadCrumbs(),f===!0){var r=[],n=null;for(var o in e.children)e.children[o].isParent===!1&&(n=null!==e.children[o].courseId?e.children[o].courseId:e.children[o].nodeId,r.push(n));var a=i.fetchMany(u.getId(),r);a.then(function(e){t.apiError=!1,t.assignments=e,t.isLoading=!1,t.responseComplete=!0},function(e){t.isLoading=!1,t.apiError=!0})}else t.apiError=!1,t.isLoading=!1},function(e){}),t.generateBreadCrumbs=function(){var r="";if(h.BreadcrumbsService.pushCrumb("assignments","users/home"),h.BreadcrumbsService.pushCrumb("catalog","catalog/"),null!==p){var n=t.catalog;r+=n.title,h.BreadcrumbsService.pushCrumb(n.title)}t.breadcrumbs=e.trustAsHtml(r)},t.showCourseListUrlButton=function(e){if(null!==e)for(var t in e)if(e[t].isParent)return!1;return!0},t.forwardToCourses=function(e){r.url("catalog/view/"+e+"/courses/")},t.addOriginInfo=function(e){var t="undefined"!=typeof window.location.origin?window.location.origin:"";return e.indexOf(t)===-1&&(e=t+e),e},t.launchCourse=function(e){if("wbt"===e.type){if(t.launcherUrlTitle=e.name,0!==e.resourceLaunchWithContent){var r=d.getSingleDocumentInfo(e.resourceLaunchWithContent);r.then(function(e){if("undefined"!=typeof e&&"undefined"!=typeof e.launchUri){var r=e.launchUri;"url"!==e.fileFormat&&(r=t.addOriginInfo(r)),window.open(r)}})}var n=i.getCourseUrl(e.id,e.type,u.getId());n.then(function(r){var n=null;if(n="undefined"!=typeof r&&"undefined"!=typeof r.uri?r.uri:r,e.isInCourseGroup){var s=i.getCourseUrl(e.isInCourseGroup,e.type,u.getId());s.then(function(e){})}var l=t.addOriginInfo(n),c=window.open(l);if("wbt"===e.type){var d=null,p=a.fetchSingle(e.id,e.type);p.then(function(e){d=e});var m=setInterval(function(){if(c.closed){clearInterval(m);var e="/",t=document.getElementsByTagName("base");t.length>0&&(e=t[0].href),e+="courses/certificate/"+d.transcriptId+"/",o.location.href=e}},500)}},function(e){t.mainErrorFailure=!0,t.mainErrorFailureMessage="There was a problem launching your course! Please try again later.",jQuery("#topErrorMessage").slideDown(function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500),t.mainErrorFailure=!1},2e3)})})}},t.showScormPlayer=function(){jQuery("#showScorm").slideUp(500),t.userAcceptsRisk=!0,jQuery("#launcherFrame").prop("src",jQuery("#launcherFrame").prop("src"))},t.closeScormPlayer=function(){jQuery("#launcherFrame").prop("src",""),jQuery("#launcherFrame").prop("ng-src","")},t.dropElectiveCourse=function(e,t){var r=i.dropElectiveCourse(e,u.getId());r.then(function(e){jQuery(t.currentTarget).slideUp()},function(e){})},t.openAccordion=function(e){setTimeout(function(){$('div[aria-selected="true"] .plusMinus').html("-"),$('div[aria-selected="false"] .plusMinus').html("+")},1)},t.getFullAssignmentTypeName=c.getFullAssignmentTypeName,t.dump=function(e){void 0}}]),app.controller("coursesController",["$sce","$scope","$route","$window","$location","RoleMapsMixin","CoursesService","UsersService","SettingsService","BreadcrumbsService","AssignmentsService","TranscriptsService",function(e,t,r,n,o,a,s,i,u,l,c,d){var p=r.current.params.name,m=this;t.courseFailure=!1,t.isLoading=!0,t.user=i,t.certificateAction=function(){var e=r.current.params.param.split("/"),n=e[0],o=e[1];if(""===e[1]&&(n=t.user.user.id,o=e[0]),u.maxEnrollmentAttemptsAllowed===-1){var a=u.getSettings();a.then(function(e){m.assignmentGet(n,o)},function(e){m.assignmentGet(n,o)})}else m.assignmentGet(n,o)},m.assignmentGet=function(e,r){var n=d.getSingleTranscript(e,r);n.then(function(e){m.assignmentGetSuccess(e)},function(e){t.courseFailure=!0,t.isLoading=!1})},m.assignmentGetSuccess=function(e){t.completionView="app/templates/courses/components/unsuccessful.html",t.assignment=e,t.launchButtonText="Relaunch",t.requestingApproval=!1,t.isLoading=!1,t.isSaba=i.isSaba(),!t.isSaba&&e.isManagerApprovalRequired&&"inProgress"!==e.status&&(t.launchButtonText="Request Approval",t.requestingApproval=!0),m.BreadcrumbsService=l,"wbt"===t.assignment.type?t.fullTypeName="Web Based":"ilt"===t.assignment.type?t.fullTypeName="Instructor Led":t.fullTypeName=t.assignment.type,"successful"===e.status?(t.completionView="app/templates/courses/components/successful.html",t.generateBreadCrumbs("Successful")):t.generateBreadCrumbs("Unsuccessful")},t.generateBreadCrumbs=function(r){var n="";m.BreadcrumbsService.pushCrumb("assignments","users/home"),m.BreadcrumbsService.pushCrumb("transcripts","users/transcripts"),"unsuccessful"===r?m.BreadcrumbsService.pushCrumb("Unsuccessful"):"successful"===r?m.BreadcrumbsService.pushCrumb("Successful"):m.BreadcrumbsService.pushCrumb(r),t.breadcrumbs=e.trustAsHtml(n)},t.addOriginInfo=function(e){var t="undefined"!=typeof window.location.origin?window.location.origin:"";return e.indexOf(t)===-1&&(e=t+e),e},t.launchCourse=function(e){if(("wbt"===e.type||"survey"===e.type||"evaluation"===e.type)&&c.isCourseRelaunchable(e)){var r={};switch(0!==e.resourceLaunchWithContent&&e.courseAssets.forEach(function(r){if(r.id===e.resourceLaunchWithContent){var n="url"!==r.fileFormat?t.addOriginInfo(r.launchUri):r.launchUri;window.open(n)}}),t.assignment=e,t.launcherUrlTitle=e.name,t.launchCourseLoader=!0,jQuery("#launchCourseLoader-"+e.id).toggle(),jQuery("#launchCourseLoaderPlayButton-"+e.id).toggle(),e.type){case"wbt":r=s.getCourseUrl(e.id,e.type,i.getId());break;case"evaluation":r=EvaluationService.fetchSingle(i.getId(),e.offeringId);break;case"survey":r=SurveyService.fetchSingle(i.getId(),e.id)}r.then(function(r){var o=null;if(o="undefined"!=typeof r&&"undefined"!=typeof r.uri?r.uri:"undefined"!=typeof r&&"undefined"!=typeof r.contentLaunchUrl?r.contentLaunchUrl:r,e.isInCourseGroup){var a=s.getCourseUrl(e.isInCourseGroup,e.type,i.getId());a.then(function(e){})}var u=t.addOriginInfo(o),l=window.open(u);if("wbt"===e.type){var d=null,p=c.fetchSingle(e.id,e.type);p.then(function(e){d=e});var m=setInterval(function(){if(l.closed){clearInterval(m);var e="/",t=document.getElementsByTagName("base");t.length>0&&(e=t[0].href),e+="courses/certificate/"+d.transcriptId+"/",n.location.href=e}},500)}},function(r){(t.requestingApproval||r.ErrorMessage.indexOf("pending manager approval")>0)&&o.path("users/home"),jQuery("#launchCourseLoader-"+e.id).toggle(),jQuery("#launchCourseLoaderPlayButton-"+e.id).toggle(),t.launchCourseLoader=!1,t.mainErrorFailure=!0,t.mainErrorFailureMessage="There was a problem launching your course! Please try again later.",jQuery("#topErrorMessage").slideDown(function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500),t.mainErrorFailure=!1},2e3)})})}},t.dump=function(e){void 0},a.overrideScope(t),"ilt-calendar"===p?t.iltCalendarAction():t[p+"Action"]()}]),app.controller("documentsController",["$sce","$scope","$location","$route","DocumentService","BreadcrumbsService",function(e,t,r,n,o,a){var s="undefined"!=typeof n.current.params.param?n.current.params.param.split("/"):null,i=null!==s&&s.length>0?s[0]:null,u=!1,l=o.fetch(i);t.apiActionLoader=!1,t.apiError=!1,t.coursesOnly=u,t.isLoading=!0,t.oneAtATime=!0,t.notFound=!1,t.BreadcrumbsService=a,l.then(function(e){t.documents=e,t.generateBreadCrumbs(),t.isLoading=!1,t.apiError=!1},function(e){404===e.StatusCode?(t.notFound=!0,t.notFoundErrorMessage=e.ErrorMessage):t.apiError=!0,t.isLoading=!1}),t.generateBreadCrumbs=function(){a.pushCrumb("assignments","users/home");var r="";if(null!==s&&void 0!==t.documents.nodeId){var n=t.documents;r+=n.name,a.pushCrumb("documents","documents"),a.pushCrumb(n.name)}else a.pushCrumb("documents");t.breadcrumbs=e.trustAsHtml(r)},t.getHtml=function(t){return e.trustAsHtml(t)},t.openAccordion=function(e){setTimeout(function(){$('div[aria-selected="true"] .plusMinus').html("-"),$('div[aria-selected="false"] .plusMinus').html("+")},1)}}]),app.controller("footerController",["$scope",function(e){e.copyrightYear=moment().format("YYYY")}]),app.controller("headerController",["$scope","$location",function(e,t){e.searchFor=function(e){e&&t.url("/search/?q="+encodeURIComponent(e))}}]),app.controller("helpController",["$scope","$route","$location","$anchorScroll","BreadcrumbsService","UsersService",function(e,t,r,n,o,a){var s=this,i=t.current.params.name;if(e.isPremiumContent=!1,e.isLoading=!1,e.hasInstructorRole=!!_.findWhere(a.auth.roles,{type:"instructor"}),e.hasManagerRole=!!_.findWhere(a.auth.roles,{type:"manager"}),e.hasTaRole=!!_.findWhere(a.auth.roles,{type:"ta"}),e.scrollTo=function(e){r.hash(e),n()},s.studentAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("student user manual")},s.studentquickstartAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("student quick start")},s.studentdemovideoAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("student demo video")},s.instructorAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("instructor user manual")},s.instructorquickstartAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("instructor quick start")},s.instructordemovideoAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("instructor demo video")},s.managerAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("manager user manual")},s.managerquickstartAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("manager quick start")},s.managerdemovideoAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("manager demo video")},s.taAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("training administrator user manual")},s.taquickstartAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("training administrator quick start")},s.tademovideoAction=function(){o.pushCrumb("help","help/"),o.pushCrumb("training administrator demo video")},"undefined"==typeof i)o.pushCrumb("help");else switch(i.toLowerCase()){case"student":s.studentAction();break;case"studentquickstart":s.studentquickstartAction();break;case"studentdemovideo":s.studentdemovideoAction();break;case"instructor":s.instructorAction();break;case"instructorquickstart":s.instructorquickstartAction();break;case"instructordemovideo":s.instructordemovideoAction();break;case"manager":s.managerAction();break;case"managerquickstart":s.managerquickstartAction();break;case"managerdemovideo":s.managerdemovideoAction();break;case"ta":s.taAction();break;case"taquickstart":s.taquickstartAction();break;case"tademovideo":s.tademovideoAction()}}]),app.controller("indexController",["$rootScope","$scope","$timeout","$location","$route","UsersService","SearchServices","loginBackgroundUtil","messagingDisplayerUtil",function(e,t,r,n,o,a,s,i,u){t.forgotPassTemplateSwitcher=!1,t.loading=!1,t.iframeLoaded=!1,t.lockOut=!1;var l=0;t.loginstate={},t.loginstate.error=u.create(),window.iframeLoadedCallBack=function(){t.iframeLoaded=!0},t.login=function(){if(!(l>=10)){var e=this.username,r=this.password;t.loading=!0,a.login(e,r).then(function(e){var r=e.loginStatus;"resetPassword"===r?(t.password="",jQuery(".signin").toggle(),jQuery(".resetpassword").toggle()):n.url("/users/home/?welcome=true")},function(e){t.loading=!1,t.loginstate.error.setError(e.StatusCode,e.ErrorMessage)})}},t.submitPasswordReset=function(){var e=this.username;a.requestTemporaryPassword(e).then(function(e){t.forgotForm(2),t.password="",setTimeout(function(){t.forgotForm(3)},1e3)},function(e){t.loading=!1;var r=e,n=500;r.indexOf("Invalid User")>0?t.errorMessage="Username Not Found":(t.errorMessage="This is a SSO Username. Please contact your Training Administrator if you are experiencing any error while attempting to Log In using SSO.",n=8e3),jQuery("#username-error").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(parseInt(500))},n)})})},t.checkNewPassword=function(){var e=this.password,r=this.username;a.validatePassword(r,e).then(function(){t.password="",t.forgotForm(4),setTimeout(function(){t.forgotForm(5)},1e3)},function(){t.loading=!1,jQuery("#reset-error").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500)},1e3)})})},t.resetPassword=function(){var e=this.password,r=this.username;a.resetPassword(e).then(function(){t.forgotForm(6),a.login(r,e).then(function(){n.url("/users/home/")},function(){})},function(e){t.loading=!1,jQuery("#reset-error").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500)},1e3)})})},t.forgotPassClick=function(e){t.forgotPassTemplateSwitcher=e}}]),app.controller("managementController",["$route","$scope","RoleMapsMixin",function(e,t,r){var n=e.current.params.name;r.overrideScope(t),t[n+"Action"]()}]),app.controller("messagesController",["$sce","$scope","$route","$window","RoleMapsMixin","MessagesService","UsersService","errorDisplayerUtil",function(e,t,r,n,o,a,s,i){var u=r.current.params.name;t.dump=function(e){void 0},t.messaging={},t.messaging.error=i.create(),t.messaging.isLoading=!1,t.role=s.hasRole("ta")===!0?"admin":"student",t.homeAction=function(){},t.inboxAction=function(){t.homeTemplate="app/templates/messages/inbox/"+t.role+".html",t.messaging.isLoading=!0;var e=a.fetch();e.then(function(e){if(t.messaging.isLoading=!1,t.messages=e,t.tooMany=!1,t.messageCount=t.messages.length,t.messageCount>2){var r=[];r.push(t.messages[0]),t.messages=r,t.tooMany=!0}},function(e){t.isLoading=!1,t.messaging.error.setError(e.ErrorCode,e.ErrorMessage)})},o.overrideScopeByRole(t,t.role),t[u+"Action"]()}]),app.controller("navigationController",["$location","$q","$rootScope","$scope","$window","BreadcrumbsService","MessagesService","TasksService","TeamService","UsersService",function(e,t,r,n,o,a,s,i,u,l){function c(e){e.addEventListener("click",function(e){e.preventDefault();this.classList.contains("is-active")===!0?this.classList.remove("is-active"):this.classList.add("is-active")})}var d=this;d.messageCount=0,n.messageCount=0,d.messageBubbleCompletedRequestTotal=0,d.messageBubbleTotalPossibleRequests=1;var p=s.fetch();if(p.then(function(e){if(d.messageBubbleCompletedRequestTotal++,n.messages=e,n.tooMany=!1,d.messageCount+=n.messages.length,n.messageCount>2){var t=[];t.push(n.messages[0]),n.messages=t,n.tooMany=!0}d.showNotifications()},function(e){d.messageBubbleCompletedRequestTotal++,d.showNotifications()}),l.isAdmin()===!0){d.messageBubbleTotalPossibleRequests+=2;var m=u.getListOfAssignmentsToApprove();m.then(function(e){d.messageBubbleCompletedRequestTotal++,d.messageCount+=e.length,d.showNotifications()},function(e){d.messageBubbleCompletedRequestTotal++,d.showNotifications()});var f=i.getTasksApprovalTA();f.then(function(e){d.messageBubbleCompletedRequestTotal++,d.messageCount+=e.length,d.showNotifications()},function(e){d.messageBubbleCompletedRequestTotal++,d.showNotifications()})}d.showNotifications=function(){d.messageBubbleCompletedRequestTotal===d.messageBubbleTotalPossibleRequests&&(n.messageCount=d.messageCount)},n.getUrlsForRoles=l.getUrlsForRoles(),n.isSabaUser=l.isSaba(),n.hasStudentRole=!!_.findWhere(n.getUrlsForRoles,{roleName:"student"}),n.hasManagerRole=!!_.findWhere(n.getUrlsForRoles,{roleName:"manager"}),n.hasInstructorRole=!!_.findWhere(n.getUrlsForRoles,{roleName:"instructor"}),n.hasAdminRole=!(!_.findWhere(n.getUrlsForRoles,{roleName:"admin"})&&!_.findWhere(n.getUrlsForRoles,{roleName:"ta"})),n.navLinks=l.getNavigation(),n.user=l.user,n.openSideNav=function(){jQuery("#flyout").slideToggle()},n.closeMessagePopup=function(e){var t=jQuery(e.currentTarget);t.parents(".message").fadeOut(500)},n.logout=function(){var t=l.getPortalCode(),r=l.clearSession();r.then(function(r){""!==t&&null!==t&&(t="?portal="+t),e.url(""+t),n.$$phase||n.$apply(),o.location.reload()},function(e){})},n.changeUserScope=function(t,r){var n=l.setUserContext(t);n.then(function(){"undefined"!=typeof r&&null!==r?e.url(r):"/users/home/"===e.url()?o.location.reload():e.url("users/home/")})};for(var g=document.querySelectorAll(".c-hamburger"),h=g.length-1;h>=0;h--){var v=g[h];c(v)}n.$watch(function(){return a.getCrumbs()},function(e,t){n.breadcrumbs=e},!0),n.$on("requestApprovals:action:success",function(){n.messageCount-1>0?n.messageCount-=1:n.messageCount=0}),n.launchReports=function(){var e=l.getManagerSabaReportUrl();e.then(function(e){var t=e,r=o.open("about:blank","_blank");r.location=t},function(e){})},n.displayChromeWarning=!1;var y=function(e,t){for(a1=e.split("."),a2=t.split("."),h=0;h<a1.length;h++){if(Number(a1[h])<Number(a2[h]))return-1;if(Number(a1[h])>Number(a2[h]))return 1}return a1.length<a2.length?1:0},C="56.0.0.0",S="57.0.2987.88",w=navigator.userAgent.match(/Chrom(e|ium)\/([0-9].+) /),D=!!w&&w[2];D&&D.trim()&&y(D,C)>=0&&y(D,S)<0&&(n.displayChromeWarning=!0)}]),app.controller("offeringsController",["$scope","$location","$route","$window","errorDisplayerUtil","OfferingsService","RoleMapsMixin","RosterService","UsersService",function(e,t,r,n,o,a,s,i,u){var l=r.current.params.name;e.data=e.offering={},e.cancellingOffering=!1,e.isLoading=!1,e.offeringDate=new Date,e.userSearchOptions={},e.userSearchOptions.error=o.create(),e.userSearchOptions.searched=!1,e.userSearchOptions.selected=0,e.rosterStatus="default",e.selectedSession=1,e.sessions=null,e.sessionOrder="lowestSessionDateForOffering.startDate",e.statuses=e.completionStatuses,s.overrideScope(e),e[l+"Action"]()}]),app.controller("rulesController",["$sce","$scope","$route","$window","RoleMapsMixin","UsersService","BreadcrumbsService",function(e,t,r,n,o,a,s){var i=r.current.params.name;t.courseFailure=!1,t.isLoading=!0,t.user=a,t.homeAction=function(){},t.dump=function(e){void 0},o.overrideScope(t),t[i+"Action"]()}]),app.controller("searchController",["$scope","$route","$sce","$window","AssignmentsService","SearchServices","CoursesService","UsersService","BreadcrumbsService","TypeMapsMixin","courseFormatterUtil","DocumentService",function(e,t,r,n,o,a,s,i,u,l,c,d){var p=this;a.setRequest(t.current.params.q),e.apiError=!1,e.isLoading=!0,e.role="student",e.search=a.request,e.courseCodeFormatter=c.getCourseCodeForImage,u.pushCrumb("assignments","users/home"),u.pushCrumb("search results"),p.searchAction=function(){e.isLoading=!0;var t=a.fetch();t.then(function(t){e.apiError=!1,e.searchResults=t,e.isLoading=!1},function(t){e.apiError=!0})},p.searchAction(),e.getHtml=function(e){return r.trustAsHtml(e)},e.$on("slideDownDirective:refreshCurrentPage",function(){e.isLoading=!0,p.searchAction()}),e.scheduleOffering=function(t,r,n){var o=s.scheduleOffering(t,i.getId(),r,n);o.then(function(t){jQuery("#offeringSlide").slideUp(),jQuery("#success").slideDown(500,function(){var t=jQuery(this);setTimeout(function(){t.slideUp(500),e.apiActionError=!1},1500)})},function(t){jQuery("#offeringSlide").slideUp(),e.apiErrorMessage="Sorry! There was a problem saving your offering. Please try again.",e.apiActionError=!0,jQuery("#underButtonError").slideDown(500,function(){var t=jQuery(this);setTimeout(function(){t.slideUp(500),e.apiActionError=!1},1500)})})},e.dropElectiveCourse=function(t,r){e.apiActionError=!1,e.apiActionLoader=!0;var n=confirm("Are you sure you want to drop?");if(n){var o=s.dropElectiveCourse(t,i.getId());o.then(function(e){jQuery("#singlecourse").slideUp(1e3,function(){var e=t.id,r=jQuery("#courseList-"+e).length>0?"#courseList-"+e:"#courseTiles-"+e;jQuery(r).slideUp(500,function(){$rootScope.$broadcast("slideDownDirective:refreshCurrentPage")})})},function(t){e.apiActionError=!0,e.apiErrorMessage="Sorry! There was an issue dropping your course. Please try again!",e.apiActionLoader=!1,jQuery("#apiFullFailure").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500)},1500)})})}else e.apiActionLoader=!1},e.getCourseFromSearchResult=function(e){return e.id>-1},e.getDocumentsFromSearchResult=function(e){return"file"===e.type},e.switchSearchFilter=function(t,r){e.searchType=t,e.searchType=null!==t?e[t]:null,jQuery(r.currentTarget).siblings(".filterItem").removeClass("selected"),jQuery(r.currentTarget).addClass("selected")},e.addOriginInfo=function(e){var t="undefined"!=typeof window.location.origin?window.location.origin:"";return e.indexOf(t)===-1&&(e=t+e),e},e.launchCourse=function(t,r){if(e.launcherUrlTitle=t.name,e.launchCourseLoader=!0,jQuery("#launchCourseLoader-"+t.id).toggle(),jQuery("#launchCourseLoaderPlayButton-"+t.id).toggle(),jQuery("#loader-"+r).show(),jQuery("#launcherHolder-"+r).hide(),jQuery("#approvalHolder-"+r).hide(),jQuery("#errorShower-"+r).hide(),"wbt"===t.type&&0!==t.resourceLaunchWithContent){var a=d.getSingleDocumentInfo(t.resourceLaunchWithContent);a.then(function(t){if("undefined"!=typeof t&&"undefined"!=typeof t.launchUri){var r=t.launchUri;"url"!==t.fileFormat&&(r=e.addOriginInfo(r)),window.open(r)}})}var u=s.getCourseUrl(t.id,t.type,i.getId());u.then(function(r){var a=null;if(a="undefined"!=typeof r&&"undefined"!=typeof r.uri?r.uri:r,t.isInCourseGroup){var u=s.getCourseUrl(t.isInCourseGroup,t.type,i.getId());u.then(function(e){})}var l=e.addOriginInfo(a),c=window.open(l);if("wbt"===t.type){var d=null,p=o.fetchSingle(t.id,t.type);p.then(function(e){d=e});var m=setInterval(function(){if(c.closed){clearInterval(m);var e="/",t=document.getElementsByTagName("base");t.length>0&&(e=t[0].href),e+="courses/certificate/"+d.transcriptId+"/",n.location.href=e}},500)}},function(t){jQuery("#loader-"+r).hide(),jQuery("#launcherHolder-"+r).show(),jQuery("#errorShower-"+r).show(),e.mainErrorFailure=!0,e.mainErrorFailureMessage="There was a problem launching your course! Please try again later.",jQuery("#errorShower-"+r).slideDown(function(){var t=jQuery(this);setTimeout(function(){t.slideUp(500),e.mainErrorFailure=!1},2e3)})})},e.requestApproval=function(t){var r=s.requestManagerialApproval(t,i.getId());r.then(function(t){e.isLoading=!0,p.searchAction(),jQuery("#offeringSlide").slideUp()},function(e){})},e.mapStatusLabel=function(e){var t={completed:"Completed",inProgress:"In Progress","new":"New",pendingApproval:"Pending Approval",successful:"Successful",unsuccessful:"Unsuccessful"};return e in t?t[e]:e},e.toggleDescription=function(e){var t=jQuery(e.currentTarget).parents(".title").children(".description"),r=jQuery('.description[data-opened="true"]');r.each(function(e,r){$(r).attr("data-assignment-id")!==$(t).attr("data-assignment-id")&&($(r).attr("data-opened","false"),$(r).slideDown())});var n=t.attr("data-opened");void 0===n?(void 0,t.attr("data-opened","true"),t.slideUp()):"true"===n?(void 0,t.attr("data-opened","false"),t.slideDown()):"false"===n&&(void 0,t.attr("data-opened","true"),t.slideUp())},e.getFullAssignmentAssetTypeName=function(e){var t;return"wbt"===e?t="Web Based Training":"ilt"===e?t="Instructor Led Training":"vle"===e?t="Virtual Classroom":"task"===e?t="Tasks":"survey"===e?t="Surveys":"evaluation"===e?t="Evaluations":"assessment"===e?t="Assessments":"courseGroups"===e&&(t="Course Groups"),t},e.dump=function(e){void 0},e.getFullAssignmentTypeName=l.getFullAssignmentTypeName}]),app.controller("usersController",["$compile","$filter","$location","$rootScope","$route","$scope","$sce","$window","AssignmentsService","CoursesService","EvaluationService","AssessmentService","OfferingsService","SurveyService","TranscriptsService","UsersService","BreadcrumbsService","TypeMapsMixin","RoleMapsMixin","errorDisplayerUtil",function(e,t,r,n,o,a,s,i,u,l,c,d,p,m,f,g,h,v,y,C){var S=o.current.params.name,w=this;a.addApiError=!1,a.apiActionLoader=!1,a.apiError=!1,a.dateRangeError=!1,a.day=moment(),a.isFutureSelected=!0,a.isLoading=!0,a.launchCourseLoader=!1,a.mainErrorFailure=!1,a.myDate=new Date,a.offeringsAreLoading=!1,a.orderProperty="dueDate.original",a.responseComplete=!1,a.role=g.getCurrentRoleType(),a.filterView="app/templates/users/partials/filters/"+a.role+".html",a.showCompletionButton=!1,a.singleIsLoading=!1,a.user=g,a.userAcceptsRisk=!1,a.currentAssignmentFilter="getRequiredAssignments",a.sortBy="name",a.searchEndDate=moment(new Date).format("YYYY-MM-DD"),a.searchStartDate=new Date,a.searchStartDate=moment(a.searchStartDate.setYear(a.searchStartDate.getFullYear()-1)).format("YYYY-MM-DD"),w.BreadcrumbsService=h,a.pageOptions={},a.pageOptions.error=C.create(),a.pageOptions.isLoading=!1,a.$on("slideDownDirective:refreshCurrentPage",function(){a.isLoading=!0,"ilt-calendar"===S?a.iltCalendarAction():a[S+"Action"]()}),a.calendarAction=function(e){a.properFiltering="dueDate",a.assignmentFilter=a.getRequiredAssignments,a.orderProperty="dueDate.original",a.role="student",a.fetchAssignments(),w.BreadcrumbsService.pushCrumb("assignments","users/home"),w.BreadcrumbsService.pushCrumb("calendar")},a.editCourse=function(){void 0},a.fetchAssignments=function(){var e=u.fetch(g.getId());a.filterView="app/templates/users/partials/filters/"+a.role+".html",e.then(function(e){var t=e;a.apiError=!1,a.assignments=t,a.isLoading=!1,a.responseComplete=!0},function(e){a.apiError=!0,a.isLoading=!1,a.responseComplete=!0,404===e.status?a.errorMessage="Sorry, there were no results found for your request.":a.errorMessage="There was an error processing your request! Please try again later!"})},a.scheduleCourse=function(e){},a.trim=function(e,r){return t("trimmer")(e,!0,r)},a.addOriginInfo=function(e){var t="undefined"!=typeof window.location.origin?window.location.origin:"";return e.indexOf(t)===-1&&(e=t+e),e},a.launchCourse=function(e){if(("wbt"===e.type||"survey"===e.type||"evaluation"===e.type||"assessment"===e.type)&&u.isCourseRelaunchable(e)){0!==e.resourceLaunchWithContent&&e.courseAssets.forEach(function(t){if(t.id===e.resourceLaunchWithContent){var r="url"!==t.fileFormat?a.addOriginInfo(t.launchUri):t.launchUri;window.open(r)}});var t={};switch(a.assignment=e,a.launchCourseLoader=!0,a.launcherUrlTitle=e.name,jQuery("#launchCourseLoader-"+e.id).toggle(),jQuery("#launchCourseLoaderPlayButton-"+e.id).toggle(),e.type){case"wbt":t=l.getCourseUrl(e.id,e.type,g.getId());break;case"evaluation":t=c.fetchSingle(g.getId(),e.id);break;case"assessment":t=d.fetchSingle(g.getId(),e.id);break;case"survey":t=m.fetchSingle(g.getId(),e.id)}t.then(function(t){var r=null;if(r="undefined"!=typeof t&&"undefined"!=typeof t.uri?t.uri:"undefined"!=typeof t&&"undefined"!=typeof t.contentLaunchUrl?t.contentLaunchUrl:t,e.isInCourseGroup){var n=l.getCourseUrl(e.isInCourseGroup,e.type,g.getId());n.then(function(e){})}var o=a.addOriginInfo(r),s=window.open(o);if("wbt"===e.type){var c=null,d=u.fetchSingle(e.id,e.type);d.then(function(e){c=e});var p=setInterval(function(){if(s.closed){clearInterval(p);var e="/",t=document.getElementsByTagName("base");t.length>0&&(e=t[0].href),e+="courses/certificate/"+c.transcriptId+"/",i.location.href=e}},500)}else var m=setInterval(function(){s.closed&&(clearInterval(m),i.location.reload())},500)},function(t){t.ErrorMessage.indexOf("pending manager approval")>0&&r.path("users/home"),jQuery("#launchCourseLoader-"+e.id).toggle(),jQuery("#launchCourseLoaderPlayButton-"+e.id).toggle(),a.launchCourseLoader=!1,a.mainErrorFailure=!0,a.mainErrorFailureMessage="There was a problem launching your course! Please try again later.",jQuery("#topErrorMessage").slideDown(function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500),a.mainErrorFailure=!1},2e3)})})}},a.changeTranscriptDate=function(e){var t="undefined"!=typeof this.transcriptSearch.startDate?this.transcriptSearch.startDate:null,r="undefined"!=typeof this.transcriptSearch.endDate?this.transcriptSearch.endDate:null;if(null!==t&&null!==r||null===t&&null===r){if(t>r)return void(a.dateRangeError=!0);a.dateRangeError=!1,null!==t&&null!==r&&(t=moment(t).format("YYYY-MM-DD"),r=moment(r).format("YYYY-MM-DD"),a.searchStartDate=t,a.searchEndDate=r),a.pageOptions.error.reset(),a.pageOptions.isLoading=!0,a.responseComplete=!1;var n=f.rangeFetch(e,t,r);n.then(function(e){a.apiError=!1,a.assignments=e,a.pageOptions.isLoading=!1,a.responseComplete=!0},function(e){a.pageOptions.error.setError(e.ErrorCode,e.ErrorMessage),a.assignments=null,a.pageOptions.isLoading=!1})}},a.openTranscriptCreator=function(){a.isLoading=!1,a.success=!1,a.addApiError=!1,a.transcriptAddModal={},a.transcriptAddModal.transcript=null,jQuery("#transcriptAddModal").modal()},a.createTranscript=function(){var e="";if(void 0!==o.current.params.param&&null!==o.current.params.param){var t=o.current.params.param.split("/");e=t[0]}else e=null,g.setUserContext("student");var r=this.transcriptAddModal.transcript;r.userId=e,a.transcriptAddLoader=!0,new Date(r.completedDate).getFullYear()<2e3&&(r.completedDate=new Date(r.completedDate.setFullYear(r.completedDate.getFullYear()+100))),new Date(r.startDate).getFullYear()<2e3&&(r.startDate=new Date(r.startDate.setFullYear(r.startDate.getFullYear()+100)));
var n=f.create(r);n.then(function(){i.location.reload()},function(){a.addApiError=!0,a.transcriptAddLoader=!1,a.isLoading=!1,jQuery("#transcriptAddError").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500)},1500)})})},a.openCertificate=function(e){a.assignment=e,a.user=g,jQuery("#certificateModal").modal()},a.getTransriptStatus=function(e){return e="successful"===e?"Successfully":"Unsuccessfully",e+" completed this course"},a.getTranscriptScoreText=function(e){if("courseGroup"===e.type||"task"===e.type||"evaluation"===e.type||"survey"===e.type)return"";var t=e.score;return"undefined"==typeof t||null===t||0===t?" with a score of 0":" with a score of "+t},a.getCourseCode=function(e){return null===e||"undefined"==typeof e?"00000":e},a.changeUrl=function(e){r.path("/courses/certificate/"+e.transcriptId+"/").replace()},a.getCompletedAssignments=function(e){return null!==e.completedDate&&("completed"===e.status||"successful"===e.status)},a.getRequiredAssignments=function(e){return e.isRequired===!0&&"successful"!==e.status},a.getNewestAssignments=function(e){return null===e.completedDate&&"new"===e.status},a.getMyPicks=function(e){return e.isUserAssigned===!0},a.getInProgress=function(e){return"inProgress"===e.status},a.getSurveysAndEvaluations=function(e){return"evaluation"===e.type||"survey"===e.type},jQuery(".filterItem").click(function(){jQuery(this).siblings(".filterItem").removeClass("selected"),jQuery(this).addClass("selected")}),a.clearForm=function(){i.location.reload()},a.resetAddTranscriptModal=function(e){"undefined"!=typeof e&&null!==e&&e.$setUntouched()},a.completeAssignment=function(e,t){var r=l.completeTask(e,g.getId());a.apiActionLoader=!0,r.then(function(t){jQuery("#singlecourse").slideUp(1e3,function(){var t=e,r=jQuery("#courseList-"+t).length>0?"#courseList-"+t:"#courseTiles-"+t;jQuery(r).slideUp(500)}),a.isLoading=!0,a.homeAction(),i.location.reload(),a.currentAssignmentFilter="InProgress"},function(e){jQuery("#offeringSlide").slideUp(),a.apiErrorMessage="We're sorry! We couldn't complete the course. Please try again.",a.apiActionError=!0,jQuery("#underButtonError").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500),a.apiActionError=!1},1500)})})},a.dropElectiveCourse=function(e,t){a.apiActionError=!1,a.apiActionLoader=!0;var r=confirm("Are you sure you want to drop?");if(r){var n=l.dropElectiveCourse(e,g.getId());n.then(function(e){a.apiActionLoader=!1,jQuery("#singlecourse").slideUp(500,function(){a.isLoading=!0,a.homeAction(),a.switchFilter(a.currentAssignmentFilter,t)})},function(e){a.apiActionError=!0,a.apiErrorMessage="Sorry! There was an issue dropping your course. Please try again!",a.apiActionLoader=!1,jQuery("#transcriptAddError").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500)},1500)})})}else a.apiActionLoader=!1},a.mapStatusLabel=function(e){var t={completed:"Completed",inProgress:"In Progress","new":"New",pendingApproval:"Pending Approval",successful:"Successful",unsuccessful:"Unsuccessful"};return e in t?t[e]:e},a.mapStatusFromRosterCounts=function(e){var t=w.getStatusForOfferingFromRoster(e);switch(t){case"attending":return"Confirmed";case"waitlist":return"Waitlisted";case"pendingApproval":return"Pending Manager Approval";default:return"Not Registered"}},a.mapStatusForCssFromRosterCounts=function(e){return w.getStatusForOfferingFromRoster(e)},w.getStatusForOfferingFromRoster=function(e){var t="notRegistered",r=a.user.getId(),n=e.roster.attendingStudents;for(var o in n){var s=n[o];if("undefined"!=typeof s.id&&0!==s.id&&r===s.id)return s.rosterStatus}var i=e.roster.waitlistStudents;for(var u in i){var l=i[u];if("undefined"!=typeof l.id&&0!==l.id&&r===l.id)return l.rosterStatus}var c=e.roster.pendingApprovalStudents;for(var d in c){var p=c[d];if("undefined"!=typeof p.id&&0!==p.id&&r===p.id)return p.rosterStatus}return t},a.isUserRegisteredInILT=function(e){return"notRegistered"!==w.getStatusForOfferingFromRoster(e)},a.getDueState=function(e){return null!==e&&(e.moment.isBefore(moment())?"overdue":!!e.moment.isBetween(moment(),moment().add(7,"days"))&&"duesoon")},a.getTranscriptDefaultCompletedOnDate=function(){var e=new Date;return e.setYear(e.getFullYear()-1),e},a.getTranscriptDefaultCompletedBeforeDate=function(){var e=new Date;return e},a.closeSlider=function(){n.$broadcast("slider:view:close",w)},a.changeInstructorCourseTense=function(e){a.homeAction(e)},a.getFullAssignmentAssetTypeName=function(e){var t;return"wbt"===e?t="Web Based Training":"ilt"===e?t="Instructor Led Training":"vle"===e?t="Virtual Classroom":"task"===e?t="Tasks":"survey"===e?t="Surveys":"evaluation"===e?t="Evaluations":"courseGroup"===e?t="Course Groups":"courseGroupCurricula"===e?t="Curricula":"courseGroupCertification"===e&&(t="Certification"),t},a.toggleDescription=function(e){var t=jQuery(e.currentTarget).parents(".title").children(".description"),r=jQuery('.description[data-opened="true"]');r.each(function(e,r){$(r).attr("data-assignment-id")!==$(t).attr("data-assignment-id")&&($(r).attr("data-opened","false"),$(r).slideDown())});var n=t.attr("data-opened");void 0===n?(void 0,t.attr("data-opened","true"),t.slideUp()):"true"===n?(void 0,t.attr("data-opened","false"),t.slideDown()):"false"===n&&(void 0,t.attr("data-opened","true"),t.slideUp())},a.switchFilter=function(e,t){a.closeSlider(),a.currentAssignmentFilter=e,a.assignmentFilter=null!==e?a[e]:null,a.$broadcast("assignmentFilter",a.assignmentFilter),jQuery(t.currentTarget).siblings(".filterItem").removeClass("selected"),jQuery(t.currentTarget).addClass("selected")},a.closeWelcomeVideoModal=function(){var e=jQuery("#repeat").is(":checked")?"watched":"false";localStorage.setItem("welcomeVideo",e),jQuery("#welcomeVideoModal").modal("hide")},a.getFullAssignmentTypeName=v.getFullAssignmentTypeName,a.assignmentFilter=a.getRequiredAssignments,a.dump=function(e){void 0},a.openManagerSearchFilters=function(){jQuery("#managerSearchFilter").slideToggle()},a.openAdvManagerSearchFilters=function(){jQuery("#advManagerSearchFilter").slideToggle()},y.overrideScope(a),"ilt-calendar"===S?a.iltCalendarAction():a[S+"Action"]()}]),app.directive("adminOverlay",["$compile",function(e){return{scope:!0,restrict:"A",link:function(t,r,n){var o=t.isSubDomainAdmin;if(o===!0){var a=angular.element('<div id="adminoverlay" class="row adminoverlay"><div id="text"></div></div>');a.appendTo(r),e(a)(t)}}}}]),function(){"use strict";function e(e){if("function"==typeof e)e=!0;else if(e&&0!==e.length){var r=t(""+e);e=!("f"===r||"0"===r||"false"===r||"no"===r||"n"===r||"[]"===r)}else e=!1;return e}var t=function(e){return"string"==typeof e?e.toLowerCase():e},r=angular.module("AngularPrint",[]);r.directive("printSection",function(){return{restrict:"A",link:function(e,t){t[0].classList.add("printSection")}}}),r.directive("printHide",function(){return{restrict:"A",link:function(e,t){t[0].classList.add("printHide")}}}),r.directive("printRemove",function(){return{restrict:"A",link:function(e,t){t[0].classList.add("printRemove")}}}),r.directive("printOnly",function(){return{restrict:"A",link:{post:function(e,t){t[0].classList.add("printOnly")}}}}),r.directive("printAvoidBreak",function(){return{restrict:"A",link:function(e,t){t[0].classList.add("avoidPageBreak")}}}),r.directive("printBtn",["$window",function(e){return{restrict:"A",link:function(t,r){r.on("click",function(){e.print()})}}}]),r.directive("printIf",["$animate",function(t){return function(r,n,o){r.$watch(o.printIf,function(r){"printOnly"in o?t[e(r)?"removeClass":"addClass"](n,"printRemove"):t[e(r)?"addClass":"removeClass"](n,"printSection")})}}]),r.directive("printLandscape",function(){return{restrict:"A",link:function(){var e=function(){var e=document.createElement("style");return e.appendChild(document.createTextNode("")),document.head.appendChild(e),e.sheet}();e.insertRule("@page{size:landscape;}",0)}}}),r.directive("printTable",function(){return function(e,t,r){e.$watch(r.printTable,function(e){setTimeout(function(){if(null!==e){var r=t[0];r.classList.add("printSection"),r.id="print-table";for(var n,o,a=r.getElementsByTagName("td"),s=0;s<a.length;s++)n=a[s].innerHTML,a[s].innerHTML="",o=document.createElement("div"),o.className="avoidPageBreak",o.innerHTML=n,a[s].appendChild(o);t[0]=r}},1e3)})}})}(),app.directive("baiDateChecker",function(){return{require:"ngModel",link:function(e,t,r,n){n.$validators.dateChecker=function(t){if("undefined"!=typeof e.transcriptAdd){var r=e.transcriptAdd.startDate.$viewValue,n=e.transcriptAdd.completionDate.$viewValue;if("undefined"!=typeof r&&"undefined"!=typeof n){if(r>n)return!1;e.transcriptAdd.completionDate.$setValidity("dateChecker",!0),e.transcriptAdd.startDate.$setValidity("dateChecker",!0),jQuery(".md-datepicker-input-container.md-datepicker-invalid").removeClass("md-datepicker-invalid")}}else if("undefined"!=typeof e.batchAddTranscript){var o=e.batchAddTranscript.startDate.$viewValue,a=e.batchAddTranscript.completionDate.$viewValue;if("undefined"!=typeof o&&"undefined"!=typeof a){if(o>a)return!1;e.batchAddTranscript.completionDate.$setValidity("dateChecker",!0),e.batchAddTranscript.startDate.$setValidity("dateChecker",!0),jQuery(".md-datepicker-input-container.md-datepicker-invalid").removeClass("md-datepicker-invalid")}}return!0}}}}),app.directive("baiValidatorsPasswords",function(){return{require:"ngModel",link:function(e,t,r,n){n.$validators.passwordMatch=function(t){var r=e.passwordReset||e.baiform;if("undefined"!=typeof r.password&&"undefined"!=typeof r.passwordmatch){var n=r.password.$viewValue,o=r.passwordmatch.$viewValue;if("undefined"!=typeof n&&"undefined"!=typeof o&&null!==n&&null!==o&&n!==o)return!1}return!0},n.$validators.passwordRules=function(e){if("undefined"!=typeof e&&null!==e&&""!==e){var t=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?!.*\s).{8,}$/;if(!t.test(e))return!1}return!0}}}}),app.directive("baiValidatorsInteger",function(){return{require:"ngModel",link:function(e,t,r,n){n.$validators.integer=function(e){return null===e||""===e||/(\d{9}$)/.test(e)}}}}),app.directive("baiOptionalField",function(){return{require:"ngModel",link:function(e,t,r,n){var o=this;n.$validators.patternBased=function(e){var t=r.pattern,n=o.checkForRequiredStatus();return n===!0||(t=RegExp(t),t.test(e)===!0)},o.checkForRequiredStatus=function(){return r.required===!1&&(n.$setViewValue(null),n.$render(),!0)}}}}),app.directive("baiNoDefault",function(){return{require:"ngModel",link:function(e,t,r,n){n.$validators.noDefault=function(e){var t="--default--";return n.$touched!==!0||e!==t}}}}),app.directive("baiInvalidIfValueExistsIn",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){n.$validators.invalidIfValueExistsIn=function(t){var o=e.$eval(r.baiInvalidIfValueExistsIn),a=n.$viewValue;return _.indexOf(o,a)===-1?n.$setValidity("valueExistsAlready",!0):n.$setValidity("valueExistsAlready",!1),t}}}}),app.directive("baiNgPatternIfFieldNotDisabled",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){n.$validators.baiNgPatternIfFieldNotDisabled=function(t){var o=!1;if("undefined"!=typeof e.$eval(r.ngDisabled)&&e.$eval(r.ngDisabled)&&(o=!0),o)return n.$setValidity("pattern",!0),t;var a=r.baiNgPatternIfFieldNotDisabled;return"/"===a[0]&&a[a.length-1]&&(a=a.slice(1,a.length-1)),a=RegExp(a),a.test(t)?n.$setValidity("pattern",!0):n.$setValidity("pattern",!1),t}}}}),app.directive("dateBefore",function(){return{require:"ngModel",link:function(e,t,r,n){function o(e,t,r){return e.replace(new RegExp(t,"g"),r)}var a=!!r.dateOrEquals&&e.$eval(r.dateOrEquals),s=function(e,t){var r=!0;if("undefined"==typeof e||"undefined"==typeof t||null===e||""===e||null===t||""===t)return void n.$setValidity("dateBefore",r);e=o(e,"-","/");var s,i=new Date(e);"undefined"!==t&&(s=new Date(t),r=a?i<=s:i<s),n.$setValidity("dateBefore",r)};e.$watch(r.dateBefore,function(){s(n.$viewValue,e.$eval(r.dateBefore))}),n.$parsers.unshift(function(t){return s(t,e.$eval(r.dateBefore)),t})}}}),app.directive("dateAfter",function(){return{require:"ngModel",link:function(e,t,r,n){function o(e,t,r){return e.replace(new RegExp(t,"g"),r)}var a=!!r.dateOrEquals&&e.$eval(r.dateOrEquals),s=function(e,t){var r=!0;if("undefined"==typeof e||"undefined"==typeof t||null===e||""===e||null===t||""===t)return void n.$setValidity("dateAfter",r);e=o(e,"-","/");var s,i=new Date(e);"undefined"!==t&&(s=new Date(t),r=a?i>=s:i>s),n.$setValidity("dateAfter",r)};e.$watch(r.dateAfter,function(){s(n.$viewValue,e.$eval(r.dateAfter))}),n.$parsers.unshift(function(t){return s(t,e.$eval(r.dateAfter)),t})}}}),app.directive("ngBlurDelay",["$timeout",function(e){return{scope:{ngBlurDelay:"&"},link:function(t,r,n){r.bind("blur",function(){e(t.ngBlurDelay,200)})}}}]),app.directive("calendar",["$rootScope","UsersService","CoursesService",function(e,t,r){function n(e){return e.day(0).hour(0).minute(0).second(0).millisecond(0)}function o(e,t,r){e.weeks=[];for(var n=!1,o=t.clone(),s=o.month(),i=0;!n;)e.weeks.push({days:a(o.clone(),r)}),o.add(1,"w"),n=i++>2&&s!==o.month(),s=o.month()}function a(e,t){for(var r=[],n=0;n<7;n++)r.push({name:e.format("dd").substring(0,1),number:e.date(),isCurrentMonth:e.month()===t.month(),month:e.month(),isToday:e.isSame(new Date,"day"),date:e,year:e.year()}),e=e.clone(),e.add(1,"d");return r}function s(e,t){var r={name:e.format("dd").substring(0,1),number:e.date(),isCurrentMonth:e.month()===t.month(),month:e.month(),isToday:e.isSame(new Date,"day"),date:e,year:e.year()};return r}var i={day:{template:"app/templates/components/calendar/day.html"},week:{template:"app/templates/components/calendar/week.html"},month:{template:"app/templates/components/calendar/month.html"}};return{restrict:"E",scope:!1,link:function(u,l,c){u.isOfferingsCalendar="offerings"===c.type,u.selected=moment(),u.day=s(u.selected.clone(),u.selected),u.week=u.selected.clone(),u.month=u.selected.clone(),u.view=i.month.template,u.selectedView="month",u.dateInLoop=u.selected.clone(),u.type="dueDate",u.isOfferingsCalendar===!0&&(u.type="lowestSessionDateForOffering"),u.assignmentFilter={isRequired:!0};var d=u.selected.clone();d.date(1),n(d.day(0)),o(u,d,u.month),u.select=function(e){u.day=e,u.selected=e.date},u.next=function(){if("month"===u.selectedView){var e=u.month.clone();n(e.month(e.month()+1).date(1)),u.month.month(u.month.month()+1),o(u,e,u.month)}else if("week"===u.selectedView){var t=u.week.clone().startOf("week");n(t.week(t.week()+1).startOf("week")),u.days=[],u.week=t;var r=a(t,u.month);u.days=r}},u.previous=function(){if("month"===u.selectedView){var e=u.month.clone();n(e.month(e.month()-1).date(1)),u.month.month(u.month.month()-1),o(u,e,u.month)}else if("week"===u.selectedView){var t=u.week.clone().startOf("week");n(t.week(t.week()-1).startOf("week")),u.days=[],u.week=t;var r=a(t,u.month);u.days=r}},u.filterCourseByDay=function(e){return function(t){return"undefined"!=typeof t[u.type]&&null!==t[u.type]&&t[u.type].day===e.number&&t[u.type].monthForCalender===e.month&&t[u.type].year===e.year}},u.filterOfferingByDay=function(e){return function(t){return"undefined"!=typeof t[u.type]&&null!==t[u.type]&&t[u.type].day===e.number&&t[u.type].monthForCalender===e.month&&t[u.type].year===e.year}},u.dayView=function(e){jQuery("#calendarAssignmentsList").length>0&&(jQuery("#calendarAssignmentsList").hide(),jQuery("#courseCalendarHolder").css("width","100%"),jQuery("#courseCalendarAssignmentHolder").css("width","0%")),e="undefined"!=typeof e?e:u.day,u.day=e,u.curDay=e.date.format("dddd L"),u.view=i.day.template,u.selectedView="day"},u.weekView=function(){jQuery("#calendarAssignmentsList").length>0&&(jQuery("#calendarAssignmentsList").hide(),jQuery("#courseCalendarHolder").css("width","60%"),jQuery("#courseCalendarAssignmentHolder").css("width","40%"));var e=u.week=u.selected.clone().startOf("week");u.days=[];var t=a(e,u.month);u.days=t,u.view=i.week.template,u.selectedView="week"},u.monthView=function(){jQuery("#calendarAssignmentsList").length>0&&(jQuery("#calendarAssignmentsList").hide(),jQuery("#courseCalendarHolder").css("width","60%"),jQuery("#courseCalendarAssignmentHolder").css("width","40%")),d=u.month.clone(),d.date(1),n(d.day(0)),o(u,d,u.month),u.view=i.month.template,u.selectedView="month"},u.getCompletedAssignments=function(e){return null!==e.completedDate},u.getRequiredAssignments=function(e){return null===e.completedDate&&e.isRequired===!0&&("new"===e.status||"inProgress"===e.status)},u.getNewestAssignments=function(e){return null===e.completedDate&&"new"===e.status},u.getMyPicks=function(e){return e.isUserAssigned===!0&&("new"===e.status||"inProgress"===e.status)},u.scheduleOffering=function(n,o,a){var s=r.scheduleOffering(n,t.getId(),o,a);s.then(function(t){var r=null;switch(jQuery("#offeringSlide").slideUp(),t){case"confirmed":case"inProgress":r=jQuery("#fullSuccess"),u.apiMessage="Registration for this course was successful.";break;case"waitlisted":r=jQuery("#waitlistedSuccess"),u.apiMessage="The current course is full. You have been added to the course waitlist.";break;case"pendingApproval":r=jQuery("#fullSuccess"),u.apiMessage="Request for approval was successfully sent."}r.slideDown(500,function(){var t=jQuery(this);setTimeout(function(){t.slideUp(500),u.apiActionError=!1,e.$broadcast("slideDownDirective:refreshCurrentPage")},1500)})},function(e){jQuery("#offeringSlide").slideUp(),e.ErrorMessage.indexOf("ILT because it is full")>-1?u.apiErrorMessage="The current course is full. Registration could not be completed.":409===e.StatusCode?u.apiErrorMessage="Sorry! Cannot register because there is a scheduling conflict.":u.apiErrorMessage="Sorry! There was a problem saving your offering. Please try again.",u.apiActionError=!0,jQuery("#underButtonError").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500),u.apiActionError=!1},2500)})})},u.requestApproval=function(n,o,a){var s=t.getId(),i=r.requestManagerialApproval(n,o,s,a);i.then(function(t){jQuery("#offeringSlide").slideUp(),u.apiMessage="Request for approval was successfully sent.",jQuery("#fullSuccess").slideDown(500,function(){var t=jQuery(this);setTimeout(function(){t.slideUp(500),u.apiActionError=!1,e.$broadcast("slideDownDirective:refreshCurrentPage")},1500)})},function(e){409===e.StatusCode?u.apiErrorMessage="Sorry! Cannot register because there is a scheduling conflict.":u.apiErrorMessage="Sorry! There was a problem requesting approval. Please try again.",u.apiActionError=!0,jQuery("#underButtonError").slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500),u.apiActionError=!1},2500)})})},u.completeAssignment=function(n,o){var a=r.completeTask(n,t.getId());u.apiActionLoader=!0,a.then(function(t){jQuery(o.currentTarget).html("Task Completed!"),setTimeout(function(){u.apiActionError=!1,u.apiActionLoader=!1,e.$broadcast("slideDownDirective:refreshCurrentPage")},1e3)},function(e){u.apiActionError=!0,u.apiActionLoader=!1,u.apiErrorMessage="We're sorry! We couldn't complete the course. Please try again.",setTimeout(function(){u.apiActionError=!1},1e3)})},u.$on("assignmentFilter",function(e,t){u.assignmentFilter=t})}}}]),app.directive("calendarAssignmentList",function(){return{restrict:"E",templateUrl:"app/templates/components/calendar/assignmentList.html",scope:!1,link:function(e,t,r){e.$on("assignmentFilter",function(t,r){e.assignmentFilter=r})}}}),app.directive("courseGroupSlideDown",["$rootScope","$sce","AssignmentsService","CoursesService","TasksService","UsersService","EvaluationService","SurveyService",function(e,t,r,n,o,a,s,u){return{restrict:"E",transclude:!0,templateUrl:"app/templates/users/partials/courseGroupSlideDown.html",link:function(e,t,n,o){e.managerView="undefined"!=typeof n.managerview&&"true"===n.managerview,e.$on("slider:view:close",function(t,r){e.closeSlider()});var a=-1;t=t.children("#courseGroupList"),e.openCourseGroupInfo=function(r,n){jQuery(".more").html("Read More"),jQuery(".courseGroupMore").html("Read More"),"opened"===jQuery(t).data("state")&&(jQuery("#offeringSlide").slideUp(),jQuery(".arrow").length>0?jQuery(".arrow").hide(1,function(){jQuery("#courseGroupList").slideUp()}):jQuery(t).slideUp(),jQuery(t).data("state","closed"));var o=jQuery("#singlecourse");"opened"===jQuery(o).data("state")&&(jQuery("#offeringSlide").slideUp(),jQuery(".arrow").length>0?jQuery(".arrow").hide(1,function(){jQuery("#singlecourse").slideUp()}):jQuery(o).slideUp(),jQuery(o).data("state","closed")),e.apiError=!1,e.singleIsLoading=!1;var s,i,u,l,c,d,p=null,m=0,f=!1,g=r.currentTarget;if(l=0,s=jQuery(g).parents("#courseList").children(".col-md-4"),s.length>0){if(p=jQuery(g).parents(".col-md-4")[0],m=jQuery(window).width()>768?3:1,s.each(function(e){var t=jQuery(p).prop("id");if(jQuery(p).prop("id",null),jQuery(this)[0]===p&&(l=e+1,f=!0),jQuery(p).prop("id",t),f===!0)return f=!1,jQuery(".col-md-4").removeClass("selected"),void jQuery(p).addClass("selected")}),l===a)return void(a=-1);jQuery(p).children(".arrow").show(1,function(){jQuery(t).slideDown()});var h=jQuery(p).width(),v=h/2;jQuery(p).children(".arrow").children(".point").css("border-left",v+"px solid transparent"),jQuery(p).children(".arrow").children(".point").css("border-right",v+"px solid transparent");var y=40;jQuery(p).children(".arrow").children(".point").css("border-top",y+"px solid #e5e5e5");var C=.75*y;jQuery(p).children(".arrow").children(".point").css("top",C+"px"),c=l-1,d=l%m,d>0&&(c=l-d+(m-1)),i=s[c],"undefined"==typeof i&&(i=s[s.length-1]),u=jQuery(i)}else{if(g=jQuery(r.currentTarget),p=g.parents(".col-md-12"),l=parseInt(p.prop("id").split("-")[1],10)+1,l===a)return void(a=-1);jQuery(t).slideDown(),jQuery(p).children(".arrow").slideDown(),u=jQuery(p)}e.courseGroup=n,e.getCourseGroupData(n),"wbt"===n.type?e.courseGroup.fullTypeName="Web Based":"courseGroupCertification"===n.type?e.courseGroup.fullTypeName="Certification":"courseGroupCurricula"===n.type?e.courseGroup.fullTypeName="Curricula":e.courseGroup.fullTypeName=n.type,jQuery(r.currentTarget).children().length>0?jQuery(r.currentTarget).children(".more").html("Read less"):jQuery(r.currentTarget).html("Read less"),jQuery(t).data("state","opened"),jQuery(u).after(jQuery(t)),a=l},e.closeSlider=function(){jQuery("#courseGroupList").slideUp(500,function(){jQuery(".arrow").hide(),jQuery(".more").html("Read More")}),a=-1},e.getCourseGroupData=function(t){e.apiError=!1,e.singleIsLoading=!0;var n=t.courseGroupId||t.id,o=t.type,a=t.studentId,s=o;"courseGroupCurricula"===o?s="Curricula":"courseGroupCertification"===o&&(s="Certification");var u=r.getCourseGroupCourses(a,o,n);u.then(function(t){t.isScheduled=!1;var r=t,n=0;for(e.courseGroup.totalCourses=r.length,i=r.length-1;i>=0;--i)current=r[i],"successful"===current.status&&(r.splice(i,1),n++);e.courseGroupCourses=r,e.singleIsLoading=!1,e.courseGroup.totalCompletedCourses=n},function(t){e.totals=!1,e.apiError=!0,e.singleIsLoading=!1})}}}}]),app.directive("documentUploader",["$route","DocumentService","errorDisplayerUtil","Upload",function(e,t,r,n){return{restrict:"E",scope:{files:"=",hideDropdownIn:"=?",stopMainUploadIn:"=?",courseType:"=",launchWithContent:"="},link:function(o,a,s){var i=this;if(o.documentRepoFileList=[],o.hideDropdownIn="undefined"!=typeof s.hideDropdown&&s.hideDropdown,i.stopMainUpload="undefined"!=typeof s.stopMainUpload&&s.stopMainUpload,o.btnDisabled=!1,o.addDocumentToCourse={},o.addDocumentToCourse.isLoading=!1,o.addDocumentToCourse.error=r.create(),o.addDocumentToRepository={},o.addDocumentToRepository.isLoading=!1,o.addDocumentToRepository.error=r.create(),i.getNewUniqueId=function(){return Math.floor(1e3*Math.random()+1)},o.dropdown={},o.dropdown.selectedObjId=null,o.files=[],o.files.deletedFiles=[],o.componentId=i.getNewUniqueId(),o.document=null,o.popoverIsOpen=!1,o.url={},o.url.externalUrlName=null,o.showExternalUrlAdder=!1,o.addDocumentToCourseError={},o.addDocumentToCourseError.error=r.create(),t.getDocumentRepositoryList().then(function(e){o.addDocumentToCourseError.error.reset(),o.documentRepoFileList=e},function(e){var t=e.StatusCode,r=e.ErrorMessage;o.addDocumentToCourseError.error.setError(t,r)}),o.documentCourseList={},o.documentCourseList.error=r.create(),i.params=e.current.params,"edit"===i.params.name&&"undefined"!==i.params.param&&null!==i.params.param){var u=i.params.param.split("/")[0];t.getDocumentsForCourse(u).then(function(e){o.documentCourseList.error.reset(),o.files=e,o.files.deletedFiles=[],o.files.forEach(function(e){e.id===o.launchWithContent&&(e.launchWithContent=!0)})},function(e){var t=e.StatusCode,r=e.ErrorMessage;o.documentCourseList.error.setError(t,r)})}o.$on("RefreshDocList",function(e,r){var n=r.courseId;"undefined"!==n&&null!==n&&setTimeout(function(){t.getDocumentsForCourse(n).then(function(e){o.documentCourseList.error.reset(),o.files=e,o.files.deletedFiles=[]},function(e){var t=e.StatusCode,r=e.ErrorMessage;o.documentCourseList.error.setError(t,r)})},5e3)}),o.showEditFileName=function(e){e.editing=!e.editing,e.tempFileName=e.name},o.cancelInlineEdit=function(e){e.tempFileName=null,e.editing=!1},o.saveInlineEdit=function(e){e.name=e.tempFileName,e.fileObject=n.rename(e.fileObject,e.tempFileName),e.tempFileName=null,e.editing=!1},o.triggerUrlAddition=function(){o.showExternalUrlAdder=!0,o.popoverIsOpen=!1,o.url.externalUrlName=null},o.addExternalUrl=function(){o.showExternalUrlAdder=!1;var e={};e.name=o.url.externalUrlName,e.fileOrUrl="url",e.id=i.getNewUniqueId(),o.files.push(e),o.hideDropdownIn&&(o.btnDisabled=!0),o.triggerAddUrlToRepoConfirmation()},o.triggerAddDocumentToRepoConfirmation=function(){"Documents"!==o.$parent.DocTreeTitle&&(jQuery("#addToDocumentRepoConfirmation-"+o.componentId).modal(),$(".modal-backdrop").appendTo(".documentUploader"))},o.hideAddDocumentToRepoConfirmation=function(){jQuery("#addToDocumentRepoConfirmation-"+o.componentId).modal("hide")},o.triggerAddUrlToRepoConfirmation=function(){"Documents"!==o.$parent.DocTreeTitle&&(jQuery("#what-"+o.componentId).modal(),$(".modal-backdrop").appendTo(".documentUploader"))},o.hideAddUrlToRepoConfirmation=function(){jQuery("#what-"+o.componentId).modal("hide")},o.setResourceLaunchWithContent=function(e){o.launchWithContent=e.id,o.files.forEach(function(t){t.launchWithContent===!0&&e===t?(t.launchWithContent=!1,o.launchWithContent=0):t.launchWithContent=e===t})},o.deleteFile=function(e){for(var t=0;t<o.files.length;t++)o.files[t].id===e&&(o.files.splice(t,1),t=o.files.length+1);var r={};r.id=e,o.files.deletedFiles.push(r),o.hideDropdownIn&&(o.btnDisabled=!1),e===o.launchWithContent&&(o.launchWithContent=0)},o.triggerFileUpload=function(){document.getElementById("document-"+o.componentId).click(),o.popoverIsOpen=!1},o.isFileMaxSize=!1,o.upload=function(e){var t={};t.name=e[0].name,t.fileOrUrl="file",t.fromRepo=!1,t.id=i.getNewUniqueId(),t.fileObject=e[0],o.files.push(t),o.hideDropdownIn&&(o.btnDisabled=!0),i.stopMainUpload===!1&&o.triggerAddDocumentToRepoConfirmation()},o.addFileFromDocRepo=function(){var e=_.filter(o.documentRepoFileList,function(e){if(e.id===o.dropdown.selectedObjId)return!0});if(0===e.length)return void(o.dropdown.selectedObjId=null);e=e[0];for(var t=0;t<o.files.length;t+=1)if(o.files[t].id===o.dropdown.selectedObjId)return void(o.dropdown.selectedObjId=null);e.fromRepo=!0,e.fileOrUrl="file",o.files.push(angular.copy(e)),o.dropdown.selectedObjId=null},o.addDocumentToRepo=function(){o.addDocumentToRepository.isLoading=!0,t.uploadDocumentToRepository(o.document).then(function(e){o.addDocumentToRepository.isLoading=!1;for(var t=0;t<o.files.length;t+=1)o.files[t].name===o.document.name&&(o.files[t].id=e.data.id,o.files[t].fromRepo=!0);o.hideAddDocumentToRepoConfirmation()},function(e){o.addDocumentToRepository.isLoading=!1,o.addDocumentToRepository.error.setError(e.ErrorCode,e.ErrorMessage)})},o.addUrlToRepo=function(){o.addDocumentToRepository.isLoading=!0,t.uploadUrlToRepository(o.url.externalUrlName).then(function(e){o.addDocumentToRepository.isLoading=!1,o.hideAddUrlToRepoConfirmation()},function(e){o.addDocumentToRepository.isLoading=!1,o.addDocumentToRepository.error.setError(e.ErrorCode,e.ErrorMessage)})}},templateUrl:"app/templates/components/documentUploader.html"}}]),app.directive("dropdown",function(){return{restrict:"E",scope:{objects:"=",selectedObj:"=",optionalRowDisplayer:"=?",optionalSelectedRowDisplayer:"=?",optionalOnClick:"=?"},link:function(e,t,r){e.pickerVisible=!1,e.togglePicker=function(){e.disabled||(e.pickerVisible=!e.pickerVisible)},e.hidePicker=function(){e.pickerVisible=!1},e.chooseObj=function(t){e.selectedObj=t,e.hidePicker(),e.optionalOnClick&&e.optionalOnClick(t)}},templateUrl:"app/templates/components/dropdown.html"}}),app.directive("baiEnterKeyHandler",function(){return function(e,t,r){t.bind("keydown keypress",function(t){13===t.which&&(e.$apply(function(){e.$eval(r.baiEnterKeyHandler)}),t.preventDefault())})}}),app.directive("iltCalendarAssignmentList",function(){return{restrict:"E",templateUrl:"app/templates/components/calendar/iltAssignmentList.html",scope:!1,link:function(e,t,r){}}}),app.directive("imageExists",function(){return{restrict:"AEC",scope:{imageExists:"="},link:function(e,t,r){t.bind("error",function(){jQuery(t).prop("src",n(r.imageExists))});var n=function(e){switch(e){case"catOnly":return"app/images/cat0000.jpg";case"icons-white":return"app/images/icons/default_white.svg";case"icons-black":return"app/images/icons/default_black.svg";default:return"app/images/00000.png"}}}}}),app.directive("loginFormSwitcher",["UsersService",function(e){var t=[".signin",".forgotpassword",".loading",".enterpin",".loading",".resetpassword",".loading"],r="app/templates/users/partials/signin.html";return{link:function(r){r.forgotForm=function(e){0===e?(jQuery(t[e]).toggle(),jQuery(t[e+1]).toggle()):(jQuery(t[e-1]).toggle(),jQuery(t[e]).toggle())},r.reset=function(){for(var n in t)".resetpassword"===t[n]&&(r.loading=!1,e.clearSession()),jQuery(t[n]).hide();jQuery(t[0]).show()}},restrict:"A",templateUrl:r}}]),app.directive("maxTimeString",["dateUtil",function(e){return{restrict:"A",require:"ngModel",link:function(t,r,n,o){o.$validators.maxTimeString=function(t){var r=!0,o=e.parseTime(n.maxTimeString);if(null!==o){var a=e.parseTime(t);null!==a&&a>o&&(r=!1)}return r}}}}]),app.directive("messagingBuilder",function(){var e={error:{template:"app/templates/components/messaging/error.html"},errorMicro:{template:"app/templates/components/messaging/error-micro.html"},success:{template:"app/templates/components/messaging/success.html"},warning:{template:"app/templates/components/messaging/warning.html"}};return{restrict:"E",scope:{active:"=",message:"=",neverHide:"=",dontDisappear:"=",view:"="},link:function(t,r,n){t.view=e[n.view].template,"undefined"!=typeof n.neverHide&&"true"===n.neverHide||t.$watch("active",function(e){e===!0&&(jQuery(r).show(),n.dontDisappear||setTimeout(function(){t.active=!1,jQuery(r).slideUp().css("display","block")},5e3))})},templateUrl:"app/templates/components/messaging.html"}}),app.directive("minTimeString",["dateUtil",function(e){return{restrict:"A",require:"ngModel",link:function(t,r,n,o){o.$validators.minTimeString=function(t){var r=!0,o=e.parseTime(n.minTimeString);if(null!==o){var a=e.parseTime(t);null!==a&&a<o&&(r=!1)}return r}}}}]),app.directive("nestedContainer",["$filter","$compile","GroupsService","UsersService","dateUtil",function(e,t,r,n,o){return{restrict:"E",scope:{data:"=",selectOptionsData:"=",containerOperandsData:"=",parentData:"=",options:"="},templateUrl:"app/templates/components/nestedcontainer.html",link:function(e,n,a){function s(e){var t=angular.element(e.target);t.attr("id");t.is(".childContainer")&&(angular.element(this).css("border","2px solid #7f7f7f"),angular.element(this.parentElement.parentNode).css("border","none"))}function i(e){var t=angular.element(e.target);t.attr("id");t.is(".childContainer")&&(angular.element(this).css("border","none"),"parentContainer ng-isolate-scope"===this.parentElement.className?angular.element(this.parentElement).css("border","none"):angular.element(this.parentElement.parentNode).css("border","2px solid #7f7f7f"));
}var u=this;if(e.containerOperands=e.containerOperandsData,e.criterias=e.data.criteria,e.typeaheadMinLength=2,e.typeaheadWaitTime=800,u.singleCriteriaOperands=function(t){return _.each(e.selectOptionsData,function(e){t.criteriaId===e.id&&(t.operatorsData=e.operands)}),t},u.setOperandsDataInCriteria=function(e){if(e.length>0)return _.each(e,function(e){u.singleCriteriaOperands(e)}),e},u.setOperandsDataInCriteria(e.data.criteria),angular.isArray(e.data.subContainers)){e.dataForSubcontainers=e.data.subContainers;var l="<div id='childContainer' class='row childContainer' ng-repeat='datapoint in dataForSubcontainers'><nested-container data='datapoint' parent-data = 'dataForSubcontainers' select-options-data='selectOptionsData' container-operands-data = 'containerOperandsData' options = 'options' ></nested-container></div>",c=t(l),d=c(e);n.append(d)}e.noResults="",e.updateNgModel=function(t){var r=t.operandId;_.each(e.selectOptionsData,function(e){_.each(e.operands,function(e){e.id===r&&(t.operandName=e.name)})})},e.selectedItem=function(e,t,r,n,o){o.value=e.id},e.drilldownOperatorSelect=function(t,r){var n=t.criteriaId;t.value="",_.each(e.selectOptionsData,function(e){e.id===n&&(t.operatorsData=e.operands,t.criteriaName=e.name)}),t.criteriaName.includes("Date")?(t.isDate=!0,t.isString=!1,t.isDropdown=!1,t.value=o.formatDate(moment().format())):"Group Name"===t.criteriaName?(t.isDropdown=!0,t.isDate=!1,t.isString=!1):(t.isDate=!1,t.isString=!0,t.isDropdown=!1)},e.formattingDate=function(e){e.value.original=moment.utc(e.value.jsDate).format()},e.setContainerOperandName=function(t){var r=t.operandId;_.each(e.containerOperandsData,function(e){e.operandId===r&&(t.operandName=e.operandValue)})},e.addMoreActions=!1,e.data.isRoot===!1&&(e.addMoreActions=!0),e.addFilterRule=function(){var t=r.generateCriteria();e.data.criteria.push(t)},e.addChild=function(){var t=r.generateSubContainer(!0);t.then(function(t){e.data.subContainers.push(t),t.parentContainerId=e.data.containerId,t.groupId=e.data.groupId,e.data.subContainers.length>0&&(e.data.hasChildren=!0)},function(e){})},e.addSibling=function(){var t=r.generateSubContainer(!0);t.then(function(t){e.parentData.push(t),t.parentContainerId=e.parentData[0].parentContainerId,t.groupId=e.parentData[0].groupId},function(e){})},e.removeFilterRule=function(t){e.data.criteria.splice(t,1)},e.removeChild=function(t){e.parentData.splice(e.parentData.indexOf(t),1)},e.containerPopover={},e.containerPopover.isOpen=!1;var p=angular.element(document.getElementsByClassName("childContainer"));p.mouseenter(s),angular.element(document.getElementsByClassName("childContainer")).mouseleave(i),e.userTypeahead={},e.userTypeahead.search=function(t,n){return e.userTypeahead.isLoading=!0,r.filterDataForAutoComplete(t,n)}}}}]),app.directive("regexValidate",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){var o=r.regexValidateFlags||"",a=new RegExp(r.regexValidate,o);n.$parsers.unshift(function(e){var t=a.test(e);return n.$setValidity("regexValidate",t),t?e:void 0}),n.$formatters.unshift(function(e){return n.$setValidity("regexValidate",a.test(e)),e})}}}),app.directive("resizer",["$document",function(e){return function(t,r,n){function o(e){if("vertical"===n.resizer){var t=e.pageX/$(window).width()*100;n.resizerMax&&t>n.resizerMax?t=parseInt(n.resizerMax):n.resizerMax&&t<n.resizerMin&&(t=parseInt(n.resizerMin)),r.css({left:t+"%"}),$(n.resizerLeft).css({width:t+"%"}),$(n.resizerRight).css({width:100-t+"%"})}else{var o=window.innerHeight-e.pageY;r.css({bottom:o+"px"}),$(n.resizerTop).css({bottom:o+parseInt(n.resizerHeight)+"px"}),$(n.resizerBottom).css({height:o+"px"})}}function a(){e.unbind("mousemove",o),e.unbind("mouseup",a)}r.on("mousedown",function(t){t.preventDefault(),e.on("mousemove",o),e.on("mouseup",a)})}}]),app.directive("onScroll",[function(){var e=0,t=function(t,r,n){r.bind("scroll",function(o){var a=r.scrollTop();t.$eval(n.onScroll,{$event:o,$direct:a>e?1:-1}),e=a})};return{restrict:"A",link:t}}]),app.directive("singleAutoComplete",function(){return{restrict:"E",scope:{objects:"=",selectedObj:"=",optRunOnSelect:"=?"},link:function(e,t,r){e.autocompleteVisible=!1,e.query="",e.selectedObj=null,e.filterRows=function(e){return function(t){return t.name.toLowerCase().indexOf(e.toLowerCase())!==-1}},e.$watch("selectedObj",function(t,r){null===t&&(e.query="")}),e.chooseObj=function(t){e.hideAutocomplete(),e.query=t.name,e.selectedObj=t,e.optRunOnSelect&&e.optRunOnSelect(e.selectedObj)},e.showAutocomplete=function(){e.autocompleteVisible=!0},e.hideAutocomplete=function(){if(e.autocompleteVisible=!1,query=e.query.trim(),""===query&&(e.selectedObj=null,e.query="",e.optRunOnSelect&&e.optRunOnSelect(null)),e.selectedObj){var t=e.selectedObj.name;""!==query&&null!==e.selectedObj&&query!==t&&(e.query=t)}}},templateUrl:"app/templates/components/singleAutoComplete.html"}}),app.directive("slideDown",["$rootScope","$sce","AssignmentsService","CoursesService","TasksService","UsersService","EvaluationService","SurveyService",function(e,t,r,n,o,a,s,i){return{restrict:"E",transclude:!0,templateUrl:"app/templates/users/partials/singleCourseSlideDown.html",link:function(u,l,c,d){u.scoped="undefined"!=typeof c.scoped&&"true"===c.scoped,u.$on("slider:view:close",function(e,t){u.closeSlider()});var p=-1;l=l.children("#singlecourse"),u.openCourseInfo=function(e,t){var r=e.target.innerHTML;jQuery(".more").html("Read More");var n="undefined"!=typeof t.CourseGroupName?t.CourseGroupName:t.isInCourseGroup;"opened"===jQuery(l).data("state")&&(void 0===n||""===n?(jQuery("#offeringSlide").slideUp(),jQuery(".arrow").length>0?jQuery(".arrow").hide(1,function(){jQuery("#singlecourse").slideUp()}):jQuery(l).slideUp(),jQuery(l).data("state","closed")):"Read less"===r?(jQuery("#courseGroupList .arrow").hide(),jQuery("#singlecourse").slideUp()):jQuery("#courseGroupList .arrow").hide());var o=jQuery("#courseGroupList");"opened"!==jQuery(o).data("state")||void 0!==n&&""!==n||(jQuery("#offeringSlide").slideUp(),jQuery(".courseGroupMore").html("Read More"),jQuery(".arrow").length>0?jQuery(".arrow").hide(1,function(){jQuery("#courseGroupList").slideUp()}):jQuery(o).slideUp(),jQuery(o).data("state","closed"));var a=jQuery("#viewResources");"opened"===jQuery(a).data("state")&&(jQuery(".arrow").length>0?jQuery(".arrow").hide(1,function(){jQuery("#viewResources").slideUp()}):jQuery(a).slideUp(),jQuery(a).data("state","closed"),jQuery(".resource").html("View Resources")),u.apiError=!1,u.singleIsLoading=!1;var s,i,c,d,m,f,g=null,h=0,v=!1,y=e.currentTarget;if(d=0,s=jQuery(y).parents("#courseList").children(".col-md-4"),s.length>0){if(g=jQuery(y).parents(".col-md-4")[0],h=jQuery(window).width()>768?3:1,s.each(function(e){var t=jQuery(g).prop("id");if(jQuery(g).prop("id",null),jQuery(this)[0]===g&&(d=e+1,v=!0),jQuery(g).prop("id",t),v===!0)return v=!1,jQuery(".col-md-4").removeClass("selected"),void jQuery(g).addClass("selected")}),d===p||n&&"Read less"===r)return void(p=-1);jQuery(g).children(".arrow").show(1,function(){jQuery(l).slideDown()});var C=jQuery(g).width(),S=C/2;jQuery(g).children(".arrow").children(".point").css("border-left",S+"px solid transparent"),jQuery(g).children(".arrow").children(".point").css("border-right",S+"px solid transparent");var w=40;jQuery(g).children(".arrow").children(".point").css("border-top",w+"px solid #e5e5e5");var D=.75*w;jQuery(g).children(".arrow").children(".point").css("top",D+"px"),m=d-1,f=d%h,f>0&&(m=d-f+(h-1)),i=s[m],"undefined"==typeof i&&(i=s[s.length-1]),void 0!==n&&""!==n&&null!==n?(y=jQuery(e.currentTarget),g=y.parents(".col-md-12"),d=parseInt(g.prop("id").split("-")[1],10)+1,jQuery(l).slideDown(),jQuery(g).children(".arrow").slideDown(),c=jQuery(g)):c=jQuery(i)}else{if(y=jQuery(e.currentTarget),g=y.parents(".col-md-12"),d=parseInt(g.prop("id").split("-")[1],10)+1,d===p)return void(p=-1);jQuery(l).slideDown(),c=jQuery(g)}u.task=null,u.getAssignment(t),"wbt"===t.type?u.fullTypeName="Web Based":u.fullTypeName=t.type,jQuery(e.currentTarget).children().length>0?jQuery(e.currentTarget).children(".more").html("Read less"):jQuery(e.currentTarget).html("Read less"),jQuery(l).data("state","opened"),jQuery(c).after(jQuery(l)),p=d},u.closeSlider=function(){jQuery("#singlecourse").slideUp(500,function(){jQuery(".arrow").hide(),jQuery(".more").html("Read More")}),p=-1},u.getAssignment=function(e){u.apiError=!1,u.singleIsLoading=!0;var t=e.courseId||e.id,n=e.type,o=r.fetchSingle(t,n);o.then(function(t){var r="assignedById";"ilt"===t.type&&(r="assignedOffering"),null!==t[r]&&"student"===u.role?(t.isScheduled=!1,void 0!==e.isInCourseGroup&&""!==e.isInCourseGroup&&(t.isDroppable=!1,t.isInCourseGroup=e.isInCourseGroup),u.assignment=t,u.singleIsLoading=!1):"ilt"===t.type||"vle"===t.type?a.isSaba()?u.getCourse(e):u.getOfferings(e):"task"===t.type?(u.assignment=e,u.getTask(e)):"evaluation"===t.type?(u.assignment=e,u.getEvaluation(e)):"assessment"===t.type?(u.assignment=e,u.getAssessment(e)):"survey"===t.type?(u.assignment=e,u.getSurvey(e)):u.getCourse(e)},function(e){u.apiError=!0,u.singleIsLoading=!1})},u.showScheduleCourseButton=function(){var e=!1;if(u.assignment&&u.assignment.offerings&&"student"===u.role&&!u.assignment.assignedOffering&&("ilt"===u.assignment.type||"vle"===u.assignment.type)&&null!==u.assignment.offerings&&u.assignment.offerings.length>0){var t=[];_.each(u.assignment.offerings,function(r){if(r.sessions&&r.sessions.length>0){var n=_.sortBy(r.sessions,"startDateTime")[0].startDateTime.jsDate,o=new Date;n>o&&(e=!0,t.push(r))}}),u.assignment.offerings=t}return e},u.getCourse=function(e,t){u.apiError=!1,u.singleIsLoading=!0;var r=t===!0&&"undefined"!=typeof e.courseId?e.courseId:e.id,o=n.getSingleCourse(r);o.then(function(e){e.isScheduled=!1,u.assignment=e,u.singleIsLoading=!1},function(e){u.apiError=!0,u.singleIsLoading=!1})},u.getTask=function(e){u.apiError=!1,u.singleIsLoading=!0;var t=o.fetchSingle(e.id,a.getId());t.then(function(e){u.task=e,u.singleIsLoading=!1},function(){u.apiError=!0,u.singleIsLoading=!1})},u.getEvaluation=function(e){u.apiError=!1,u.singleIsLoading=!0;var t=s.fetchSingle(a.getId(),e.offeringId);t.then(function(t){u.evaluation=t,e.source=u.evaluation.assignedBy,u.assignment.source=u.evaluation.assignedBy,u.singleIsLoading=!1},function(e){u.apiError=!0,u.singleIsLoading=!1})},u.getSurvey=function(e){u.apiError=!1,u.singleIsLoading=!0;var t=i.fetchSingle(a.getId(),e.offeringId);t.then(function(e){u.survey=e,u.singleIsLoading=!1},function(e){u.apiError=!0,u.singleIsLoading=!1})},u.getOfferings=function(e){u.apiError=!1,u.singleIsLoading=!0;var t="undefined"!=typeof e.courseId&&null!==e.courseId?e.courseId:e.id,r=n.getSingleCourse(t),o=e.isInCourseGroup;r.then(function(e){e.isScheduled=!1,u.assignment=e,u.assignment.isInCourseGroup=o;var r=n.getSingleCourseOfferings(t);return r.then(function(e){u.assignment.offerings=e,u.assignment.offeringId=null,u.assignment.assignedOffering=null,u.singleIsLoading=!1},function(e){u.apiError=!0,u.singleIsLoading=!1})},function(e){u.apiError=!0,u.singleIsLoading=!1})},u.requestApproval=function(t,r,o){var s=a.getId(),i=n.requestManagerialApproval(t,r,s,o);u.assignmentID=t,i.then(function(t){var r=u.assignmentID;u.apiMessage="Request for approval was successfully sent.",jQuery("#AvailableOfferings"+r).hide(),jQuery("#scheduleSuccess"+r).show(),setTimeout(function(){jQuery("#ScheduleCourseModal"+r).modal("hide"),jQuery("#scheduleSuccess"+r).hide(),e.$broadcast("slideDownDirective:refreshCurrentPage")},1500)},function(t){500===t.StatusCode&&"The person was successfully registered in the given offering but, cannot move forward until their manager approves the action"===t.ErrorMessage?(u.apiMessage="Request for approval was successfully sent.",jQuery("#fullSuccess-"+u.assignmentID).show(),setTimeout(function(){jQuery("#fullSuccess-"+u.assignmentID).hide(),e.$broadcast("slideDownDirective:refreshCurrentPage")},2e3)):(409===t.StatusCode?u.apiScheduleErrorMessage="Sorry! Cannot register because there is a scheduling conflict.":u.apiScheduleErrorMessage="Sorry! There was a problem requesting approval. Please try again.",jQuery("#apiScheduleError"+u.assignmentID).slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500)},2500)}))})},u.scheduleOffering=function(t,r,o,s){var i=n.scheduleOffering(t,a.getId(),r,o);u.assignmentID=t,i.then(function(t){if(s){var o=n.getCourseUrl(s,r,a.getId());o.then(function(e){})}var i=null,l=u.assignmentID;switch(t){case"confirmed":case"inProgress":i=jQuery("#scheduleSuccess"+l),u.apiMessage="Registration for this course was successful.";break;case"waitlisted":i=jQuery("#waitlistedSchedSuccess"+l),u.apiMessage="The current course is full. You have been added to the course waitlist."}jQuery("#AvailableOfferings"+l).hide(),i.show(),setTimeout(function(){jQuery("#ScheduleCourseModal"+l).modal("hide"),i.hide(),e.$broadcast("slideDownDirective:refreshCurrentPage")},1500)},function(e){e.ErrorMessage.indexOf("it is full")>-1?u.apiScheduleErrorMessage="The current course is full. Registration could not be completed.":409===e.StatusCode?u.apiScheduleErrorMessage="Sorry! Cannot register because there is a scheduling conflict.":u.apiScheduleErrorMessage="Sorry! There was a problem scheduling your offering. Please try again.",jQuery("#apiScheduleError"+u.assignmentID).slideDown(500,function(){var e=jQuery(this);setTimeout(function(){e.slideUp(500)},2500)})})},u.getHtml=function(e,r){var n="undefined"!=typeof r?r+e:e;if("string"==typeof n)return t.trustAsHtml(n)},u.getMyPicks=function(e){return e.isUserAssigned===!0},u.offeringListOpener=function(e,t){jQuery("#ScheduleCourseModal"+t.id).modal("show")}}}}]),app.directive("loadingSpinner",function(){return{restrict:"E",scope:{activator:"="},link:function(e,t,r){},templateUrl:"app/templates/components/spinner.html"}}),app.directive("subContainer",["$filter",function(e){return{restrict:"E",scope:{data:"="},templateUrl:"app/templates/users/editpeoplegroup/partials/peopleGroupContainer.html",link:function(e,t,r){e.criterias=e.data.criteria,void 0}}}]),app.directive("templateSwitcher",function(){return{replace:!0,link:function(e,t,r){e.views=[{label:"tiles",name:"Tiles",template:"app/templates/users/partials/tiles.html",icon:"","class":"assignmentFilter selected"},{label:"list",name:"List",template:"app/templates/users/partials/list.html",icon:"","class":"assignmentFilter"},{label:"calendar",name:"Calendar",template:"app/templates/users/partials/calendar.html",icon:"","class":"assignmentFilter"}],jQuery(".assignmentFilter").click(function(){jQuery(this).siblings(".assignmentFilter").removeClass("selected"),jQuery(this).addClass("selected")})},controller:["$scope",function(e){}]}}),app.directive("tree",["$location",function(e){return{restrict:"E",scope:{inputData:"=",onClick:"=",nodeNowHidden:"=?",search:"=",title:"=",options:"=",treeError:"="},link:function(t,r,n){function o(e,t,r){for(var n=0;n<e.length;n+=1)e[n][t]=r,e[n].nodes&&o(e[n].nodes,t,r)}function a(e){for(var t=0;t<e.length;t+=1)e[t]._id=d,d+=1,e[t].nodes&&a(e[t].nodes)}function s(e,t){for(var r=0;r<t.length;r+=1)if(t[r]._id===e)return t[r];for(var n=!1,o=0;o<t.length;o+=1)if(t[o].nodes)for(var a=0;a<t[o].nodes.length;a+=1)n=s(e,t[o].nodes);return n}function i(e,t){for(var r=0;r<t.length;r+=1)if(e(t[r]))return t[r];for(var n=!1,o=0;o<t.length;o+=1)if(t[o].nodes)for(var a=0;a<t[o].nodes.length;a+=1)n=i(e,t[o].nodes);return n}function u(e,t){if(void 0===t)for(var r=0;r<e.length;r+=1)u(e[r],e[r]._id);else if(e._group_id=t,"undefined"!=typeof e.nodes)for(var n=0;n<e.nodes.length;n+=1)u(e.nodes[n],t)}function l(e,t){for(var r=Array(),n=0;n<e.length;n+=1)if(c.predicate(e[n],t))r.push(e[n]);else{var o=l(e[n].nodes,t);o.length>0&&(e[n].nodes=o,r.push(e[n]))}return r}var c=this;t.currentlyHighlightedNode=null;var d=0;t.selected_group="",t.toggleTreeVisibility=function(){t.treeClosed=!t.treeClosed},t.backgroundTasks=function(e){t.currentlyHighlightedNode=e._id,t.selected_group=e._group_id},t.toggle=function(e){e.hidden=!e.hidden},c.predicate=function(e,t){var r=e.name.toLowerCase(),n=t.toLowerCase();return r.indexOf(n)!==-1};var p=function(){if(t.originalData){t.data=l(angular.copy(t.originalData),t.search);var e=s(t.currentlyHighlightedNode,t.data);e?t.options&&t.options.searchUpdateCallback&&t.options.searchUpdateCallback(e):null===t.currentlyHighlightedNode&&t.options.rootNodeIsTopLevel?t.options&&t.options.searchUpdateCallback&&t.options.searchUpdateCallback(t.data[0]):t.nodeNowHidden&&t.nodeNowHidden()}};t.$watch("search",p),t.$watch("inputData",function(e,r){t.inputData&&(t.data=angular.copy(t.inputData),a(t.data),o(t.data,"hidden",!0),u(t.data),t.originalData=angular.copy(t.data),t.options.initiallySelectedNodeName&&(node=i(function(e){return t.options.initiallySelectedNodeName===e.name},t.data),node&&(t.currentlyHighlightedNode=node._id),t.options.initiallySelectedNodeName=!1))}),t.options?(t.options.initiallyOpened?t.treeClosed=!1:t.treeClosed=!0,void 0===t.options.showLocks&&(t.options.showLocks=!0),void 0===t.options.canDrillDown&&(t.options.canDrillDown=!0)):(t.options={},t.options.showLocks=!0),t.iconClick=function(t){var r=t.id;e.path("users/peoplegroup/"+r+"/")},t.iconClickCourseEdit=function(t){"courseGroups"===t.api_name&&"undefined"!=typeof t.id&null!==typeof t.id&&e.path("courses/edit/"+t.id+"/")}},templateUrl:"app/templates/components/tree.html"}}]),app.directive("viewResourcesSlideDown",["$rootScope","$sce","AssignmentsService","CoursesService","TasksService","UsersService","EvaluationService","SurveyService",function(e,t,r,n,o,a,s,i){return{restrict:"E",transclude:!0,templateUrl:"app/templates/users/partials/viewResourceSlideDown.html",link:function(e,t,r,n){e.$on("slider:view:close",function(t,r){e.closeSlider()});var o=-1;t=t.children("#viewResources"),e.openResourceInfo=function(r,n){e.assignment=n;var a=n.CourseGroupName,s=n.courseAssets;for(var i in s)current=s[i],"pdf"===current.fileFormat?s[i].fileFormatName=".PDF":"excel"===current.fileFormat?s[i].fileFormatName=".XLS":"url"===current.fileFormat?s[i].fileFormatName="URL":"word"===current.fileFormat?s[i].fileFormatName=".DOCX":"powerpoint"===current.fileFormat?s[i].fileFormatName=".PPT":"text"===current.fileFormat?s[i].fileFormatName=".TXT":"audio"===current.fileFormat?s[i].fileFormatName=".MP3":"video"===current.fileFormat?s[i].fileFormatName=".MP4":"picture"===current.fileFormat?s[i].fileFormatName=".PNG":"zip"===current.fileFormat&&(s[i].fileFormatName=".ZIP");e.resources=s,jQuery(".resource").html("View Resources"),"opened"===jQuery(t).data("state")&&(jQuery(".arrow").length>0?jQuery(".arrow").hide(1,function(){jQuery("#viewResources").slideUp()}):jQuery(t).slideUp(),jQuery(t).data("state","closed"));var u=jQuery("#singlecourse");"opened"===jQuery(u).data("state")&&(jQuery("#offeringSlide").slideUp(),jQuery(".arrow").length>0?jQuery(".arrow").hide(1,function(){jQuery("#singlecourse").slideUp()}):jQuery(u).slideUp(),jQuery(u).data("state","closed")),e.apiError=!1,e.singleIsLoading=!1;var l,c,d,p,m,f,g=null,h=0,v=!1,y=r.currentTarget;if(p=0,l=jQuery(y).parents("#courseList").children(".col-md-4"),l.length>0){if(g=jQuery(y).parents(".col-md-4")[0],h=jQuery(window).width()>768?3:1,l.each(function(e){var t=jQuery(g).prop("id");if(jQuery(g).prop("id",null),jQuery(this)[0]===g&&(p=e+1,v=!0),jQuery(g).prop("id",t),v===!0)return v=!1,jQuery(".col-md-4").removeClass("selected"),void jQuery(g).addClass("selected")}),p===o)return void(o=-1);jQuery(g).children(".arrow").show(1,function(){jQuery(t).slideDown()});var C=jQuery(g).width(),S=C/2;jQuery(g).children(".arrow").children(".point").css("border-left",S+"px solid transparent"),jQuery(g).children(".arrow").children(".point").css("border-right",S+"px solid transparent");var w=40;jQuery(g).children(".arrow").children(".point").css("border-top",w+"px solid #e5e5e5");var D=.75*w;jQuery(g).children(".arrow").children(".point").css("top",D+"px"),m=p-1,f=p%h,f>0&&(m=p-f+(h-1)),c=l[m],"undefined"==typeof c&&(c=l[l.length-1]),void 0!==a&&""!==a?(y=jQuery(r.currentTarget),g=y.parents(".col-md-12"),p=parseInt(g.prop("id").split("-")[1],10)+1,jQuery(t).slideDown(),jQuery(g).children(".arrow").slideDown(),d=jQuery(g)):d=jQuery(c)}else{if(y=jQuery(r.currentTarget),g=y.parents(".col-md-12"),p=parseInt(g.prop("id").split("-")[1],10)+1,p===o)return void(o=-1);jQuery(t).slideDown(),jQuery(g).children(".arrow").slideDown(),d=jQuery(g)}e.task=null,jQuery(r.currentTarget).children().length>0?jQuery(r.currentTarget).children(".resource").html("Hide Resources"):jQuery(r.currentTarget).html("Hide Resources"),jQuery(t).data("state","opened"),jQuery(d).after(jQuery(t)),o=p},e.closeSlider=function(){jQuery("#viewResources").slideUp(500,function(){jQuery(".arrow").hide(),jQuery(".resource").html("View Resources")}),o=-1}}}}]),ModelException.prototype.constructor=new Exception,app.filter("associativeArrayEmpty",function(){return function(e){return!(!e||0!==Object.keys(e).length)}}),app.filter("trimmer",["$sce",function(e){return function(e,t,r,n){if(!e)return"";if(r=parseInt(r,10),!r)return e;if(e.length<=r)return e;if(e=e.substr(0,r),t){var o=e.lastIndexOf(" ");o!==-1&&(e=e.substr(0,o))}return e+(n||" …")}}]),app.filter("unique",function(){return function(e,t){var r=[],n=[];return angular.forEach(e,function(e){var o=e[t];n.indexOf(o)===-1&&(n.push(o),r.push(e))}),r}}),app.factory("OrgFunctions",[function(){function e(t,r,n){if("undefined"!=typeof t){void 0===n&&(n=[]);var o={};o.name=t.name,o._id=t.id,o.orgObject=t;var a=angular.copy(n);if(a.push(o),r[t.id]=a,t.nodes)for(var s=0;s<t.nodes.length;s+=1)e(t.nodes[s],r,a)}}function t(e,t,r,n,o){for(var a,s,i=[],u={},l=0,c=e.length;l<c;l++)a=e[l],u[a[t]]=a,u[a[t]].nodes=[];for(var d in u)u.hasOwnProperty(d)&&(s=u[d],n(s)?i.push(s):"undefined"==typeof u[s[r]]||"function"==typeof o&&!o(s)||u[s[r]].nodes.push(s));return i}function r(e,t,n){if(t.push(e[n]),e.nodes)for(var o=0;o<e.nodes.length;o+=1)r(e.nodes[o],t,n)}return{createOrgHierarchyList:e,unflatten:t,getSubIdsRecursively:r}}]),app.factory("PeopleGroupFunctions",["$http","$q","$filter","GroupsService","UsersService","OrganizationsService","JobsService","CountriesService",function(e,t,r,n,o,a,s,i){function u(e){var t;"undefined"==typeof e||null===e?t=n.generateRootContainer(!0):"undefined"!=typeof e&&null!==e&&"ruleTab"!==e?t=n.peopleGroupStructure(e):"undefined"!=typeof e&&"ruleTab"===e&&(t=null);var r=n.getPeopleGroupFilters(),u=n.getContainerOperands(),l=a.getOrganizationHierarchy(),c=n.getPeopleGroups(),d=s.getAllJobs(),p=i.getLatitudeCountryList(o.getPortalId()),m=[t,r,u,l,c,d,p];return m}return{peopleGroupActions:u}}]),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},app.factory("RoleMapsMixin",["$route","UsersService","$injector",function(e,t,r){return{findProvider:findProvider,overrideScope:function(n){var o=e.current.params.controller,a=t.getCurrentRoleType();return mapPageAndRoleToOverride(o,a,r,n)},overrideScopeByRole:function(t,n){var o=e.current.params.controller;return mapPageAndRoleToOverride(o,n,r,t)}}}]),app.factory("TreeHelpers",[function(){var e=this;return e.setPropertyOnAllNodes=function(t,r,n){for(var o=0;o<t.length;o+=1)t[o][r]=n,t[o].nodes&&e.setPropertyOnAllNodes(t[o].nodes,r,n)},e.addGroupIds=function(t,r){if(void 0===r)for(var n=0;n<t.length;n+=1)e.addGroupIds(t[n],t[n]._id);else if(t._group_id=r,"undefined"!=typeof t.nodes)for(var o=0;o<t.nodes.length;o+=1)e.addGroupIds(t.nodes[o],r)},e}]),TypeMapsMixin.prototype.getFullAssignmentTypeName=function(e){var t={assessment:"Assessment",survey:"Survey",evaluation:"Evaluation",ext:"External",ilt:"Instructor Led Training",task:"Task",vle:"Video Learning Elective",wbt:"Web Based",courseGroup:"Course Group",courseGroupCurricula:"Course Group Curricula",courseGroupCertification:"Course Group Certification"};return t[e]},app.factory("TypeMapsMixin",[function(){return new TypeMapsMixin}]),app.factory("addressUtil",[function(){return{formatAddress:function(e){var t="";return"undefined"!=typeof e.addressLine1&&""!==e.addressLine1&&null!==e.addressLine1&&""!==e.addressLine1?(t=e.addressLine1,"undefined"!=typeof e.addressLine2&&""!==e.addressLine2&&null!==e.addressLine2&&""!==e.addressLine2?(t+=" "+e.addressLine2,"undefined"!=typeof e.addressLine3&&""!==e.addressLine3&&null!==e.addressLine3&&""!==e.addressLine3&&(t+=" "+e.addressLine3)):"undefined"!=typeof e.addressLine3&&""!==e.addressLine3&&null!==e.addressLine3&&""!==e.addressLine3&&(t+=" "+e.addressLine3)):"undefined"!=typeof e.addressLine2&&""!==e.addressLine2&&null!==e.addressLine2&&""!==e.addressLine2?(t=e.addressLine2,"undefined"!=typeof e.addressLine3&&""!==e.addressLine3&&null!==e.addressLine3&&""!==e.addressLine3&&(t+=" "+e.addressLine3)):"undefined"!=typeof e.addressLine3&&""!==e.addressLine3&&null!==e.addressLine3&&""!==e.addressLine3&&(t=e.addressLine3),t+=" "+this.getCityStateZipLabel(e)},getCityStateZipLabel:function(e){var t="";return"undefined"!=typeof e&&null!==e&&("undefined"!=typeof e.city&&null!==e.city&&""!==e.city?(t+=e.city,"undefined"!=typeof e.stateName&&null!==e.stateName&&""!==e.stateName&&(t+=", "+e.stateName,"undefined"!=typeof e.postalCode&&null!==e.postalCode&&""!==e.postalCode&&(t+=" "+e.postalCode))):"undefined"!=typeof e.stateName&&null!==e.stateName&&""!==e.stateName?(t+=", "+e.stateName,"undefined"!=typeof e.postalCode&&null!==e.postalCode&&""!==e.postalCode&&(t+=" "+e.postalCode)):"undefined"!=typeof e.postalCode&&null!==e.postalCode&&""!==e.postalCode&&(t+=e.postalCode)),t},isThereAnAddress:function(e){return"undefined"!=typeof e&&null!==e&&(e=this.formatAddress(e),null!==e)}}}]),app.factory("courseFormatterUtil",[function(){return{getCourseCodeForImage:function(e){if(null===e||"undefined"==typeof e)return"00000";var t=["20022-CB","20205OPS"];return jQuery.inArray(e,t)>-1?e:e.replace(/([^\d])/g,"")}}}]),app.factory("dateUtil",[function(){function e(e){var t=new RegExp("^\\b((1[0-2]|0[1-9]):([0-5][0-9]) ([AaPp][Mm]))$");return t.test(e)}return{formatDate:function(e){var t={},r=moment(e);return t.original=e,t.apiDate=r.format("YYYY-MM-DD"),t.day=parseInt(r.format("D"),10),t.dayName=r.format("ddd"),t.fullDate=r.format("L"),t.fullDateWithTime=r.format("L LT"),t.month=r.format("MMM"),t.monthNumber=parseInt(r.format("M"),10),t.monthForCalender=r.month(),t.year=parseInt(r.format("YYYY"),10),t.time=r.format("LT"),t.utcDate=r.utc(),t.moment=r,t.dateAsObj={},t.dateAsObj.day=t.day,t.dateAsObj.month=t.monthNumber,t.dateAsObj.year=t.year,t.jsDate=new Date(e),t},setStartTime:function(e){if(void 0!==e&&null!==e){var t=new Date(e);return t.setHours(0,0,0,0),t}return e},setEndTime:function(e){if(void 0!==e&&null!==e){var t=new Date(e);return t.setHours(23,59,0,0),t}return e},generateNormalTimeFormat:function(e){var t=e.getHours(),r=this._convertMinutesToDoubleValue(e.getMinutes());return parseFloat(t+r)},_convertMinutesToDoubleValue:function(e){return e/60},convertDoubleToMinutes:function(e){var t=parseFloat(e).toFixed(2).toString().split(".");return(parseInt(t[0],10)+60*parseInt(t[1],10)/1e4).toFixed(2).toString().replace(/\./g,":")+":00"},parseTime:function(t){if(!e(t))return null;var r=t.split(":"),n=r[0],o=r[1],a=o.split(" "),s=a[0],i=a[1];n=parseInt(n),"pm"===i.toLowerCase()&&n<12&&(n+=12),"am"===i.toLowerCase()&&12===n&&(n=0);var u=new Date(1970,0,1);return u.setHours(n,s,0,0),u},isTimeFormatValid:function(t){return e(t)}}}]),app.factory("errorDisplayerUtil",[function(){return{create:function(){var e=function(){this.code=0,this.message=null,this.neverHide=!1,this.thrown=!1,this.reset=function(){this.code=0,this.message=null,this.neverHide=!1,this.thrown=!1},this.setError=function(e,t,r){this.code=e,this.message=t,this.neverHide=r,this.thrown=!0}};return new e}}}]),app.factory("httpUtil",["$rootScope","urlParamsUtil",function(e,t){var r=this;return r._headers={},r._getHeader=function(e){return"undefined"!=typeof r._headers[e]&&r._headers[e]},r._getHeaders=function(){return r._headers},r._setHeader=function(e,t){r._headers[e]=t},r._request=function(n){return n.url+=t.create(),e.resetCache===!0&&(r._setHeader("Cache-Control","no-cache"),angular.extend(n.headers,r._headers),e.resetCache=!1),n},{getHeader:r._getHeader,getHeaders:r._getHeaders,request:r._request,setHeader:r._setHeader}}]),app.factory("loginBackgroundUtil",[function(){function e(e){function t(e,t,r){r[t]=parseInt(e)}var r=e.split("(")[1].split(")")[0].split(",");return r.forEach(t),r}function t(e,t){function r(e,t){return e*t/255}var n=e.getContext("2d"),o=n.getImageData(0,0,e.width,e.height),a=o.data,s=0,i=0;for(s=0,i=a.length;s<i;s+=4)a[s]=r(t[0],a[s]),a[s+1]=r(t[1],a[s+1]),a[s+2]=r(t[2],a[s+2]);n.putImageData(o,0,0)}function r(){$(".portalLoginBackground,.portalLoginFormOverlay1").hide(),$("#portalLoginBackgroundCanvas").show();var r=document.getElementById("portalLoginBackgroundCanvas");r.width=$(window).width(),r.height=$(window).height();var n=r.getContext("2d"),o=$(".portalLoginBackground").css("background-image");o=o.replace('url("',""),o=o.replace('")',"");var a=new Image;a.onload=function(){a.width<r.width||a.height<r.height?n.drawImage(a,0,0,r.width,r.height):n.drawImage(a,0,0);var o=$(".portalLoginFormOverlay1").css("background-color"),s=e(o);t(r,s)},a.src=o}return{drawBackground:r}}]),app.factory("messagingDisplayerUtil",[function(){return{create:function(){var e=function(){this.code=0,this.message=null,this.neverHide=!1,this.thrown=!1,this.reset=function(){this.code=0,this.message=null,this.neverHide=!1,this.thrown=!1},this.setError=function(e,t,r){this.code=e,this.message=t,this.neverHide=r,this.thrown=!0}};return new e}}}]),app.factory("popupcheckUtil",[function(){return{openPopUp:function(){var e=null,t=null;if(localStorage.popupsAllowed){var r=Date.parse(localStorage.popupsAllowed);if(r<Date.parse(new Date)){t=window.open("../App/images/spacer.gif","myWindow","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=yes, width=1, height=1");try{t.focus(),t.close(),e=new Date((new Date).getTime()+432e5),localStorage.setItem("popupsAllowed",e)}catch(n){void 0,e=new Date((new Date).getTime()+432e5),localStorage.setItem("popupsAllowed",e)}}}else{t=window.open("../App/images/spacer.gif","myWindow","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=yes, resizable=yes, copyhistory=yes, width=1, height=1");try{t.focus(),t.close()}catch(n){void 0}e=new Date((new Date).getTime()+432e5),localStorage.setItem("popupsAllowed",e)}}}}]),app.factory("sessionFormatterUtil",["dateUtil",function(e){return{existingSessionRanges:[],formatableDates:["endDateTime","registrationEndDateTime","startDateTime"],_sorted:[],formatSession:function(e){return e},formatSessions:function(t){var r=t.sessions||t.studentSessions;this._sorted=[],this._organizeSessions(r),r=this._sorted;var n=moment();for(var o in r)if("function"!=typeof r[o]){for(var a in r[o])"function"!=typeof r[o][a]&&null!==r[o][a]&&$.inArray(a,this.formatableDates)!==-1&&(r[o][a]=e.formatDate(r[o][a]),"startDateTime"!==a||null!==t.lowestSessionDateForOffering&&!moment(r[o].startDateTime.original).isBefore(t.lowestSessionDateForOffering.original)||(t.lowestSessionDateForOffering=r[o].startDateTime),"startDateTime"===a&&moment(r[o].startDateTime.original).isAfter(n)&&(null===t.closestSession||moment(r[o].startDateTime.original).isBefore(moment(t.closestSession)))&&(t.closestSessionKey=parseInt(o,10)+1,t.closestSession=r[o]),"endDateTime"!==a||null!==t.highestSessionDateForOffering&&!moment(r[o].endDateTime.original).isAfter(t.highestSessionDateForOffering.original)||(t.highestSessionDateForOffering=r[o].endDateTime));"undefined"!=typeof r[o]&&null!==r[o]&&"undefined"!=typeof r[o].hoursSpent&&null!==r[o].hoursSpent&&(r[o].hoursSpent=this._round(r[o].hoursSpent,1))}
return null===t.closestSession&&(t.closestSession=r[r.length-1],t.closestSessionKey=r.length),t.sessions=r,t},_round:function(e){return e=e>0?+(Math.round(100*e)/100).toFixed(2):0},createSessionsByStandardRepeat:function(t,r,n,o){var a=null,s=[],i=_.findWhere(r,{localId:t.offering}),u=moment(t.endDate),l=null,c=moment(t.startDate),d=null,p=moment(e.parseTime(t.endTime)),m=moment(e.parseTime(t.startTime));do{if(l=moment(c),d=moment(c),d.isAfter(u))break;var f=!0;if("days"===n&&t.includeWeekdaysOnly===!0){var g=d.day(),h=6===g||0===g;h===!0&&(f=!1)}f===!0&&(a=null,a={},a.offeringId=t.offering,a.offeringName=i.name,i.includeWeekdaysOnly=t.includeWeekdaysOnly,a.endDateTime=e.formatDate(l.hours(p.hours()).minutes(p.minutes())),a.startDateTime=e.formatDate(d.hours(m.hours()).minutes(m.minutes())),a.endDate=l.toDate(),a.endTime=p.toDate(),a.startDate=d.toDate(),a.startTime=m.toDate(),a.error=this._checkForSessionOverlap(a,r),s.push(a)),c.add(o,n)}while(d.isBefore(u));return s},createSessionsByRepeatingDays:function(t,r){for(var n=null,o=[],a=_.findWhere(r,{localId:t.offering}),s=moment(t.endDate),i=null,u=moment(t.startDate),l=null,c=moment(e.parseTime(t.endTime)),d=moment(e.parseTime(t.startTime)),p=u.day(),m=0,f=t.repeatAmount,g=0;g<f;g++){for(var h=0;h<t.days.length;h++)if(i=moment(u),l=moment(u),n=null,n={},m=t.days[h]-p,m<0&&0===g)f++;else{if(i=i.add(m,"days"),l=l.add(m,"days"),l.isAfter(s))break;n.offeringId=t.offering,n.offeringName=a.name,a.includeWeekdaysOnly=t.includeWeekdaysOnly,n.endDateTime=e.formatDate(i.hours(c.hours()).minutes(c.minutes())),n.startDateTime=e.formatDate(l.hours(d.hours()).minutes(d.minutes())),n.endDate=i.toDate(),n.endTime=c.toDate(),n.startDate=l.toDate(),n.startTime=d.toDate(),n.error=this._checkForSessionOverlap(n,r),o.push(n)}u=u.add(1,"weeks")}return o},_checkForSessionOverlap:function(e,t){var r=e.endDateTime.moment,n=e.startDateTime.moment,o=null,a=_.find(t,function(t){return parseInt(t.localId,10)===parseInt(e.offeringId)});if("undefined"==typeof a.sessions||null===a.sessions||0===a.sessions.length)return!1;for(var s=0;s<a.sessions.length;s++){if(o=a.sessions[s],n.isSame(o.startDateTime.moment)||r.isSame(o.endDateTime.moment))return!0;if(n.isAfter(o.startDateTime.moment)&&n.isBefore(o.endDateTime.moment))return!0;if(r.isAfter(o.startDateTime.moment)&&r.isBefore(o.endDateTime.moment))return!0}return!1},_getTimeForTimeFields:function(e){return e=0===e?"01:00:00":e,e=e.split(":"),e=new Date(1970,0,1,e[0],e[1],e[2])},_organizeSessions:function(e,t){if("undefined"==typeof t)return this._sorted.push(e[0]),e.shift(),void("undefined"!=typeof e[0]&&this._organizeSessions(e,e[0]));for(var r=0;e.length>0;){switch(this._valueState(e[r])){case 0:this._sorted.unshift(e[r]);break;case 1:this._sorted.push(e[r]);break;case 2:this._insertIntoCorrectSpot(e[r])}e.shift(),"undefined"!=typeof e[0]&&this._organizeSessions(e,e[0]),r++}},_valueState:function(e){return moment(e.startDateTime).isBefore(moment(this._sorted[0].startDateTime))?0:moment(e.startDateTime).isAfter(moment(this._sorted[this._sorted.length-1].startDateTime))?1:2},_insertIntoCorrectSpot:function(e){for(var t=null,r=null,n=moment(e.startDateTime),o=0;o<this._sorted.length;o++)if("function"!=typeof this._sorted[o]&&(o=parseInt(o,10),t=moment(this._sorted[o].startDateTime),r=moment(this._sorted[o+1].startDateTime),n.isAfter(t)&&n.isBefore(r)))return void this._sorted.splice(o+1,0,e)}}}]);var sqlguid=function(){var e,t;if("object"==typeof window&&"object"==typeof window.crypto&&"function"==typeof window.crypto.getRandomValues&&(t=window.crypto),"object"==typeof window&&"object"==typeof window.msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&(t=window.msCrypto),"object"==typeof t&&"function"==typeof t.getRandomValues)e=function(e){var r=new Uint8Array(e),n="",o=0;for(t.getRandomValues(r),o=0;o<e;o++)n+=("0"+r[o].toString(16)).slice(-2);return n};else if("object"==typeof process&&"object"==typeof process.release&&"node"===process.release.name){var r;try{r=require("crypto"),e=function(e){var t=r.randomBytes(e);return t.toString("hex")}}catch(n){}}else"function"!=typeof e&&("object"==typeof console&&"function"==typeof console.warn&&void 0,e=function(e){for(var t="";t.length<2*e;)t=("00000000"+Math.floor(4294967296*Math.random()).toString(16)).slice(-8);return t.slice(-(2*e))});var o=function(){var t=("000000000000"+(new Date).getTime().toString(16)).slice(-12);return t=e(2)+"-"+t,t=e(2)+"-"+t,t=e(2)+"-"+t,t=e(4)+"-"+t,t.toUpperCase()};return o}();app.factory("successDisplayerUtil",[function(){return{create:function(){var e=function(){this.code=200,this.message=null,this.neverHide=!1,this.thrown=!1,this.reset=function(){this.code=200,this.message=null,this.neverHide=!1,this.thrown=!1},this.set=function(e,t){this.message=e,this.neverHide=t,this.thrown=!0}};return new e}}}]),app.factory("urlParamsUtil",["$location",function(e){var t=this;return t.queries=[],t._add=function(e,r){var n=e+"="+r;jQuery.inArray(n,t.queries)>-1||t.queries.push(n)},t._create=function(){var e="";return 0===t.queries.length?e:(e=t.queries.join("&"),"?"+e)},{add:t._add,create:t._create,"delete":t._delete,request:t._request}}]),app.factory("Assignments_AdminOverride",["BreadcrumbsService","UsersService","OrganizationsService","CatalogService","$http","$routeParams","RoleMapsMixin","$injector","$filter","errorDisplayerUtil","$route","CoursesService","OrgFunctions","AssignmentsService","$location","TypeMapsMixin","SettingsService","$rootScope","DocumentService","$sce","WizardHandler",function(e,t,r,n,o,a,s,i,u,l,c,d,p,m,f,g,h,v,y,C,S){return function(e){var t=this;e.defaultHeader=!0,e.activeTab="tab-active-class",e.tab2_Options={},e.contentSearch="assignmentsSearch.name",e.rows=Array(),t.allCoursesData=Array(),e.tab2_Options.baiCatalogTreeFilter="",e.baiCatalogIsLoading=!0,e.customCatalogIsLoading=!0,e.rowsAreLoading=!0,e.homeAction=function(){e.homeTemplate="app/templates/assignments/home/admin.html",t.baiCatalogCta(),t.customCatalogCta()},e.baiCatalogError={},e.baiCatalogOptions={},e.baiCatalogOptions.initiallyOpened=!0,e.baiCatalogError.error=l.create(),e.baiCatalogTreeTitle="BAI Catalog",e.orgRowDisplayer=function(e){var t="";for(var r in e)t=e[r].name;return t},e.selectedOrgDisplayer=function(e){return e?e[e.length-1].name:""},t.baiCatalogCta=function(){e.baiCatalogError.error.reset(),t.allCourses();var r=n.getBaiCatalogData();return r.then(function(r){t.baiCatalogPromiseData=r,e.baiCatalogData=r.formattedCatalogTreeData,e.baiCatalogIsLoading=!1},function(t){e.baiCatalogIsLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.baiCatalogError.error.setError(r,n)})},e.assignmentTableError={},e.assignmentTableError.error=l.create(),t.allCourses=function(){e.assignmentTableError.error.reset();var r=d.getCoursesForOrg();return r.then(function(r){e.rowsAreLoading=!1,e.rows=r,t.allCoursesData=r,"undefined"==typeof e.edit&&(e.edit={}),e.manageCourse.categoryRows=t.allCoursesData,e.courseCodes=_.uniq(_.map(t.allCoursesData,function(e){return e.code}))},function(t){e.baiCatalogIsLoading=!1,e.rowsAreLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.assignmentTableError.error.setError(r,n)})},e.baiCatalogNodeClick=function(a){if("root"===a)e.rows=t.allCoursesData;else{t.coursesArray=[],e.rows=[];var s=r(a);e.rows=n.removeDuplicates(o(s),"id")}};var r=function(e){var n=t.baiCatalogPromiseData.formattedCoursesData,o=e.nodeId;return _.each(n,function(e){e.parentId===o&&t.coursesArray.push(e)}),e.nodes&&_.each(e.nodes,function(e){r(e)}),t.coursesArray},o=function(e){var r=[];return _.each(e,function(e){_.each(t.allCoursesData,function(t){t.id===e.courseId&&r.push(t)})}),r};e.customCatalogError={},e.customCatalogOptions={},e.customCatalogError.error=l.create(),e.customCatalogTreeTitle="Custom Catalog",e.customCatalogOptions.initiallyOpened=!1,t.customCatalogCta=function(){e.customCatalogIsLoading=!1;var t="404",r="The method or operation is not implemented.";e.customCatalogError.error.setError(t,r)},e.propertyName="name",e.reverse=!1,e.sortBy=function(t){e.reverse=e.propertyName===t&&!e.reverse,e.propertyName=t},e.property="$",e.changeFilter=function(t){"all"===t?e.property="$":e.property=t},e.selectAll={},e.checkAll=function(){_.each(e.rows,function(t){t.select=e.selectAll.checked})},e.edit={},e.edit.course={},e.edit.error=l.create(),e.edit.isLoading=!1,e.edit.selectedCourseCategory=null,e.edit.rowDisplayer=function(e){var t=[];for(var r in e)t.push(e[r].name);return t.join(">")},e.edit.selectedDisplayer=function(e){return e?e[e.length-1].name:""},e.edit.changeCommonDates=function(){var t=e.edit.course.displayStart,r=e.edit.course.displayEnd;if(null!==t&&null!==r||null===t&&null===r){if(t>r)return void(e.edit.form.dateRangeError=!0);e.edit.form.dateRangeError=!1}null===r&&(e.edit.form.dateRangeError=!1)},e.editAction=function(){e.homeTemplate="app/templates/assignments/edit/admin.html",e.edit.isLoading=!0,e.edit.error.reset();var r=parseInt(c.current.params.param.split("/")[0]);t.allCourses().then(function(n){if(e.edit.course=_.filter(t.allCoursesData,function(e){return e.id===r}),0===e.edit.course.length){var o="404",a="There's no course under that ID";return e.edit.error.setError(o,a),void(e.edit.isLoading=!1)}if(e.edit.course=e.edit.course[0],e.edit.course.typeFullName=g.getFullAssignmentTypeName(e.edit.course.type),e.edit.course.BAIOnly=!0,0!==e.edit.course.catalogId){var s=_.filter(e.manageCourse.categoryRows,function(t){return t.id===e.edit.course.catalogId});s.length>0&&(e.edit.selectedCourseCategory=s[0])}else e.edit.selectedCourseCategory=null;var i=m.fetchSingleCourse(e.edit.course.id);i.then(function(t){var r=t;e.edit.course.maxEnrollmentAttempts=r.maxEnrollmentAttempts,e.edit.course.displayEnd?e.edit.course.displayEnd=moment(r.displayEnd).toDate():e.edit.course.displayEnd=null,e.edit.course.displayStart=moment(r.displayStart).toDate(),e.edit.course.isManagerApprovalRequired=r.isManagerApprovalRequired,e.edit.course.BAIOnly=!0,e.edit.isLoading=!1},function(t){var r=t.ErrorCode,n=t.ErrorMessage;e.edit.error.setError(r,n),e.edit.isLoading=!1})},function(t){var r=t.ErrorCode,n=t.ErrorMessage;e.edit.error.setError(r,n),e.edit.isLoading=!1}),t.customCatalogCta()},e.edit.save=function(t){var r=angular.copy(t);e.edit.selectedCourseCategory&&(r.catalogId=e.edit.selectedCourseCategory.id),r.displayStart=moment(r.displayStart).toDate(),r.displayEnd?r.displayEnd=moment(r.displayEnd).toDate():r.displayEnd=null,e.customCatalogOptions.initiallyOpened=!1,e.edit.isLoading=!0,d.editCourse(r).then(function(t){e.baiCatalogTreeFilter="",e.baiCatalogIsLoading=!0,e.customCatalogIsLoading=!0,e.rowsAreLoading=!0,e.homeAction(),f.path("assignments/home/"),e.edit.isLoading=!1},function(t){e.edit.isLoading=!1;var r=t.ErrorCode,n=t.ErrorMessage;e.edit.error.setError(r,n)})},e.create={},e.create.ASSIGNMENT_TYPE_ENUM={WBT:"wbt",ILT:"ilt",COURSEGROUP:"courseGroup",TASK:"task",EVALUATION:"evaluation",SURVEY:"survey",ASSESSMENT:"assessment"},e.create.ASSIGNMENT_TYPE_TITLE_ENUM={wbt:"Web Based Training",ilt:"Instructor Led Training",courseGroup:"Course Group",task:"Task",evaluation:"Evaluation",survey:"Survey",assessment:"Assessment"},e.create.currentAssignmentType=null,e.create.formData={},e.create.error=l.create(),e.create.isLoading=!1,e.create.createdCourse=null,e.create.documentList=[],e.$watch("create.maxEnrollmentAttemptsIsUnlimited",function(t){t?(e.create.enrollmentAttemptsRegex=new RegExp(""),e.create.formData.maxEnrollmentAttempts=0):e.create.enrollmentAttemptsRegex=/^\d+$/}),e.$watch("create.nonScoring",function(t){e.create.nonScoring&&(e.create.formData.score=null)}),e.create.selectAssignment=function(t){e.create.currentAssignmentType=t,e.create.formData.type=t,e.create.currentAssignmentTypeFullName=e.create.ASSIGNMENT_TYPE_TITLE_ENUM[t],e.create.formData.code=e.create.currentAssignmentType+(new Date).toISOString().replace(/[^0-9]/g,""),S.wizard("Course").next()},e.create.goBackToStep2=function(){delete e.create.formData.id,S.wizard("Course").previous()},e.create.hideModal=function(){jQuery("#courseCreateSuccessModal").modal("hide"),f.url("assignments/home/")},t._attachFiles=function(e,t,r,n){for(var o=[],a=0;a<r.length;a+=1)o.push(y.uploadScormPackage(r[a],e));for(var s=0;s<n.length;s+=1)"file"!==n[s].fileOrUrl||n[s].fromRepo||o.push(y.uploadDocument(n[s].fileObject,e,!1)),"file"===n[s].fileOrUrl&&n[s].fromRepo&&o.push(y.attachDocumentFromRepositoryToCourse(n[s].id,e)),"url"===n[s].fileOrUrl&&o.push(y.attachUrlToCourse(n[s].name,e,!1));return Promise.all(o)},e.create.addScormPackage=function(t){if(e.isNotZipFile=!1,0!==t.length){var r=t[0];if("application/zip"!==r.type)return void(e.isNotZipFile=!0);r.uniqueId=Date.now(),e.create.scormPackages.push(r)}},e.create.removeScormPackage=function(t){e.create.scormPackages=_.filter(e.create.scormPackages,function(e){return e.uniqueId!==t.uniqueId})},t._clearCourseCreateForm=function(){e.create.formData={},e.create.scormPackages=[],e.create.documentList=[],e.create.formData.courseList=[],e.create.formData.displayStart=new Date,e.create.formData.passingScore=null,v.$watch("sysSettings",function(t){"undefined"!=typeof t.enrollmentAttempts&&(0===t.enrollmentAttempts?(e.create.formData.maxEnrollmentAttempts=null,e.create.maxEnrollmentAttemptsIsUnlimited=!0):(e.create.formData.maxEnrollmentAttempts=t.enrollmentAttempts,e.create.maxEnrollmentAttemptsIsUnlimited=!1))}),e.create.enrollmentAttemptsRegex=/^\d+$/},t._showCreateError=function(t){var r=t.StatusCode,n=t.ErrorMessage;e.create.error.setError(r,n)},t._showWizardSuccessScreen=function(){e.create.isLoading=!1,e.create.error.reset(),jQuery("#courseCreateSuccessModal").modal(),t._clearCourseCreateForm()},t._showWizardErrorScreen=function(r){e.create.isLoading=!1,t._showCreateError(r)},e.create.addCourseToCourseGroupList=function(){var r=_.filter(t.allCoursesData,function(t){return t.name===e.create.selectedCourse});if(r.length>0){e.create.selectedCourse="",r=r[0];var n=_.filter(e.create.formData.courseList,function(e){return r.id===e.id});if(n.length>0)return;r.uniqueId=Date.now(),e.create.formData.courseList.push(r)}},e.create.removeCourseFromCourseGroupList=function(t){e.create.formData.courseList=_.filter(e.create.formData.courseList,function(e){return e.uniqueId!==t.uniqueId})},e.create.createCourse=function(){e.create.isLoading=!0,e.create.error.reset();var r=d.createCourse(e.create.formData);r.then(function(t){e.create.isLoading=!1,e.create.formData=t,S.wizard("Assignment").next(),"courseGroup"===e.create.formData.type&&(e.create.formData.courseList=[]),"wbt"===e.create.formData.type&&(e.create.formData.score=null)},function(r){e.create.isLoading=!1,t._showCreateError(r)})},e.create.addExtraCourseProperties=function(){e.create.isLoading=!0,e.create.error.reset();var r=d.editCourse(e.create.formData);r.then(function(r){var n=t._attachFiles(e.create.formData.id,e.create.currentAssignmentType,e.create.scormPackages,e.create.documentList);n.then(function(e){t._showWizardSuccessScreen()},function(e){t._showWizardErrorScreen(e)})},function(e){t._showWizardErrorScreen(e)})},e.createAction=function(){e.homeTemplate="app/templates/assignments/create/admin.html",e.wizardTitle="Add New Assignment",t._clearCourseCreateForm(),t.baiCatalogCta(),t.customCatalogCta()}}}]),app.factory("Courses_AdminOverride",["$injector","$location","$q","$filter","$rootScope","$route","$timeout","$window","$uibModal","CatalogService","CoursesService","DocumentService","LocationsService","OfferingsService","RosterService","SettingsService","UsersService","dateUtil","messagingDisplayerUtil","sessionFormatterUtil","WizardHandler","TreeHelpers",function(e,t,r,n,o,a,s,i,u,l,c,d,p,m,f,g,h,v,y,C,S,w){return function(e){var D=this;e.defaultHeader=!0,e.activeTab="tab-active-class",e.tab2_Options={},e.contentSearch="assignmentsSearch.name",e.rows=Array(),D.originalRowData=Array(),e.tab2_Options.baiCatalogTreeFilter="",e.baiCatalogIsLoading=!0,e.customCatalogIsLoading=!0,e.rowsAreLoading=!0,D.currentCourseSet=[],D.params=a.current.params,e.propertyName="name",e.reverse=!1,e.sortBy=function(t){e.reverse=e.propertyName===t&&!e.reverse,e.propertyName=t},e.general={},e.general.search=null,e.general.typeaheadMinLength=3,e.general.typeaheadWaitTime=800,e.sequenceCourseSave=!1,e.general.filterBySearch=function(){var t=e.general.search,r=angular.copy(D.allCoursesData),o=e.property,a={},s={};switch(s[o]=t,o){case"displayStart":a=n("filter")(r,{displayStart:{fullDate:t}});break;case"displayEnd":a=n("filter")(r,{displayEnd:{fullDate:t}});break;default:a=n("filter")(r,s)}D.calculatePages(a),e.rows=a.splice(0,e.home.pageSize)},e.courses={},e.courses.isILTEnabled=!1,e.$watch(function(){return o.sysSettings},function(){e.courses.isILTEnabled=g.isILTEnabled()}),e.property="$",e.changeFilter=function(t){"all"===t?e.property="$":e.property=t},e.baiCatalogError={},e.baiCatalogOptions={},e.baiCatalogError.error=y.create(),e.baiCatalogTreeTitle="BAI Catalog",e.baiCatalogOptions.initiallyOpened=!0,e.assignmentTableError={},e.assignmentTableError.error=y.create(),e.home={},e.homeAction=function(){e.home.page=1,e.home.limit=100,e.home.total=0,e.home.maxVisiblePages=10,e.homeTemplate="app/templates/courses/home/admin.html",D.allCourses()},e.home.nextPage=function(){var t=e.home.page*e.home.limit-e.home.limit,r=angular.copy(D.currentCourseSet);e.rows=r.splice(t,e.home.limit)},e.manageCourse={},e.manageCourse.error=y.create(),e.manageCourse.isLoading=!1,e.editCourse={},e.editCourse.error=y.create(),e.editCourse.isLoading=!1,e.editAction=function(){e.homeTemplate="app/templates/courses/edit/admin.html",e.manageCourse.isLoading=!0,e.manageCourse.course.iModifyLoading=!1;var t=a.current.params.param.split("/"),r=t[0],n=c.getSingleCourse(r);n.then(function(t){e.manageCourse.course=t,"ilt"!==e.manageCourse.course.type&&(e.manageCourse.isLoading=!1),e.manageCourse.cancelMessage="Are you sure want to cancel?",D.getSecondaryDataForEdit(),D.setEvaluations()},function(t){e.manageCourse.isLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.manageCourse.error.setError(r,n)})},e.RetakeLimitSetPortal=function(){e.manageCourse.course.allowedEnrollments=null,e.manageCourse.course.enrollmentRestrictionDays=null},D.getSecondaryDataForEdit=function(){switch(D.setSecondaryProperties(e.manageCourse.course.type),e.manageCourse.course.type){case"ilt":e.manageCourse.getCourseOfferings()}},e.launchUrl=function(e){D.updatePassingScorelaunchUrl(e)},e.getFullAssignmentAssetTypeName=function(e){var t;return"wbt"===e?t="Web Based Training":"ilt"===e?t="Instructor Led Training":"vle"===e?t="Virtual Classroom":"task"===e?t="Tasks":"survey"===e?t="Surveys":"evaluation"===e?t="Evaluations":"assessment"===e?t="Assesments":"courseGroup"===e?t="Course Group":"courseGroupCertification"===e?t="Course Groups (Certification)":"courseGroupCurricula"===e&&(t="Course Groups (Curricula)"),t},e.dump=function(e){void 0},e.sendEditCourseCall=function(n){e.editCourse.isLoading=!0;var a=angular.copy(e.manageCourse.course);a.resourceLaunchWithContent=e.manageCourse.course.resourceLaunchWithContent;var s=[];if("undefined"!=typeof n&&n===!0?a.displayEnd=moment().utc():"undefined"!=typeof n&&n===!1&&(a.displayEnd=null),"courseGroup"===a.type||"courseGroupCurricula"===a.type||"courseGroupCertification"===a.type){var i=D.updatedCourseGroupCourses(a);"undefined"!=typeof i&&null!==i&&s.push(i)}if("undefined"!=typeof a.type&&"ilt"===a.type){var u=D.updateCourseIlt(a);"undefined"!=typeof u&&null!==u&&s.push(u)}var l=D.updateCourseCommonProp(a);"undefined"!=typeof l&&null!==l&&s.push(l);var c=D.updateCourseAssets(a);"undefined"==typeof c||null===c||e.sequenceCourseSave||s.push(c),r.all(s).then(function(n){e.editCourse.isLoading=!1,t.path("courses/home/"),e.sequenceCourseSave&&r.all(c).then(function(e){})},function(t){o.$broadcast("RefreshDocList",{courseId:a.id}),e.editCourse.isLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.manageCourse.error.setError(r,n)})},e.toggleConfirmation=function(){jQuery(".confirmiltSave").toggle()},D.updateCourseIlt=function(e){var t;return _.each(e.offerings,function(e){e.assignmentType="ilt";var r=angular.copy(e),n=r.sessions;if("undefined"!=typeof n&&null!==n&&n.length>0)for(var o=0;o<n.length;o++){var a=moment(n[o].endDate),s=moment(n[o].endTime),i=moment(n[o].startDate),u=moment(n[o].startTime),l=moment(a),c=moment(i);n[o].endDateTime=v.formatDate(l.hours(s.hours()).minutes(s.minutes())),n[o].startDateTime=v.formatDate(c.hours(u.hours()).minutes(u.minutes()))}t="undefined"!=typeof e.id?m.updateOffering(r):m.createOfferings([r])}),t},e.updateCourseOfferingRoster=function(t){e.manageCourse.stepSix={};var r=[],n=t.offerings;_.each(n,function(e){var t=e.roster.attendingStudents;r=[],_.each(t,function(t){if(t.error=y.create(),"undefined"==typeof e.id)return void t.error.setError("","Offering does not exist.");if("undefined"==typeof t.isExisting||null===t.isExisting){var n={};n.StudentId=t.id,n.OfferingId=e.id,n.RegistrationStatus="confirmed",n.AssignmentType="ilt",r.push(n)}}),r.length>0&&D.batchUpdateUserInRoster(r,e)})},D.updateCourseCommonProp=function(e){var t=c.updateCourse(e);return t},D.updateCourseAssets=function(t){var r=D._attachFiles(t.id,t.type,e.manageCourse.scormPackages,e.manageCourse.course.documentList);return r},e.manageCourse.editCourseOfferingsError=y.create(),e.manageCourse.editOfferingsIsLoading=!0,e.manageCourse.showOfferingsLoading=!0,e.manageCourse.stepFive={},e.manageCourse.stepFive.error=y.create(),e.manageCourse.getCourseOfferings=function(){var t=a.current.params.param.split("/")[0];if(e.manageCourse.editCourseOfferingsError.reset(),e.manageCourse.editOfferingsIsLoading=!0,e.manageCourse.showOfferingsLoading=!0,"undefined"!=typeof e.manageCourse.course.offerings&&null!==e.manageCourse.course.offerings)return e.manageCourse.editOfferingsIsLoading=!1,e.manageCourse.showOfferingsLoading=!1,e.manageCourse.isLoading=!1,!0;var n=c.getSingleCourseOfferings(t),o=p.getAll(),s=h.getAllInstructors(),i=[];i.push(n),i.push(o),i.push(s),o.then(function(t){e.manageCourse.locations=t},function(e){}),s.then(function(t){return e.manageCourse.stepFour.instructors=t,n},function(e){return n}).then(function(t){e.manageCourse.course.offerings=t,D.setOfferingInstructors(),D.setSessions(t),_.each(e.manageCourse.course.offerings,function(e){D.setOfferingAccordionHeading(e)})},function(e){}),r.all(i).then(function(t){e.manageCourse.editOfferingsIsLoading=!1,e.manageCourse.showOfferingsLoading=!1,e.manageCourse.isLoading=!1},function(t){e.manageCourse.editOfferingsIsLoading=!1,e.manageCourse.showOfferingsLoading=!1,e.manageCourse.isLoading=!1}),e.manageCourse.getCourseSessions()},e.$on("$includeContentLoaded",function(t,r){if("app/templates/courses/create/partials/step4/partials/admin.step4.offeringRepeater.html"===r)return void(e.manageCourse.showOfferingsLoading=!1)}),D.setSessions=function(t){var r=(e.manageCourse.course,[]);_.each(t,function(e){e.localId=e.id,_.each(e.sessions,function(t){t.offeringName=e.name,t.offeringId=e.id,t.startDate=v.formatDate(t.startDateTime.jsDate).jsDate,t.startTime=v.formatDate(t.startDateTime.jsDate).jsDate,t.endDate=v.formatDate(t.endDateTime.jsDate).jsDate,t.endTime=v.formatDate(t.endDateTime.jsDate).jsDate,t.error=!1,r.push(t)})}),e.manageCourse.stepFive.allSessions=r},this.setOfferingInstructors=function(){var t=e.manageCourse.stepFour.instructors,r=e.manageCourse.course.offerings;"undefined"!=typeof r&&null!==r&&_.each(r,function(e){e.instructorPills=[],"undefined"!=typeof e.instructorIds&&null!==e.instructorIds&&e.instructorIds.length>0&&_.each(e.instructorIds,function(r){var n=_.findWhere(t,{id:r});if("undefined"!=typeof n)e.instructorPills.push(n);else{var o=h.fetch(r);o.then(function(t){e.instructorPills.push(t)})}})})},this.batchUpdateUserInRoster=function(t,r){e.manageCourse.stepSix.rosterSaving=!0;var n=f.updateMultiplePersonOnRoster(t);n.then(function(t){var n=_.where(t,{success:!0}),o=_.where(t,{success:!1}),a=r.roster.attendingStudents;_.each(n,function(e){var t=_.findWhere(a,{id:e.studentId});t.isExisting=!0,t.success=y.create(),t.success.setError(200,"Successfully added "+t.fullName+" to roster!",!1)}),_.each(o,function(e){var t=_.findWhere(a,{id:e.studentId});t.error.setError("",e.message)}),D.setOfferingAccordionHeading(r),e.manageCourse.stepSix.rosterSaving=!1},function(t){_.each(r.roster.attendingStudents,function(r){e.manageCourse.singleUserToRosterError(t,r)}),e.manageCourse.stepSix.rosterSaving=!1})},e.manageCourse.getCourseSessions=function(){e.manageCourse.stepFive.allSessions;e.manageCourse.stepFive.repeatOptions=[{id:1,label:"Daily"},{id:2,label:"Weekly"},{id:4,label:"Monthly"},{id:5,label:"Yearly"}]},e.manageCourse.getCourseOfferingsRoster=function(){var t=e.manageCourse.course.offerings;e.manageCourse.editRosterIsLoading=!0,"undefined"!=typeof t&&t.length>0&&_.each(t,function(e){e.search={},e.search.error=y.create();var t=f.fetch(e.id,"ilt");t.then(function(t){if("undefined"!=typeof t&&null!==t){var r=t.attendingStudents;r.length>0&&(e.roster={},e.roster.attendingStudents=[],_.each(t.attendingStudents,function(t){t.student.isExisting=!0,e.roster.attendingStudents.push(t.student)}))}},function(e){void 0})}),e.manageCourse.editRosterIsLoading=!1},D.updatedCourseGroupCourses=function(e){var t=c.updateCourseGroupChildren(e);t.then(function(e){},function(e){void 0})},D.baiCatalogCta=function(){e.baiCatalogError.error.reset();var t=l.getBaiCatalogData();t.then(function(t){D.baiCatalogPromiseData=t,e.manageCourse.categoryRows=t.formattedCatalogTree,w.setPropertyOnAllNodes(t.formattedCatalogTreeData,"lockIcon",!0),e.baiCatalogData=[{name:"BAI Catalog",nodes:t.formattedCatalogTreeData}],e.baiCatalogIsLoading=!1,e.coursesSelected=e.baiCatalogData[0]},function(t){e.baiCatalogIsLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.baiCatalogError.error.setError(r,n)})},e.baiCatalogNodeClick=function(r){var n=document.getElementsByClassName("tree-selected");Array.prototype.forEach.call(n,function(e){$(e).removeClass("tree-selected")});var o=[];if("undefined"!=typeof D.params.name&&null!==D.params.name&&"home"===D.params.name){"undefined"==typeof r.nodeId?(o=D.allCoursesData,D.currentCourseSet=o):(D.emptyArray=[],o=D.filterRowsByCatalogId(r)),D.calculatePages(o);var a=angular.copy(o);o=a.splice(0,e.home.limit),e.rows=o}else t.path("/courses/home")},e.createAction=function(){e.homeTemplate="app/templates/courses/create/admin.html",e.wizardTitle="Add New Course",e.manageCourse.popoverIsOpen=!1,e.create={},e.create.isLoading=!0,e.manageCourse.ASSIGNMENT_TYPE_ENUM={WBT:"wbt",CERTIFICATION:"courseGroupCertification",COURSEGROUP:"courseGroup",CURRICULA:"courseGroupCurricula",TASK:"task",EVALUATION:"evaluation",SURVEY:"survey",ASSESSMENT:"assessment"},e.manageCourse.ASSIGNMENT_TYPE_TITLE_ENUM={wbt:"Web Based Training",courseGroupCertification:"Certification",courseGroup:"Course Group",courseGroupCurricula:"Curricula",task:"Task",evaluation:"Evaluation",survey:"Survey",assessment:"Assessment"},D._clearCourseCreateForm(),D.setEvaluations(),e.$watch(function(){return o.sysSettings},function(){e.create.isLoading=!1,e.courses.isILTEnabled=g.isILTEnabled(),e.courses.isILTEnabled===!0&&(e.manageCourse.ASSIGNMENT_TYPE_ENUM.ILT="ilt",e.manageCourse.ASSIGNMENT_TYPE_TITLE_ENUM.ilt="Instructor Led Training")})},e.manageCourse.currentAssignmentType=null,e.manageCourse.course={},e.manageCourse.error=y.create(),e.manageCourse.isLoading=!1,e.manageCourse.scormPackages=[],e.offeringInUse={},e.manageCourse.selectInstructor=function(e,t,r,n,o){o.instructorReader=r,o.instructorLabel="",o.instructorIds.push(e.id),o.instructorPills.push(e)},e.manageCourse.selectLocation=function(t){var r=_.find(e.manageCourse.locations,function(e){return e.id===t.facilityId});t.location=r.name,t.address=r.mailingAddress,D.setOfferingAccordionHeading(t)},e.manageCourse.cloneOffering=function(){var t=a.current.params.name;"undefined"!=typeof t&&"edit"===t&&"undefined"==typeof e.manageCourse.course.offerings&&(e.manageCourse.course.offerings=[]);var r=m.createGenericOffering(e.manageCourse.course.offerings.length+1,e.manageCourse.course.id);D.setOfferingEnrollmentOpensDateBoundries(r),D.setOfferingEnrollmentEndDateBoundries(r),r.accordionOpen=!0,e.offeringInUse=r,D.setNewOfferingDefaults(r);var n=new Date;n.setHours(0,0,0,0),n>=e.manageCourse.course.displayStart.jsDate?r.requestedOn=v.formatDate(n):r.requestedOn=e.manageCourse.course.displayStart,D.setOfferingAccordionHeading(r),e.manageCourse.course.offerings.push(r)},e.manageCourse.removeUserForInstructorList=function(e,t){e.instructorIds.splice(t,1),e.instructorPills.splice(t,1),0===e.instructorPills.length&&(e.instructorLabel="",e.instructorReader="")},e.manageCourse.removeOffering=function(t,r){if(e.manageCourse.course.offerings.splice(t,1),e.offeringInUse=D.getOfferingwithNoSession(),"undefined"!=typeof e.manageCourse.stepFive.allSessions&&e.manageCourse.stepFive.allSessions.length>0){var n=angular.copy(e.manageCourse.stepFive.allSessions);_.each(n,function(t){t.offeringId===r.id&&(sessionKey=e.manageCourse.stepFive.allSessions.indexOf(t),e.manageCourse.stepFive.allSessions.splice(sessionKey,1))})}var o=a.current.params.name;"undefined"!=typeof o&&"edit"===o&&D.removeOffering(r)},D.removeOffering=function(e){var t=m.cancelOffering(e.id,"ilt");t.then(function(e){},function(e){})},e.manageCourse.selectDayForSessionCreator=function(t,r){if(jQuery(r.currentTarget).hasClass("active")){var n=e.manageCourse.stepFive.sessionCreator.days.indexOf(t);e.manageCourse.stepFive.sessionCreator.days.splice(n,1)}else e.manageCourse.stepFive.sessionCreator.days.push(t);e.manageCourse.stepFive.sessionCreator.day=t,jQuery(r.currentTarget).toggleClass("active")},e.manageCourse.createSessions=function(){var t=e.manageCourse.stepFive.sessionCreator,r=[];if(e.manageCourse.stepFive.error.reset(),e.manageCourse.stepFive.errorCount=0,t.startDate>t.endDate)return void e.manageCourse.stepFive.error.setError(500,"No sessions added. Start date must be less than end date");switch(t.repeat){case 1:r=C.createSessionsByStandardRepeat(t,e.manageCourse.course.offerings,"days",1);break;case 2:r=C.createSessionsByRepeatingDays(t,e.manageCourse.course.offerings);break;case 3:r=C.createSessionsByStandardRepeat(t,e.manageCourse.course.offerings,"weeks",2);break;case 4:r=C.createSessionsByStandardRepeat(t,e.manageCourse.course.offerings,"months",1);break;case 5:r=C.createSessionsByStandardRepeat(t,e.manageCourse.course.offerings,"years",1)}r=_.filter(r,function(t){return t.error!==!0?t:void e.manageCourse.stepFive.errorCount++}),e.manageCourse.stepFive.errorCount>0&&e.manageCourse.stepFive.error.setError(500,e.manageCourse.stepFive.errorCount+" sessions were not added, due to date time conflicts!"),"undefined"!=typeof e.manageCourse.stepFive.allSessions?e.manageCourse.stepFive.allSessions=e.manageCourse.stepFive.allSessions.concat(r):e.manageCourse.stepFive.allSessions=r;var n=_.find(e.manageCourse.course.offerings,function(e){return e.localId===t.offering});"undefined"!=typeof n.sessions&&null!==n.sessions?n.sessions=n.sessions.concat(r):n.sessions=r,D.setOfferingAccordionHeading(n)},e.manageCourse.changeEndDateOnSessionUpdate=function(e){var t=angular.copy(e),r=moment(t.startDate),n=moment(t.endTime),o=moment(t.startDate),a=moment(t.startTime);e.endDateTime=v.formatDate(r.hours(n.hours()).minutes(n.minutes())),e.startDateTime=v.formatDate(o.hours(a.hours()).minutes(a.minutes()))},e.manageCourse.removeSession=function(t){var r=_.find(e.manageCourse.course.offerings,function(e){return parseInt(e.localId,10)===parseInt(t.offeringId,10)}),n=r.sessions.indexOf(t);r.sessions.splice(n,1),e.offeringInUse=r,n=e.manageCourse.stepFive.allSessions.indexOf(t),e.manageCourse.stepFive.allSessions.splice(n,1),D.setOfferingAccordionHeading(r)},e.manageCourse.createOfferingsCall=function(){e.manageCourse.stepFive.isLoading=!0,e.manageCourse.stepFive.error.reset();var t=angular.copy(e.manageCourse.course.offerings),r=m.createOfferings(t);
r.then(function(t){_.each(t,function(t){_.each(e.manageCourse.course.offerings,function(e){e.name===t.name&&"undefined"==typeof e.id&&(e.id=t.id)})}),e.manageCourse.stepFive.isLoading=!1,S.wizard("Course").next(),e.manageCourse.cancelMessage=D.setCourseCancelMessage(6)},function(t){e.manageCourse.stepFive.isLoading=!1,e.manageCourse.stepFive.error.setError(t.StatusCode,t.ErrorMessage)})},e.manageCourse.maxEnrollmentAttemptsToggle=!0,e.manageCourse.createdCourse=null,e.manageCourse.documentList=[],e.manageCourse.selectAssignment=function(t){e.manageCourse.currentAssignmentType=t,e.manageCourse.course.type=t,e.manageCourse.currentAssignmentTypeFullName=e.manageCourse.ASSIGNMENT_TYPE_TITLE_ENUM[t],e.manageCourse.course.code=e.manageCourse.currentAssignmentType+(new Date).toISOString().replace(/[^0-9]/g,""),D.setSecondaryProperties(e.manageCourse.course.type),S.wizard("Course").next(),e.manageCourse.cancelMessage=D.setCourseCancelMessage(2)},e.manageCourse.goBackToStep2=function(){S.wizard("Course").previous(),e.manageCourse.cancelMessage=D.setCourseCancelMessage(2)},e.manageCourse.goTo=function(t){S.wizard("Course").goTo(t),e.manageCourse.cancelMessage=D.setCourseCancelMessage(t+1)},e.manageCourse.hideModal=function(){jQuery("#courseCreateSuccessModal").modal("hide"),t.url("courses/home/")},D._attachFiles=function(t,n,o,a){var s=[];if("undefined"!=typeof o&&o.length>0)for(var i=0;i<o.length;i+=1)e.manageCourse.course.hasScormContent?s.push(d.updateScormPackage(o[i],t)):s.push(d.uploadScormPackage(o[i],t));if("undefined"!=typeof a&&a.length>0)for(var u=0;u<a.length;u+=1)"file"!==a[u].fileOrUrl||a[u].fromRepo||(a[u].launchWithContent===!0&&(e.sequenceCourseSave=!0),s.push(d.uploadDocument(a[u].fileObject,t,a[u].launchWithContent))),"file"===a[u].fileOrUrl&&a[u].fromRepo&&s.push(d.attachDocumentFromRepositoryToCourse(a[u].id,t)),"url"===a[u].fileOrUrl&&(a[u].launchWithContent===!0&&(e.sequenceCourseSave=!0),s.push(d.attachUrlToCourse(a[u].name,t,a[u].launchWithContent)));if("undefined"!=typeof a&&"undefined"!=typeof a.deletedFiles&&a.deletedFiles.length>0)for(var l=0;l<a.deletedFiles.length;l+=1)"undefined"!=typeof a.deletedFiles[l].id&&s.push(d.deleteAsset(t,a.deletedFiles[l].id));return r.all(s)},e.manageCourse.addScormPackage=function(t){if(e.isNotZipFile=!1,0!==t.length){var r=t[0];if("application/zip"!==r.type&&"application/x-zip-compressed"!==r.type)return void(e.isNotZipFile=!0);r.uniqueId=Date.now(),e.manageCourse.scormPackages.push(r)}},e.manageCourse.removeScormPackage=function(t){e.manageCourse.scormPackages=_.filter(e.manageCourse.scormPackages,function(e){return e.uniqueId!==t.uniqueId})},D._clearCourseCreateForm=function(){e.manageCourse.course={},e.manageCourse.scormPackages=[],e.manageCourse.documentList=[],e.manageCourse.course.courseList=[];var t=new Date;t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),e.manageCourse.course.displayStart=v.formatDate(t),e.manageCourse.previouslyAddedCourses=[],e.manageCourse.enrollmentAttemptsRegex=/^\d+$/},D._showWizardSuccessScreen=function(){e.manageCourse.isLoading=!1,e.manageCourse.error.reset(),jQuery("#courseCreateSuccessModal").modal(),D._clearCourseCreateForm()},e.manageCourse.createCourse=function(){e.manageCourse.stepTwo.isLoading=!0,e.manageCourse.error.reset();var t,r=e.manageCourse.course.id;"undefined"==typeof r||null===r?t=c.createCourse(e.manageCourse.course):r&&(t=D.updateCourseCommonProp(e.manageCourse.course)),t.then(function(t){e.manageCourse.stepTwo.isLoading=!1,e.manageCourse.course=_.extend(e.manageCourse.course,t);var r=["courseGroup","courseGroupCertification","courseGroupCurricula"];jQuery.inArray(e.manageCourse.course.type,r)>-1&&(e.manageCourse.course.childCourses=angular.copy(e.manageCourse.previouslyAddedCourses)),S.wizard("Course").next(),e.manageCourse.cancelMessage=D.setCourseCancelMessage(3)},function(t){e.manageCourse.stepTwo.isLoading=!1,e.manageCourse.stepTwo.error.setError(t.ErrorCode,t.ErrorMessage)})},e.manageCourse.setNonScoring=function(t){t&&(e.manageCourse.course.masteryScore=0)},D.setCourseCancelMessage=function(e){switch(e){case 2:return"This will take you out of Course creation.\nDo you wish to continue?";case 3:return"Changes you made to this step will not be saved.\nDo you wish to continue?";case 4:case 5:case 6:return"Changes you made will not be saved.\nDo you wish to continue?";default:return"Are you sure want to cancel?"}},D.setSecondaryProperties=function(t){switch(D._initAdditionalStep("Two","Properties"),D._initAdditionalStep("Three","Details"),t){case"wbt":e.manageCourse.course.score=null;break;case"ilt":D._initAdditionalStep("Four","Offerings"),D._initAdditionalStep("Five","Sessions"),D._initAdditionalStep("Six","Roster")}},D._initAdditionalStep=function(t,r){e.manageCourse["step"+t]={};var n=e.manageCourse["step"+t];n.error=y.create(),n.isLoading=!1,n.allSessions=[],n.errorCount=0,n.exists=!0,n.name=r},e.manageCourse._stepFourAction=function(){switch(e.manageCourse.course.type){case"ilt":e.manageCourse.stepFour.autoCompleteError=!1,e.manageCourse.course.offerings=[];var t=m.createGenericOffering(1,e.manageCourse.course.id);t.accordionOpen=!0,D.setNewOfferingDefaults(t),D.setOfferingAccordionHeading(t),e.manageCourse.course.offerings.push(t)}},e.manageCourse._stepFiveAction=function(){switch(e.manageCourse.course.type){case"ilt":e.manageCourse.stepFive.sessionCreator={},e.ilt={},e.manageCourse.stepFive.sessionCreator.days=[],e.manageCourse.stepFive.sessionCreator.endDate=null,e.manageCourse.stepFive.sessionCreator.endTime=null,e.manageCourse.stepFive.sessionCreator.startDate=null,e.manageCourse.stepFive.sessionCreator.startTime=null,e.manageCourse.stepFive.repeatOptions=[{id:1,label:"Daily"},{id:2,label:"Weekly"},{id:4,label:"Monthly"},{id:5,label:"Yearly"}],e.manageCourse.stepFive.sessionCreator.includeWeekdaysOnly=!1}},e.manageCourse._stepSixAction=function(){switch(e.manageCourse.course.type){case"ilt":e.manageCourse.stepSix.currentCompletedTotal=0,e.manageCourse.stepSix.currentSuccessTotal=0,e.manageCourse.stepSix.totalCompletionsPossible=0}},e.manageCourse.addUsersToRosterCall=function(){e.manageCourse.stepSix.currentCompletedTotal=0,e.manageCourse.stepSix.currentSuccessTotal=0,e.manageCourse.stepSix.totalCompletionsPossible=0;var t,r=e.manageCourse.course.offerings,n=null;e.manageCourse.stepSix.isLoading=!0;for(var o=0;o<r.length;o++)if(t=r[o].roster.attendingStudents,t.length>0){e.manageCourse.stepSix.totalCompletionsPossible+=t.length;for(var a=0;a<t.length;a++){if(n=t[a],"undefined"==typeof n.error||null===n.error?n.error=y.create():n.error.reset(),"undefined"==typeof n.success||null===n.success)n.success=y.create();else if(n.success.thrown===!0){e.manageCourse.stepSix.totalCompletionsPossible--;continue}D.updateUserInRoster(r[o],n)}}0===e.manageCourse.stepSix.totalCompletionsPossible&&D.trackUserToRosterCompletions()},D.updateUserInRoster=function(t,r){r.isLoading=!0,r.call=f.updateSinglePersonOnRoster(r.id,t.id,"confirmed","ilt"),r.call.then(function(t){e.manageCourse.stepSix.currentCompletedTotal++,e.manageCourse.stepSix.currentSuccessTotal++,e.manageCourse.singleUserToRosterSuccess(r)},function(t){e.manageCourse.stepSix.currentCompletedTotal++,e.manageCourse.singleUserToRosterError(t,r)})},e.manageCourse.singleUserToRosterError=function(e,t){t.isLoading=!1,t.error.setError(e.ErrorCode,e.ErrorMessage),D.trackUserToRosterCompletions()},e.manageCourse.singleUserToRosterSuccess=function(e){e.isLoading=!1,e.success.setError(200,"Successfully added "+e.fullName+" to roster!"),D.trackUserToRosterCompletions()},D.trackUserToRosterCompletions=function(){e.manageCourse.stepSix.isLoading=!1,e.manageCourse.stepSix.currentSuccessTotal===e.manageCourse.stepSix.totalCompletionsPossible?jQuery("#courseCreateSuccessModal").modal():e.manageCourse.stepSix.currentCompletedTotal===e.manageCourse.stepSix.totalCompletionsPossible},e.manageCourse.getTotalSessionsForAllOfferings=function(){var t=e.manageCourse.course.offerings,r=0;return _.each(t,function(e){r+=e.sessions.length}),r},e.manageCourse.searchForUsers=function(e,t){t.search.error.reset(),t.search.isLoading=!0;var r={};r.pageNumber=1,r.pageSize=25,r.fullNameContains=e;var n=h.advancedSearch(r);return n.then(function(e){return t.search.isLoading=!1,t.roster.attendingStudents.length>0&&(e=_.filter(e,function(e){var r=_.findWhere(t.roster.attendingStudents,{id:e.id});return("undefined"==typeof r||e.id!==r.id)&&e}),0===e.length)?(t.rosterUser="",t.search.error.setError(404,"There are no items to display."),!1):e},function(e){t.search.isLoading=!1,t.search.error.setError(e.StatusCode,e.ErrorMessage)})},e.manageCourse.selectUsersForRoster=function(e,t,r,n,o){o.rosterUser="",o.roster.attendingStudents.length<o.maxAllowedSize&&o.roster.attendingStudents.push(e)},e.manageCourse.removeUserFromRoster=function(e,t){var r=t.roster.attendingStudents.indexOf(e);t.roster.attendingStudents.splice(r,1);var n=a.current.params.name;if("undefined"!=typeof n&&"edit"===n){e.isLoading=!0;var o=f.updateSinglePersonOnRoster(e.id,t.id,"cancelled","ilt");o.then(function(t){e.isLoading=!1},function(t){e.isLoading=!1,e.error.setError(t.ErrorCode,t.ErrorMessage)})}},e.manageCourse.addExtraCourseProperties=function(){e.manageCourse.stepThree.isLoading=!0,e.manageCourse.stepThree.error.reset(),"courseGroup"!==e.manageCourse.course.type&&"courseGroupCertification"!==e.manageCourse.course.type&&"courseGroupCurricula"!==e.manageCourse.course.type||D.updatedCourseGroupCourses(e.manageCourse.course);var t=angular.copy(e.manageCourse.course),r=c.updateCourse(t);r.then(function(){var t="undefined"!=typeof e.manageCourse.course.documentList?e.manageCourse.course.documentList:e.manageCourse.documentList,r=D._attachFiles(e.manageCourse.course.id,e.manageCourse.currentAssignmentType,e.manageCourse.scormPackages,t);r.then(function(){e.manageCourse.stepThree.isLoading=!1,o.$broadcast("RefreshDocList",{courseId:e.manageCourse.course.id}),D.performSecondaryAction()},function(t){o.$broadcast("RefreshDocList",{courseId:e.manageCourse.course.id}),e.manageCourse.stepThree.isLoading=!1,e.manageCourse.stepThree.error.setError(t.ErrorCode,t.ErrorMessage)})},function(t){e.manageCourse.stepThree.isLoading=!1,e.manageCourse.stepThree.error.setError(t.ErrorCode,t.ErrorMessage)})},e.launchEditor=function(t){var r=angular.copy(e.manageCourse.course),n=c.updateCourse(r);n.then(function(){void 0,e.launchUrl(t,"_blank")})},D.filterRowsByCatalogId=function(e){var t=e.nodeId;return _.each(D.allCoursesData,function(e){e.catalogId===t&&D.emptyArray.push(e)}),e.nodes&&_.each(e.nodes,function(e){D.filterRowsByCatalogId(e)}),D.emptyArray},D.performSecondaryAction=function(t){switch(e.manageCourse.course.type){case"ilt":if(t===!0);else for(var r=0;r<e.manageCourse.course.offerings.length;r++)e.manageCourse.course.offerings[r].courseId=e.manageCourse.course.id;var n=p.getAll();n.then(function(t){e.manageCourse.locations=t},function(){});var o=h.getAllInstructors();o.then(function(t){e.manageCourse.stepFour.instructors=t},function(e){}),S.wizard("Course").next(),e.manageCourse.cancelMessage=D.setCourseCancelMessage(4);break;default:D._showWizardSuccessScreen()}},e.changeSortBy=function(t){e.propertyName=t,e.reverse=e.propertyName===t&&!e.reverse,t.indexOf("displayStart")>=0?D.currentCourseSet=_.sortBy(D.currentCourseSet,function(e){var t=new Date(e.displayStart.apiDate);return t}):t.indexOf("displayEnd")>=0?D.currentCourseSet=_.sortBy(D.currentCourseSet,function(e){if("undefined"!==e.displayEnd&&null!==e.displayEnd){var t=new Date(e.displayEnd.apiDate);return t}return-1}):D.currentCourseSet=_.sortBy(D.currentCourseSet,e.propertyName),e.reverse===!0&&D.currentCourseSet.reverse(),D.calculatePages(D.currentCourseSet);var r=e.home.page*e.home.limit-e.home.limit,n=angular.copy(D.currentCourseSet);e.rows=n.splice(r,e.home.limit)},e.selectedCourseCount=0,e.checkForLength=function(t){t===!0?e.selectedCourseCount++:e.selectedCourseCount--},e.addAllCourses=function(t){_.each(e.courseData,function(e){e.select=t}),t===!0?e.selectedCourseCount=e.courseData.length:e.selectedCourseCount=0},D.allCourses=function(){e.assignmentTableError.error.reset();var t=c.getCoursesForOrg();return t.then(function(t){e.rowsAreLoading=!1,D.allCoursesData=_.sortBy(t,e.propertyName),D.currentCourseSet=angular.copy(D.allCoursesData),D.calculatePages(D.allCoursesData);var r=angular.copy(D.allCoursesData);t=r.splice(0,e.home.pageSize),e.rows=t,"undefined"==typeof e.edit&&(e.edit={}),e.manageCourse.evaluationsNsurveys=D.getEvaluations(r)},function(t){e.baiCatalogIsLoading=!1,e.rowsAreLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.assignmentTableError.error.setError(r,n)})},D.formatCoursesData=function(e){var t=[];return _.each(e,function(e){e.select=!1,"courseGroup"!==e.type&&"courseGroupCertification"!==e.type&&"courseGroupCurricula"!==e.type&&t.push(e)}),t},D.getEvaluations=function(e){var t=[],r={name:"Select One",type:"default",evaluationId:0,id:0};n("filter")(e,function(e){"evaluation"!==e.type&&"survey"!==e.type||t.push(e)});var o=_.sortBy(t,"name");return o.unshift(r),o},D.setEvaluations=function(){D.allCoursesData?e.manageCourse.evaluationsNsurveys=D.getEvaluations(D.allCoursesData):D.allCourses()},e.courseSearchModal={},e.courseSearchModal.courseSearch="",e.courseSearchModal.selectAll=!1,e.courseSearchModal.coursesAreLoading=!0,e.viewCoursesError={},e.viewCoursesError.error=y.create(),e.getAllCoursesCta=function(t){e.modalBodyShow=!0,e.selectedCourseCount=0,e.viewCoursesError.error.reset(),e.courseSearchModal.coursesAreLoading=!0,e.courseSearchModal.selectAll=!1;var r=c.getActiveCoursesForOrg();r.then(function(r){var o=D.formatCoursesData(r);"undefined"!=typeof t&&null!==t?e.courseData=n("filter")(o,t):e.courseData=o,e.courseSearchModal.coursesAreLoading=!1},function(t){e.courseSearchModal.coursesAreLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.viewCoursesError.error.setError(r,n)})},e.applyNewAssignmentsCta=function(t){var r=D.getSelectedCourses(t);_.each(r,function(t){"undefined"!=typeof e.manageCourse.course.childCourses&&e.manageCourse.course.childCourses.indexOf(t)===-1&&e.manageCourse.course.childCourses.push(t),"undefined"!=typeof e.manageCourse.previouslyAddedCourses&&e.manageCourse.previouslyAddedCourses.indexOf(t)===-1&&e.manageCourse.previouslyAddedCourses.push(t)}),e.manageCourse.course.childCourses=D.uniqueCourses(e.manageCourse.course.childCourses)},D.getSelectedCourses=function(e){var t=[];return _.each(e,function(e){e.select===!0&&t.push(e)}),t},D.uniqueCourses=function(e){var t=[],r=[];return _.each(e,function(e){var n=e.course.id;r.indexOf(n)===-1&&(r.push(n),t.push(e))}),t},e.removeCourse=function(t){e.manageCourse.course.childCourses.splice(e.manageCourse.course.childCourses.indexOf(t),1)},e.addNewAssignmentCta=function(){e.courseSearchModal.courseSearch="",e.selectedCourseCount=0,e.courseSearchModal.selectAll=!1,D.formatCoursesData(e.courseData),angular.element(document.querySelector("#viewAssignmentsModal")).modal("hide"),angular.element(document.querySelector("#addNewAssignmentModal")).modal()},e.customCatalogError={},e.customCatalogOptions={},e.customCatalogError.error=y.create(),e.customCatalogTreeTitle="Custom Catalog",e.customCatalogOptions.showLocks=!1,e.customCatalogOptions.initiallyOpened=!0,e.customCatalogOptions.nodeClick=function(e){"courseGroups"===e.api_name&&"undefined"!=typeof e.id&null!==typeof e.id&&t.path("courses/edit/"+e.id+"/")},D.customCatalogCta=function(){e.customCatalogIsLoading=!0;var t=l.getCustomCatalog();t.then(function(t){e.customCatalogIsLoading=!1,e.customCatalogData=[{name:"Custom Catalog",nodes:t}],D.customCatalogDataOriginal=t},function(t){e.customCatalogIsLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.customCatalogError.error.setError(r,n)})},e.customCatalogNodeClick=function(r){var n=document.getElementsByClassName("tree-selected");if(Array.prototype.forEach.call(n,function(e){$(e).removeClass("tree-selected")}),e.coursesSelected=e.customCatalogData[0],"undefined"!=typeof D.params.name&&null!==D.params.name&&"home"===D.params.name)if("root"===r){e.rowsAreLoading=!0;var o=D.customCatalogDataOriginal;e.rows=D.uniqueCourses(D.allCustomCourses(o)),e.rowsAreLoading=!1}else r.hasOwnProperty("courses")?(e.rowsAreLoading=!0,e.rows=D.uniqueCourses(D.coursesSubset(r)),e.rowsAreLoading=!1):r.hasOwnProperty("nodes")&&(e.rowsAreLoading=!0,e.rows=D.uniqueCourses(D.courseGroupSubset(r)),e.rowsAreLoading=!1);else t.path("courses/home")},D.uniqueCourses=function(t){var r=[],n=[];return _.each(t,function(e){var t=e.id;n.indexOf(t)===-1&&(n.push(t),r.push(e))}),D.calculatePages(r),D.currentCourseSet=angular.copy(r),r.length>e.home.limit&&(r=r.splice(0,e.home.pageSize)),r},D.courseGroupSubset=function(e){var t=[];return"undefined"!==e&&null!==e&&_.each(e.nodes,function(e){var r=D.coursesSubset(e);_.each(r,function(e){t.push(e)})}),t},D.allCustomCourses=function(e){var t,r=[];return _.each(e,function(e){e.hasOwnProperty("courses")&&(t=D.coursesSubset(e),_.each(t,function(e){r.push(e)})),e.hasOwnProperty("nodes")&&(t=D.courseGroupSubset(e),_.each(t,function(e){r.push(e)}))}),r},D.coursesSubset=function(e){var t=e.courses;if("undefined"!=typeof t&&null!==typeof t){var r=_.pluck(t,"id"),n=D.allCoursesData,o=[];return _.each(n,function(e){_.each(r,function(t){e.id===t&&o.push(e)})}),o}},e.launchIModify=function(e){var t=c.getImodifyUrl(e);t.then(function(e){var t=e,r=i.open("about:blank","_blank");r.location=t},function(e){})},e.resetIModifyCourseContent=function(t){e.manageCourse.course.iModifyLoading=!0;var r=c.resetIModifyCourseContent(t);r.then(function(t){e.manageCourse.course.iModifyLoading=!1,e.IModifyMessage="IModify content was successfully reset",e.IModifySuccessThrow=!0},function(t){e.manageCourse.course.iModifyLoading=!1,e.IModifyMessage=t.ErrorMessage,e.IModifyErrorThrow=!0})},e.CreateNewIModifyCourse=function(t){e.manageCourse.course.iModifyLoading=!0;var r=c.CreateIModifyCourse(t);r.then(function(t){e.manageCourse.course.iModifyLoading=!1;var r=t.id;e.IModifyRedirect(r)},function(t){e.manageCourse.course.iModifyLoading=!1,e.IModifyMessage=t.ErrorMessage,e.IModifyErrorThrow=!0})},e.IModifyRedirect=function(e){return t.url("courses/edit/"+e)},e.launchIdesign=function(){var e=h.getIdesignUrl();e.then(function(e){var t=e,r=i.open("about:blank","_blank");r.location=t},function(e){})},D.baiCatalogCta(),D.customCatalogCta(),e.treeOptions={nodeChildren:"nodes",templateUrl:"tree.html",injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},D.calculatePages=function(t){e.home.page=1,e.home.total=t.length,e.home.pageSize=e.home.page*e.home.limit},s(function(){var e=$("#pagination");e.find("a").addClass("portalBackground")},3e3),e.initStep5=function(){D.setIltSessionMinMaxDates(),S&&S.wizard("Course")&&(S.wizard("Course").next(),e.manageCourse.cancelMessage=D.setCourseCancelMessage(5));var t=(new Date).toString();e.localTimezoneString=t.substring(t.indexOf("(")+1,t.indexOf(")")),jQuery(".taModal").modal("hide")},e.step5OfferingSelectChanged=function(){D.setIltSessionMinMaxDates()},D.setIltSessionMinMaxDates=function(){var t=e.manageCourse.stepFive.sessionCreator.offering;if(t){var r=_.find(e.manageCourse.course.offerings,function(t){return parseInt(t.localId,10)===parseInt(e.manageCourse.stepFive.sessionCreator.offering,10)}),n=r.registrationEndDateTime;n&&n.jsDate?(e.ilt.minSessionDate=n.jsDate,e.manageCourse.stepFive.sessionCreator.startDate<n.jsDate&&(e.manageCourse.stepFive.sessionCreator.startDate=null),e.manageCourse.stepFive.sessionCreator.endDate<n.jsDate&&(e.manageCourse.stepFive.sessionCreator.endDate=null),e.manageCourse.course.displayEnd?(e.manageCourse.course.displayEnd.jsDate?e.ilt.maxSessionDate=e.manageCourse.course.displayEnd.jsDate:e.ilt.maxSessionDate=null,e.manageCourse.stepFive.sessionCreator.startDate>e.manageCourse.course.displayEnd.jsDate&&(e.manageCourse.stepFive.sessionCreator.startDate=null),e.manageCourse.stepFive.sessionCreator.endDate>e.manageCourse.course.displayEnd.jsDate&&(e.manageCourse.stepFive.sessionCreator.endDate=null)):e.ilt.maxSessionDate=null):(e.ilt.minSessionDate=e.manageCourse.course.displayStart.jsDate,e.manageCourse.stepFive.sessionCreator.startDate<e.manageCourse.course.displayStart.jsDate&&(e.manageCourse.stepFive.sessionCreator.startDate=null),e.manageCourse.stepFive.sessionCreator.endDate<e.manageCourse.course.displayStart.jsDate&&(e.manageCourse.stepFive.sessionCreator.endDate=null),e.manageCourse.course.displayEnd?(e.manageCourse.course.displayEnd.jsDate?e.ilt.maxSessionDate=e.manageCourse.course.displayEnd.jsDate:e.ilt.maxSessionDate=null,e.manageCourse.stepFive.sessionCreator.startDate>e.manageCourse.course.displayEnd.jsDate&&(e.manageCourse.stepFive.sessionCreator.startDate=null),e.manageCourse.stepFive.sessionCreator.endDate>e.manageCourse.course.displayEnd.jsDate&&(e.manageCourse.stepFive.sessionCreator.endDate=null)):e.ilt.maxSessionDate=null)}else e.ilt.minSessionDate=e.manageCourse.course.displayStart.jsDate,e.manageCourse.stepFive.sessionCreator.startDate<e.manageCourse.course.displayStart.jsDate&&(e.manageCourse.stepFive.sessionCreator.startDate=null),e.manageCourse.stepFive.sessionCreator.endDate<e.manageCourse.course.displayStart.jsDate&&(e.manageCourse.stepFive.sessionCreator.endDate=null),e.manageCourse.course.displayEnd?(e.manageCourse.course.displayEnd.jsDate?e.ilt.maxSessionDate=e.manageCourse.course.displayEnd.jsDate:e.ilt.maxSessionDate=null,e.manageCourse.stepFive.sessionCreator.startDate>e.manageCourse.course.displayEnd.jsDate&&(e.manageCourse.stepFive.sessionCreator.startDate=null),e.manageCourse.stepFive.sessionCreator.endDate>e.manageCourse.course.displayEnd.jsDate&&(e.manageCourse.stepFive.sessionCreator.endDate=null)):e.ilt.maxSessionDate=null},e.effectiveStartDateChanged=function(t){var r=v.setStartTime(e.manageCourse.course.displayStart.jsDate);switch(e.manageCourse.course.type){case"ilt":var n=!1,o=!1;if(e.manageCourse.course.offerings)for(var a=0;a<e.manageCourse.course.offerings.length;a++){var s=e.manageCourse.course.offerings[a];if(s.requestedOn&&s.requestedOn.jsDate&&r>s.requestedOn.jsDate){void 0!==t?e.manageCourse.course.displayStart=v.formatDate(v.setStartTime(t)):e.manageCourse.course.displayStart=void 0,o=!0,e.manageCourse.stepTwo.error.setError(500,"Effective start date could not be changed because it is greater than an offering enrollment opens date");break}if(s.registrationEndDateTime&&s.registrationEndDateTime.jsDate&&r>s.registrationEndDateTime.jsDate){void 0!==t?e.manageCourse.course.displayStart=v.formatDate(v.setStartTime(t)):e.manageCourse.course.displayStart=void 0,o=!0,e.manageCourse.stepTwo.error.setError(500,"Effective start date could not be changed because it is greater than an offering enrollment closes date");break}if(s.sessions)for(var i=0;i<s.sessions.length;i++){var u=s.sessions[i];if(r>u.startDateTime.jsDate){void 0!==t?e.manageCourse.course.displayStart=v.formatDate(v.setStartTime(t)):e.manageCourse.course.displayStart=void 0,n=!0,e.manageCourse.stepTwo.error.setError(500,"Effective start date could not be changed because it is greater than date of earliest session");break}}}n===!1&&o===!1&&(null===r||void 0===r?e.manageCourse.course.displayStart=r:e.manageCourse.course.displayStart=v.formatDate(r));break;default:null===r||void 0===r?e.manageCourse.course.displayStart=r:e.manageCourse.course.displayStart=v.formatDate(r)}},e.effectiveEndDateChanged=function(t){var r=v.setEndTime(e.manageCourse.course.displayEnd.jsDate);switch(e.manageCourse.course.type){case"ilt":var n=!1,o=!1;if(null!==r&&e.manageCourse.course.offerings)for(var a=0;a<e.manageCourse.course.offerings.length;a++){var s=e.manageCourse.course.offerings[a];if(s.requestedOn&&s.requestedOn.jsDate&&r<=s.requestedOn.jsDate){void 0!==t?e.manageCourse.course.displayEnd=v.formatDate(v.setEndTime(t)):e.manageCourse.course.displayEnd=void 0,o=!0,e.manageCourse.stepTwo.error.setError(500,"Effective end date could not be changed because it is less than an offering enrollment opens date");break}if(s.registrationEndDateTime&&s.registrationEndDateTime.jsDate&&r<=s.registrationEndDateTime.jsDate){void 0!==t?e.manageCourse.course.displayEnd=v.formatDate(v.setEndTime(t)):e.manageCourse.course.displayEnd=void 0,o=!0,e.manageCourse.stepTwo.error.setError(500,"Effective end date could not be changed because it is not greater than last offering enrollment closes date");break}if(s.sessions){for(var i=0;i<s.sessions.length;i++){var u=s.sessions[i];if(r<=u.endDateTime.jsDate){void 0!==t?e.manageCourse.course.displayEnd=v.formatDate(v.setEndTime(t)):e.manageCourse.course.displayEnd=void 0,n=!0,e.manageCourse.stepTwo.error.setError(500,"Effective end date could not be changed because it is not greater than date of last session");break}}if(n===!0||o===!0)break}}n===!1&&o===!1&&(null===r||void 0===r?e.manageCourse.course.displayEnd=r:e.manageCourse.course.displayEnd=v.formatDate(r));break;default:null===r||void 0===r?e.manageCourse.course.displayEnd=r:e.manageCourse.course.displayEnd=v.formatDate(r)}},e.initStep4=function(){D.setEnrollmentDateBoundries(),jQuery(".taModal").modal("hide")},e.initStep6=function(){jQuery(".taModal").modal("hide")},D.setNewOfferingDefaults=function(e){e.name="OFR"+Math.floor(1e9*Math.random()).toString(),e.minimumEnrollment=0,e.maxAllowedSize=39,e.cancelDays=0,e.waitlistDays=0},D.setOfferingAccordionHeading=function(e){if(e.accordionHeading="",e.name&&(e.accordionHeading+=e.name+" | "),e.location&&(e.accordionHeading+=e.location+" | "),e.sessions&&e.sessions.length>0){var t=null;t=_.sortBy(e.sessions,"startDateTime")[0].startDateTime,null!==t&&(e.accordionHeading+=t.fullDate+" | ")}e.status&&(e.accordionHeading+=e.status+" | "),e.roster&&e.roster.attendingStudents?e.accordionHeading+=e.roster.attendingStudents.length+" / ":e.accordingHeading+="0 / ",e.maxAllowedSize&&(e.accordionHeading+=e.maxAllowedSize)},D.setEnrollmentDateBoundries=function(){_.each(e.manageCourse.course.offerings,function(e){D.setOfferingEnrollmentOpensDateBoundries(e),D.setOfferingEnrollmentEndDateBoundries(e)})},e.enrollmentClosesChanged=function(e){D.setOfferingEnrollmentOpensDateBoundries(e),e.registrationEndDateTime.jsDate&&(e.registrationEndDateTime.jsDate.setHours(0,0,0,0),e.registrationEndDateTime=v.formatDate(e.registrationEndDateTime.jsDate))},e.enrollmentOpensChanged=function(e){D.setOfferingEnrollmentEndDateBoundries(e),e.requestedOn.jsDate&&(e.requestedOn.jsDate.setHours(0,0,0,0),e.requestedOn=v.formatDate(e.requestedOn.jsDate))},D.setOfferingEnrollmentOpensDateBoundries=function(t){var r,n=null;if(t.registrationEndDateTime)if(t.registrationEndDateTime.jsDate)t.maxRequestedOnDate=t.registrationEndDateTime.jsDate;else if(t.sessions){for(n=null,r=0;r<t.sessions.length;r++)null===n&&(n=t.sessions[r].startDateTime.jsDate),n>t.sessions[r].startDateTime.jsDate&&(n=t.sessions[r].startDateTime.jsDate);null===n?e.manageCourse.course.displayEnd&&e.manageCourse.course.displayEnd.jsDate?t.maxRequestedOnDate=e.manageCourse.course.displayEnd.jsDate:t.maxRequestedOnDate=null:t.maxRequestedOnDate=n}else e.manageCourse.course.displayEnd&&e.manageCourse.course.displayEnd.jsDate?t.maxRequestedOnDate=e.manageCourse.course.displayEnd.jsDate:t.maxRequestedOnDate=null;else if(t.sessions){for(n=null,r=0;r<t.sessions.length;r++)null===n&&(n=t.sessions[r].startDateTime.jsDate),n>t.sessions[r].startDateTime.jsDate&&(n=t.sessions[r].startDateTime.jsDate);null===n?e.manageCourse.course.displayEnd&&e.manageCourse.course.displayEnd.jsDate?t.maxRequestedOnDate=e.manageCourse.course.displayEnd.jsDate:t.maxRequestedOnDate=null:t.maxRequestedOnDate=n}else e.manageCourse.course.displayEnd&&e.manageCourse.course.displayEnd.jsDate?t.maxRequestedOnDate=e.manageCourse.course.displayEnd.jsDate:t.maxRequestedOnDate=null},D.setOfferingEnrollmentEndDateBoundries=function(t){if(t.requestedOn&&t.requestedOn.jsDate?t.minRegistrationEndDateTime=t.requestedOn.jsDate:t.minRegistrationEndDateTime=e.manageCourse.course.displayStart.jsDate,t.sessions){for(var r=null,n=0;n<t.sessions.length;n++)null===r&&(r=t.sessions[n].startDateTime.jsDate),r>t.sessions[n].startDateTime.jsDate&&(r=t.sessions[n].startDateTime.jsDate);null===r?e.manageCourse.course.displayEnd&&e.manageCourse.course.displayEnd.jsDate?t.maxRegistrationEndDateTime=e.manageCourse.course.displayEnd.jsDate:t.maxRegistrationEndDateTime=null:t.maxRegistrationEndDateTime=r}else e.manageCourse.course.displayEnd&&e.manageCourse.course.displayEnd.jsDate?t.maxRegistrationEndDateTime=e.manageCourse.course.displayEnd.jsDate:t.maxRegistrationEndDateTime=null},e.offeringNameChanged=function(e){"undefined"!=typeof e.sessions&&null!==e.sessions&&_.each(e.sessions,function(t){t.offeringName=e.name}),D.setOfferingAccordionHeading(e)},e.maxAllowedSizeChanged=function(e){D.setOfferingAccordionHeading(e)},D.getOfferingwithNoSession=function(){var t=e.manageCourse.course.offerings,r={};return _.each(t,function(e){if(!(e.sessions&&e.sessions.length>0))return void(r=e)}),r},D.updatePassingScorelaunchUrl=function(t){var r=(e.manageCourse.course,angular.copy(e.manageCourse.course)),n=c.updateCourse(r);n.then(function(e){window.open(t,"_blank")},function(e){void 0})},e.openInstructorDeskModal=function(t){var r=u.open({templateUrl:"app/templates/courses/create/modals/manageIltRoster.html",controller:"Offerings_AdminController",windowClass:"rosterModal",backdrop:"static",resolve:{offeringId:function(){return t.id}}});r.result.then(function(r){e.manageCourse.editOfferingsIsLoading=!0,e.manageCourse.showOfferingsLoading=!0;var n=c.getSingleCourseOfferings(t.courseId);n.then(function(t){e.manageCourse.course.offerings=t,D.setOfferingInstructors(),D.setSessions(t),_.each(e.manageCourse.course.offerings,function(e){D.setOfferingAccordionHeading(e)}),e.manageCourse.editOfferingsIsLoading=!1,e.manageCourse.showOfferingsLoading=!1,e.manageCourse.isLoading=!1},function(t){e.manageCourse.editOfferingsIsLoading=!1,e.manageCourse.showOfferingsLoading=!1,e.manageCourse.isLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.manageCourse.error.setError(r,n)})},function(e){})},e.isSubDomainAdmin=h.isSubDomainAdmin(),e.taDomains=h.taDomains(),e.activeDomain=h.activeDomain(),e.switchDomains={},e.switchDomains.error=y.create(),e.onActiveDomainChanged=function(t,r){var n=h.switchProfile(t.id);n.then(function(e){location.reload()},function(t){e.switchDomains.error.setError(t.StatusCode,t.ErrorMessage),jQuery("#switchDomainsError").show(),setTimeout(function(){e.switchDomains.error.reset(),jQuery("#switchDomainsError").hide()},2e3)})}}}]),app.factory("Management_AdminOverride",["$httpParamSerializer","$injector","$location","$q","$route","$timeout","$filter","CountriesService","DocumentService","JobsService","LocationsService","OrganizationsService","TimezoneService","UsersService","RoleMapsMixin","OrgFunctions","dateUtil","errorDisplayerUtil","successDisplayerUtil","SettingsService","StatesService","TreeHelpers",function(e,t,r,n,o,a,s,i,u,l,c,d,p,m,f,g,h,v,y,C,S,w){return function(t){t.SettingsService=C;var f=this;t.defaultHeader=!0,t.activeTab="tab-active-class",t.management={},t.management.managementSearch="",t.propertyName="name",t.reverse=!1,t.home={},t.home.limit=50,t.home.maxVisiblePages=10,f.scopedViewListData=[],t.homeAction=function(){t.home.page=1,t.home.total=0,t.homeTemplate="app/templates/management/home/admin.html"},t.OrgTreeTitle="Organizations",t.orgTableError={},t.orgTableError.error=v.create(),t.OrgOptions={},t.OrgData=[{name:"Organizations",nodes:[]}],t.OrgData[0].nodes.push({nodes:[],name:"Active",lockIcon:!0}),t.OrgData[0].nodes.push({nodes:[],name:"Inactive",lockIcon:!0}),t.orgCutoff=100,f.originalOrgList=[],t.vieworganizationsAction=function(){if(t.home.page=1,t.homeTemplate="app/templates/management/vieworganizations/admin.html",t.management.managementSearch="",t.orgTableError.error.reset(),t.orgTableIsLoading=!0,
f.isOrgsListPage=!0,t.OrgOptions.initiallyOpened=!0,t.OrgOptions.showLocks=!1,t.orgSelected=t.OrgData[0],"undefined"!=typeof o.current.params.orgFilter){var e="active"===o.current.params.orgFilter.toLowerCase()?0:1;t.orgSelected=t.OrgData[0].nodes[e],t.orgExpanded=[t.OrgData[0]]}var r=d.getOrganizationHierarchy();r.then(function(e){if(f.originalOrgList=e,o.current.params.orgFilter){t.OrgOptions.initiallyOpened=!0;var r=o.current.params.orgFilter;t.OrgNodeClick({name:r})}else f.scopedViewListData=e,t.rows=e.slice(0,t.home.limit),f.calculatePages(e),t.orgTableIsLoading=!1},function(e){t.orgTableIsLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.orgTableError.error.setError(r,n)})},t.home.nextPage=function(){var e=t.management.managementSearch;e?f.SearchData():(f.setStartandEndIndex(),t.rows=f.scopedViewListData.slice(t.startIndex,t.endIndex))},t.general={},t.general.peopleSearch=null,t.general.filterBySearch=function(){t.home.page=1,f.SearchData()},f.SearchData=function(){var e=t.management.managementSearch,r=[];f.isOrgsListPage?r=s("filter")(f.scopedViewListData,function(t){return angular.lowercase(t.name).indexOf(angular.lowercase(e)||"")!==-1||!t.isTopLevelOrg&&angular.lowercase(t.parentOrgName).indexOf(angular.lowercase(e)||"")!==-1}):f.isJobsListPage&&(r=s("filter")(f.scopedViewListData,function(t){return angular.lowercase(t.name).indexOf(angular.lowercase(e)||"")!==-1||angular.lowercase(t.code).indexOf(angular.lowercase(e)||"")!==-1})),f.calculatePages(r),f.setStartandEndIndex(),t.rows=r.slice(t.startIndex,t.endIndex)},t.organization={},t.updateOrg={},t.updateOrg.orgform={},t.updateOrg.error=v.create(),t.updateOrg.isLoading=!1,t.updateOrg.organizationCta=function(){t.updateOrg.isLoading=!0;var e=t.organization,n=o.current.params;e.updateDateTime=moment().format();var a;n.name.includes("create")?a="POST":n.name.includes("edit")&&(a="PUT");var s=d.updateOrganization(e,a);s.then(function(e){t.updateOrg.isLoading=!1,r.url("management/vieworganizations/")},function(e){t.updateOrg.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.updateOrg.error.setError(r,n)})},t.viewOrgForm={},t.viewOrgForm.error=v.create(),t.viewOrgForm.isLoading=!1,t.createorgAction=function(){t.homeTemplate="app/templates/management/createorg/admin.html",t.createHeader=!0,t.viewOrgForm.isLoading=!0;var e=d.createOrgObj(!0),r=d.getOrganizationHierarchy(),o=n.all([e,r]);o.then(function(e){t.viewOrgForm.isLoading=!1,t.organization=e[0],t.orgList=f.formatOrgDataForTypeahead(e[1]),t.organization.enabled=!0},function(e){t.viewOrgForm.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.viewOrgForm.error.setError(r,n)})},t.editorganizationAction=function(){t.homeTemplate="app/templates/management/editorganization/admin.html",t.createHeader=!1,t.viewOrgForm.isLoading=!0;var e=o.current.params.param.split("/"),r=parseInt(e[0]),a=d.getSingleOrg(r),s=d.getOrganizationHierarchy(),i=n.all([a,s]);i.then(function(e){t.viewOrgForm.isLoading=!1,t.organization=e[0],t.orgList=f.formatOrgDataForTypeahead(e[1])},function(e){t.viewOrgForm.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.viewOrgForm.error.setError(r,n)})},t.selectParentOrganization=function(e,r,n,o,a){t.organization.parentId=e.id},f.formatOrgDataForTypeahead=function(e){var r=[];t.orgCutoff=100;for(var n=_.filter(e,function(e){return e.enabled===!0}),o=0;o<n.length;o++){var a=n[o];r.push({name:a.name,id:a.id})}return r},t.OrgNodeClick=function(n){if(t.home.page=1,t.management.managementSearch="",!f.isOrgsListPage){var o={};"Active"===n.name&&(o.orgFilter="Active"),"Inactive"===n.name&&(o.orgFilter="Inactive");var a="management/vieworganizations/";return o=e(o),void r.path(a).search(o)}"Active"===n.name?f.scopedViewListData=_.filter(f.originalOrgList,{enabled:!0}):"Inactive"===n.name&&(f.scopedViewListData=_.filter(f.originalOrgList,{enabled:!1})),t.rows=f.scopedViewListData.slice(0,t.home.limit),f.calculatePages(f.scopedViewListData),t.orgTableIsLoading=!1},t.jobsList={},t.jobsList.error=v.create(),t.jobsList.isLoading=!1,t.jobsList.options={},t.jobsList.options.showLocks=!1,t.jobsList.title="Positions",t.jobsList.inputData=[{name:"Positions",nodes:[]}],t.jobsList.inputData[0].nodes.push({nodes:[],name:"Active"}),t.jobsList.inputData[0].nodes.push({nodes:[],name:"Inactive"}),t.jobsList.jobs=[],f.originalJobs=[],f.isJobsListPage=!1,t.viewjobsAction=function(){if(t.home.page=1,t.jobsList.error.reset(),t.homeTemplate="app/templates/management/viewjobs/admin.html",t.jobSelected=t.jobsList.inputData[0],"undefined"!=typeof o.current.params.jobFilter){var e="active"===o.current.params.jobFilter.toLowerCase()?0:1;t.jobSelected=t.jobsList.inputData[0].nodes[e],t.jobExpanded=[t.jobsList.inputData[0]]}f.isJobsListPage=!0,t.jobsList.isLoading=!0,t.jobsList.error.reset();var r=l.getAllJobs();t.jobsList.options.initiallyOpened=!0,r.then(function(e){if(t.jobsList.isLoading=!1,f.originalJobs=e,o.current.params.jobFilter){t.jobsList.options.initiallyOpened=!0;var r=o.current.params.jobFilter;t.selectJobFilter({name:r})}else f.scopedViewListData=e,t.rows=e.slice(0,t.home.limit)},function(e){t.jobsList.isLoading=!1,t.jobsList.error.setError(e.ErrorCode,e.ErrorMessage)})},t.editJob={},t.editJob.baiForm={},t.editJob.error=v.create(),t.editJob.isLoading=!1,t.editJob.closePopover=function(){t.editJob.popoverOpen=!1},t.editjobAction=function(){t.homeTemplate="app/templates/management/editjob/admin.html";var e=o.current.params.param.split("/"),r=parseInt(e[0]);t.editJob.error.reset();var n=l.getAllJobs();t.editJob.isLoading=!0,n.then(function(e){var n=_.filter(e,function(e){return e.id===r});n.length>0?(n[0].lastUpdate=moment(n[0].lastUpdate),t.job=n[0]):t.editJob.error.setError("404","Position not found"),t.editJob.jobNames=_.map(e,function(e){return t.job&&e.id===t.job.id?null:e.name}),t.editJob.isLoading=!1},function(e){t.editJob.error.setError(e.ErrorCode,e.ErrorMessage),t.editJob.isLoading=!1})},t.editJob.updateJob=function(e){t.editJob.isLoading=!0,t.editJob.closePopover();var r=angular.copy(t.job);r.nodes&&delete r.nodes,r.lastUpdate&&delete r.lastUpdate,e&&(r.isActive=!r.isActive),l.updateJob(r).then(function(e){window.location="management/viewjobs/"},function(e){t.editJob.isLoading=!1,t.editJob.error.setError(e.ErrorCode,e.ErrorMessage)})},t.selectJobFilter=function(n){if(t.home.page=1,t.management.managementSearch="",!f.isJobsListPage){var o={};"Active"===n.name&&(o.jobFilter="Active"),"Inactive"===n.name&&(o.jobFilter="Inactive");var a="management/viewjobs/";return o=e(o),void r.path(a).search(o)}"Inactive"===n.name?f.scopedViewListData=_.filter(f.originalJobs,{isActive:!1}):f.scopedViewListData=_.filter(f.originalJobs,{isActive:!0}),t.rows=f.scopedViewListData.slice(0,t.home.limit),f.calculatePages(f.scopedViewListData)},t.createJob={},t.createJob.baiform={},t.createJob.inputJobName=!1,t.createJob.error=v.create(),t.createjobAction=function(){t.homeTemplate="app/templates/management/createJob/admin.html",t.createJob.inputJobName=!0,t.createJob.defaultJobHeader=!0,f.isJobsListPage=!0;var e=l.getAllJobs();e.then(function(e){t.editJob={},t.editJob.jobNames=_.map(e,function(e){return e.name})},function(e){}),t.job={}},t.containerOptions={},t.containerOptions.showLock=!1,t.createJob.success=y.create(),t.createJob.createJob=function(e){e.code=sqlguid(),l.createJob(e).then(function(e){t.createJob.success.set("The Position has been saved."),setTimeout(function(){return t.viewjobsAction(),r.url("management/viewjobs/")},2e3)},function(e){t.createJob.isLoading=!1,t.createJob.error.setError(e.ErrorCode,e.ErrorMessage)})},t.manageLocation={},t.manageLocation.error=v.create(),t.manageLocation.countriesLoading=!1,t.manageLocation.popoverOpen=!1,t.manageLocation.closePopover=function(){t.manageLocation.popoverOpen=!1},t.createLocation={},t.createLocation.error=v.create(),t.manageLocation.baiform={},t.editLocation={},t.editLocation.error=v.create(),t.createlocationAction=function(){t.homeTemplate="app/templates/management/createlocation/admin.html";var e=p.getAllTimezones();e.then(function(e){t.timezones=e},function(e){}),t.manageLocation.error.reset(),a(t.resetCreateLocationForm,1),t.location=c.getMock(),t.types=c.types;var r=i.getLatitudeCountryList(m.getPortalId());r.then(function(e){t.countries=e,t.manageLocation.countriesLoading=!1},function(e){})},t.resetCreateLocationForm=function(){t.manageLocation.baiform&&"function"==typeof t.manageLocation.baiform.$setPristine&&(t.manageLocation.baiform.$setPristine(),t.manageLocation.baiform.$setUntouched(),t.location={})},t.sendCreateLocationCall=function(){if(void 0,t.location.startDate){var e=h.formatDate(t.location.startDate.jsDate);t.location.startDate=e.jsDate}var n=c.create(t.location);n.then(function(e){return t.resetCreateLocationForm(),r.url("management/viewlocations/")},function(r){t.location.startDate=e,t.createLocation.error.setError(r.ErrorCode,r.ErrorMessage)})},t.editlocationAction=function(){t.homeTemplate="app/templates/management/editlocation/admin.html";var e=o.current.params.param.split("/"),r=e[0];t.manageLocation.error.reset(),t.types=c.types;var n=p.getAllTimezones();n.then(function(e){t.timezones=e},function(e){});var a=i.getLatitudeCountryList(m.getPortalId());a.then(function(e){t.countries=e,t.manageLocation.countriesLoading=!1},function(e){});var s=c.getSingle(r);s.then(function(e){t.location=e;var r=t.location.physicalAddress;"undefined"!=typeof r&&null!==r&&null!==r.countryId&&parseInt(r.countryId,10)>0&&t.getStates()},function(e){t.manageLocation.error.setError(e.ErrorCode,e.ErrorMessage)})},t.getStates=function(){var e=t.location.physicalAddress.countryId,r=S.getLatitudeStateList(e);r.then(function(e){t.states=e},function(e){t.states=[]})},t.sendEditLocationCall=function(e){t.editLocation.error.reset();var n=h.formatDate(t.location.startDate.jsDate);t.location.startDate=n.utcDate,"undefined"!=typeof e&&e===!0?t.location.endDate=moment().utc():t.location.endDate=null;var o=c.edit(t.location);o.then(function(e){return r.url("management/viewlocations/")},function(e){t.location.startDate=n,t.editLocation.error.setError(e.ErrorCode,e.ErrorMessage)})},t.locationsList={},t.locationsList.showLocks=!1,t.locationsList.title="Locations",t.locationsList.treeData=[{name:"Locations",nodes:[]}],t.locationsList.treeData[0].nodes.push({nodes:[],name:"Active",value:!0}),t.locationsList.treeData[0].nodes.push({nodes:[],name:"Inactive",value:!1}),t.locationsList.error=v.create(),t.locationsList.isLoading=!1,t.locationsList.options={},t.locationsList.options.showLocks=!1,f.isLocationsListPage=!1,t.viewlocationsAction=function(){if(t.locationsList.error.reset(),f.isLocationsListPage=!0,t.locationsList.options.initiallyOpened=!0,t.homeTemplate="app/templates/management/viewlocations/admin.html",t.locationSelected=t.locationsList.treeData[0],"undefined"!=typeof o.current.params.locationFilter){var e="active"===o.current.params.locationFilter.toLowerCase()?0:1;t.locationSelected=t.locationsList.treeData[0].nodes[e],t.locationExpanded=[t.locationsList.treeData[0]]}t.locationsList.isLoading=!0,t.locationsList.error.reset();var r=c.getAll();r.then(function(e){if(t.locationsList.isLoading=!1,t.locationsList.data=e,f.locationsListData=e,o.current.params.locationFilter){t.locationsList.options.initiallyOpened=!0;var r=o.current.params.locationFilter;t.locationsList.filterLocations({name:r})}},function(e){t.locationsList.isLoading=!1,t.locationsList.error.setError(e.ErrorCode,e.ErrorMessage)})},t.locationsList.filterLocations=function(n){if(!f.isLocationsListPage){var o={};"Active"===n.name&&(o.locationFilter="Active"),"Inactive"===n.name&&(o.locationFilter="Inactive");var a="management/viewlocations/";o=e(o),r.path(a).search(o)}"Locations"===n.name&&(t.locationsList.data=f.locationsListData),"Inactive"===n.name&&(t.locationsList.data=_.filter(f.locationsListData,function(e){return e.isActive===!1})),"Active"===n.name&&(t.locationsList.data=_.filter(f.locationsListData,function(e){return e.isActive===!0}))},t.DocTreeTitle="Documents",t.docTableError={},t.docTableError.error=v.create(),t.DocOptions={},t.DocOptions.showLocks=!1,t.DocOptions.canDrillDown=!1,t.DocData=[{name:"Documents",nodes:[]}],t.docTableIsLoading=!1,t.viewdocumentsAction=function(){t.homeTemplate="app/templates/management/viewdocuments/admin.html",t.docTableError.error.reset(),t.docTableIsLoading=!0,f.isDocsListPage=!0,t.DocOptions.initiallyOpened=!0,t.docSelected=t.DocData[0];var e=u.getDocumentRepositoryList();e.then(function(e){t.docTableIsLoading=!1,t.rows=e,f.docsListData=e},function(e){t.docTableIsLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.docTableError.error.setError(r,n)})},t.DocNodeClick=function(e){"Documents"===e.name&&r.path("management/viewdocuments")},t.updateDocument={},t.updateDocument.documents=[],t.updateDocument.error=v.create(),t.updateDocument.success=y.create(),t.updateDocument.isLoading=!1,t.createdocumentAction=function(){t.homeTemplate="app/templates/management/createdocument/admin.html",t.createHeader=!0},t.sendDocumentCreateCall=function(){var e=t.updateDocument.documents,r=[];if(t.updateDocument.error.reset(),t.updateDocument.success.reset(),t.updateDocument.isLoading=!0,"undefined"!=typeof e&&e.length>0){for(var o=0;o<e.length;o+=1)"file"!==e[o].fileOrUrl||e[o].fromRepo?"url"===e[o].fileOrUrl&&r.push(u.uploadUrlToRepository(e[o].name)):r.push(u.uploadDocumentToRepository(e[o].fileObject));n.all(r).then(function(e){t.updateDocument.isLoading=!1,t.updateDocument.documents=[],t.updateDocument.success.set("The document was successfully uploaded!")},function(e){t.updateDocument.isLoading=!1,t.updateDocument.error.setError(e.ErrorCode,e.ErrorMessage)})}},t.clickDocumentSave=function(){var e=t.updateDocument.documents;"undefined"!=typeof e&&e.length>0?t.confirmSaveDocument=!0:t.sendDocumentEditCall()},t.toggleSaveDocumentTooltip=function(){t.confirmSaveDocument=!1},t.sendDocumentEditCall=function(){t.confirmSaveDocument=!0;var e=t.document;t.updateDocument.error.reset(),t.updateDocument.success.reset(),t.updateDocument.isLoading=!0;var o=t.updateDocument.documents,a=e.id,s=[];if("undefined"!=typeof o&&o.length>0){var i=o[0];"file"!==i.fileOrUrl||i.fromRepo?"url"===i.fileOrUrl&&s.push(u.replaceAsset(i.name,a,"url")):s.push(u.replaceAsset(i.fileObject,a,"file"))}if(t.document.originalName!==t.document.name){var l=u.updateSingleAsset(e);s.push(l)}n.all(s).then(function(e){t.updateDocument.isLoading=!1,r.path("management/viewdocuments")},function(e){t.updateDocument.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.updateDocument.error.setError(r,n)})},t.editdocumentAction=function(){t.homeTemplate="app/templates/management/editdocument/admin.html",t.createHeader=!1,t.updateDocument.error.reset(),t.updateDocument.success.reset(),t.documentFormIsLoading=!0;var e=o.current.params.param.split("/"),r=parseInt(e[0]),n=u.getSingleDocumentInfo(r);n.then(function(e){t.document=e,t.document.originalName=t.document.name,t.updateDocument.documents=e,t.documentFormIsLoading=!1},function(e){t.documentFormIsLoading=!1})},t.SettingsTreeTitle="Settings",t.settingsError={},t.settingsError.error=v.create(),t.settingsSuccess={},t.settingsSuccess.success=y.create(),t.SettingsOptions={},t.SettingsOptions.showLocks=!1,t.SettingsOptions.canDrillDown=!1,t.SettingsData=[{name:"Settings",nodes:[]}],t.settingsIsLoading=!1,t.editsettingsAction=function(){t.homeTemplate="app/templates/management/editsettings/admin.html",t.settingsError.error.reset(),t.settingsIsLoading=!0;var e=C.getSettings(!1);e.then(function(e){t.settingsIsLoading=!1,t.rows=e,t.settings=e},function(e){t.settingsIsLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.settingsError.error.setError(r,n)})},t.SettingsNodeClick=function(e){"Settings"===e.name&&r.path("management/editsettings")},t.sendSettingsEditCall=function(){var e=t.settings,r=[];r.push(C.updateSettings("EnrollmentLimitCount",e.features.enrollmentLimitCount)),r.push(C.updateSettings("EnrollmentLimitDays",e.features.enrollmentLimitDays)),n.all(r).then(function(e){t.settingsSuccess.success.message="Portal settings were successfully saved.",t.settingsSuccess.success.thrown=!0},function(e){var r=e.StatusCode,n=e.ErrorMessage;t.settingsError.error.setError(r,n)})},t.sortBy=function(e){t.reverse=t.propertyName===e&&!t.reverse,t.propertyName=e;var r=t.management.managementSearch;f.setStartandEndIndex();var n=[];if(r){var o=[];f.isOrgsListPage?o=s("filter")(f.scopedViewListData,function(e){return angular.lowercase(e.name).indexOf(angular.lowercase(r)||"")!==-1||angular.lowercase(e.parentOrgName).indexOf(angular.lowercase(r)||"")!==-1}):f.isJobsListPage&&(o=s("filter")(f.scopedViewListData,function(e){return angular.lowercase(e.name).indexOf(angular.lowercase(r)||"")!==-1||angular.lowercase(e.code).indexOf(angular.lowercase(r)||"")!==-1})),n=s("orderBy")(o,t.propertyName,t.reverse)}else n=s("orderBy")(f.scopedViewListData,t.propertyName,t.reverse);f.scopedViewListData=n,t.rows=n.slice(t.startIndex,t.endIndex)},f.calculatePages=function(e){t.home.total=e.length},t.treeOptions={nodeChildren:"nodes",templateUrl:"tree.html",injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},f.formatToSkinnyOrgData=function(e){for(var t=[],r=0;r<e.length;r++)t.push(_.pick(e[r],"id","name","enabled","parentOrgName","isTopLevelOrg"));return t},f.setStartandEndIndex=function(){t.startIndex=t.home.page*t.home.limit-t.home.limit,t.endIndex=t.startIndex+t.home.limit},t.isSubDomainAdmin=m.isSubDomainAdmin(),t.taDomains=m.taDomains(),t.activeDomain=m.activeDomain(),t.switchDomains={},t.switchDomains.error=v.create(),t.onActiveDomainChanged=function(e,r){var n=m.switchProfile(e.id);n.then(function(e){location.reload()},function(e){t.switchDomains.error.setError(e.StatusCode,e.ErrorMessage),jQuery("#switchDomainsError").show(),setTimeout(function(){t.switchDomains.error.reset(),jQuery("#switchDomainsError").hide()},2e3)})}}}]),app.factory("Messages_AdminOverride",["$http","$injector","$rootScope","$route","AssignmentsService","BreadcrumbsService","MessagesService","TasksService","TeamService","UsersService","errorDisplayerUtil",function(e,t,r,n,o,a,s,i,u,l,c){return function(e){var t=this;e.defaultHeader=!1,e.messaging.tasks={},e.messaging.tasks.isLoading=!1,e.messaging.tasks.error=c.create(),e.messaging.assignments={},e.messaging.assignments.isLoading=!1,e.messaging.assignments.error=c.create(),e.requestsAction=function(){e.homeTemplate="app/templates/messages/requests/admin.html",e.messaging.assignments.isLoading=!0,e.messaging.assignments.error.reset(),e.messaging.tasks.isLoading=!0,e.messaging.tasks.error.reset(),t.getAssignmentsToApprove(),t.getTasksToApprove(),a.pushCrumb("home"),a.pushCrumb("messages","messages/inbox/"),a.pushCrumb("requests","messages/requests/")},e.enrollmentsAction=function(){e.homeTemplate="app/templates/messages/enrollments/admin.html",e.messaging.assignments.error.reset(),e.messaging.assignments.isLoading=!0,t.getAssignmentsToApprove(),a.pushCrumb("home"),a.pushCrumb("messages","messages/inbox/"),a.pushCrumb("requests","messages/requests/"),a.pushCrumb("approvals","messages/approvals/")},e.tasksAction=function(){e.homeTemplate="app/templates/messages/tasks/admin.html",e.messaging.error.reset(),e.messaging.isLoading=!0,t.getTasksToApprove(),a.pushCrumb("home"),a.pushCrumb("messages","messages/inbox/"),a.pushCrumb("requests","messages/requests/"),a.pushCrumb("tasks","messages/tasks/")},e.approveOrDenyRequestCall=function(t,n){t.error.reset(),t.isLoading=!0;var a=o.approveDenyEnrollment(t.studentId,t.offeringId,t.transcriptId,t.assignmentType,n);a.then(function(n){t.isLoading=!1;var o=e.assignments.indexOf(t);e.assignments.splice(o,1),0===e.assignments.length&&e.messaging.error.assignments.setError(404,"There no requests at this time!"),r.$broadcast("requestApprovals:action:success")},function(e){t.isLoading=!1,t.error.setError(e.ErrorCode,e.ErrorMessage)})},e.approveOrDenyTaskCall=function(t,n){var o=i.taskApproval(t.userId,t.id,n);o.then(function(){t.isLoading=!1;var n=e.tasks.indexOf(t);e.tasks.splice(n,1),0===e.tasks.length&&e.messaging.tasks.error.setError(404,"There no requests at this time!"),r.$broadcast("requestApprovals:action:success")},function(e){t.isLoading=!1,t.error.setError(e.ErrorCode,e.ErrorMessage)})},t.getAssignmentsToApprove=function(){e.assignments=[];var t=u.getListOfAssignmentsToApprove();return t.then(function(t){e.messaging.assignments.isLoading=!1,e.assignments=t},function(t){e.messaging.assignments.isLoading=!1,e.messaging.assignments.error.setError(t.ErrorCode,t.ErrorMessage)})},t.getTasksToApprove=function(){e.tasks=[],e.messaging.tasks.isLoading=!0,l.hasRole("ta")&&!l.isAdmin()&&l.setUserContext("ta");var t=i.getTasksApprovalTA();t.then(function(t){e.messaging.tasks.isLoading=!1,e.tasks=t},function(t){e.messaging.tasks.isLoading=!1,e.messaging.tasks.error.setError(t.ErrorCode,t.ErrorMessage)})}}}]),app.controller("Offerings_AdminController",["$scope","$uibModalInstance","offeringId","$mdDialog","$uibModal","dateUtil","errorDisplayerUtil","OfferingsService","RosterService","UsersService",function(e,t,r,n,o,a,s,i,u,l){var c=this;e.offeringId=r;var d="ilt";c.totalCompleteCalls=0,c.groupSaveTotal=0,c.totalSavedFromGroupCall=0,e.allHours=0,e.isLoading=!1,e.offeringDate=new Date,e.userSearchOptions={},e.userSearchOptions.error=s.create(),e.userSearchOptions.searched=!1,e.userSearchOptions.selected=0,e.rosterStatus="default",e.selectedSession=1,e.sessions=null,e.sessionOrder="lowestSessionDateForOffering.startDate",e.statuses=e.completionStatuses,e.options={},e.options.isLoading=!1,e.options.error=s.create(),e.rosterViewOptions={},e.rosterViewOptions.isLoading=!1,e.rosterViewOptions.error=s.create(),e.waitlistViewOptions={},e.waitlistViewOptions.isLoading=!1,e.waitlistViewOptions.error=s.create(),e.pendingOptions={},e.pendingOptions.isLoading=!1,e.pendingOptions.error=s.create(),e.dialogOptions={},e.dialogOptions.isLoading=!1,e.dialogOptions.error=s.create(),e.hasDecimal=!1,e.rosterStatus="Change Status",e.completionStatuses=["Change Status","Successful","Unsuccessful","No Show"],e.userCompletionStatuses=[{name:"Change Status",value:"default"},{name:"Successful",value:"successful"},{name:"Unsuccessful",value:"unsuccessful"},{name:"No Show",value:"cancelledNoShow"}],e.substitutor={},e.substitutor.error=s.create(),c.updateStudentInBatch=function(e,t,n,o,a,s,i){e.call=u.updateSinglePersonOnRoster(e.id,r,t,d,n),e.call.then(function(t){o(t,e),c.totalCompleteCalls++,c.totalSavedFromGroupCall++,c.groupSaveCounter(s,i,e)},function(t){a(t,e),c.totalCompleteCalls++,c.groupSaveCounter(s,i,e)})},c.groupSaveCounter=function(e,t,r){c.totalSavedFromGroupCall===c.groupSaveTotal?e(r):c.totalCompleteCalls===c.groupSaveTotal&&c.totalSavedFromGroupCall!==c.groupSaveTotal&&t(r)},e.viewAction=function(){e.options.isLoading=!0,e.options.error.reset();var t=i.fetchSingle(r,d);t.then(function(t){e.userEmailList=u.generateMailToFromUsers("attendingStudents").join(";"),e.options.isLoading=!1,e.offering=t,e.offeringComplete=!0;var r=t.status;"open"===r&&(e.offeringComplete=!1),e.offeringDate=new Date(e.offering.lowestSessionDateForOffering.original),e.selectedSession=i.getLowestSessionIdByDate(),e.sessions=e.offering.sessions,e.isCancellable=i.isOfferingCancellable()},function(t){e.options.isLoading=!1,e.options.error.setError(t.StatusCode,t.ErrorMessage)}),jQuery(".instructor-extra-nav").hide()},e.rosterAction=function(){e.rosterViewOptions.error.reset(),e.rosterViewOptions.isLoading=!0;var t=u.fetch(r,d);t.then(function(t){e.rosterViewOptions.isLoading=!1,e.roster=u.getAttendingStudents(),e.selectedSession=i.getLowestSessionIdByDate(),e.sessions=e.offering.sessions,e.sessionsForDropdown=[];for(var r=0,n=0;n<e.sessions;n++)r=parseInt(n,10)+1,e.sessionsForDropdown.push({name:"Session "+r+" - "+e.sessions[n].startDateTime.fullDateWithTime,value:e.sessions[n].id})},function(t){e.rosterViewOptions.isLoading=!1,e.rosterViewOptions.error.setError(t.StatusCode,t.ErrorMessage)}),jQuery(".instructor-extra-nav").show()},e.waitlistAction=function(){e.waitlistroster=null,e.options.error.reset(),e.waitlistViewOptions.error.reset(),e.waitlistViewOptions.isLoading=!0;var t=u.fetch(r,d);t.then(function(t){e.waitlistroster=u.getWaitlistedStudents(),null!==e.waitlistroster&&0!==e.waitlistroster.length||e.waitlistViewOptions.error.setError(404,"The wait list for this course is currently empty.",!0),e.waitlistViewOptions.isLoading=!1},function(t){e.waitlistViewOptions.isLoading=!1,e.waitlistViewOptions.error.setError(t.StatusCode,t.ErrorMessage)}),jQuery(".instructor-extra-nav").show()},e.pendingApprovalAction=function(){e.pendingOptions.error.reset(),e.pendingOptions.isLoading=!0;var t=u.fetch(r,d);t.then(function(t){e.pendingOptions.isLoading=!1,e.roster=u.getPendingApprovalStudents(),0===e.roster.length&&e.pendingOptions.error.setError(404,"There are no students pending approval for this course.",!0)},function(t){e.pendingOptions.error.setError(t.StatusCode,t.ErrorMessage)}),jQuery(".instructor-extra-nav").show()},e.showCancelOfferingModal=function(t,r){e.offering=r,e.dialogOptions.error.reset(),n.show({controller:"offeringsController",focusOnOpen:!0,targetEvent:t,preserveScope:!0,scope:e,templateUrl:"app/templates/offerings/components/dialogs/cancellationDialog.html",clickOutsideToClose:!0,parent:angular.element(".rosterModal")}).then(function(e){},function(){})},e.cancelOffering=function(t){if(t===!0){e.dialogOptions.error.reset(),e.dialogOptions.isLoading=!0;var r=i.cancelOffering(e.offering.id,e.offering.type);r.then(function(t){e.dialogOptions.isLoading=!1,c.closeModal()},function(t){e.dialogOptions.isLoading=!1,e.dialogOptions.error.setError(t.StatusCode,t.ErrorMessage)})}else n.hide()},e.showCompleteOfferingModal=function(t,r){e.offering=r,e.dialogOptions.error.reset();var o=i.getIncompleteUserCount();switch(o=0){case-1:e.offeringDeliveryErrorMessage="Sorry! There are no students who have been signed up for this offering!",e.showOfferingDeliveryErrorMessage=!0,setTimeout(function(){e.offeringDeliveryErrorMessage="",e.showOfferingDeliveryErrorMessage=!1},5e3);break;case 0:n.show({clickOutsideToClose:!0,focusOnOpen:!0,parent:angular.element(".rosterModal"),preserveScope:!0,scope:e,templateUrl:"app/templates/offerings/components/dialogs/completionDialog.html"}).then(function(e){},function(){});break;default:e.offeringDeliveryErrorMessage="Sorry! There are still students who have not completed the offering!",e.showOfferingDeliveryErrorMessage=!0,setTimeout(function(){e.offeringDeliveryErrorMessage="",e.showOfferingDeliveryErrorMessage=!1},5e3)}},e.showDropUserModal=function(t,r){e.droppedPerson=r,n.show({clickOutsideToClose:!0,focusOnOpen:!0,parent:angular.element(".rosterModal"),targetEvent:t,preserveScope:!0,scope:e,templateUrl:"app/templates/offerings/components/dialogs/dropPersonDialog.html"}).then(function(e){},function(){})},e.dropStudent=function(t){n.hide(),t===!0&&(e.droppedPerson.droppingStudent=!0,e.droppedPerson.error.reset(),e.droppedPerson.call=u.updateSinglePersonOnRoster(e.droppedPerson.student.id,r,"cancelled",d),e.droppedPerson.call.then(function(t){e.rosterAction(),n.hide()},function(t){e.droppedPerson.droppingStudent=!1,e.droppedPerson.error.setError(t.StatusCode,t.ErrorMessage),setTimeout(function(){droppedPerson.error.reset()},2e3)}))},e.completeOffering=function(t){if(t===!0){e.completingOffering=!0,e.dialogOptions.isLoading=!0;var r=i.completeOffering(e.offering.id,e.offering.type);r.then(function(t){e.dialogOptions.isLoading=!1,n.hide(),e.viewAction()},function(t){e.dialogOptions.isLoading=!1,e.dialogOptions.error.setError(t.StatusCode,t.ErrorMessage)})}else n.hide()},e.changeAllStatuses=function(){var t=e.roster,r=this.rosterStatus,n=!1,o=e.userCompletionStatuses.filter(function(e){if(e.name===r)return e})[0];if("undefined"!=typeof o&&"undefined"!=typeof o.value)for(var a in t){for(var s in e.userCompletionStatuses)if(e.userCompletionStatuses[s].value===t[a].student.registrationStatus){n=!0;break}n!==!0?t[a].statusForDropdown=o.value:n=!1}},e.setAllGrades=function(){var t=this.allGrades;if((null!==t||"undefined"!==t)&&t>=0&&t<=100)for(var r in e.roster)e.roster[r].student.score=t,e.gradeRangeError=!1;else e.gradeRangeError=!0},e.setHoursSpent=function(){var t=this.allHours;for(var r in e.roster)for(var n in e.roster[r].sessions)sessions=e.roster[r].sessions,sessions[n].id===e.selectedSession&&(sessions[n].hoursSpent=t)},e.savePersonForFullOffering=function(t){t.isLoading=!0,t.error.reset();var n=u.updateSinglePersonOnRoster(t.student.id,r,t.statusForDropdown,d,{completionDate:e.offering.highestSessionDateForOffering.moment.utc().format(),score:parseInt(t.student.score,10)});n.then(function(e){t.isLoading=!1,t.hasCompletedTheOffering=!0},function(e){t.isLoading=!1,t.error.setError(e.StatusCode,e.ErrorMessage),setTimeout(function(){t.error.reset()},2e3)})},e.changeSession=function(){e.selectedSession=this.selectedSession},e.savePersonPerSession=function(t){t.isLoading=!0,t.error.reset();var n=u.getCorrectSessionFromUser(t.student.id,e.selectedSession);t.call=u.updateSessionByUserOnOffering(t.student.id,r,{sessionId:e.selectedSession,hoursSpent:parseFloat(n.hoursSpent,10)}),t.call.then(function(e){t.isLoading=!1},function(e){t.isLoading=!1,t.error.setError(e.StatusCode,e.ErrorMessage),setTimeout(function(){t.error.reset()},2e3)})},e.saveAllUsersForCurrentSession=function(){var t=e.roster;for(var r in t)e.savePersonPerSession(t[r])},e.saveAllForFullOffering=function(){var t=e.roster;c.groupSaveTotal=t.length,c.totalSavedFromGroupCall=0,e.fullOfferingUpdateIsLoading=!0;for(var r in t)"default"!==t[r].statusForDropdown&&(t[r].isLoading=!0,t[r].id=t[r].student.id,c.updateStudentInBatch(t[r],t[r].statusForDropdown,{completionDate:e.offering.highestSessionDateForOffering.moment.format("MM/DD/YYYY"),score:parseInt(t[r].student.score,10)},function(e,t){t.isLoading=!1,t.success=!0,t.hasCompletedTheOffering=!0},function(e,t){t.isLoading=!1,t.error.setError(e.StatusCode,e.ErrorMessage)},function(e){},function(){}))},e.openAdditionModal=function(){e.userSearchOptions.isLoading=!1,e.userSearchOptions.searched=!1,e.userSearchOptions.selected=0,e.users=null,jQuery("#userAdditionModal").modal()},e.openSubstituteModal=function(t){e.userSearchOptions.isLoading=!1,e.userSearchOptions.searched=!1,e.userSearchOptions.selected=0,e.users=null,e.substitutee=t,o.open({templateUrl:"app/templates/offerings/components/modals/userSubstitutionModal.html",scope:e,windowClass:"offeringModal",backdrop:"static",controller:"ModalInstanceCtrl"})},e.searchForUsers=function(){var t=this.userSearchOptions.value;e.userSearchOptions.error.reset(),e.userSearchOptions.addStudentLoader=!1,e.userSearchOptions.isLoading=!0,e.userSearchOptions.searched=!0;var r=l.search(t);r.then(function(t){e.userSearchOptions.isLoading=!1,e.users=t},function(t){e.users=[],e.isLoading=!1,e.userSearchOptions.isLoading=!1,e.userSearchOptions.error.setError(t.StatusCode,t.ErrorMessage)})},e.setCountOfSelectedUsers=function(t){var r=jQuery(t.currentTarget).is(":checked");r===!0?e.userSearchOptions.selected+=1:e.userSearchOptions.selected-=1},e.addStudents=function(){e.userSearchOptions.addStudentLoader=!0,c.groupSaveTotal=jQuery(".checkbox:checked").length,c.totalSavedFromGroupCall=0;var t=function(t,r){r.showEx=!0,e.userSearchOptions.addStudentLoader=!1,r.error.reset(),r.error.setError(t.StatusCode,t.ErrorMessage)},r=function(e,t){t.showCheck=!0,t.showEx=!1},n=function(){e.userSearchOptions.addStudentLoader=!1,jQuery("#userAdditionModal").modal("hide"),e.rosterAction(),e.waitlistAction()},o=function(){e.userSearchOptions.addStudentLoader=!1};for(var a in e.users)"undefined"!=typeof e.users[a].checked&&e.users[a].checked===!0&&c.updateStudentInBatch(e.users[a],"confirmed",null,r,t,n,o)},e.closeModal=function(){t.close()},e.substituteStudent=function(){var t=null;e.substitutee.error.reset(),e.userSearchOptions.addStudentLoader=!0;for(var n in e.users)if(parseInt(e.users[n].checked,10)>0){
t=e.users[n].id;break}var o=u.substituteUser(e.substitutee.student.id,t,r,d);o.then(function(t){e.userSearchOptions.addStudentLoader=!1,jQuery("#userSubstitutionModal").modal("hide"),e.rosterAction()},function(t){e.userSearchOptions.addStudentLoader=!1,e.substitutee.error.setError(t.StatusCode,t.ErrorMessage),setTimeout(function(){substitutee.error.reset()},2e3)})},e.dump=function(e){void 0},e.showWaitlistRemoveConfirmationModal=function(t,r){e.person=r;e.person.fullName;n.show({controller:["$scope","person","reallyRemoveFromWaitList",function(e,t,r){e.person=t,e.reallyRemoveFromWaitList=r}],focusOnOpen:!1,targetEvent:t,templateUrl:"app/templates/offerings/components/dialogs/removeWaitlistDialog.html",clickOutsideToClose:!0,parent:angular.element(".rosterModal"),locals:{person:e.person,reallyRemoveFromWaitList:e.reallyRemoveFromWaitList}})},e.reallyRemoveFromWaitList=function(t){if(t===!0){e.removingWaitListStudent=!0;var r=i.removeStudentFromWaitList(e.person,e.offeringId);r.then(function(t){e.waitlistAction(),e.removingWaitListStudent=!1,n.hide()})}else n.hide()},e.getCorrectLabelForStatusDropdown=function(t){return e.userCompletionStatuses.filter(function(e){if(e.value===t)return e})[0].name},e.highlightDates=function(t){var r=null;t=moment(t);var n=t.date(),o=t.month(),a=t.year();if("undefined"!=typeof e.sessions&&null!==e.sessions&&e.sessions.length>0)for(var s=0;s<e.sessions.length;s++)if(r=e.sessions[s],n===r.startDateTime.day&&o===r.startDateTime.monthNumber-1&&a===r.startDateTime.year)return!0;return!1}}]),app.controller("ModalInstanceCtrl",["$scope","$uibModalInstance",function(e,t){e.close=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}]),app.factory("Offerings_InstructorOverride",["$location","$mdDialog","$route","dateUtil","errorDisplayerUtil","BreadcrumbsService","OfferingsService","RosterService","UsersService",function(e,t,r,n,o,a,s,i,u){return function(n){var l=this,c=n.offeringId="undefined"!=typeof r.current.params.param?r.current.params.param.split("/")[0]:null,d=e.search().type;l.totalCompleteCalls=0,l.groupSaveTotal=0,l.totalSavedFromGroupCall=0,a.pushCrumb("instructor desk","users/home"),n.allHours=0,n.options={},n.options.isLoading=!1,n.options.error=o.create(),n.rosterViewOptions={},n.rosterViewOptions.isLoading=!1,n.rosterViewOptions.error=o.create(),n.waitlistViewOptions={},n.waitlistViewOptions.isLoading=!1,n.waitlistViewOptions.error=o.create(),n.pendingOptions={},n.pendingOptions.isLoading=!1,n.pendingOptions.error=o.create(),n.dialogOptions={},n.dialogOptions.isLoading=!1,n.dialogOptions.error=o.create(),n.hasDecimal=!1,n.rosterStatus="Change Status",n.completionStatuses=["Change Status","Successful","Unsuccessful","No Show"],n.userCompletionStatuses=[{name:"Change Status",value:"default"},{name:"Successful",value:"successful"},{name:"Unsuccessful",value:"unsuccessful"},{name:"No Show",value:"cancelledNoShow"}],n.substitutor={},n.substitutor.error=o.create(),l.updateStudentInBatch=function(e,t,r,n,o,a,s){e.call=i.updateSinglePersonOnRoster(e.id,c,t,d,r),e.call.then(function(t){n(t,e),l.totalCompleteCalls++,l.totalSavedFromGroupCall++,l.groupSaveCounter(a,s,e)},function(t){o(t,e),l.totalCompleteCalls++,l.groupSaveCounter(a,s,e)})},l.groupSaveCounter=function(e,t,r){l.totalSavedFromGroupCall===l.groupSaveTotal?e(r):l.totalCompleteCalls===l.groupSaveTotal&&l.totalSavedFromGroupCall!==l.groupSaveTotal&&t(r)},n.viewAction=function(){n.options.isLoading=!0,n.options.error.reset(),a.reset();var e=s.fetchSingle(c,d);e.then(function(e){n.userEmailList=i.generateMailToFromUsers("attendingStudents").join(";"),n.options.isLoading=!1,n.offering=e,n.offeringComplete=!0;var t=e.status;"open"===t&&(n.offeringComplete=!1),n.offeringDate=new Date(n.offering.lowestSessionDateForOffering.original),n.selectedSession=s.getLowestSessionIdByDate(),n.sessions=n.offering.sessions,n.isCancellable=s.isOfferingCancellable(),a.pushCrumb("instructor desk","users/home"),a.pushCrumb(n.offering.name)},function(e){n.options.isLoading=!1,n.options.error.setError(e.StatusCode,e.ErrorMessage)}),jQuery(".instructor-extra-nav").hide()},n.rosterAction=function(){n.rosterViewOptions.error.reset(),n.rosterViewOptions.isLoading=!0;var t=e.search().type,r=i.fetch(c,t);r.then(function(e){n.rosterViewOptions.isLoading=!1,n.roster=i.getAttendingStudents(),n.selectedSession=s.getLowestSessionIdByDate(),n.sessions=n.offering.sessions,n.sessionsForDropdown=[];for(var t=0,r=0;r<n.sessions;r++)t=parseInt(r,10)+1,n.sessionsForDropdown.push({name:"Session "+t+" - "+n.sessions[r].startDateTime.fullDateWithTime,value:n.sessions[r].id})},function(e){n.rosterViewOptions.isLoading=!1,n.rosterViewOptions.error.setError(e.StatusCode,e.ErrorMessage)}),jQuery(".instructor-extra-nav").show()},n.waitlistAction=function(){n.waitlistroster=null,n.options.error.reset(),n.waitlistViewOptions.error.reset(),n.waitlistViewOptions.isLoading=!0;var e=i.fetch(c,d);e.then(function(e){n.waitlistroster=i.getWaitlistedStudents(),null!==n.waitlistroster&&0!==n.waitlistroster.length||n.waitlistViewOptions.error.setError(404,"The wait list for this course is currently empty.",!0),n.waitlistViewOptions.isLoading=!1},function(e){n.waitlistViewOptions.isLoading=!1,n.waitlistViewOptions.error.setError(e.StatusCode,e.ErrorMessage)}),jQuery(".instructor-extra-nav").show()},n.pendingApprovalAction=function(){n.pendingOptions.error.reset(),n.pendingOptions.isLoading=!0;var e=i.fetch(c,d);e.then(function(e){n.pendingOptions.isLoading=!1,n.roster=i.getPendingApprovalStudents(),0===n.roster.length&&n.pendingOptions.error.setError(404,"There are no students pending approval for this course.",!0)},function(e){n.pendingOptions.error.setError(e.StatusCode,e.ErrorMessage)}),jQuery(".instructor-extra-nav").show()},n.showCancelOfferingModal=function(e,r){n.offering=r,t.show({controller:"offeringsController",focusOnOpen:!1,targetEvent:e,templateUrl:"app/templates/offerings/components/dialogs/cancellationDialog.html",clickOutsideToClose:!0,parent:angular.element(document.body)}).then(function(e){},function(){})},n.cancelOffering=function(r){if(r===!0){n.dialogOptions.error.reset(),n.dialogOptions.isLoading=!0;var o=s.cancelOffering(n.offering.id,n.offering.type);o.then(function(t){n.dialogOptions.isLoading=!1,e.url("users/home/")},function(e){n.dialogOptions.isLoading=!1,n.dialogOptions.error.setError(e.StatusCode,e.ErrorMessage)})}else t.hide()},n.showCompleteOfferingModal=function(e,r){n.offering=r,n.dialogOptions.error.reset();var o=s.getIncompleteUserCount();switch(o=0){case-1:n.offeringDeliveryErrorMessage="Sorry! There are no students who have been signed up for this offering!",n.showOfferingDeliveryErrorMessage=!0,setTimeout(function(){n.offeringDeliveryErrorMessage="",n.showOfferingDeliveryErrorMessage=!1},5e3);break;case 0:t.show({clickOutsideToClose:!0,focusOnOpen:!0,parent:angular.element(document.body),preserveScope:!0,scope:n,templateUrl:"app/templates/offerings/components/dialogs/completionDialog.html"}).then(function(e){},function(){});break;default:n.offeringDeliveryErrorMessage="Sorry! There are still students who have not completed the offering!",n.showOfferingDeliveryErrorMessage=!0,setTimeout(function(){n.offeringDeliveryErrorMessage="",n.showOfferingDeliveryErrorMessage=!1},5e3)}},n.showDropUserModal=function(e,r){n.droppedPerson=r,t.show({clickOutsideToClose:!0,focusOnOpen:!0,targetEvent:e,preserveScope:!0,scope:n,templateUrl:"app/templates/offerings/components/dialogs/dropPersonDialog.html"}).then(function(e){},function(){})},n.dropStudent=function(e){t.hide(),e===!0&&(n.droppedPerson.droppingStudent=!0,n.droppedPerson.error.reset(),n.droppedPerson.call=i.updateSinglePersonOnRoster(n.droppedPerson.student.id,c,"cancelled",d),n.droppedPerson.call.then(function(e){n.rosterAction(),t.hide()},function(e){n.droppedPerson.droppingStudent=!1,n.droppedPerson.error.setError(e.StatusCode,e.ErrorMessage),setTimeout(function(){droppedPerson.error.reset()},2e3)}))},n.completeOffering=function(e){if(e===!0){n.completingOffering=!0,n.dialogOptions.isLoading=!0;var r=s.completeOffering(n.offering.id,n.offering.type);r.then(function(e){n.dialogOptions.isLoading=!1,t.hide(),n.viewAction()},function(e){n.dialogOptions.isLoading=!1,n.dialogOptions.error.setError(e.StatusCode,e.ErrorMessage)})}else t.hide()},n.changeAllStatuses=function(){var e=n.roster,t=this.rosterStatus,r=!1,o=n.userCompletionStatuses.filter(function(e){if(e.name===t)return e})[0];if("undefined"!=typeof o&&"undefined"!=typeof o.value)for(var a in e){for(var s in n.userCompletionStatuses)if(n.userCompletionStatuses[s].value===e[a].student.registrationStatus){r=!0;break}r!==!0?e[a].statusForDropdown=o.value:r=!1}},n.setAllGrades=function(){var e=this.allGrades;if((null!==e||"undefined"!==e)&&e>=0&&e<=100)for(var t in n.roster)n.roster[t].student.score=e,n.gradeRangeError=!1;else n.gradeRangeError=!0},n.setHoursSpent=function(){var e=this.allHours;for(var t in n.roster)for(var r in n.roster[t].sessions)sessions=n.roster[t].sessions,sessions[r].id===n.selectedSession&&(sessions[r].hoursSpent=e)},n.savePersonForFullOffering=function(e){e.isLoading=!0,e.error.reset();var t=i.updateSinglePersonOnRoster(e.student.id,c,e.statusForDropdown,d,{completionDate:n.offering.highestSessionDateForOffering.moment.utc().format(),score:parseInt(e.student.score,10)});t.then(function(t){e.isLoading=!1,e.hasCompletedTheOffering=!0},function(t){e.isLoading=!1,e.error.setError(t.StatusCode,t.ErrorMessage),setTimeout(function(){e.error.reset()},2e3)})},n.changeSession=function(){n.selectedSession=this.selectedSession},n.savePersonPerSession=function(e){e.isLoading=!0,e.error.reset();var t=i.getCorrectSessionFromUser(e.student.id,n.selectedSession);e.call=i.updateSessionByUserOnOffering(e.student.id,c,{sessionId:n.selectedSession,hoursSpent:parseFloat(t.hoursSpent,10)}),e.call.then(function(t){e.isLoading=!1},function(t){e.isLoading=!1,e.error.setError(t.StatusCode,t.ErrorMessage),setTimeout(function(){e.error.reset()},2e3)})},n.saveAllUsersForCurrentSession=function(){var e=n.roster;for(var t in e)n.savePersonPerSession(e[t])},n.saveAllForFullOffering=function(){var e=n.roster;l.groupSaveTotal=e.length,l.totalSavedFromGroupCall=0,n.fullOfferingUpdateIsLoading=!0;for(var t in e)"default"!==e[t].statusForDropdown&&(e[t].isLoading=!0,e[t].id=e[t].student.id,l.updateStudentInBatch(e[t],e[t].statusForDropdown,{completionDate:n.offering.highestSessionDateForOffering.moment.format("MM/DD/YYYY"),score:parseInt(e[t].student.score,10)},function(e,t){t.isLoading=!1,t.success=!0,t.hasCompletedTheOffering=!0},function(e,t){t.isLoading=!1,t.error.setError(e.StatusCode,e.ErrorMessage)},function(e){},function(){}))},n.openAdditionModal=function(){n.userSearchOptions.isLoading=!1,n.userSearchOptions.searched=!1,n.userSearchOptions.selected=0,n.users=null,jQuery("#userAdditionModal").modal()},n.openSubstituteModal=function(e){n.userSearchOptions.isLoading=!1,n.userSearchOptions.searched=!1,n.userSearchOptions.selected=0,n.users=null,n.substitutee=e,jQuery("#userSubstitutionModal").modal()},n.searchForUsers=function(){var e=this.userSearchOptions.value;n.userSearchOptions.error.reset(),n.userSearchOptions.addStudentLoader=!1,n.userSearchOptions.isLoading=!0,n.userSearchOptions.searched=!0;var t=u.search(e);t.then(function(e){n.userSearchOptions.isLoading=!1,n.users=e},function(e){n.users=[],n.isLoading=!1,n.userSearchOptions.isLoading=!1,n.userSearchOptions.error.setError(e.StatusCode,e.ErrorMessage)})},n.setCountOfSelectedUsers=function(e){var t=jQuery(e.currentTarget).is(":checked");t===!0?n.userSearchOptions.selected+=1:n.userSearchOptions.selected-=1},n.addStudents=function(){n.userSearchOptions.addStudentLoader=!0,l.groupSaveTotal=jQuery(".checkbox:checked").length,l.totalSavedFromGroupCall=0;var e=function(e,t){t.showEx=!0,n.userSearchOptions.addStudentLoader=!1,t.error.reset(),t.error.setError(e.StatusCode,e.ErrorMessage)},t=function(e,t){t.showCheck=!0,t.showEx=!1},r=function(){n.userSearchOptions.addStudentLoader=!1,jQuery("#userAdditionModal").modal("hide"),n.rosterAction(),n.waitlistAction()},o=function(){n.userSearchOptions.addStudentLoader=!1};for(var a in n.users)"undefined"!=typeof n.users[a].checked&&n.users[a].checked===!0&&l.updateStudentInBatch(n.users[a],"confirmed",null,t,e,r,o)},n.refresh=function(){n.rosterAction()},n.substituteStudent=function(){var e=null;n.substitutee.error.reset(),n.userSearchOptions.addStudentLoader=!0;for(var t in n.users)if(parseInt(n.users[t].checked,10)>0){e=n.users[t].id;break}var r=i.substituteUser(n.substitutee.student.id,e,c,d);r.then(function(e){n.userSearchOptions.addStudentLoader=!1,jQuery("#userSubstitutionModal").modal("hide"),n.rosterAction()},function(e){n.userSearchOptions.addStudentLoader=!1,n.substitutee.error.setError(e.StatusCode,e.ErrorMessage),setTimeout(function(){substitutee.error.reset()},2e3)})},n.dump=function(e){void 0},n.showWaitlistRemoveConfirmationModal=function(e,r){n.person=r;n.person.fullName;t.show({controller:["$scope","person","reallyRemoveFromWaitList",function(e,t,r){e.person=t,e.reallyRemoveFromWaitList=r}],focusOnOpen:!1,targetEvent:e,templateUrl:"app/templates/offerings/components/dialogs/removeWaitlistDialog.html",clickOutsideToClose:!0,locals:{person:n.person,reallyRemoveFromWaitList:n.reallyRemoveFromWaitList}})},n.reallyRemoveFromWaitList=function(e){if(e===!0){n.removingWaitListStudent=!0;var r=s.removeStudentFromWaitList(n.person,n.offeringId);r.then(function(e){n.waitlistAction(),n.removingWaitListStudent=!1,t.hide()})}else t.hide()},n.getCorrectLabelForStatusDropdown=function(e){return n.userCompletionStatuses.filter(function(t){if(t.value===e)return t})[0].name},n.highlightDates=function(e){var t=null;e=moment(e);for(var r=e.date(),o=e.month(),a=e.year(),s=0;s<n.sessions.length;s++)if(t=n.sessions[s],r===t.startDateTime.day&&o===t.startDateTime.monthNumber-1&&a===t.startDateTime.year)return!0;return!1}}}]),app.factory("Rules_AdminOverride",["BreadcrumbsService","UsersService","RulesService","GroupsService","CoursesService","dateUtil","PeopleGroupFunctions","$q","$http","$timeout","$filter","filterFilter","$route","$location","$routeParams","WizardHandler","RoleMapsMixin","$injector","errorDisplayerUtil",function(e,t,r,n,o,a,s,i,u,l,c,d,p,m,f,g,h,v,y){return function(e){var u=this;e.defaultHeader=!0,e.activeTab="tab-active-class",e.general={},e.general.rulesSearch={},"undefined"!=typeof p.current&&null!==typeof p.current&&(u.params=p.current.params),e.activeRuleData=[{name:"Active",nodes:[]}],e.activeRuleOptions={},e.activeRuleOptions.initiallyOpened=!1,e.activeRuleOptions.rootNodeIsTopLevel=!1,e.activeRuleOptions.canDrillDown=!1,e.ruleFilter="",e.activeRuleTreeIsLoading=!0,e.activeRuleNowHidden=!0,e.activeRuleTitle="Active",e.activeRuleError={},e.activeRuleError.error=y.create(),e.homeAction=function(){e.homeTemplate="app/templates/rules/home/admin.html",e.ruleSelected=e.activeRuleData[0],u.listAllRules()},e.createAction=function(){e.isCreate=!0,e.homeTemplate="app/templates/rules/create/admin.html",e.wizardTitle="Add New Rule",e.goToPrevious=!1,u.createRule()},e.rulesTableError={},e.rulesTableError.error=y.create(),e.rulesRowsAreLoading=!0,u.listAllRules=function(){e.rulesTableError.error.reset();var t=r.getAllRules();t.then(function(t){e.rulesRowsAreLoading=!1,u.allRulesData=t,e.rows=u.filterRows("active")},function(t){e.rulesRowsAreLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.rulesTableError.error.setError(r,n)})},u.createRule=function(){var t=r.createRuleObj(!0);t.then(function(t){e.rule=t},function(e){})},e.ruleCreateError={},e.ruleCreateError.error=y.create(),e.ruleCreateIsLoading=!1,u.createFailure=function(t){e.ruleCreateIsLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.ruleCreateError.error.setError(r,n)},e.isDisabled=!1,u.create_peopleAction=function(){e.goToPrevious=!0,e.ruleCreateIsLoading=!0,e.ruleCreateError.error.reset();var t,r=angular.copy(e.rule);t="undefined"!==r.id&&null!==r.id?u.generalInfo_update(r):u.generalInfo(r),t.then(function(t){e.ruleCreateIsLoading=!1,e.isDisabled=!0,e.rule=t,g.wizard("Rule").next();var r=t.groupId;u.ruleIdForCreate=t.id,u.ruleCreateInProgress=t,u.createRule_PeopleGroup(r)},function(e){u.createFailure(e)})},u.generalInfo=function(e){var t="create",n=r.ruleGeneralCall(e,t);return n},u.generalInfo_update=function(e){var t="update",n=r.ruleGeneralCall(e,t);return n},e.createPeopleGroup={},e.createPeopleGroup.isHeaderOpen=!1,e.createPeopleGroup.isDisabled=!1,e.createContainerOptions={},e.createContainerOptions.showLock=!1,u.createRule_PeopleGroup=function(t){e.ruleCreateIsLoading=!0,e.ruleCreateError.error.reset();var r=i.all(s.peopleGroupActions());r.then(function(r){e.groupStructure=r[0],e.selectOptionsData=r[1],e.containerOperandsData=n.containerOperandsRequired(r[2]),e.groupStructure.groupId=t,n.secondaryFormatGroupStructure(r[3],r[4].groups,r[5],r[6]),e.ruleCreateIsLoading=!1,e.showRulePeopleGroup=!0},function(t){e.showRulePeopleGroup=!1,u.createFailure(t)})},u.create_assignmentsAction=function(){e.goToPrevious=!0,e.ruleCreateIsLoading=!0,e.ruleCreateError.error.reset(),e.rows=[];var t=u.updatePeopleGroup();t.then(function(t){e.ruleCreateIsLoading=!1,e.peopleGroupStructure=t,g.wizard("Rule").next(),e.rows=[]},function(e){u.createFailure(e)})},u.create_datesAction=function(){e.goToPrevious=!0,e.ruleCreateIsLoading=!0,e.ruleCreateError.error.reset();var t=u.addAssignments();t.then(function(t){e.ruleCreateIsLoading=!1,g.wizard("Rule").next(),e.rows=u.checkForEndDate(t)},function(e){u.createFailure(e)})},u.addAssignments=function(){var t,n=angular.copy(e.rows),o=u.ruleIdForCreate;return void 0!==n&&"null"!==n&&(t=r.updateRuleAssignments(o,n)),t},u.checkForEndDate=function(e){var t=u.ruleCreateInProgress;if("undefined"!=typeof t.endDate&&null!==t.endDate)var r=t.endDate.moment.subtract(14,"days");return _.each(e,function(e){e.required=!0,e.flagDueDateMethod=0,"undefined"!=typeof t.endDate&&null!==t.endDate?e.dueDateFixed=a.formatDate(r):e.dueDateFixed=null}),e},u.create_previewAction=function(){e.goToPrevious=!0,e.ruleCreateIsLoading=!0,e.ruleCreateError.error.reset();var t=u.addAssignments();t.then(function(t){e.ruleCreateIsLoading=!1,g.wizard("Rule").next(),u.ruleCount()},function(e){u.createFailure(e)})},u.ruleCount=function(){e.ruleCreateIsLoading=!0,e.ruleCreateError.error.reset();var t=u.ruleIdForCreate,n=r.getRuleCounts(t);n.then(function(t){e.ruleCreateIsLoading=!1,e.count=t},function(e){u.createFailure(e)})},u.create_activateAction=function(){e.goToPrevious=!0,e.ruleCreateIsLoading=!0,e.ruleCreateError.error.reset(),e.rule.status="active";var t=u.updateGeneralInfo();t.then(function(t){e.ruleCreateIsLoading=!1,e.rule_Success=!0,l(function(){m.path("/rules/home")},3e3)},function(e){u.createFailure(e)})},e.ruleEditTabs={},e.editAction=function(){e.isCreate=!1,e.homeTemplate="app/templates/rules/edit/admin.html",e.ruleEditTabs.selectedTab=0,u.update_getGeneralAction()},e.editRuleGeneralErrror={},e.editRuleGeneralErrror.error=y.create(),e.editRuleGeneralIsLoading=!0,u.update_getGeneralAction=function(){var t=u.params.param.split("/")[0],n=r.getSingleRule(t),o=r.getRuleStatusOptions(!0),a=i.all([n,o]);a.then(function(t){e.editRuleGeneralIsLoading=!1,e.showEditRuleGeneral=!0,e.rule=t[0],e.statusOptions=t[1],u.ruleCreateInProgress=t[0],u.beforeDaysList=e.rule.beforeDueNotificationDays;var r=t[0];u.validateStartDate(r)},function(t){e.editRuleGeneralIsLoading=!1,e.showEditRuleGeneral=!1;var r=t.StatusCode,n=t.ErrorMessage;e.editRuleGeneralErrror.error.setError(r,n)})},e.uniqueNotificationBefore=function(t){if(e.duplicateBefore=!1,"undefined"!=typeof t&&null!==t){var r=[],n=e.rule.beforeDueNotificationDays;_.each(n,function(e){var n=e-t;0===n&&r.push(n)}),r.length>1&&(e.duplicateBefore=!0)}},e.uniqueNotificationAfter=function(t){if(e.duplicateAfter=!1,"undefined"!=typeof t&&null!==t){var r=[],n=e.rule.afterDueNotificationDays;_.each(n,function(e){var n=e-t;0===n&&r.push(n)}),r.length>1&&(e.duplicateAfter=!0)}},u.validateStartDate=function(t){void 0===t.status||null===t.status||"draft"!==t.status||t.startDate||t.startDate.moment||t.startDate.moment._isValid?e.isEditable=!1:(t.startDate=a.formatDate(moment().format()),e.isEditable=!0),void 0!==t.status&&null!==t.status&&"closed"===t.status?e.closedRule=!0:e.closedRule=!1},e.updateStatus=function(e){u.validateStartDate(e)},e.editPeopleGroup={},e.editPeopleGroup.isHeaderOpen=!0,e.editPeopleGroup.isDisabled=!1,e.containerOptions={},e.containerOptions.showLock=!1,e.editRulePeopleError={},e.editRulePeopleError.error=y.create(),e.editRulePeopleIsLoading=!0,e.update_getPeopleAction=function(t){e.editRulePeopleError.error.reset();var r=i.all(s.peopleGroupActions("ruleTab"));r.then(function(r){e.selectOptionsData=r[1],e.containerOperandsData=n.containerOperandsRequired(r[2]),n.secondaryFormatGroupStructure(r[3],r[4].groups,r[5],r[6]),u.peopleGroupStructure(t),e.editRulePeopleIsLoading=!1,e.showPeopleGroup=!0},function(t){e.editRulePeopleIsLoading=!1,e.showPeopleGroup=!1;var r=t.StatusCode,n=t.ErrorMessage;e.editRulePeopleError.error.setError(r,n)})},e.peopleGroupError={},e.peopleGroupError.error=y.create(),e.peopleGroupIsLoading=!1,e.showPeopleGroup=!0,u.peopleGroupStructure=function(t){e.peopleGroupIsLoading=!0,e.peopleGroupError.error.reset();var r=n.peopleGroupStructure(t);r.then(function(t){e.groupStructure=u.reFormattingPeopleGroupStructure(n.secondaryFormatGroupStructure_groupStructure(t)),e.peopleGroupIsLoading=!1,e.showPeopleGroup=!0},function(t){e.peopleGroupIsLoading=!1,e.showPeopleGroup=!1;var r=t.StatusCode,n=t.ErrorMessage;e.peopleGroupError.error.setError(r,n)})},u.reFormattingPeopleGroupStructure=function(e){return"edit"===u.params.name&&("undefined"!=typeof e.name&&null===e.name&&(e.name=""),"undefined"!=typeof e.containerId&&null!==e.containerId&&"00000000-0000-0000-0000-000000000000"===e.containerId&&null===e.operandName&&0===e.operandId&&(e.containerId=n.generateGuid(),e.operandId=1,e.operandName="AND (1)")),e},e.editRuleAssignmentsErrror={},e.editRuleAssignmentsErrror.error=y.create(),e.editRuleAssignmentsIsLoading=!1,e.update_getAssignmentsAction=function(){e.editRuleAssignmentsErrror.error.reset(),e.editRuleAssignmentsIsLoading=!0;var t=u.params.param.split("/")[0];if("undefined"!=typeof e.rows&&null!==typeof e.rows)return e.editRuleAssignmentsIsLoading=!1,e.showRuleAssignments=!0,e.rows;var n=r.getRuleAssignments(t);n.then(function(t){e.editRuleAssignmentsIsLoading=!1,e.showRuleAssignments=!0,e.rows=t},function(t){e.editRuleAssignmentsIsLoading=!1,e.showRuleAssignments=!1;var r=t.StatusCode,n=t.ErrorMessage;e.editRuleAssignmentsErrror.error.setError(r,n)})},e.validateCourseDates=function(e){0===e.flagDueDateMethod?(e.dueDateDaysFromKey="none",e.dueDateDaysFromValue=null):1===e.flagDueDateMethod&&(e.dueDateFixed=null)},e.modalBodyShow=!1,e.modalBodyToggle=function(){e.modalBodyShow=!e.modalBodyShow},e.selectedCourseCount=0,e.checkForLength=function(t){t===!0?e.selectedCourseCount++:e.selectedCourseCount--},e.courseSearchModal={},e.courseSearchModal.courseSearch="",e.courseSearchModal.selectAll=!1,e.courseSearchModal.coursesAreLoading=!0,e.viewCoursesError={},e.viewCoursesError.error=y.create(),e.getAllCoursesCta=function(t){e.modalBodyShow=!0,e.selectedCourseCount=0,e.viewCoursesError.error.reset(),e.courseSearchModal.coursesAreLoading=!0,e.courseSearchModal.selectAll=!1;var r=o.getActiveCoursesForOrg();r.then(function(r){var n=u.formatCoursesData(r);"undefined"!=typeof t&&null!==t?e.courseData=c("filter")(n,t):e.courseData=n,e.courseSearchModal.coursesAreLoading=!1},function(t){e.courseSearchModal.coursesAreLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.viewCoursesError.error.setError(r,n)})},e.addAllCourses=function(t){_.each(e.courseData,function(e){e.select=t}),t===!0?e.selectedCourseCount=e.courseData.length:e.selectedCourseCount=0},e.removeCourse=function(t){e.rows.splice(e.rows.indexOf(t),1)},e.applyNewAssignmentsCta=function(t){var r=u.getSelectedCourses(t);void 0!==e.rows&&null!==e.rows||(e.rows=[]),e.rows.constructor!==Array&&(e.rows=[]),e.showRuleAssignments=!0,_.each(r,function(t){e.rows.indexOf(t)===-1&&e.rows.push(t)}),e.rows=u.uniqueCourses(e.rows),u.formatCoursesData(t),e.courseSearch=""},u.uniqueCourses=function(e){var t=[],r=[];return _.each(e,function(e){var n=e.course.id;r.indexOf(n)===-1&&(r.push(n),t.push(e))}),t},u.getSelectedCourses=function(e){var t=[];return _.each(e,function(e){e.select===!0&&t.push(e)}),r.formatCourseObj(t)},u.formatCoursesData=function(e){return _.each(e,function(e){e.select=!1}),e},e.addNewAssignmentCta=function(){e.courseSearchModal.courseSearch="",e.selectedCourseCount=0,e.courseSearchModal.selectAll=!1,u.formatCoursesData(e.courseData),angular.element(document.querySelector("#viewAssignmentsModal")).modal("hide"),angular.element(document.querySelector("#addNewAssignmentModal")).modal()},e.update_getDatesAction=function(){"undefined"!=typeof e.rows&&0!==e.rows.length||e.update_getAssignmentsAction()},e.todaysDate=a.formatDate(moment().format()),e.batchEditModal=function(){e.selectedCoursesForEdit=[],e.batchEditForm={},e.batchEditForm.dueDateDaysStatus=!1,e.batchEditForm.dueDateFixedStatus=!1,e.batchEditForm.acceptPassingScoreDateStatus=!1,e.isEditableModal_01=!1,e.isEditableModal_02=!1,e.selectedCoursesForEdit=d(e.rows,{select:"true"}),e.selectedCoursesForEdit.length>0?e.showEditForm=!0:e.showEditForm=!1},e.saveBatchEditChanges=function(){var t=e.batchEditForm,r=e.selectedCoursesForEdit;_.each(r,function(e){"undefined"!=typeof t.required&&null!==t.required&&(e.required=t.required),t.acceptPassingScoreDateStatus===!0&&"undefined"!=typeof t.acceptPassingScoreDate&&null!==t.acceptPassingScoreDate&&(e.acceptPassingScoreDate=a.formatDate(t.acceptPassingScoreDate)),t.dueDateDaysStatus===!0&&"undefined"!=typeof t.dueDateDaysFromKey&&null!==t.dueDateDaysFromKey&&"none"!==t.dueDateDaysFromKey&&(e.dueDateFixed=null,e.flagDueDateMethod=1,e.dueDateDaysFromValue=t.dueDateDaysFromValue,e.dueDateDaysFromKey=t.dueDateDaysFromKey),t.dueDateFixedStatus===!0&&"undefined"!=typeof t.dueDateFixed&&null!==t.dueDateFixed&&(e.flagDueDateMethod=0,e.dueDateFixed=a.formatDate(t.dueDateFixed),e.dueDateDaysFromValue=null,e.dueDateDaysFromKey="none")})},e.toggleDatesSelection_01=function(e){null===e.dueDateFixed.jsDate&&(e.isEditable_01=!0)},e.toggleDatesSelection_02=function(e){""===e.dueDateDaysFromValue&&"none"===e.dueDateDaysFromKey&&(e.isEditable_01=!1)},e.toggleDatesSelectionModal_01=function(){e.batchEditForm.dueDateFixedStatus===!0?e.isEditableModal_01=!0:e.isEditableModal_01=!1},e.toggleDatesSelectionModal_02=function(){e.batchEditForm.dueDateDaysStatus===!0?e.isEditableModal_02=!0:e.isEditableModal_02=!1},e.ruleUpdateError={},e.ruleUpdateError.error=y.create(),e.ruleUpdateIsLoading=!1,e.updateRule=function(){e.ruleUpdateIsLoading=!0,e.ruleUpdateError.error.reset();var t=[],r=u.updateGeneralInfo();if("undefined"!=typeof r&&null!==r&&t.push(r),"undefined"!=typeof e.groupStructure&&null!==e.groupStructure){var n=u.updatePeopleGroup();"undefined"!=typeof n&&null!==n&&t.push(n)}if("undefined"!=typeof e.rows&&null!==e.rows){var o=u.updateAssignments();"undefined"!=typeof o&&null!==o&&t.push(o)}i.defer();i.all(t).then(function(t){e.ruleUpdateIsLoading=!1,e.rule=t[0],e.ruleEditTabs.selectedTab=0},function(t){e.ruleUpdateIsLoading=!1;var r=t.StatusCode,n=t.ErrorMessage;e.ruleUpdateError.error.setError(r,n)})},u.updateGeneralInfo=function(){var t="update",n=angular.copy(e.rule),o=r.ruleGeneralCall(n,t);return o},u.updatePeopleGroup=function(){var t="update",r=angular.copy(e.groupStructure);r.IsRuleCaller=!0,r.name="  ";var o;return"undefined"!=typeof r&&null!==typeof r&&("undefined"===r.groupId&&null===r.groupId&&(r.groupId=e.rule.groupId),o=n.savePeopleGroup(r,t)),o},u.updateAssignments=function(){var t,n=angular.copy(e.rows),o=u.params.param.split("/")[0];return void 0!==n&&"null"!==n&&(t=r.updateRuleAssignments(o,n)),t},e.previewPeopleError={},e.previewPeopleError.error=y.create(),e.previewPeopleIsLoading=!1,e.previewPeople=function(){e.previewPeopleError.error.reset(),e.previewPeopleIsLoading=!0;var t=e.groupStructure,r=n.getPeoplePreview(t);r.then(function(t){e.previewPeopleIsLoading=!1,e.showPreview=!0,e.people_rows=t},function(t){e.previewPeopleIsLoading=!1,e.showPreview=!1;var r=t.StatusCode,n=t.ErrorMessage;e.previewPeopleError.error.setError(r,n)})},e.activeRuleNodeClick=function(){"undefined"!=typeof u.params.name&&null!==u.params.name&&"home"===u.params.name?e.rows=u.filterRows("active"):m.path("rules/home")},e.inactiveRuleNodeClick=function(){"undefined"!=typeof u.params.name&&null!==u.params.name&&"home"===u.params.name?e.rows=u.filterRows("closed"):m.path("rules/home")},e.draftRuleNodeClick=function(){"undefined"!=typeof u.params.name&&null!==u.params.name&&"home"===u.params.name?e.rows=u.filterRows("draft"):m.path("rules/home")},e.templateRuleNodeClick=function(){"undefined"!=typeof u.params.name&&null!==u.params.name&&"home"===u.params.name?e.rows=u.filterRows("template"):m.path("rules/home")},u.filterRows=function(e){return _.filter(u.allRulesData,function(t){return t.status===e})},e.copyRuleError={},e.copyRuleError.error=y.create(),e.copyRuleIsLoading=!1,e.copyRuleModal=function(){e.copyRuleIsLoading=!0,e.copyRuleError.error.reset();var t=r.formatRuleForCopy(c("filter")(e.rows,{select:!0}));if(t.length>0)e.copyRuleIsLoading=!1,e.showCopyTable=!0,e.rows_In_CopyModal=t;else{e.copyRuleIsLoading=!1,e.showCopyTable=!1;var n="0",o="There are no rules selcted for copy!";e.copyRuleError.error.setError(n,o)}},e.copyRule=function(){e.copyRuleError.error.reset(),e.copyRuleIsLoading=!0;var t=angular.copy(e.rows_In_CopyModal);for(var n in t)t[n].isAddYear&&null!==t[n].newEndDate&&(t[n].newEndDate=a.formatDate(t[n].newEndDate.moment.add(1,"year")));void 0;var o=r.saveCopiedRule(t);o.then(function(t){e.copyRuleIsLoading=!1,e.showCopyTable=!0,m.path("/rules/home")},function(t){e.copyRuleIsLoading=!1,e.showCopyTable=!1;var r=t.StatusCode,n=t.ErrorMessage;e.copyRuleError.error.setError(r,n)})},e.inactiveRuleData=[{name:"Closed",nodes:[]}],e.inactiveRuleOptions={},e.inactiveRuleOptions.initiallyOpened=!1,e.inactiveRuleOptions.rootNodeIsTopLevel=!1,e.inactiveRuleOptions.canDrillDown=!1,e.inactiveRuleTreeIsLoading=!0,e.inactiveRuleNowHidden=!0,e.inactiveRuleTitle="Closed",e.inactiveRuleError={},e.inactiveRuleError.error=y.create(),e.draftRuleData=[{name:"Drafts",nodes:[]}],e.draftRuleOptions={},e.draftRuleOptions.initiallyOpened=!1,e.draftRuleOptions.rootNodeIsTopLevel=!1,e.draftRuleOptions.canDrillDown=!1,e.draftRuleTreeIsLoading=!0,e.draftRuleNowHidden=!0,e.draftRuleTitle="Drafts",e.draftRuleRuleError={},e.draftRuleRuleError.error=y.create(),e.templateRuleData=[{name:"Templates",nodes:[]}],e.templateRuleOptions={},e.templateRuleOptions.initiallyOpened=!1,e.templateRuleOptions.rootNodeIsTopLevel=!1,e.templateRuleOptions.canDrillDown=!1,e.templateRuleTreeIsLoading=!0,e.templateRuleNowHidden=!0,e.templateRuleTitle="Templates",e.templateRuleError={},e.templateRuleError.error=y.create(),e.propertyName="name",e.reverse=!1,e.requiredOptions=[{name:"Yes",value:!0},{name:"No",value:!1}],e.dueDateOptions=[{name:"Select",value:"none"},{name:"Hire Date",value:"hireDate"},{name:"Assigned On Date",value:"assignedOnDate"}],e.dueDateMethods=[{name:"Due Date",value:0},{name:"Calculated Due Date",value:1}],e.selectAll={},e.checkAll=function(){_.each(e.rows,function(t){t.select=e.selectAll.checked})},e.sortBy=function(t){e.reverse=e.propertyName===t&&!e.reverse,e.propertyName=t},e.ruleCreate_Step=function(e){var t=e;u["create_"+t+"Action"]()},e.treeOptions={nodeChildren:"nodes",templateUrl:"tree.html",injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},e.isSubDomainAdmin=t.isSubDomainAdmin(),e.taDomains=t.taDomains(),e.activeDomain=t.activeDomain(),e.switchDomains={},e.switchDomains.error=y.create(),
e.onActiveDomainChanged=function(r,n){var o=t.switchProfile(r.id);o.then(function(e){location.reload()},function(t){e.switchDomains.error.setError(t.StatusCode,t.ErrorMessage),jQuery("#switchDomainsError").show(),setTimeout(function(){e.switchDomains.error.reset(),jQuery("#switchDomainsError").hide()},2e3)})}}}]),app.factory("Users_AdminOverride",["$filter","$http","$q","$sce","$injector","$route","$timeout","$location","$httpParamSerializer","dateUtil","AssignmentsService","BreadcrumbsService","CountriesService","CoursesService","GroupsService","JobsService","OfferingsService","OrganizationsService","StatesService","TimezoneService","TranscriptsService","UsersService","errorDisplayerUtil","OrgFunctions","LocationsService","PeopleGroupFunctions","TreeHelpers",function(e,t,r,n,o,a,s,i,u,l,c,d,p,m,f,g,h,v,y,C,S,w,D,T,A,b,E){return function(t){var n=this;t.rows=Array(),t.rowsAreLoading=!0,t.defaultHeader=!0,t.activeTab="tab-active-class",n.homeRoute=function(){i.path("/users/home/")},t.general={},t.general.peopleSearch=null,t.general.filterBySearch=function(){t.home.page=1;var e=t.general.search,r={};r.keyword=e,n.sendAdvancedSearchQueryToServerAndDisplayUsers(r)},t.OrgData=[],t.OrgOptions={},t.OrgOptions.initiallyOpened=!1,t.OrgOptions.rootNodeIsTopLevel=!1,t.OrgTreeFilter="",t.OrgTreeIsLoading=!0,t.PeopleTreeIsLoading=!0,t.managerTreeIsLoading=!0,t.listFilter="",t.home={},t.home.limit=50,t.home.typeaheadMinLength=2,t.home.typeaheadWaitTime=800,t.homeAction=function(){t.home.page=1,t.home.total=0,t.home.maxVisiblePages=10,t.homeTemplate="app/templates/users/home/admin.html",t.peopleSelected=t.OrgData[0];var e=angular.copy(a.current.params);delete e.controller,delete e.name;var r=!1,o={};for(var s in e)e.hasOwnProperty(s)&&(o[s]=e[s],r=!0);o.welcome&&(r=!1),r?n.sendAdvancedSearchQueryToServerAndDisplayUsers(o):n.fetchAllUsersPaged()},t.checkSearchisEmpty=function(){var e=angular.equals({},t.advancedSearchStruct);if(!e){e=!0;for(var r in t.advancedSearchStruct)if(t.advancedSearchStruct.hasOwnProperty(r)&&null!==t.advancedSearchStruct[r]&&""!==t.advancedSearchStruct[r]){e=!1;break}}return e},t.home.nextPage=function(){t.selectAll.checked=!1;var e=angular.equals({},n.advancedSearchStructForPaging);e||"undefined"==typeof n.advancedSearchStructForPaging?n.fetchAllUsersPaged():n.sendAdvancedSearchQueryToServerAndDisplayUsers(n.advancedSearchStructForPaging)},t.OrgTreeTitle="Organizations",t.orgTreeError={},t.orgTreeError.error=D.create(),t.predicate={hasActiveUsersAssigned:!0},n.organizationCta=function(){t.orgTreeError.error.reset();var e=v.getOrgTree();return e.then(function(e){E.setPropertyOnAllNodes(e,"lockIcon",!0),t.OrgData=[{name:"Organizations",nodes:[e[0]]}],t.OrgTreeIsLoading=!1},function(e){t.OrgTreeIsLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;void 0,t.orgTreeError.error.setError(r,n)})},n.getOrganizationHierarchyData=function(){var e=v.getOrganizationHierarchy();return e.then(function(e){t.orgArray=[],t.domainsArray=[],t.orgCutoff=100;for(var r=0;r<e.length;r++){var n=e[r],o={};o.pathToOrg=n.pathToOrg,o.name=n.name,o.id=n.id,0===n.parentId&&t.domainsArray.push(n),t.orgArray.push(o)}t.isSubDomainAdmin===!1&&t.domainsArray&&t.domainsArray.length>1&&t.domainsArray.unshift({id:w.topLevelOrganizationId(),name:"Entire Portal"})})},n.getPositionsData=function(){var e=g.getAllJobs();e.then(function(e){t.jobs=[];for(var r=0;r<e.length;r++)if(e[r].isActive===!0){t.jobs.push(e[r]);var n=t.jobs.length-1;t.jobs[n].text=t.jobs[n].name}})},t.PeopleOptions={},t.PeopleOptions.initiallyOpened=!1,t.PeopleOptions.showLocks=!1,t.PeopleOptions.editPencil=!0,t.PeopleOptions.nodeClick=function(e){var t=e.id;i.path("users/peoplegroup/"+t+"/")},t.PeopleTreeTitle="People Groups",t.peopleTreeError={},t.peopleTreeError.error=D.create(),n.peopleCta=function(){t.peopleTreeError.error.reset();var e=f.getPeopleGroups();return e.then(function(e){for(var r=0;r<e.groups.length;r+=1)e.groups[r].pencilIcon=!0,e.groups[r].nodeClick=t.PeopleOptions.nodeClick;t.PeopleData=[{name:"People Groups",nodes:e.groups}],n.peopleGroupUserList=e.groupUserList,t.PeopleTreeIsLoading=!1},function(e){t.PeopleTreeIsLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.peopleTreeError.error.setError(r,n)})},t.managerTreeTitle="Managers",t.managerTreeError={},t.managerTreeError.error=D.create(),t.managerData=[],t.managerOptions={},t.managerOptions.initiallyOpened=!1,t.managerOptions.rootNodeIsTopLevel=!1,t.managerOptions.showLocks=!1,n.fetchAllUsersPaged=function(){t.rowsAreLoading=!0;var e={},r=t.home.page;e.pageNumber=r,e.pageSize=t.home.limit,e.sortBy=t.propertyName,e.sortAscending=!t.reverse;var o=w.advancedSearch(e);return o.then(function(e){t.rowsAreLoading=!1;var r=n.activeUsers(e);n.calculatePages(r),t.rows=r,n.setRowSelection()},function(e){t.rowsAreLoading=!1,t.rows=[],t.home.total=0;var r=e.StatusCode,n=e.ErrorMessage;t.userTableError.error.setError(r,n)})},t.managerNodeClick=function(e){var r=document.getElementsByClassName("tree-selected");Array.prototype.forEach.call(r,function(e){$(e).removeClass("tree-selected")});var o={};o.managerId=e.id,t.home.page=1,n.sendAdvancedSearchQueryToServerAndDisplayUsers(o)},n.activeUsers=function(t){var r=e("filter")(t,function(e){if(e.endDate>moment.utc().format()||null===e.endDate)return e});return r},n.getuserDataForManagerstree=function(){t.managerTreeError.error.reset(),t.managerTreeIsLoading=!0;var e=w.getManagerTree();return e.then(function(e){t.managerData=e,t.managerTree=[{name:"Managers",nodes:t.managerData}],t.managerTreeIsLoading=!1},function(e){t.managerTreeIsLoading=!1,t.managerTreeError.error.setError(e.statusCode,e.errorMessage)})},n.primaryManagersOnly=function(e){for(var t=e.length-1;t>=0;t--)e[t].hasDirectReports===!0?null!==e[t].nodes&&n.primaryManagersOnly(e[t].nodes):e.splice(t,1);return e},t.advancedSearch={},t.showAdvancedSearch=!1,t.advancedSearchStruct={},t.advancedSearchCta=function(){if("undefined"!=typeof t.orgArray&&null!==t.orgArray||n.getOrganizationHierarchyData(),"undefined"!=typeof t.jobs&&null!==t.jobs||n.getPositionsData(),t.showAdvancedSearch=!t.showAdvancedSearch,(t.showAdvancedSearch&&"undefined"==typeof t.timezones||null===t.timezones)&&(t.timezones=C.getAllZones()),t.showAdvancedSearch&&"undefined"==typeof t.countries||null===t.countries){var e=p.getLatitudeCountryList(w.getPortalId());e.then(function(e){t.countries=e,t.editUser.countriesLoading=!1},function(e){void 0})}},n.clearAdvancedSearch=function(){t.advancedSearchStruct={}},n.clearAdvancedSearch(),t.advancedSearch.selectJob=function(e,r,n){t.advancedSearchStruct.jobId=e.id},t.advancedSearch.selectOrganization=function(e,r,n){t.advancedSearchStruct.organizationId=e.id},t.advancedSearch.selectManager=function(e,r,n){var o=t.advancedSearchStruct.selectedManager;"undefined"==typeof e||null===e?("undefined"==typeof o||null===o||angular.isString(o)&&""===o.trim())&&delete t.advancedSearchStruct.managerId:t.advancedSearchStruct.managerId=e.id},t.advancedSearch.selectAlternateManager=function(e,r,n){var o=t.advancedSearchStruct.selectedAltManager;"undefined"==typeof e||null===e?("undefined"==typeof o||null===o||angular.isString(o)&&""===o.trim())&&delete t.advancedSearchStruct.alternateManagerId:t.advancedSearchStruct.alternateManagerId=e.id},t.advancedSearch.toggleTrainingAdministrator=function(){"undefined"!=typeof t.advancedSearchStruct.isTa?delete t.advancedSearchStruct.isTa:t.advancedSearchStruct.isTa=!0},t.advancedSearch.toggleInstructor=function(){"undefined"!=typeof t.advancedSearchStruct.isInstructor?delete t.advancedSearchStruct.isInstructor:t.advancedSearchStruct.isInstructor=!0},t.runAdvancedSearch=function(){delete t.advancedSearchStruct.selectedManager,delete t.advancedSearchStruct.selectedAltManager;for(var e in t.advancedSearchStruct)t.advancedSearchStruct.hasOwnProperty(e)&&(null!==t.advancedSearchStruct[e]&&""!==t.advancedSearchStruct[e]||delete t.advancedSearchStruct[e]);t.home.page=1,"home"!==a.current.params.name?i.path("/users/home/").search(t.advancedSearchStruct):n.sendAdvancedSearchQueryToServerAndDisplayUsers(t.advancedSearchStruct)},n.sendAdvancedSearchQueryToServerAndDisplayUsers=function(e){n.advancedSearchStructForPaging={},n.advancedSearchStructForPaging=e,_.isEmpty(e.pathToOrg)||delete e.pathToOrg,e.pageNumber=t.home.page,e.pageSize=t.home.limit,e.sortBy=t.propertyName,e.sortAscending=!t.reverse;var r=w.advancedSearch(e);return t.rowsAreLoading=!0,t.userTableError.error.reset(),t.closeAdvancedSearch(),r.then(function(e){n.calculatePages(e),t.rows=e,t.rowsAreLoading=!1,n.setRowSelection()},function(e){t.rowsAreLoading=!1,t.rows=[];var r=e.StatusCode;if(404!==r){var n=e.ErrorMessage;t.userTableError.error.setError(r,n)}})},t.closeAdvancedSearch=function(){n.clearAdvancedSearch(),t.showAdvancedSearch=!1},t.editUser={},t.editUser.error=D.create(),t.editAction=function(){t.timezones=C.getAllZones(),t.editUser.isLoading=!0,t.editUser.countriesLoading=!0,t.editUser.error.reset(),t.editUser.isEditing=!0,t.homeTemplate="app/templates/users/edit/admin.html";var e=a.current.params.param.split("/")[0],r=p.getLatitudeCountryList(w.getPortalId());r.then(function(e){t.countries=e,t.editUser.countriesLoading=!1},function(e){void 0}),"undefined"==typeof t.orgArray||null===t.orgArray?n.getOrganizationHierarchyData().then(function(){t.getUserToEdit(e)}):t.getUserToEdit(e),"undefined"!=typeof t.jobs&&null!==t.jobs||n.getPositionsData()},t.getUserToEdit=function(e){var r=w.fetch(e);r.then(function(e){if(t.user=e,"undefined"!=typeof t.user.homeAddress&&null!==t.user.homeAddress&&null!==t.user.homeAddress.countryId&&parseInt(t.user.homeAddress.countryId,10)>0&&t.getStates(t.user.homeAddress.countryId),null!==t.user.alternateManagers&&Object.keys(t.user.alternateManagers).length>0){var r=Object.keys(t.user.alternateManagers)[0],n=t.user.alternateManagers[r];t.user.selectedAlternateManager={},t.user.selectedAlternateManager.id=r,t.user.selectedAlternateManager.fullName=n,t.selectAlternateManager(t.user.selectedAlternateManager)}t.addUser.isUserTA()&&(w.isSubDomainAdmin()===!1?(t.addUser.trainingAdministrator=!0,t.addUser.toggleTrainingAdministrator(!0)):t.user.taRoleOrgIds.indexOf(w.activeDomain().id)===-1&&t.user.taRoleOrgIds.indexOf(w.topLevelOrganizationId())===-1||(t.addUser.trainingAdministrator=!0,t.addUser.toggleTrainingAdministrator(!0))),_.contains(t.user.roles,"instructor")&&(t.addUser.instructor=!0,t.addUser.toggleInstructor(!0)),t.editUser.isLoading=!1,t.editUser.isActive=w.isUserActive(t.user),t.editUser.isInFuture=w.isInFuture(t.user)},function(e){t.editUser.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.editUser.error.setError(r,n)})},t.confirmDeactivateUserError=D.create(),t.confirmDeactivateUserLoading=!1,t.confirmDeactivateUser=!1,t.deactivateUser=function(e){t.confirmDeactivateUserLoading=!0;var r=w.deactivateUser(e);r.then(function(e){t.toggleDeactivateUserTooltip(),n.homeRoute()},function(e){t.confirmDeactivateUserLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.confirmDeactivateUserError.setError(r,n)})},t.toggleDeactivateUserTooltip=function(){t.confirmDeactivateUser=!t.confirmDeactivateUser,t.confirmDeactivateUserError.reset(),t.confirmDeactivateUserLoading=!1},t.confirmActivate={},t.confirmActivateUserError=D.create(),t.confirmActivate.UserLoading=!1,t.confirmActivateUser=!1,t.ActivateUser=function(e){t.confirmDeactivateUserLoading=!0;var r=w.activateUser(e);r.then(function(e){n.homeRoute()},function(e){t.confirmActivateUserLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.confirmActivateUserError.setError(r,n)})},t.userTableError={},t.userTableError.error=D.create(),t.confirmSaveUser=!1,t.toggleSaveUserTooltip=function(){t.confirmSaveUser=!t.confirmSaveUser},t.confirmCancelUser=!1,t.toggleCancelUserTooltip=function(){t.confirmCancelUser=!t.confirmCancelUser},t.clearCancelBool=function(){t.confirmCancelUser=!1},t.OrgNodeClick=function(e){var r=document.getElementsByClassName("tree-selected");Array.prototype.forEach.call(r,function(e){$(e).removeClass("tree-selected")}),"undefined"!=typeof n.params.name&&null!==n.params.name&&"home"===n.params.name?"undefined"!=typeof e.id&&(t.selectedNode=e.name,n.filterRowsByOrgId(e)):i.path("users/home/")},n.filterRowsByOrgId=function(e){var r="undefined"!=typeof e.id?e.id:0,o={};o.organizationId=r,o.limitToSingleOrg=!0,t.home.page=1,n.sendAdvancedSearchQueryToServerAndDisplayUsers(o)},t.PeopleNodeClick=function(e){var r=document.getElementsByClassName("tree-selected");if(Array.prototype.forEach.call(r,function(e){$(e).removeClass("tree-selected")}),"undefined"!=typeof n.params.name&&null!==n.params.name&&"home"===n.params.name){if("People Groups"!==e.name){t.selectedNode=e.name;var o=e.id;n.peopleGroupUsers(o)}}else i.path("/users/home")},n.peopleGroupUsers=function(e){t.userTableError.error.reset(),t.rowsAreLoading=!0,t.rows=[];var r={};r.group_id=e,t.home.page=1,n.sendAdvancedSearchQueryToServerAndDisplayUsers(r)},t.userAuditInfo={},t.userAuditInfo.isLoading=!1,t.userAuditInfo.error=D.create(),t.auditAction=function(){t.homeTemplate="app/templates/users/audit/admin.html","undefined"==typeof a.current.params.param,t.userAuditInfo.error.reset(),t.userAuditInfo.isLoading=!0;var e=a.current.params.param.split("/")[0],r=w.getUserTrainingAudit(e);r.then(function(e){t.userAuditInfo.isLoading=!1,t.audits=e},function(e){t.userAuditInfo.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.userAuditInfo.error.setError(r,n)})},t.propertyName="lastName",t.reverse=!1,t.sortBy=function(e){t.home.page=1,t.reverse=t.propertyName===e&&!t.reverse,t.propertyName=e;var r=angular.equals({},n.advancedSearchStructForPaging);r||"undefined"==typeof n.advancedSearchStructForPaging?n.fetchAllUsersPaged():n.sendAdvancedSearchQueryToServerAndDisplayUsers(n.advancedSearchStructForPaging)},t.selectAll={},t.checkAll=function(){t.selectAll.checked?_.each(_.filter(t.rows,{isActive:!0}),function(e){e.select=!0;var r=_.findWhere(t.batch.selectedUsers,{id:e.id});"undefined"==typeof r&&t.batch.selectedUsers.push(angular.copy(e))}):_.each(_.filter(t.rows,{isActive:!0}),function(e){e.select=!1;var r=_.findIndex(t.batch.selectedUsers,{id:e.id});r!==-1&&t.batch.selectedUsers.splice(r,1)})},t.OrgNodeNowHidden=function(){t.rows=[]},t.editUserForm={},t.editUserForm.error=D.create(),t.callUserEdit=function(){var e=angular.copy(t.user);t.editUserForm.isLoading=!0,""===e.managerName&&null!==e.managerId&&(e.managerName=null,e.managerId=null),""===e.selectedAlternateManager&&null!==e.alternateManagers&&(e.alternateManagers={}),null!==e.endDate&&"undefined"!=typeof e.endDate.jsDate&&null===e.endDate.jsDate&&(e.endDate=null);var r=w.taEditProfile([e]);r.then(function(e){if(t.editUserForm.isLoading=!1,e[0].success===!0)i.path("users/home");else if(e[0].success===!1){var r="404",n=e[0].message;t.editUserForm.error.setError(r,n)}},function(e){t.editUserForm.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.editUserForm.error.setError(r,n)})},t.selectOrganization=function(e,r,n,o,a){t.user.organizationName=e.name,t.user.organizationId=e.id},t.selectManager=function(e,r,n,o,a){t.user.managerId=e.id},t.selectAlternateManager=function(e,r,n,o,a){t.user.alternateManagers={},t.user.alternateManagers[e.id]=e.fullName},t.languageOptions=[{id:9,name:"English"}],t.adminRemoveAssignment=function(e){t.assignmentsAreLoading=!0;var r=c.removeAssignment(e);r.then(function(e){n.viewAssignmentsCta(),setTimeout(function(){t.assignmentsAreLoading=!1,jQuery("#removeConfirmation").show(),setTimeout(function(){jQuery("#removeConfirmation").hide()},3e3)},2e3)},function(e){t.assignmentsAreLoading=!1,jQuery("#removeAssignmentError").show(),setTimeout(function(){jQuery("#removeAssignmentError").hide()},2e3)})},t.toggleRemoveAssignmentConfirmation=function(e,t){jQuery(".removeCourseContainer .confirmSave.confirmRemove").toggle(!1),"undefined"!=typeof t&&t===!0?jQuery("#removeConfirmation-"+e.assignmentCourseId).toggle(!1):jQuery("#removeConfirmation-"+e.assignmentCourseId).toggle(!0)},t.adminWaiveorReactivateAssignment=function(e,r){t.assignmentsAreLoading=!0;var o=c.waiveAssignment(e,r);o.then(function(e){n.viewAssignmentsCta()},function(e){t.assignmentsAreLoading=!1})},t.toggleWaiveAssignmentConfirmation=function(e,t){jQuery(".removeCourseContainer .confirmSave.confirmRemove").toggle(!1),"undefined"!=typeof t&&t===!0?jQuery("#waiveConfirmation-"+e.assignmentCourseId).toggle(!1):jQuery("#waiveConfirmation-"+e.assignmentCourseId).toggle(!0)},t.toggleReactivateAssignmentConfirmation=function(e,t){jQuery(".removeCourseContainer .confirmSave.confirmRemove").toggle(!1),"undefined"!=typeof t&&t===!0?jQuery("#reactivateConfirmation-"+e.assignmentCourseId).toggle(!1):jQuery("#reactivateConfirmation-"+e.assignmentCourseId).toggle(!0)},t.batch={},t.batch.error=D.create(),t.batch.locationError=D.create(),t.batch.selectedUsers=[],t.batch.selectAll={},t.batch.selectAll.checked=!0,t.pushInArray=function(e){t.selectAll.checked&&(t.selectAll.checked=!1);var r=_.findIndex(t.batch.selectedUsers,{id:e.id});e.select?r===-1&&t.batch.selectedUsers.push(angular.copy(e)):r!==-1&&t.batch.selectedUsers.splice(r,1)},t.batch.clearSelection=function(){t.batch.selectedUsers=[],_.each(t.rows,function(e){e.select=!1}),t.selectAll.checked=!1,t.batch.selectedUsersForm.$setPristine(),jQuery("#peopleTabBatchSelectedUsersModal").modal("hide"),t.showSelectUsersTooltip=!1},t.batch.selectUserRow=function(){t.batch.selectAll.checked=!1},t.batch.applySelectionChanges=function(){_.each(_.where(t.batch.selectedUsers,{select:!1}),function(e){var r=_.findWhere(t.rows,{id:e.id});"undefined"!=typeof r&&null!==r&&(r.select=!1,t.selectAll.checked=!1);var n=_.findIndex(t.batch.selectedUsers,{id:e.id});n!==-1&&t.batch.selectedUsers.splice(n,1)}),t.batch.selectedUsersForm.$setPristine(),jQuery("#peopleTabBatchSelectedUsersModal").modal("hide"),t.showSelectUsersTooltip=!1},t.showSelectUsersTooltip=!1,t.batch.toggleSelectUsersTooltip=function(){t.batch.selectedUsersForm.$dirty?t.showSelectUsersTooltip=!t.showSelectUsersTooltip:(jQuery("#peopleTabBatchSelectedUsersModal").modal("hide"),t.showSelectUsersTooltip=!1)},t.batch.closeSelectUsersModal=function(){var e=t.batch.selectedUsersForm.$dirty;e&&(n.undoSelectedUserChanges(),t.batch.selectedUsersForm.$setPristine()),jQuery("#peopleTabBatchSelectedUsersModal").modal("hide"),t.showSelectUsersTooltip=!1},n.undoSelectedUserChanges=function(){_.each(t.batch.selectedUsers,function(e){e.select=!0})},n.setRowSelection=function(){_.each(t.rows,function(e){var r=_.findWhere(t.batch.selectedUsers,{id:e.id});"undefined"!=typeof r&&(e.select=!0),e.isActive=w.isUserActive(e)}),t.selectAll.checked=_.every(t.rows,{select:!0})},t.batch.checkAll=function(){t.batch.selectAll.checked?_.each(t.batch.selectedUsers,function(e){e.select=!0}):_.each(t.batch.selectedUsers,function(e){e.select=!1})},t.batch.showPopover=function(){t.batch.popoverIsVisible=!0,t.batch.selectAll.checked=!0,jQuery("#peopleTabBatchSelectedUsersModal").modal()},t.batch.hidePopover=function(){t.batch.popoverIsVisible=!1,jQuery("#peopleTabBatchSelectedUsersModal").modal("hide")},n.clearBatchForm=function(){t.batch.form={},t.batch.form.orgObj=null,t.batch.form.jobType=null,t.advancedSearchStruct.jobId=null,t.batch.locationLoading=!1,t.batch.locationError.reset(),t.batch.error.reset()},n.clearBatchForm(),t.batch.clearBatchEditModal=function(){n.clearBatchForm()},t.batch.editUserModal=function(){"undefined"!=typeof t.orgArray&&null!==t.orgArray||n.getOrganizationHierarchyData(),"undefined"!=typeof t.jobs&&null!==t.jobs||n.getPositionsData(),t.batch.selectedActiveUsers=_.filter(t.batch.selectedUsers,w.isUserActive),jQuery("#peopleTabBatchEditResultsModal").modal("hide"),jQuery("#peopleTabBatchEditModal").modal(),n.clearBatchForm()},t.batch.editResultsModal=function(e){jQuery("#peopleTabBatchEditModal").modal("hide"),jQuery("#peopleTabBatchAddTranscriptModal").modal("hide"),jQuery("#peopleTabBatchEditResultsModal").modal(),e?(n.fetchAllUsersPaged(),t.batch.successMessage="Batch edit successful!",t.batch.failureMessage="Please edit individual records"):(t.batch.successMessage="Batch add to transcript successful!",t.batch.failureMessage="Please add transcript entry to individual records")},t.batch.hideModals=function(){jQuery("#peopleTabBatchEditModal").modal("hide"),jQuery("#peopleTabBatchEditResultsModal").modal("hide"),jQuery("#peopleTabBatchAddTranscriptModal").modal("hide"),jQuery("#peopleTabBatchSelectedUsersModal").modal("hide"),n.clearBatchForm(),n.clearBatchAddTranscriptForm()},t.batch.selectJob=function(e,r,n){"undefined"!=typeof e&&"undefined"!=typeof e.jobId&&(e.id=e.jobId),t.batch.form.jobType=e},t.batch.selectOrganization=function(e,r,n){t.batch.form.orgObj=e},n.updateFieldsOnUsersToUpload=function(e){for(var r=0;r<e.length;r+=1){delete e[r].nodes;for(var n=["custom1","custom2","custom3","custom4","custom5","location"],o=0;o<n.length;o+=1){var a=n[o];t.batch.form[a]&&t.batch.form[a].trim&&""!==t.batch.form[a].trim()&&(e[r][a]=t.batch.form[a].trim())}if(t.batch.form.endDate&&(e[r].endDate=t.batch.form.endDate),t.batch.form.manager&&""!==t.batch.form.manager&&(e[r].managerId=t.batch.form.manager.id,e[r].managerName=t.batch.form.manager.firstName+" "+t.batch.form.manager.lastName),t.batch.form.alternateManager&&""!==t.batch.form.alternateManager&&(e[r].alternateManagers={},e[r].alternateManagers[t.batch.form.alternateManager.id]=t.batch.form.alternateManager.firstName+" "+t.batch.form.alternateManager.lastName),t.batch.form.jobType&&""!==t.batch.form.jobType&&(e[r].jobId=t.batch.form.jobType.id),null!==t.batch.form.orgObj){var s=t.batch.form.orgObj;e[r].organizationId=s.id,e[r].organizationName=s.name}}},t.batch.scrollBarConfig={autoHideScrollbar:!1,theme:"bai",advanced:{updateOnContentResize:!0},setHeight:"50vh",scrollInertia:0,scrollButtons:{scrollAmount:"auto",enable:!0}},t.batch.applyChanges=function(){t.batch.processing=!0,n.updateFieldsOnUsersToUpload(t.batch.selectedActiveUsers),t.batch.selectedUsers=[],w.batchUpdateUsers(t.batch.selectedActiveUsers).then(function(e){t.batch.failedUsers=_.filter(e,function(e){return!e.success}),t.batch.processing=!1,t.batch.editResultsModal(!0)},function(e){t.batch.processing=!1;var r=e.StatusCode,n=e.ErrorMessage;t.batch.error.setError(r,n),t.batch.editResultsModal(!0)})},t.batchAddTranscript={},t.batchAddTranscript.error=D.create(),n.clearBatchAddTranscriptForm=function(){t.batchAddTranscript.form={},t.batchAddTranscript.error.reset()},n.clearUserBatchCheckboxes=function(){_.filter(t.rows,function(e){e.select&&(e.select=!1)}),t.selectAll.checked&&(t.selectAll.checked=!1)},n.clearBatchAddTranscriptForm(),t.batch.addTranscriptModal=function(){t.batch.selectedActiveUsers=_.filter(t.batch.selectedUsers,w.isUserActive),jQuery("#peopleTabBatchAddTranscriptModal").modal(),n.clearBatchAddTranscriptForm()},t.batch.showBatchTranscriptConfirmationModal=function(){jQuery("#peopleTabBatchAddTranscriptModal").modal("hide"),jQuery("#peopleTabBatchEditResultsModal").modal()},t.batch.submitBatchAddToTranscript=function(){t.batch.processing=!0;var e=t.batch.batchAddTranscript.course;new Date(e.completedDate).getFullYear()<2e3&&(e.completedDate=new Date(e.completedDate.setFullYear(e.completedDate.getFullYear()+100))),new Date(e.startDate).getFullYear()<2e3&&(e.startDate=new Date(e.startDate.setFullYear(e.startDate.getFullYear()+100))),e.users=t.batch.selectedActiveUsers,t.batch.selectedUsers=[],S.batchCreate(e).then(function(e){t.batch.failedUsers=_.filter(e,function(e){return!e.success}),t.batch.processing=!1,t.batch.editResultsModal(!1),n.clearUserBatchCheckboxes()},function(e){t.batch.processing=!1;var r=e.StatusCode,o=e.ErrorMessage;t.batch.error.setError(r,o),t.batch.editResultsModal(!1),n.clearUserBatchCheckboxes()})},t.viewAssignments=function(e,r){t.userName=e,t.studentId=r,angular.element(document.querySelector("#viewAssignmentsModal")).modal(),n.viewAssignmentsCta()},t.assignmentsAreLoading=!0,t.viewAssignmentsError={},t.viewAssignmentsError.error=D.create(),n.viewAssignmentsCta=function(){t.propertyName="name",t.viewAssignmentsError.error.reset();var e=a.current.params.param.split("/")[0],r=c.fetch(e);r.then(function(e){t.assignmentsData=o(e),t.assignmentsAreLoading=!1},function(e){t.assignmentsAreLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.viewAssignmentsError.error.setError(r,n)})};var o=function(e){return _.each(e,function(e){e.errorSpinner=!1,e.isDroppable&&null!==e.prescriptiveRuleId&&(e.isDroppable=!1)}),e};t.closeViewAssignmentModal=function(){t.editAction()},t.addNewAssignmentCta=function(){angular.element(document.querySelector("#viewAssignmentsModal")).modal("hide"),angular.element(document.querySelector("#addNewAssignmentModal")).modal()},t.closeNewAssignmentModal=function(){angular.element(document.querySelector("#addNewAssignmentModal")).modal("hide"),angular.element(document.querySelector("#viewAssignmentsModal")).modal(),n.viewAssignmentsCta(),t.courseModal.courseSearch="",t.modalBodyShow=!1},t.modalBodyShow=!1,t.modalBodyToggle=function(){t.modalBodyShow=!t.modalBodyShow},t.courseModal={},t.courseModal.courseSearch="",t.courseModal.selectAll=!1,t.viewCoursesError={},t.viewCoursesError.error=D.create(),t.coursesAreLoading=!0,t.assignmentsAddedSuccessfully=!1,t.getCoursesCta=function(r){t.modalBodyShow=!0,t.selectedCourseCount=0,t.viewCoursesError.error.reset(),t.courseModal.selectAll=!1,t.coursesAreLoading=!0;var o=m.getActiveCoursesForOrg();o.then(function(o){var a=n.formatCoursesData(o);"undefined"!=typeof r&&null!==r?t.courseData=e("filter")(a,r):t.courseData=a,t.coursesAreLoading=!1},function(e){t.coursesAreLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.viewCoursesError.error.setError(r,n)})},n.formatCoursesData=function(e){return _.each(e,function(e){e.select=!1}),e},t.addAllCourses=function(e){_.each(t.courseData,function(t){t.select=e}),e===!0?t.selectedCourseCount=t.courseData.length:t.selectedCourseCount=0},t.selectedCourseCount=0,t.checkForLength=function(e){e===!0?t.selectedCourseCount++:t.selectedCourseCount--};var u=function(e){var t=[],r=a.current.params.param.split("/")[0];return _.each(e,function(e){e.select===!0&&(e.StudentId=r,t.push(e))}),t};t.applyCourseError={},t.applyCourseError.error=D.create(),t.coursesAreApplying=!1,t.applyNewAssignmentsCta=function(e){var r=u(e);t.assignmentsAddedSuccessfully=!0,t.coursesAreApplying=!0,t.applyCourseError.error.reset();var n=c.assignAssignment(r);n.then(function(e){t.coursesAreApplying=!1,t.assignmentsAddedSuccessfully=!0,t.courseModal.courseSearch="",s(function(){t.assignmentsAddedSuccessfully=!1,t.closeNewAssignmentModal()},3e3)},function(e){t.coursesAreApplying=!1;var r=e.StatusCode,n=e.ErrorMessage;t.viewCoursesError.error.setError(r,n)})},n.changedAssignments=[],t.changeDueDate=function(e){n.changedAssignments.push(e)},t.appltCtaViewAssignments=function(){var e=n.changedAssignments;t.assignmentsLength=e.length,_.each(e,function(e){n.updateAssignmentsCta(e)}),n.changedAssignments=[],angular.element(document.querySelector("#viewAssignmentsModal")).modal("hide")},n.updateAssignmentsCta=function(e){e.errorSpinner=!0;var t=a.current.params.param.split("/"),r=l.formatDate(e.dueDate.jsDate),n=w.getId(),o=t[0],s=e.assignmentCourseId,i=r.utcDate,u=c.updateDueDate(n,o,s,i);u.then(function(t){e.errorSpinner=!1},function(t){e.errorSpinner=!1;var r=t.StatusCode,n=t.ErrorMessage;e.error.setError(r,n)})},t.invalidScore=!1,t.updateFailed=!1,t.studentId={},t.successfulAssignment={},t.markSuccessful=function(e){t.completionDate=new Date,angular.element(document.querySelector("#viewAssignmentsModal")).modal("hide"),angular.element(document.querySelector("#markSuccessfulModal")).modal(),t.successfulAssignment=e},t.closeMarkSuccessfulModal=function(){angular.element(document.querySelector("#markSuccessfulModal")).modal("hide"),angular.element(document.querySelector("#viewAssignmentsModal")).modal(),t.successfulAssignment=null},t.updateSuccessfulAssignment=function(e,r,o){var a=document.getElementById("successfulScore").value;if(t.invalidScore=!1,t.markingSuccessful=!0,(null!==a||"undefined"!==a)&&a>=0&&a<=100){var s=r.status,i=r.score;r.status="successful",r.score=a,r.completedDate=o;var u=S.updateSingle(e,r);u.then(function(e){t.markingSuccessful=!1,t.closeMarkSuccessfulModal(),n.viewAssignmentsCta()},function(e){r.status=s,r.score=i,r.completedDate=null,t.markingSuccessful=!1,t.updateFailed=!0,setTimeout(function(){t.updateFailed=!1},2e3)})}else t.invalidScore=!0,t.markingSuccessful=!1,setTimeout(function(){t.invalidScore=!1},3e3)},t.resetAssignment={},t.resetAssignmentStatus=function(e){angular.element(document.querySelector("#viewAssignmentsModal")).modal("hide"),angular.element(document.querySelector("#resetStatusModal")).modal(),t.resetAssignment=e},t.closeResetStatusModal=function(){angular.element(document.querySelector("#resetStatusModal")).modal("hide"),angular.element(document.querySelector("#viewAssignmentsModal")).modal(),t.resetAssignment=null},t.resetCourseStatus=function(e,r){t.markingSuccessful=!0;var o=m.resetCourseStatus(e.id,r);o.then(function(e){t.resettingCourseStatus=!1,t.closeResetStatusModal(),n.viewAssignmentsCta()},function(e){t.markingSuccessful=!1,t.updateFailed=!0,setTimeout(function(){t.updateFailed=!1},2e3)})},t.jobsTreeLoading=!0,t.jobsTreeTitle="Positions",t.jobsTreeError={},t.jobsTreeError.error=D.create(),t.jobsTreeOptions={},t.jobsTreeOptions.initiallyOpened=!1,t.jobsTreeOptions.rootNodeIsTopLevel=!1,t.jobCutoff=100,t.jobTreeLimit=100,t.selectJob=function(e,r,n,o,a){t.user.jobType=e.name,t.user.jobId=e.id},t.jobsNodeClick=function(e){var r=document.getElementsByClassName("tree-selected");Array.prototype.forEach.call(r,function(e){$(e).removeClass("tree-selected")});if("undefined"!=typeof n.params.name&&null!==n.params.name&&"home"===n.params.name){if("undefined"!=typeof e.id){t.selectedNode=e.name;var o={};o.jobId=e.id,t.home.page=1,n.sendAdvancedSearchQueryToServerAndDisplayUsers(o)}}else i.path("/users/home")},t.getStates=function(e){var r=y.getLatitudeStateList(e);r.then(function(e){t.states=e},function(e){t.states=[]})},t.createPeopleGroup={},t.createPeopleGroup.inputPeopleGroupName=!1,n.params=a.current.params,t.peoplegroupAction=function(){t.PeopleOptions.initiallyOpened=!0,t.homeTemplate="app/templates/users/peoplegroup/admin.html",void 0!==n.params.param&&null!==n.params.param?(t.createPeopleGroup.inputPeopleGroupName=!1,t.createPeopleGroup.defaultPeopleGroupHeader=!1,n.getPeopleGroupsStructure()):(t.createPeopleGroup.inputPeopleGroupName=!0,t.createPeopleGroup.defaultPeopleGroupHeader=!0,n.createPeoplegroup())},t.peopleGroupError={},t.peopleGroupError.error=D.create(),t.peopleGroupsAreLoading=!0,t.viewPeopleGroupStructure=!1,t.containerOptions={},t.containerOptions.showLock=!1,n.createPeoplegroup=function(){t.peopleGroupsAreLoading=!0;var e=r.all(b.peopleGroupActions());e.then(function(e){t.groupStructure={},t.groupStructure=e[0],t.selectOptionsData=e[1],t.containerOperandsData=f.containerOperandsRequired(e[2]),f.secondaryFormatGroupStructure(e[3],e[4].groups,e[5],e[6]),t.peopleGroupsAreLoading=!1,t.viewPeopleGroupStructure=!0},function(e){n.failurePeopleGroup(e)})},n.getPeopleGroupsStructure=function(){var e=n.params.param.split("/")[0];t.peopleGroupsAreLoading=!0;var o=r.all(b.peopleGroupActions(e));o.then(function(e){t.groupStructure={},t.selectOptionsData=e[1],t.containerOperandsData=f.containerOperandsRequired(e[2]),f.secondaryFormatGroupStructure(e[3],e[4].groups,e[5],e[6]),t.groupStructure=f.secondaryFormatGroupStructure_groupStructure(e[0]),n.showGroupStatus(e[0]),t.peopleGroupsAreLoading=!1,t.viewPeopleGroupStructure=!0},function(e){n.failurePeopleGroup(e)})},n.failurePeopleGroup=function(e){t.peopleGroupsAreLoading=!1,t.viewPeopleGroupStructure=!1;var r=e.StatusCode,n=e.ErrorMessage;t.peopleGroupError.error.setError(r,n)},t.editPeopleGroup={},t.cancelPeopleGroup=function(){t.editPeopleGroup.isOpen=!t.editPeopleGroup.isOpen},t.peopleGroupSaveError={},t.peopleGroupSaveError.error=D.create(),
t.savePeopleGroupCta=function(e){t.peopleGroupSaveError.error.reset(),t.savePeopleGroupAreLoading=!0;var r,o,a=t.groupStructure;"undefined"!==e&&e.includes("save")?r=a:"undefined"!==e&&"deactivate"===e?(o=n.setEndDate(e),a.endDate=o,r=a):"undefined"!==e&&"activate"===e&&(o=n.setEndDate(e),a.endDate=o,r=a);var s=f.savePeopleGroup(r,e);s.then(function(e){t.savePeopleGroupAreLoading=!1,n.showGroupStatus(e),i.path("/users/home/")},function(e){t.savePeopleGroupAreLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.peopleGroupSaveError.error.setError(r,n)})},t.previewPeopleError={},t.previewPeopleError.error=D.create(),t.previewPeopleIsLoading=!1,t.previewPeople=function(){t.previewPeopleError.error.reset(),t.previewPeopleIsLoading=!0;var e=t.groupStructure,r=f.getPeoplePreview(e);r.then(function(e){t.previewPeopleIsLoading=!1,t.showPreview=!0,t.people_rows=e},function(e){t.previewPeopleIsLoading=!1,t.showPreview=!1;var r=e.StatusCode,n=e.ErrorMessage;t.previewPeopleError.error.setError(r,n)})},n.setEndDate=function(e){var t;return"deactivate"===e?t=l.formatDate(moment.utc().format()):"activate"===e&&(t=null),t},n.showGroupStatus=function(e){var r=e.endDate,n=moment.utc().format();"undefined"!==r&&null!==r&&r.original<=n?t.isActive=!1:t.isActive=!0},t.jsonLabel="JSON",t.showHideJson=!1,t.disableJson=!0,t.showJson=function(){t.showHideJson=!t.showHideJson,t.showHideJson===!1?t.jsonLabel="Show JSON":t.jsonLabel="Hide JSON"},t.addUser={},t.addUser.isLoading=!1,t.addUser.error=D.create(),t.addUser.countriesIsLoading=!1,t.addUser.locationsIsLoading=!1,t.addUser.trainingAdministrator=!1,t.addUser.toggleInstructor=!1,t.addUser.errorMessage="Sorry, we couldn't load this page. Please try again",t.addAction=function(){t.user={},t.user.homeAddress={},t.user.roles=["unknown"],t.homeTemplate="app/templates/users/add/admin.html",t.addUser.countriesIsLoading=!0;var e=p.getLatitudeCountryList(w.getPortalId());e.then(function(e){t.countries=e,t.addUser.countriesIsLoading=!1},function(e){var r=e.StatusCode,n=e.ErrorMessage;t.addUser.error.setError(r,n)});var r=w.isSSO();r.then(function(e){t.user.isSSO=e}),t.timezones=C.getAllZones(),"undefined"!=typeof t.orgArray&&null!==t.orgArray||n.getOrganizationHierarchyData(),"undefined"!=typeof t.jobs&&null!==t.jobs||n.getPositionsData()},t.addUser.toggleTrainingAdministrator=function(e){"undefined"!=typeof t.user.roles&&null!==t.user.roles||(t.user.roles=["unknown"]),void 0===t.user.taRoleOrgIds&&(t.user.taRoleOrgIds=[]);var r=t.user.roles;e?(t.addUser.isUserTA()||(1===r.length&&_.contains(r,"unknown")?t.user.roles=["TA"]:t.user.roles.push("TA")),1===t.domainsArray.length&&t.user.taRoleOrgIds.indexOf(w.activeDomain().id)===-1&&t.user.taRoleOrgIds.push(w.activeDomain().id),jQuery("#taOrgPicker").show()):(1===r.length?t.user.roles=["unknown"]:t.user.roles=_.filter(r,function(e){return"TA"!==e.toUpperCase()}),1===t.domainsArray.length&&t.user.taRoleOrgIds.splice(t.user.taRoleOrgIds.indexOf(w.activeDomain().id),1),jQuery("#taOrgPicker").hide())},t.addUser.isUserTA=function(){var e=t.user.roles,r=_.filter(e,function(e){return"TA"===e.toUpperCase()});return r.length>0},t.addUser.toggleInstructor=function(e){"undefined"!=typeof t.user.roles&&null!==t.user.roles||(t.user.roles=["unknown"]);var r=t.user.roles;e?_.contains(r,"instructor")||(1===r.length&&_.contains(r,"unknown")?t.user.roles=["instructor"]:t.user.roles.push("instructor")):1===r.length?t.user.roles=["unknown"]:t.user.roles=_.filter(r,function(e){return"instructor"!==e})},t.addUserSave={},t.addUserSave.isLoading=!1,t.addUserSave.error=D.create(),t.addUser.save=function(){"undefined"!=typeof t.user.homeAddress&&0!==Object.keys(t.user.homeAddress).length||delete t.user.homeAddress;var e=t.user;t.addUserSave.isLoading=!0;var r=w.createUser(e);r.then(function(e){t.addUserSave.isLoading=!1,i.path("/users/home/")},function(e){t.addUserSave.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.addUserSave.error.setError(r,n),t.addUser.errorMessage=n}),t.confirmSaveUser=!1},t.transcriptsAction=function(){t.homeTemplate="app/templates/users/transcripts/admin.html",t.isAdmin=!0,t.maxDate=new Date,t.pageOptions.isLoading=!0;var e=a.current.params.param;if("undefined"!=typeof e){var r=e.split("/");t.studentId=r[0]}else t.studentId=w.getId();var n=w.fetch(t.studentId);n.then(function(e){t.fullName=e.fullName,t.studentId=e.id},function(e){void 0});var o=S.fetch(t.studentId);o.then(function(e){t.assignments=e,t.pageOptions.isLoading=!1,t.propertyName="status",t.reverse=!0},function(e){t.assignments=null,t.pageOptions.isLoading=!1,t.pageOptions.error.setError(e.StatusCode,e.ErrorMessage)})},t.editTranscript={},t.editTranscript.isLoading=!1,t.editTranscript.error=D.create(),t.edittranscriptAction=function(){t.homeTemplate="app/templates/users/edittranscript/admin.html",t.editTranscript.isLoading=!0;var e=parseInt(a.current.params.param.split("/")[0]),r=parseInt(a.current.params.param.split("/")[1]),n=a.current.params.param.split("/")[2],o=encodeURI(a.current.params.param.split("/")[3]),s=w.fetch(e);s.then(function(a){t.fullName=a.fullName,t.studentId=a.id;var s=S.rangeFetch(e,n,o);s.then(function(e){return t.assignment=_.filter(e,function(e){return e.transcriptId===r}),0===t.assignment.length?void t.orgTreeError.error.setError(404,"Couldn't find transcript"):(t.assignment=t.assignment[0],t.assignmentCopy=angular.copy(t.assignment),void(t.editTranscript.isLoading=!1))},function(e){t.editTranscript.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.editTranscript.error.setError(r,n)})},function(e){t.editTranscript.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.editTranscript.error.setError(r,n)})},t.editTranscript.saveTranscript=function(e){t.editTranscript.isLoading=!0;var r=S.updateTranscript(e);r.then(function(e){t.editTranscript.isLoading=!1,i.path("/users/transcripts/"+t.studentId+"/")},function(e){t.editTranscript.isLoading=!1;var r=e.StatusCode,n=e.ErrorMessage;t.editTranscript.error.setError(r,n)})},t.userTypeahaed={},t.userTypeahaed.error=D.create(),t.userTypeahaed.search=function(e,r){t.userTypeahaed.error.reset(),t.userTypeahaed.isLoading=!0;var n={};n.pageNumber=1,n.pageSize=25,"manager"===e?(n.fullNameContains=r,n.roleid=11):"person"===e?n.fullNameContains=r:n[e]=r;var o=w.advancedSearch(n);return o.then(function(e){return t.userTypeahaed.isLoading=!1,0===e.length?(t.userTypeahaed.error.setError(404,"There are no items to display."),!1):e},function(e){return t.userTypeahaed.isLoading=!1,t.userTypeahaed.error.setError(e.StatusCode,e.ErrorMessage),[]})},n.getTreeData=function(){t.managerTree=[{name:"Managers",nodes:[{name:"",id:"-1"}]}],t.OrgData=[{name:"Organizations",nodes:[{name:"",id:"-1"}]}],t.PeopleData=[{name:"People Groups",nodes:[{name:"",id:"-1"}]}],t.jobsTree=[{name:"Positions",nodes:[{name:"",id:"-1"}]}],t.PeopleTreeIsLoading=!1,t.OrgTreeIsLoading=!1,t.managerTreeIsLoading=!1,t.jobsTreeLoading=!1},n.getTreeData();var d=A.getAll();d.then(function(e){t.locations=e},function(e){}),t.iconClick=function(e){void 0},t.treeOptions={nodeChildren:"nodes",templateUrl:"tree.html",lockIcon:!0,injectClasses:{ul:"a1",li:"a2",liSelected:"a7",iExpanded:"a3",iCollapsed:"a4",iLeaf:"a5",label:"a6",labelSelected:"a8"}},t.onNodeToggle=function(e,r){if("Organizations"===e.name&&r===!0){if("-1"!==t.OrgData[0].nodes[0].id)return void(t.OrgTreeIsLoading=!1);t.OrgTreeIsLoading=!0;var o=v.getOrgTree();return void o.then(function(e){E.setPropertyOnAllNodes(e,"lockIcon",!0);var r=[],n=0;for(n=0;n<e.length;n++)r.push(e[n]);t.OrgData=[{name:"Organizations",nodes:r}],t.OrgTreeIsLoading=!1},function(e){var r=e.StatusCode,n=e.ErrorMessage;t.OrgTreeIsLoading=!1,t.orgTreeError.error.setError(r,n)})}if("Managers"===e.name&&r===!0){if("-1"!==t.managerTree[0].nodes[0].id)return void(t.managerTreeIsLoading=!1);t.managerTreeIsLoading=!0;var a=w.getManagerTree();return void a.then(function(e){t.managerData=e,t.managerTree=[{name:"Managers",nodes:t.managerData}],t.managerTreeIsLoading=!1},function(e){void 0;var r=e.StatusCode,n=e.ErrorMessage;t.managerTreeIsLoading=!1,t.managerTreeError.error.setError(r,n)})}if("Positions"!==e.name||r!==!0){if("People Groups"===e.name&&r===!0){if("-1"!==t.PeopleData[0].nodes[0].id)return void(t.PeopleTreeIsLoading=!1);var s=f.getPeopleGroups();return void s.then(function(e){for(var r=0;r<e.groups.length;r+=1)e.groups[r].pencilIcon=!0,e.groups[r].nodeClick=t.PeopleOptions.nodeClick;t.PeopleData=[{name:"People Groups",nodes:e.groups}],n.peopleGroupUserList=e.groupUserList,t.PeopleTreeIsLoading=!1},function(e){var r=e.StatusCode,n=e.ErrorMessage;t.PeopleTreeIsLoading=!1,t.peopleTreeError.error.setError(r,n)})}}else{if("-1"!==t.jobsTree[0].nodes[0].id)return void(t.jobsTreeLoading=!1);if("undefined"!=typeof t.jobs&&null!==t.jobs){t.jobsTreeLoading=!0;var i=_.map(_.filter(t.jobs,{hasActiveUsersAssigned:!0}),function(e){return _.pick(e,"id","name")});E.setPropertyOnAllNodes(i,"lockIcon",!0),t.jobsTree=[{name:"Positions",nodes:i}],t.jobsTreeLoading=!1}else{t.jobsTreeLoading=!0;var u=g.getAllJobs();u.then(function(e){t.jobs=[];for(var r=0;r<e.length;r++)if(e[r].isActive===!0){t.jobs.push(e[r]);var n=t.jobs.length-1;t.jobs[n].text=t.jobs[n].name}var o=_.map(_.filter(t.jobs,{hasActiveUsersAssigned:!0}),function(e){return _.pick(e,"id","name")});E.setPropertyOnAllNodes(o,"lockIcon",!0),t.jobsTree=[{name:"Positions",nodes:o}],t.jobsTreeLoading=!1},function(e){void 0;var r=e.StatusCode,n=e.ErrorMessage;t.jobsTreeLoading=!1,t.jobsTreeError.error.setError(r,n)})}}},n.calculatePages=function(e){t.home.total=e[0].totalCount},t.topLevelOrganizationId=w.topLevelOrganizationId(),t.isSubDomainAdmin=w.isSubDomainAdmin(),t.taDomains=w.taDomains(),t.activeDomain=w.activeDomain(),t.switchDomains={},t.switchDomains.error=D.create(),t.onActiveDomainChanged=function(e,r){var n=w.switchProfile(e.id);n.then(function(e){location.reload()},function(e){t.switchDomains.error.setError(e.StatusCode,e.ErrorMessage),jQuery("#switchDomainsError").show(),setTimeout(function(){t.switchDomains.error.reset(),jQuery("#switchDomainsError").hide()},2e3)})},t.onDomainSelectedChanged=function(e){if(t.user.taRoleOrgIds.length>0&&t.user.taRoleOrgIds.splice(0,t.user.taRoleOrgIds.length),void 0!==e){var r=0;for(r=0;r<e.length;r++)t.user.taRoleOrgIds.push(e[r].id)}},t.initSelectedDomains=function(){void 0===t.domainsSelected&&(t.domainsSelected=[]),void 0===t.user.taRoleOrgIds&&(t.user.taRoleOrgIds=[]),t.domainsSelected.splice(0,t.domainsSelected.length);var e=0,r=0;for(e=0;e<t.user.taRoleOrgIds.length;e++)for(r=0;r<t.domainsArray.length;r++)if(t.user.taRoleOrgIds[e]===t.domainsArray[r].id){t.domainsSelected.push(t.domainsArray[r]);break}}}}]),app.factory("Users_InstructorOverride",["BreadcrumbsService","OfferingsService","errorDisplayerUtil",function(e,t,r){return function(n){var o=this;n.isFutureSelected=!0,n.isPastSelected=!1,n.options={},n.options.isLoading=!1,n.options.error=r.create(),o.fetchInstructorOfferingsList=function(e){n.assignments=null,n.options.isLoading=!0,n.role="instructor",n.filterView="app/templates/users/partials/filters/"+n.role+".html",n.options.error.reset();var r=t.fetchInstructorAssignments(e);r.then(function(e){var t=e;n.assignments=t,n.options.isLoading=!1,n.responseComplete=!0},function(e){n.options.isLoading=!1,n.options.error.setError(e.StatusCode,e.ErrorMessage)})},n.homeAction=function(t){n.homeTemplate="app/templates/users/home/instructor.html",n.isLoading=!0,n.orderProperty="past"===t?"-lowestSessionDateForOffering.original":"lowestSessionDateForOffering.original",n.role="instructor",t="undefined"!=typeof t&&null!==t?t:"future",n.isFutureSelected="future"===t,n.isPastSelected="past"===t,o.fetchInstructorOfferingsList(t);var r=e.getCrumbs();0===r.length&&e.pushCrumb("instructor desk","users/home")}}}]),app.factory("Users_ManagerOverride",["$rootScope","$http","$location","$timeout","$q","$route","AssignmentsService","BreadcrumbsService","TeamService","TranscriptsService","UsersService","TasksService","dateUtil","errorDisplayerUtil","$anchorScroll",function(e,t,r,n,o,a,s,i,u,l,c,d,p,m,f){return function(t){function f(e){return/^#[0-9A-F]{6}$/i.test(e)?e:(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+g(e[1])+g(e[2])+g(e[3]))}function g(e){return("0"+parseInt(e).toString(16)).slice(-2)}var h=this;t.role="manager",t.pageOptions.dashboardSummary={},t.pageOptions.dashboardSummary.error=m.create(),t.pageOptions.dashboardSummary.isLoading=!0,t.pageOptions.teamSummary={},t.pageOptions.teamSummary.error=m.create(),t.pageOptions.teamSummary.isLoading=!1,t.pageOptions.enrollmentRequests={},t.pageOptions.enrollmentRequests.error=m.create(),t.pageOptions.enrollmentRequests.isLoading=!1,t.pageOptions.managerApprovalRequests={},t.pageOptions.managerApprovalRequests.error=m.create(),t.pageOptions.managerApprovalRequests.isLoading=!1,t.homeTemplate="app/templates/users/home/manager.html",t.role="manager",t.cssDoneLoading=!1,e.$watch("cssDoneLoading",function(e){if(e===!0){var r="#009ce6",n=null;for(var o in document.styleSheets)if(n=document.styleSheets[o],"portalStyles"===n.ownerNode.id){var a=n.rules||n.cssRules;for(var s in a)if(".portalSvgFill"===a[s].selectorText){r=f(a[s].style.fill);break}break}t.pieChartDefaults.colours=[r,"#d6d6d6"],t.pieChartDefaults.labels=["Complete","Incomplete"],t.cssDoneLoading=!0}},!0);var v=new Date;v.setDate(1),v.setMonth(0),v.setFullYear(v.getFullYear()),t.currentDateRange=v,t.scrollBarConfig={autoHideScrollbar:!1,theme:"bai",advanced:{updateOnContentResize:!0},setHeight:"50vh",scrollInertia:0,scrollButtons:{scrollAmount:"auto",enable:!0}},t.summaryExpanded=!0,t.toggleSummary=function(){t.summaryExpanded=!t.summaryExpanded},t.fullyRecursive=!1,t.teamContextMenuExpanded=!1,t.toggleTeamContextMenu=function(){n(function(){t.teamContextMenuExpanded=!t.teamContextMenuExpanded},1)},h.closeAllContextMenus=function(){t.lookupContextMenuExpanded=!1,t.teamContextMenuExpanded=!1},$(document).on("click",function(e){t.teamContextMenuExpanded&&!$(e.target).closest("#directTeamFlyout").length&&t.$apply(function(){t.teamContextMenuExpanded=!1}),t.lookupContextMenuExpanded&&!$(e.target).closest("#searchBarFlyout").length&&t.$apply(function(){t.lookupContextMenuExpanded=!1})}),t.selectedTeamEnum={DEFAULT:"",DIRECT_TEAM:"directTeam",ALTERNATE_TEAM:"alternateTeam"},t.selectedTeam=t.selectedTeamEnum.DIRECT_TEAM,t.directTeamManagerList=null,t.selectedDirectTeamManagerId=null,t.SEARCH_FILTER_ENUM={ALL:"all",PEOPLE:"people",ROLES:"role",GROUPS:"group"},t.searchFilter=t.SEARCH_FILTER_ENUM.ALL,t.changeSearchFilter=function(e){t.searchFilter=e,h.closeAllContextMenus()},t.pieChartDefaults=Array(),t.pieChartDefaults.options={animation:!1,showTooltips:!1,segmentShowStroke:!1,maintainAspectRatio:!1},t.emptyPieChartDefaults=Array(),t.emptyPieChartDefaults.options={animation:!1,showTooltips:!1,segmentShowStroke:!1,maintainAspectRatio:!1},t.emptyPieChartDefaults.colours=["#FFFFFF"],t.emptyPieChartDefaults.labels=["N/A"],t.emptyPieChartData=[100],t.teamList=null,h.getTeamList=function(){return t.teamList},h.setTeamList=function(e){t.teamList=e},t.breadCrumbs=Array(),t.breadCrumbsVisible=!1,t.currentUserName=c.getName(),h.pushBreadCrumb=function(e,r){t.breadCrumbs.push({managerName:e,managerId:r}),t.breadCrumbsVisible=!0},h.clearBreadCrumbs=function(){t.breadCrumbs=Array(),t.breadCrumbsVisible=!1},t.teamSummary=Array(),t.toggleProfile=function(e){return e.error=m.create(),e.error.reset(),e.profileExpanded?void(e.profileExpanded=!e.profileExpanded):(e.isLoading=!0,void c.fetch(e.studentId).then(function(t){e.isLoading=!1,e.data=t,e.profileExpanded=!0},function(t){e.isLoading=!1,e.profileExpanded=!0,e.error.setError(t.StatusCode,t.ErrorMessage)}))},t.displayDirectTeam=function(){var e=u.getDirectTeamList(t.startDate.apiDate,t.endDate.apiDate);return t.breadCrumbsVisible=!1,h.closeAllContextMenus(),t.selectedTeam=t.selectedTeamEnum.DIRECT_TEAM,t.pageOptions.teamSummary.error.reset(),t.pageOptions.teamSummary.isLoading=!0,e.then(function(e){h.setTeamList(e),t.selectedDirectTeamManagerId=null,h.clearBreadCrumbs();var r=h.getTeamList();"undefined"!=typeof r&&r.lenght>0&&(t.directTeamManagerList=r.filter(function(e){return e.isManager===!0&&e.teamCount>0})),t.pageOptions.teamSummary.isLoading=!1},function(e){t.pageOptions.teamSummary.isLoading=!1,t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})},t.displayAlternateTeam=function(){var e=u.getAlternateTeamList(t.startDate.apiDate,t.endDate.apiDate);t.breadCrumbsVisible=!1,h.closeAllContextMenus(),t.selectedTeam=t.selectedTeamEnum.ALTERNATE_TEAM,t.pageOptions.teamSummary.isLoading=!0,e.then(function(e){return e=e,t.selectedDirectTeamManagerId=null,h.clearBreadCrumbs(),t.pageOptions.teamSummary.isLoading=!1,0===e.length?(h.setTeamList([]),void t.pageOptions.teamSummary.error.setError(404,"There were no alternate team members found")):(_.each(e,function(e){e.isManager=!1}),void h.setTeamList(e))},function(e){h.setTeamList([]),t.pageOptions.teamSummary.isLoading=!1,t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})},t.displayDirectTeamByManagerId=function(e){try{var r=h.getTeamList().filter(function(t){return t.studentId===e})[0];if("undefined"==typeof r){r=t.directTeamManagerList.filter(function(t){return t.studentId===e})[0];var n=!0}var o=r.firstName+" "+r.lastName,a=u.getDirectTeamListByManagerId(e,t.startDate.apiDate,t.endDate.apiDate);t.breadCrumbsVisible=!1,h.closeAllContextMenus(),t.pageOptions.teamSummary.isLoading=!0,t.pageOptions.teamSummary.error.reset(),a.then(function(r){r=r,h.setTeamList(r),t.selectedTeam=t.selectedTeamEnum.DIRECT_TEAM,t.selectedDirectTeamManagerId=e,n&&h.clearBreadCrumbs(),h.pushBreadCrumb(o,e);var a=u.getRollup(e,t.startDate.apiDate,t.endDate.apiDate);a.then(function(e){e=e,t.teamSummary=e,t.teamSummary.managerName=o,t.breadCrumbsVisible=!0,t.pageOptions.teamSummary.isLoading=!1},function(e){h.setTeamList([]),t.breadCrumbsVisible=!1,t.pageOptions.teamSummary.isLoading=!1,t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})},function(e){h.setTeamList([]),t.breadCrumbsVisible=!1,t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})}catch(s){void 0;var i=new Error;void 0,t.pageOptions.teamSummary.error.setError(null,"There was an issue rendering the page.")}},t.drillDirectTeamByBreadCrumb=function(e){var r=t.breadCrumbs[e].managerId,n=t.breadCrumbs[e].managerName,o=u.getDirectTeamListByManagerId(r,t.startDate.apiDate,t.endDate.apiDate);t.breadCrumbsVisible=!1,h.closeAllContextMenus(),t.pageOptions.teamSummary.isLoading=!0,o.then(function(o){o=o,h.setTeamList(o),t.selectedTeam=t.selectedTeamEnum.DIRECT_TEAM,t.selectedDirectTeamManagerId=null;for(var a=t.breadCrumbs.length,s=e;s<a;s+=1)t.breadCrumbs.pop();h.pushBreadCrumb(n,r);var i=u.getRollup(r,t.startDate.apiDate,t.endDate.apiDate);i.then(function(e){t.teamSummary=e,t.teamSummary.managerName=n,t.breadCrumbsVisible=!0,t.pageOptions.teamSummary.isLoading=!1},function(e){h.setTeamList([]),t.breadCrumbsVisible=!1,t.pageOptions.teamSummary.isLoading=!1,t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})},function(e){h.setTeamList([]),e=e,t.breadCrumbsVisible=!1,t.pageOptions.teamSummary.isLoading=!1,t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})},t.homeAction=function(e){return"undefined"==typeof e||e===!1?void t.updateDatesForSummaries(!0):(t.pageOptions.dashboardSummary.error.reset(),t.pageOptions.dashboardSummary.isLoading=!0,t.pageOptions.teamSummary.error.reset(),t.pageOptions.teamSummary.isLoading=!0,t.getManagerSummary(),t.teamListTitle=c.getName(),t.breadcrumb=Array(),void t.displayDirectTeam())},t.toggleFullyRecursive=function(){t.fullyRecursive=!t.fullyRecursive,t.getManagerSummary()},t.getManagerSummary=function(){t.pageOptions.dashboardSummary.isLoading=!0;var e=u.getSummary(t.startDate.apiDate,t.endDate.apiDate,t.fullyRecursive);e.then(function(e){void 0,void 0,t.summary=e,t.pageOptions.dashboardSummary.isLoading=!1},function(e){t.pageOptions.dashboardSummary.isLoading=!1,t.pageOptions.dashboardSummary.error.setError(e.StatusCode,e.ErrorMessage)})},t.listAction=function(){t.homeTemplate="app/templates/users/list/manager.html",h.fetchStudentAssignments(),i.pushCrumb("Dashboard","users/home/"),i.pushCrumb("List")},t.searchForUnderlings=function(){var e=this.underlings;t.pageOptions.teamSummary.error.reset(),t.pageOptions.teamSummary.isLoading=!0;var r=c.search(e,t.searchFilter);r.then(function(e){for(var r=[],n=e,o=0;o<n.length;o++)r.push(n[o].id);n=u.getSummariesByUserId(r,t.startDate.apiDate,t.endDate.apiDate),n.then(function(e){t.pageOptions.teamSummary.isLoading=!1,t.selectedTeam=t.selectedTeamEnum.DEFAULT,h.setTeamList(e)},function(e){t.pageOptions.teamSummary.isLoading=!1,h.setTeamList([]),t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})},function(e){t.pageOptions.teamSummary.isLoading=!1,h.setTeamList([]),t.pageOptions.teamSummary.error.setError(e.StatusCode,e.ErrorMessage)})},t.enrollmentRequestsAction=function(){jQuery("#enrollmentRequestsModal").modal();var e=u.getListOfAssignmentsToApprove();e.then(function(e){t.approvalAssignments=e,0===e.length&&t.pageOptions.enrollmentRequests.error.setError(404,"There were no requests found")},function(e){t.apiError=!0,t.responseComplete=!0,t.pageOptions.enrollmentRequests.error.setError(e.StatusCode,e.ErrorMessage)})},t.ApproveRequest=function(e){var r=e.offeringId,n=e.studentId,o=e.transcriptId,a=e.assignmentType;e.error.reset(),e.isLoading=!0;var i=s.approveDenyEnrollment(n,r,o,a,!0);i.then(function(){t.enrollmentRequestsAction()},function(t){e.isLoading=!1,e.error.setError(t.StatusCode,t.ErrorMessage)})},t.DenyRequest=function(e){var r=e.offeringId,n=e.studentId,o=e.transcriptId,a=e.assignmentType;e.error.reset(),e.isLoading=!0;var i=s.approveDenyEnrollment(n,r,o,a,!1);i.then(function(e){t.enrollmentRequestsAction()},function(t){e.isLoading=!1,e.error.setError(t.StatusCode,t.ErrorMessage)})},t.approvalsAction=function(){jQuery("#approvalsModal").modal(),t.pageOptions.managerApprovalRequests.error.reset();var e=u.getTasksForApproval();e.then(function(e){t.approvalTasks=e},function(e){t.pageOptions.managerApprovalRequests.error.setError(e.StatusCode,e.ErrorMessage)})},t.CompletedTask=function(e,r,n){n.isLoading=!0,n.error.reset();var o=d.taskApproval(e,r,!0);o.then(function(){t.approvalsAction()},function(e){n.isLoading=!1,n.error.setError(e.StatusCode,e.ErrorMessage)})},t.NotCompletedTask=function(e,r,n){n.isLoading=!0,n.error.reset();var o=d.taskApproval(e,r,!1);o.then(function(){t.approvalsAction()},function(e){n.isLoading=!1,n.error.setError(e.StatusCode,e.ErrorMessage)})},t.refresh=function(){t.homeAction()},t.addAssignments={},t.addAssignments.error=m.create(),t.addAssignments.noUsersSelectedError=!1,t.addAssignments.STEP_ENUM={ASSIGNMENTS:1,DUE_DATE:2,AUDIENCE:3},t.addAssignments.SEARCH_TAB_ENUM={PLEASE_BEGIN:0,LOADING:1,ERROR:2,NO_RESULTS:3,RESULTS_FOUND:4},t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.PLEASE_BEGIN,t.addAssignments.AUDIENCE_TAB_ENUM={SELECT_USERS:0,LOADING:1,ERROR:2,SUCCESS:3},t.addAssignments.audienceTabState=t.addAssignments.AUDIENCE_TAB_ENUM.SELECT_USERS,t.addAssignments.searchResults=Array(),t.addAssignments.queuedAssignments={},t.addAssignments.assignmentsToggledForRemoval={},t.addAssignments.clearAddAssignmentsModal=function(){t.addAssignments.queuedAssignments={},t.addAssignments.assignmentsToggledForRemoval={},t.addAssignments.selectedUsers={},t.addAssignments.keyword="",t.addAssignments.assignmentType="unknown",t.addAssignments.noUsersSelectedError=!1,t.addAssignments.step=t.addAssignments.STEP_ENUM.ASSIGNMENTS,t.addAssignments.searchResults=Array(),t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.PLEASE_BEGIN,t.addAssignments.audienceTabState=t.addAssignments.AUDIENCE_TAB_ENUM.SELECT_USERS,t.addAssignments.autoOpenedList=!1,t.addAssignments.error.reset(),y()},t.addAssignments.selectedUsers={},t.addAssignments.keyword="",t.addAssignments.assignmentType="unknown",t.addAssignments.step=t.addAssignments.STEP_ENUM.ASSIGNMENTS,t.addAssignments.buttonDisabled=!1,t.addAssignments.autoOpenedList=!1,t.addAssignments.selectAssignments=function(){t.addAssignments.audienceTabState=t.addAssignments.AUDIENCE_TAB_ENUM.SELECT_USERS,w(t.addAssignments.queuedAssignments,t.addAssignments.assignmentsToggledForRemoval),t.addAssignments.assignmentsToggledForRemoval={},t.addAssignments.step=t.addAssignments.STEP_ENUM.ASSIGNMENTS};var y=function(){setTimeout(function(){angular.element("#assignmentsTabSelector").addClass("active"),angular.element("#dueDateTabSelector").removeClass("active"),angular.element("#audienceTabSelector").removeClass("active"),angular.element("#assignmentsTabSelector > a").addClass("portalBackground"),angular.element("#assignmentsTabSelector > .nav-arrow").addClass("portalBorderLeft"),angular.element("#dueDateTabSelector > a").removeClass("portalBackground"),angular.element("#dueDateTabSelector > .nav-arrow").removeClass("portalBorderLeft"),angular.element("#dueDateTabSelector > .nav-wedge").removeClass("portalBorderTop portalBorderRight portalBorderBottom"),angular.element("#audienceTabSelector > a").removeClass("portalBackground"),angular.element("#audienceTabSelector > .nav-arrow").removeClass("portalBorderLeft"),angular.element("#audienceTabSelector > .nav-wedge").removeClass("portalBorderTop portalBorderRight portalBorderBottom")},1)},C=function(){setTimeout(function(){angular.element("#assignmentsTabSelector").removeClass("active"),angular.element("#dueDateTabSelector").addClass("active"),angular.element("#audienceTabSelector").removeClass("active"),angular.element("#assignmentsTabSelector > a").removeClass("portalBackground"),angular.element("#assignmentsTabSelector > .nav-arrow").removeClass("portalBorderLeft"),angular.element("#dueDateTabSelector > a").addClass("portalBackground"),angular.element("#dueDateTabSelector > .nav-arrow").addClass("portalBorderLeft"),angular.element("#dueDateTabSelector > .nav-wedge").addClass("portalBorderTop portalBorderRight portalBorderBottom")},1)},S=function(){setTimeout(function(){angular.element("#assignmentsTabSelector").removeClass("active"),angular.element("#dueDateTabSelector").removeClass("active"),angular.element("#audienceTabSelector").addClass("active"),angular.element("#dueDateTabSelector > a").removeClass("portalBackground"),angular.element("#dueDateTabSelector > .nav-arrow").removeClass("portalBorderLeft"),angular.element("#dueDateTabSelector > .nav-wedge").removeClass("portalBorderTop portalBorderRight portalBorderBottom"),angular.element("#audienceTabSelector > a").addClass("portalBackground"),angular.element("#audienceTabSelector > .nav-wedge").addClass("portalBorderTop portalBorderRight portalBorderBottom")},1)},w=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;n+=1)r[n]in e&&delete e[r[n]]};t.addAssignments.selectDueDate=function(){return t.addAssignments.audienceTabState=t.addAssignments.AUDIENCE_TAB_ENUM.SELECT_USERS,0===Object.keys(t.addAssignments.queuedAssignments).length?(t.addAssignments.step=t.addAssignments.STEP_ENUM.ASSIGNMENTS,y(),void(t.addAssignments.noAssignmentsSelectedError=!0)):(t.addAssignments.step=t.addAssignments.STEP_ENUM.DUE_DATE,t.addAssignments.noAssignmentsSelectedError=!1,void C())},t.addAssignments.nextButton=function(){switch(t.addAssignments.step){case t.addAssignments.STEP_ENUM.ASSIGNMENTS:t.addAssignments.selectDueDate();break;case t.addAssignments.STEP_ENUM.DUE_DATE:t.addAssignments.selectAudience();break;case t.addAssignments.STEP_ENUM.AUDIENCE:t.addAssignments.submitAssignmentsForSelectedUsers()}},t.addAssignments.searchAssignments=function(e,r){t.addAssignments.noAssignmentsSelectedError=!1,t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.LOADING,t.addAssignments.error.reset();var n=u.searchAssignments(e,r);n.then(function(e){e=e;for(var r=0;r<e.length;r+=1)e[r].id in t.addAssignments.queuedAssignments&&(e[r].checked=!0);t.addAssignments.searchResults=e,0===e.length?t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.NO_RESULTS:t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.RESULTS_FOUND},function(e){t.addAssignments.error.setError(e.StatusCode,e.ErrorMessage),404===e.StatusCode?""===t.addAssignments.keyword?t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.PLEASE_BEGIN:(t.addAssignments.searchResults=[],t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.NO_RESULTS):t.addAssignments.searchTabState=t.addAssignments.SEARCH_TAB_ENUM.ERROR})},t.addAssignments.queueAssignment=function(e){e.id in t.addAssignments.queuedAssignments?(delete t.addAssignments.queuedAssignments[e.id],0===Object.keys(t.addAssignments.queuedAssignments).length&&(t.addAssignments.noAssignmentsSelectedError=!0)):(t.addAssignments.queuedAssignments[e.id]=e,t.addAssignments.noAssignmentsSelectedError=!1)},t.addAssignments.toggleAssignmentForRemoval=function(e){e.id in t.addAssignments.assignmentsToggledForRemoval?delete t.addAssignments.assignmentsToggledForRemoval[e.id]:t.addAssignments.assignmentsToggledForRemoval[e.id]=e},t.addAssignments.audienceData=[];var D=function(e,r){if(e.checked=r,e.checked?t.addAssignments.selectedUsers[e.studentId]=e:delete t.addAssignments.selectedUsers[e.studentId],e.teamList&&e.teamList.length>0)for(var n=0;n<e.teamList.length;n+=1)D(e.teamList[n],r);if(e.alternateTeamList&&e.alternateTeamList.length>0)for(var o=0;o<e.alternateTeamList.length;o+=1)D(e.alternateTeamList[o],r)};t.addAssignments.toggleUser=function(e,r){if(t.addAssignments.noUsersSelectedError=!1,e.checked=!e.checked,e.checked?t.addAssignments.selectedUsers[e.studentId]=e:delete t.addAssignments.selectedUsers[e.studentId],r===!0&&e.teamList&&e.teamList.length>0)for(var n=0;n<e.teamList.length;n+=1)D(e.teamList[n],e.checked);0===Object.keys(t.addAssignments.selectedUsers).length&&(t.addAssignments.noUsersSelectedError=!0)},t.addAssignments.toggle=function(e){e.hidden=!e.hidden},h.setPropertyOnAllNodes=function(e,t,r){for(var n=0;n<e.length;n+=1)e[n][t]=r,"undefined"!=typeof e[n].teamList&&e[n].teamList.length>0&&h.setPropertyOnAllNodes(e[n].teamList,t,r)},t.addAssignments.submitAssignmentsForSelectedUsers=function(){if(0===Object.keys(t.addAssignments.selectedUsers).length)return void(t.addAssignments.noUsersSelectedError=!0);t.addAssignments.audienceTabState=t.addAssignments.AUDIENCE_TAB_ENUM.LOADING;for(var e=Object.keys(t.addAssignments.queuedAssignments),r=Object.keys(t.addAssignments.selectedUsers),n=[],a=function(e,t){return s.submitAssignment(e,t)},i=0;i<e.length;i+=1)for(var u=0;u<r.length;u+=1){var l=Object.keys(t.addAssignments.queuedAssignments)[i],c=t.addAssignments.queuedAssignments[l],d=Object.keys(t.addAssignments.selectedUsers)[u],p=t.addAssignments.selectedUsers[d];n.push(a(p.studentId,c))}o.all(n).then(function(e){t.addAssignments.audienceTabState=t.addAssignments.AUDIENCE_TAB_ENUM.SUCCESS,jQuery("#addAssignmentsModal").modal("hide"),jQuery("#addAssignmentsModal").on("hidden.bs.modal",function(){t.homeAction(),t.addAssignments.clearAddAssignmentsModal()})},function(e){t.addAssignments.audienceTabState=t.addAssignments.AUDIENCE_TAB_ENUM.ERROR,t.addAssignments.error.setError(e.StatusCode,e.ErrorMessage)})},t.addAssignments.selectAudience=function(){if(0===Object.keys(t.addAssignments.queuedAssignments).length)return t.addAssignments.step=t.addAssignments.STEP_ENUM.ASSIGNMENTS,y(),void(t.addAssignments.noAssignmentsSelectedError=!0);var e=Object.keys(t.addAssignments.queuedAssignments).length,r=Object.keys(t.addAssignments.assignmentsToggledForRemoval).length;return e===r?(t.addAssignments.step=t.addAssignments.STEP_ENUM.DUE_DATE,C(),void(t.addAssignments.noAssignmentsSelectedError=!0)):(w(t.addAssignments.queuedAssignments,t.addAssignments.assignmentsToggledForRemoval),t.addAssignments.assignmentsToggledForRemoval={},
t.addAssignments.step=t.addAssignments.STEP_ENUM.AUDIENCE,void S())},t.addAssignmentsAction=function(e){h.getTeamRecursiveList(e),t.stepThreeView="app/templates/users/home/modals/addAssignmentViews/step3.audience.subTeam.html",jQuery("#addAssignmentsModal").modal()},t.addAssignmentsActionForAllTeams=function(){var e=c.user;e.studentId=c.getId(),h.getTeamRecursiveList(e);var r=u.getAlternateTeamList(t.startDate.apiDate,t.endDate.apiDate);r.then(function(r){r=r;var n={};n.firstName=e.firstName,n.lastName=e.lastName,n.studentId=e.studentId,n.teamList=r,t.addAssignments.alternateDataList=n,h.setPropertyOnAllNodes(t.addAssignments.alternateDataList,"hidden",!0),h.setPropertyOnAllNodes(t.addAssignments.alternateDataList,"checked",!1)},function(e){void 0}),t.stepThreeView="app/templates/users/home/modals/addAssignmentViews/step3.audience.fullTeam.html",jQuery("#addAssignmentsModal").modal()},t.editAssignment=function(e){var t=a.current.params.param.split("/"),r=p.formatDate(e.dueDate.jsDate),n=r;if(c.isSaba()){var o=n.jsDate.setHours(0,0,0,0);n=p.formatDate(o),n=n.moment}else n=r.utcDate;var i=t[0];e.error.reset(),e.changingDueDate=!0;var u=e.assignmentCourseId;c.isSaba()&&(u=e.id);var l=s.updateDueDate(c.getId(),i,u,n);l.then(function(t){e.dueDate=r,e.changingDueDate=!1},function(t){e.error.setError(t.status,t.message),e.changingDueDate=!1,e.dueDate=p.formatDate(originalDate)})},t.updateDatesForSummaries=function(e){t.currentDateRange=this.currentDateRange||t.currentDateRange,t.endDate=p.formatDate(new Date),t.startDate=p.formatDate(t.currentDateRange),t.homeAction(e)},t.transcriptsAction=function(){t.homeTemplate="app/templates/users/transcripts/manager.html",t.maxDate=new Date,t.pageOptions.isLoading=!0;var e=a.current.params.param,r=e.split("/"),n=r[0];h.getTranscriptAction(n)},t.studentId=c.getId(),h.getTranscriptAction=function(e){var r=c.fetch(e);r.then(function(e){t.fullName=e.fullName,t.studentId=e.id},function(e){void 0});var n=l.fetch(e);n.then(function(e){t.assignments=e,t.pageOptions.isLoading=!1,t.sortBy="status"},function(e){t.assignments=null,t.pageOptions.isLoading=!1,t.pageOptions.error.setError(e.StatusCode,e.ErrorMessage)}),i.pushCrumb("my team","users/home"),i.pushCrumb("transcripts")},t.removeAssignment=function(e){var r;if(r="coursegroupcurricula"===e.type.toLowerCase()||"coursegroupcertification"===e.type.toLowerCase()||"coursegroup"===e.type.toLowerCase()?confirm("This course was assigned by a course group. If you click OK, you will remove the entire course group. Are you sure you want to remove this course group?"):confirm("Are you sure you want to remove this course?")){var n=s.removeAssignment(e);n.then(function(r){t.apiMessage="The course "+e.name+" has been successfully dropped.",jQuery("#apiMessage-"+e.id).toggle(),setTimeout(function(){h.fetchStudentAssignments()},2e3)},function(r){t.apiMessage="Sorry! There was an issue removing the course. Please try again!",jQuery("#apiMessage-"+e.id).toggle(),setTimeout(function(){jQuery("#apiMessage-"+e.id).toggle()},2e3)})}else t.apiActionLoader=!1},t.dump=function(e){void 0},h.fetchStudentAssignments=function(){t.isLoading=!0;var e=a.current.params.param.split("/"),n=r.search().type,o=p.formatDate(new Date),i=p.formatDate(new Date(n)),u=e[2],l=e[1],d=e[0],m=e[3];t.pageOptions.error.reset();var f=null;f="coursegroupcurricula"===l.toLowerCase()||"coursegroupcertification"===l.toLowerCase()?s.getCourseGroupCourses(d,l,m):s.getAssignmentsBystateAndType(d,l,u,i.apiDate,o.apiDate);var g=c.fetch(d);f.then(function(e){t.isLoading=!1,t.courseGroup=!1;var r=e;"wbt"===l.toLowerCase()?t.managerListViewHeader="Web Based Course Assignments":"ilt"===l.toLowerCase()?t.managerListViewHeader="Instructor Led Course Assignments":"coursegroup"===l.toLowerCase()?(t.managerListViewHeader="Course Group Assignments",t.courseGroup=!0):"coursegroupcurricula"===l.toLowerCase()||"coursegroupcertification"===l.toLowerCase()?t.managerListViewHeader=r[0].certificationName+r[0].curriculumName+" Courses":t.managerListViewHeader=r.type,t.apiError=!1,t.assignments=r,t.isLoading=!1,t.responseComplete=!0},function(e){t.apiError=!0,t.isLoading=!1,t.responseComplete=!0,t.pageOptions.error.setError(e.StatusCode,e.ErrorMessage)}),g.then(function(e){var r="s"===e.fullName.slice(-1)?"'":"'s";t.studentFullName=e.fullName+r},function(){})},h.getTeamRecursiveList=function(e){var r={};r.firstName=e.firstName,r.lastName=e.lastName,r.studentId=e.studentId,r.hidden=!1,u.recursiveTeamList(e.studentId,t.startDate.apiDate,t.endDate.apiDate).then(function(e){r.teamList=e,t.addAssignments.audienceData=[r]},function(){t.addAssignments.audienceData=[r]})},t.toggleThisAssignmentsCalender=function(e,t){t.openCalendar=!t.openCalendar}}}]),app.factory("Users_StudentOverride",["AssignmentsService","BreadcrumbsService","OfferingsService","TranscriptsService","UsersService","errorDisplayerUtil","SettingsService",function(e,t,r,n,o,a,s){return function(a){var i=this;return a.role="student",i.fetchAssignments=function(){if(a.filterView="app/templates/users/partials/filters/"+a.role+".html",s.maxEnrollmentAttemptsAllowed===-1){var e=s.getSettings();e.then(function(e){i.assignmentGet()},function(e){i.assignmentGet()})}else i.assignmentGet()},i.assignmentGet=function(){var t=e.fetch(o.getId());t.then(function(e){var t=e;a.apiError=!1,a.assignments=t,a.isLoading=!1,a.responseComplete=!0},function(e){a.apiError=!0,a.isLoading=!1,a.responseComplete=!0,a.errorMessage=e.ErrorMessage})},a.transcriptsAction=function(){a.homeTemplate="app/templates/users/transcripts/student.html",a.maxDate=new Date,a.user=o,a.pageOptions.isLoading=!0,a.studentId=o.getId(),a.isStudent=!0;var e=n.fetch(a.studentId);e.then(function(e){a.assignments=e,a.pageOptions.isLoading=!1,a.sortBy="status"},function(e){a.assignments=null,a.pageOptions.isLoading=!1,a.pageOptions.error.setError(e.StatusCode,e.ErrorMessage)}),t.pushCrumb("assignments","users/home"),t.pushCrumb("transcripts")},a.iltCalendarAction=function(){a.homeTemplate="app/templates/users/ilt-calendar/student.html",a.offeringsAreLoading=!0;var e=r.fetch(o.getId(),"ilt");e.then(function(e){a.offeringsAreLoading=!1,a.offerings=r.offerings,a.isLoading=!1},function(e){a.offeringsAreLoading=!1,a.apiError=!0,a.isLoading=!1}),0===t.getCrumbs().length&&(t.pushCrumb("assignments","users/home"),t.pushCrumb("instructor led"))},a.calendarAction=function(e){a.homeTemplate="app/templates/users/calendar/student.html",a.properFiltering="dueDate",a.assignmentFilter=a.getRequiredAssignments,a.orderProperty="dueDate.original",a.role="student",i.fetchAssignments(),t.pushCrumb("assignments","users/home"),t.pushCrumb("calendar")},a.listAction=function(e){a.homeTemplate="app/templates/users/list/student.html",a.assignmentFilter=a.getRequiredAssignments,a.orderProperty="dueDate.original",a.role="student",i.fetchAssignments(),t.pushCrumb("assignments","users/home"),t.pushCrumb("list")},a.homeAction=function(){a.homeTemplate="app/templates/users/home/student.html",a.assignmentFilter=a.getRequiredAssignments,a.orderProperty="dueDate.original",a.role="student",i.fetchAssignments()},i}}]);
//# sourceMappingURL=app.min.js.map
